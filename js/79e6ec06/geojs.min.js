if(typeof ogs==="undefined"){var ogs={}}ogs.namespace=function(e){"use strict";var t=e.split("."),i=ogs,n;if(t[0]==="ogs"){t=t.slice(1)}for(n=0;n<t.length;n+=1){if(typeof i[t[n]]==="undefined"){i[t[n]]={}}i=i[t[n]]}return i};var geo=ogs.namespace("geo");geo.renderers={};geo.features={};function inherit(e,t){"use strict";var i=function(){};i.prototype=t.prototype;e.prototype=new i;e.uber=t.prototype;e.prototype.constructor=e}Object.size=function(e){"use strict";var t=0,i=null;for(i in e){if(e.hasOwnProperty(i)){t++}}return t};geo.registerRenderer=function(e,t){if(geo.renderers===undefined){geo.renderers={}}geo.renderers[e]=t};geo.createRenderer=function(e,t,i){if(e in geo.renderers){var n=geo.renderers[e]({layer:t,canvas:i});n._init();return n}return null};geo.registerFeature=function(e,t,i){if(geo.features===undefined){geo.features={}}if(!(e in geo.features)){geo.features[e]={}}geo.features[e][t]=i};geo.createFeature=function(e,t,i,n){var a=i.api(),o={layer:t,renderer:i};if(a in geo.features&&e in geo.features[a]){if(n!==undefined){$.extend(true,o,n)}return geo.features[a][e](o)}return null};geo.object=function(e){"use strict";if(!(this instanceof geo.object)){return new geo.object}var t=this,i={};this.on=function(e,n){if(Array.isArray(e)){e.forEach(function(e){t.on(e,n)});return this}if(!i.hasOwnProperty(e)){i[e]=[]}i[e].push(n);return this};this.trigger=function(e,n){if(Array.isArray(e)){e.forEach(function(e){t.trigger(e,n)});return this}if(i.hasOwnProperty(e)){i[e].forEach(function(e){e(n)})}return this};this.off=function(e,n){if(Array.isArray(e)){e.forEach(function(e){t.off(e,n)});return this}if(!n){i[e]=[]}else if(Array.isArray(n)){n.forEach(function(i){t.off(e,i)});return this}if(i.hasOwnProperty(e)){i[e]=i[e].filter(function(e){return e!==n})}return this};vgl.object.call(this);return this};inherit(geo.object,vgl.object);geo.sceneObject=function(e){"use strict";if(!(this instanceof geo.sceneObject)){return new geo.sceneObject}geo.object.call(this,e);var t=this,i=null,n=[],a=this.trigger;this.parent=function(e){if(e===undefined){return i}i=e;return this};this.addChild=function(e){if(Array.isArray(e)){e.forEach(this.addChild);return this}e.parent(this);n.push(e);return this};this.removeChild=function(e){if(Array.isArray(e)){e.forEach(this.removeChild);return this}n=n.filter(function(t){return t!==e});return this};this.children=function(){return n.slice()};this.trigger=function(e,o){o=o||{};if(i&&o._triggeredBy!==i){o._triggeredBy=t;i.trigger(e,o);return this}a.call(this,e,o);n.forEach(function(i){o._triggeredBy=t;i.trigger(e,o)});return this};return this};inherit(geo.sceneObject,geo.object);geo.timestamp=function(){"use strict";if(!(this instanceof geo.timestamp)){return new geo.timestamp}vgl.timestamp.call(this)};inherit(geo.timestamp,vgl.timestamp);geo.ellipsoid=function(e,t,i){"use strict";if(!(this instanceof geo.ellipsoid)){return new geo.ellipsoid(e,t,i)}e=vgl.defaultValue(e,0);t=vgl.defaultValue(t,0);i=vgl.defaultValue(i,0);if(e<0||t<0||i<0){return console.log("[error] Al radii components must be greater than zero")}var n=new vec3.fromValues(e,t,i),a=new vec3.fromValues(e*e,t*t,i*i),o=Math.min(e,t,i),r=Math.max(e,t,i);this.radii=function(){return n};this.radiiSquared=function(){return a};this.maximumRadius=function(){return r};this.minimumRadius=function(){return o};this.computeGeodeticSurfaceNormal=function(e,t){if(typeof e==="undefined"||typeof t==="undefined"){throw"[error] Valid latitude and longitude is required"}var i=Math.cos(e),n=vec3.create();n[0]=i*Math.cos(t);n[1]=i*Math.sin(t);n[2]=Math.sin(e);vec3.normalize(n,n);return n};this.transformPoint=function(e,t,i){e=e*(Math.PI/180);t=t*(Math.PI/180);var n=this.computeGeodeticSurfaceNormal(e,t),o=vec3.create(),r=Math.sqrt(vec3.dot(n,o)),s=vec3.create();vec3.multiply(o,a,n);vec3.scale(o,o,1/r);vec3.scale(n,n,i);vec3.add(s,n,o);return s};this.transformGeometry=function(e){if(!e){throw"[error] Failed to transform to cartesian. Invalid geometry."}var t=e.sourceData(vgl.vertexAttributeKeys.Position),i=t.data(),n=t.attributeNumberOfComponents(vgl.vertexAttributeKeys.Position),o=t.attributeStride(vgl.vertexAttributeKeys.Position),r=t.attributeOffset(vgl.vertexAttributeKeys.Position),s=t.sizeOfAttributeDataType(vgl.vertexAttributeKeys.Position),l=null,u=i.length*(1/n),d=null,c=null,p=0,f=vec3.create(),m=vec3.create();o/=s;r/=s;if(n!==3){throw"[error] Requires positions with three components"}for(p=0;p<u;++p){l=p*o+r;i[l]=i[l]*(Math.PI/180);i[l+1]=i[l+1]*(Math.PI/180);c=this.computeGeodeticSurfaceNormal(i[l+1],i[l]);vec3.multiply(f,a,c);d=Math.sqrt(vec3.dot(c,f));vec3.scale(f,f,1/d);vec3.scale(c,c,i[l+2]);vec3.add(m,c,f);i[l]=m[0];i[l+1]=m[1];i[l+2]=m[2]}};return this};geo.ellipsoid.WGS84=vgl.freezeObject(geo.ellipsoid(6378137,6378137,6356752.314245179));geo.ellipsoid.UNIT_SPHERE=vgl.freezeObject(geo.ellipsoid(1,1,1));geo.mercator={r_major:6378137};geo.mercator.r_minor=function(e){var t;e=e!==undefined?e:false;if(e){t=6378137}else{t=6356752.314245179}return t};geo.mercator.f=function(e){return(geo.mercator.r_major-geo.mercator.r_minor(e))/geo.mercator.r_major};geo.mercator.long2tilex=function(e,t){"use strict";var i=(e+180)/360,n=Math.floor(i*Math.pow(2,t));return n};geo.mercator.lat2tiley=function(e,t){"use strict";var i=e*Math.PI/180;return Math.floor((1-i/Math.PI)/2*Math.pow(2,t))};geo.mercator.long2tilex2=function(e,t){"use strict";var i=(e+180)/360,n=i*Math.pow(2,t),a=Math.floor(n),o=n-a;return[a,o]};geo.mercator.lat2tiley2=function(e,t){"use strict";var i=e*Math.PI/180,n=(1-Math.log(Math.tan(i)+1/Math.cos(i))/Math.PI)/2*Math.pow(2,t),a=Math.floor(n),o=n-a;return[a,o]};geo.mercator.tilex2long=function(e,t){"use strict";return e/Math.pow(2,t)*360-180};geo.mercator.tiley2lat=function(e,t){"use strict";var i=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))};geo.mercator.y2lat=function(e){"use strict";return 180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2)};geo.mercator.lat2y=function(e){"use strict";return 180/Math.PI*Math.log(Math.tan(Math.PI/4+e*(Math.PI/180)/2))};geo.mercator.deg2rad=function(e){"use strict";var t=e*(Math.PI/180);return t};geo.mercator.rad2deg=function(e){"use strict";var t=e/(Math.PI/180);return t};geo.mercator.ll2m=function(e,t,i){"use strict";if(t>89.5){t=89.5}if(t<-89.5){t=-89.5}var n=this.r_major*this.deg2rad(e),a=this.r_minor(i)/this.r_major,o=1-a*a,r=Math.sqrt(o),s=this.deg2rad(t),l=Math.sin(s),u=r*l,d=.5*r,c=Math.pow((1-u)/(1+u),d),p=Math.tan(.5*(Math.PI*.5-s))/c,f=-this.r_major*Math.log(p),m={x:n,y:f};return m};geo.mercator.m2ll=function(e,t,i){"use strict";var n=this.rad2deg(e/this.r_major),a=this.r_minor(i)/this.r_major,o=Math.sqrt(1-a*a),r=this.rad2deg(this.pjPhi2(Math.exp(-(t/this.r_major)),o)),s={lon:n,lat:r};return s};geo.mercator.pjPhi2=function(e,t){"use strict";var i=15,n=Math.PI/2,a=1e-10,o,r,s=i,l=.5*t,u=n-2*Math.atan(e);do{o=t*Math.sin(u);r=n-2*Math.atan(e*Math.pow((1-o)/(1+o),l))-u;u+=r}while(Math.abs(r)>a&&--s);return u};geo.latlng=function(e,t){"use strict";if(!(this instanceof geo.latlng)){return new geo.latlng(e,t)}var i=t===undefined?e.lat():e,n=t===undefined?e.lng():t;this.lat=function(e){if(e===undefined){return i}else{i=e}};this.lng=function(e){if(e===undefined){return n}else{n=e}};this.x=function(e){if(e===undefined){return this.lng()}else{n=e}};this.y=function(e){if(e===undefined){return this.lat()}else{i=e}};return this};geo.layerOptions=function(){"use strict";if(!(this instanceof geo.layerOptions)){return new geo.layerOptions}this.opacity=.5;this.showAttribution=true;this.visible=true;this.binNumber=vgl.material.RenderBin.Default;return this};geo.newLayerId=function(){var e=1;return function(){var t=e;e++;return t}}();geo.layer=function(e){"use strict";if(!(this instanceof geo.layer)){return new geo.layer(e)}e=e||{};geo.sceneObject.call(this,e);var t=this,i=e.style===undefined?{opacity:.5,color:[.8,.8,.8],visible:true,bin:100}:e.style,n=e.id===undefined?geo.newLayerId():e.id,a="",o="EPSG:4326",r=[],s=e.source||null,l=e.map===undefined?null:args.map,u=false,d=0,c=0,p=0,f=0,m=null,h=null,g=null,y=false,v=e.renderer===undefined?"vglRenderer":e.renderer,b=geo.timestamp(),w=geo.timestamp(),x=geo.timestamp();this.node=function(){return m};this.id=function(e){if(e===undefined){return n}else{n=id;this.modified();return this}};this.name=function(e){if(e===undefined){return a}else{a=e;this.modified();return this}};this.opacity=function(e){if(e===undefined){return i.opacity}else{i.opacity=e;this.modified();return this}};this.visible=function(e){if(e===undefined){return i.visible}else{i.visible=e;this.modified();return this}};this.bin=function(e){if(e===undefined){return i.bin}else{i.bin=e;this.modified();return this}};this.gcs=function(e){if(e===undefined){return o}else{o=e;this.modified();return this}};this.transform=function(e){geo.transform.transformLayer(e,this,l.baseLayer());return this};this.timeRange=function(e){if(e===undefined){return timeRange}else{timeRange=e.slice(0);this.modified();return this}};this.source=function(e){if(e===undefined){return s}else{s=e;this.modified();return this}};this.map=function(e){if(e===undefined){return l}else{l=e;l.node().append(m);this.modified();return this}};this.renderer=function(){return g};this.canvas=function(){return h};this.viewport=function(){return[d,c,p,f]};this.dataTime=function(){return b};this.updateTime=function(){return w};this.drawTime=function(){return x};this.query=function(e){};this.referenceLayer=function(e){if(e!==undefined){u=e;this.modified();return this}return u};this.initialized=function(e){if(e!==undefined){y=e;return this}return y};this.toLocal=function(e){throw"Not implemented"};this.fromLocal=function(e){throw"Not implemented"};this._init=function(){if(y){return this}m=$(document.createElement("div"));m.attr("id",a);m.css("position","absolute");m.css("width","100%");m.css("height","100%");if(l){l.node().append(m)}if(h){g=geo.createRenderer(v,this,h)}else{g=geo.createRenderer(v,this);h=g.canvas()}this.addChild(g);y=true;return this};this._exit=function(){};this._update=function(e){};this._resize=function(e,t,i,n){d=e;c=t;p=i;f=n;this.modified();this.trigger(geo.event.resize,{x:e,y:t,width:p,height:f});return this};this._draw=function(){};return this};inherit(geo.layer,geo.sceneObject);geo.featureLayer=function(e){"use strict";if(!(this instanceof geo.featureLayer)){return new geo.featureLayer(e)}geo.layer.call(this,e);var t=this,i=null,n=this._init,a=this._update;this.create=function(e,n){this._init();var a=geo.createFeature(e,t,this.renderer(),n);if(!i){i=[]}i.push(a);this.features(i);this.modified();return a};this.features=function(e){return this._features(e)};this._features=function(e){var t=0;if(e===undefined){return i||[]}else{i=e.slice(0);this.dataTime().modified();this.modified()}};this._delete=function(e){var t;for(t=0;t<i.length;++t){if(i[t]===e){i[t]._exit();this.dataTime().modified();this.modified();return i.splice(t,1)}}return this};this._init=function(){if(this.initialized()){return this}n.call(this);this.on(geo.event.resize,function(e){t.renderer()._resize(e.x,e.y,e.width,e.height);t._update({});t.renderer()._render()});this.on(geo.event.pan,function(e){t._update({event:e});t.renderer()._render()});this.on(geo.event.zoom,function(e){t.map().zoom(e.curr_zoom);t._update({event:e});t.renderer()._render()});return this};this._update=function(e){var t;if(!i){return this}a.call(this,e);if(!this.source()&&i&&i.length===0){console.log("[info] No valid data source found.");return}if(this.dataTime().getMTime()>this.updateTime().getMTime()){for(t=0;t<i.length;++t){i[t].renderer(this.renderer())}}for(t=0;t<i.length;++t){i[t]._update()}this.updateTime().modified();return this};this._draw=function(){this.renderer()._render();return this};return this};inherit(geo.featureLayer,geo.layer);geo.featureCollection=function(){"use strict";if(!(this instanceof geo.featureCollection)){return new geo.featureCollection}vgl.object.call(this);var e={},t={};this.newFeatures=function(t){if(e.hasOwnProperty(t)){return e[t]}e[t]=[];return e[t]};this.setNewFeatures=function(t,i){e[t]=i;this.modified()};this.expiredFeatures=function(e){if(t.hasOwnProperty(e)){return t[e]}t[e]=[];return t[e]};this.setExpiredFeatures=function(e,i){t[e]=i;this.modified()};this.clone=function(t){if(!t){return}var i=null;for(i in e){if(e.hasOwnProperty(i)){t.setFeatures(i,e[i])}}};this.isEmpty=function(){return Object.keys(e).length===0&&Object.keys(t).length===0};this.resetAll=function(){e={};t={}}};inherit(geo.featureCollection,vgl.object);geo.layerSource=function(e,t,i){"use strict";var n=vgl.timestamp(),a=e,o=t,r=i;this.requestDataMTime=function(){return n};this.requestDataMTimeModified=function(){n.modified()};this.id=function(){return a};this.setId=function(e){if(e!==null&&a!==e){a=e;this.modified();return true}return false};this.name=function(){return o};this.setName=function(e){if(e!==null&&o!==e){o=e;this.modified();return true}return false};this.path=function(){return r};this.setPath=function(e){if(e!==null&&r!==e){r=e;this.modified();return true}return false};this.init=function(){};this.destroy=function(){};this.getData=function(e){};this.getMetaData=function(){};this.getTimeRange=function(e){};this.getSpatialRange=function(e){};this.getScalarRange=function(e){}};inherit(geo.layerSource,vgl.object);geo.archiveLayerSource=function(e,t,i,n,a,o){"use strict";if(!(this instanceof geo.archiveLayerSource)){return new geo.archiveLayerSource(e,t,i,n,a,o)}geo.layerSource.call(this,e,t,i);var r=n,s=a,l=-1,u=null,d=function(e){};if(o){d=o}this.variableNames=function(){return s};this.resultCache=function(){return u};this.p_setResultCache=function(e){u=e};this.destroy=function(){u=null};this.getData=function(e,i){if(l===e){console.log("[info] No new data as timestamp has not changed.");return u}l=e;var n=false,o=[],r=null,s=null;if(i){n=true}$.ajax({type:"POST",url:"/services/data/read",data:{expr:JSON.stringify(t),vars:JSON.stringify(a),time:JSON.stringify(e)},dataType:"json",async:n,success:function(e){if(e.error!==null){r="[error] "+e.error?e.error:"no results returned from server";console.log(r);d(r)}else{s=vgl.geojsonReader();o=s.readGJObject(jQuery.parseJSON(e.result.data[0]))}},error:function(e,i,n){r="Error reading "+t+": "+n;console.log(r);d(r)}});if(i){i(o)}u=o;return o};this.getMetaData=function(e){};this.getTimeRange=function(e){var t=[],i=false,n=null;if(e){i=true}$.ajax({type:"POST",url:"/services/data/query",data:{expr:this.path(),vars:s[0],fields:["timerange"]},dataType:"json",async:i,success:function(e){if(e.error!==null){n="[error] "+e.error?e.error:"no results returned from server";console.log(n);d(n)}else{return null}},error:function(e,t,i){n="Error reading timerange for "+this.path()+": "+i;console.log(n);d(n)}})};this.getSpatialRange=function(e){return[0,0]};this.getScalarRange=function(e){var t=null,i={basename:this.path()},n=null,a,o;$.ajax({type:"POST",url:"/services/mongo/"+r.server+"/"+r.database+"/"+r.collection,data:{query:JSON.stringify(i),fields:JSON.stringify(["name","basename","timeInfo","variables"])},dataType:"json",async:false,success:function(i){if(i.error!==null){o="[error] "+i.error?i.error:"no results returned from server";console.log(o);d(o)}n=i.result.data[0];for(a=0;a<n.variables.length;++a){if(n.variables[a].name===e){t=n.variables[a].range;break}}},error:function(e,t,i){o="Error reading timerange for "+this.path()+": "+i;console.log(o);d(o)}});return t};this.init();return this};inherit(geo.archiveLayerSource,geo.layerSource);geo.event=function(){"use strict";if(!(this instanceof geo.event)){return new geo.event}vgl.event.call(this);return this};inherit(geo.event,vgl.event);geo.event.update="geo.update";geo.event.opacityUpdate="geo.opacityUpdate";geo.event.layerAdd="geo.layerAdd";geo.event.layerRemove="geo.layerRemove";geo.event.layerToggle="geo.layerToggle";geo.event.layerSelect="geo.layerSelect";geo.event.layerUnselect="geo.layerUnselect";geo.event.zoom="geo.zoom";geo.event.center="geo.center";geo.event.pan="geo.pan";geo.event.rotate="geo.rotate";geo.event.resize="geo.resize";geo.event.animate="geo.animate";geo.event.query="geo.query";geo.event.draw="geo.draw";geo.event.drawEnd="geo.drawEnd";geo.time={};geo.time.incrementTime=function(e,t,i){"use strict";if(t==="days"){e.setDate(e.getDate()+i)}else if(t==="months"){e.setMonth(e.getMonth()+i)}else if(t==="years"){e.setYear(e.getYear()+i)}return e};geo.map=function(e){"use strict";if(!(this instanceof geo.map)){return new geo.map(e)}e=e||{};geo.sceneObject.call(this,e);e.layers=e.layers===undefined?[]:e.layers;var t=this,i=0,n=0,a=0,o=0,r=$(e.node),s=e.gcs===undefined?"EPSG:4326":e.gcs,l=e.uigcs===undefined?"EPSG:4326":e.uigcs,u=e.center===undefined?[0,0]:e.center,d=e.zoom===undefined?10:e.zoom,c=null,p=geo.timestamp(),f=geo.timestamp();this.gcs=function(e){if(e===undefined){return s}s=e;return this};this.uigcs=function(){return l};this.node=function(){return r};this.zoom=function(e){if(e===undefined){return d}else{d=e;this.modified();return t}};this.center=function(e){if(e===undefined){return u}else{u=e.slice;this.modified();return t}};this.addLayer=function(e){if(e!==null||e!==undefined){e.map(this);e._init();e._resize(i,n,a,o);if(e.referenceLayer()||this.children().length===0){this.baseLayer(e)}this.addChild(e);this.modified();t.trigger(geo.event.layerAdd,{type:geo.event.layerAdd,target:t,layer:e})}return this};this.removeLayer=function(e){var i;if(e!==null&&e!==undefined){e._exit();this.removeChild(e);this.modified();t.trigger(geo.event.layerRemove,{type:geo.event.layerRemove,target:t,layer:e})}return this};this.toggle=function(e){if(e!==null&&e!==undefined){e.visible(!e.visible());t.modified();t.trigger(geo.event.layerToggle,{type:geo.event.layerToggle,target:t,layer:e})}return this};this.resize=function(e,r,s,l){var u=0,d=this.children();i=e;n=r;a=s;o=l;for(;u<d.length;++u){d[u]._resize(e,r,s,l)}t.trigger(geo.event.resize,{type:geo.event.resize,target:t,x:i,y:n,width:s,height:l});this.modified()};this.gcsToDisplay=function(e){var t,i,n=[];if(e instanceof Array&&e.length>0){if(e[0]instanceof geo.latlng){for(t=0;t<e.length;++t){i=c.toLocal(e)[0];n.push(c.renderer().worldToDisplay({x:i.x(),y:i.y()})[0])}}else{n=c.renderer().worldToDisplay(e).slice(0)}}else if(e instanceof geo.latlng){i=c.toLocal(e)[0];n.push(c.renderer().worldToDisplay({x:i.x(),y:i.y()})[0])}else if(e instanceof Object){n.push(c.renderer().worldToDisplay({x:e.x,y:e.y})[0])}else{throw"Conversion method latLonToDisplay does not handle "+e}return n};this.displayToGcs=function(e){var t;if(e instanceof Array&&e.length>0||e instanceof Object){t=c.renderer().displayToWorld(e);t=c.fromLocal(t)}else{throw"Conversion method latLonToDisplay does not handle "+e}return t};this.query=function(e){};this.baseLayer=function(e){if(typeof e!=="undefined"){if(s!==e.gcs()){this.gcs(e.gcs())}c=e;c.referenceLayer(true);return this}return c};this.interactorStyle=function(e){if(e===undefined){return m_interactorStyle}else{m_interactorStyle=e;this.modified()}return m_interactorStyle};this.draw=function(){var e=0,i=this.children();t.trigger(geo.event.draw,{type:geo.event.draw,target:t});this._update();for(e=0;e<i.length;++e){i[e]._draw()}t.trigger(geo.event.drawEnd,{type:geo.event.drawEnd,target:t})};this._init=function(e){var t;if(r===undefined||r===null){throw"Map require DIV node"}if(e!==undefined&&e.layers!==undefined){for(t=0;t<e.layers.length;++t){if(t===0){this.baseLayer(e.layers[t])}this.addLayer(e.layers[t])}}};this._update=function(){var e=0,t=this.children();for(e=0;e<t.length;++e){t[e]._update()}};this._exit=function(){var e=0,t=this.children();for(e=0;e<t.length;++e){t[e]._exit()}};this._init(e);return this};inherit(geo.map,geo.sceneObject);geo.feature=function(e){"use strict";if(!(this instanceof geo.feature)){return new geo.feature(e)}geo.object.call(this);e=e||{};var t={},i=e.layer===undefined?null:e.layer,n=e.gcs===undefined?"EPSG:4326":e.gcs,a=e.visible===undefined?true:e.visible,o=e.bin===undefined?0:e.bin,r=e.renderer===undefined?null:e.renderer,s=geo.timestamp(),l=geo.timestamp(),u=geo.timestamp();this.style=function(e,i){if(e===undefined){return t}else if(i===undefined){t=$.extend({},t,e);this.modified();return this}else{t[e]=i;this.modified();return this}};this.layer=function(){return i};this.renderer=function(){return r};this.drawables=function(){return this._drawables()};this.gcs=function(e){if(e===undefined){return n}else{n=e;this.modified();return this}};this.visible=function(e){if(e===undefined){return a}else{a=e;this.modified();return this}};this.bin=function(e){if(e===undefined){return o}else{o=e;this.modified();return this}};this.dataTime=function(e){if(e===undefined){return s}else{s=e;this.modified();return this}};this.buildTime=function(e){if(e===undefined){return l}else{l=e;this.modified();return this}};this.updateTime=function(e){if(e===undefined){return u}else{u=e;this.modified();return this}};this._init=function(e){if(!i){throw"Feature requires a valid layer"}t=$.extend({},{opacity:1},e.style===undefined?{}:e.style)};this._build=function(){};this._drawables=function(){};this._update=function(){};this._exit=function(){};this._init(e);return this};inherit(geo.feature,geo.object);geo.pointFeature=function(e){"use strict";if(!(this instanceof geo.pointFeature)){return new geo.pointFeature(e)}e=e||{};geo.feature.call(this,e);var t=e.positions===undefined?null:e.positions,i=this._init;this.positions=function(e){if(e===undefined){return t}else{t=e.slice(0);this.dataTime().modified();this.modified();return this}};this._init=function(e){i.call(this,e);var n=$.extend({},{size:1,width:1,height:1,color:[1,1,1],point_sprites:false,point_sprites_image:null},e.style===undefined?{}:e.style);this.style(n);if(t){this.dataTime().modified()}};this._init(e);return this};inherit(geo.pointFeature,geo.feature);geo.lineFeature=function(e){"use strict";if(!(this instanceof geo.lineFeature)){return new geo.lineFeature(e)}e=e||{};geo.feature.call(this,e);var t=e.positions===undefined?[]:e.positions,i=this._init;this.positions=function(e){if(e===undefined){return t}else{t=e.slice(0);this.dataTime().modified();this.modified();return this}};this._init=function(e){i.call(this,e);var n=$.extend({},{width:[1],color:[1,1,1],pattern:"solid"},e.style===undefined?{}:e.style);this.style(n);if(t){this.dataTime().modified()}};this._init(e);return this};inherit(geo.lineFeature,geo.feature);geo.polygonFeature=function(e){"use strict";if(!(this instanceof geo.polygonFeature)){return new geo.polygonFeature(e)}e=e||{};geo.feature.call(this,e);var t=this._init;this._init=function(e){t.call(this,e);var i=$.extend({},{color:[1,1,1],fill_color:[1,1,1],fill:true},e.style===undefined?{}:e.style);this.style(i)};this._init(e);return this};inherit(geo.polygonFeature,geo.feature);geo.planeFeature=function(e){"use strict";if(!(this instanceof geo.planeFeature)){return new geo.planeFeature(e)}e=e||{};e.ul=e.ul===undefined?[0,1,0]:e.ul;e.lr=e.lr===undefined?[1,0,0]:e.lr;e.depth=e.depth===undefined?0:e.depth;geo.polygonFeature.call(this,e);var t=[e.ul.x,e.lr.y,e.depth],i=[e.ul.x,e.ul.y,e.depth],n=[e.lr.x,e.lr.y,e.depth],a=e.depth,o=e.drawOnAsyncResourceLoad===undefined?true:false,r=this._init;this.origin=function(e){if(e===undefined){return t}else if(e instanceof Array){if(e.length>3||e.length<2){throw"Upper left point requires point in 2 or 3 dimension"}t=e.slice(0);if(t.length===2){t[2]=a}}else if(e instanceof geo.latlng){t=[e.x(),e.y(),a]}this.dataTime().modified();this.modified();return this};this.upperLeft=function(e){if(e===undefined){return i}else if(e instanceof Array){if(e.length>3||e.length<2){throw"Upper left point requires point in 2 or 3 dimension"}i=e.slice(0);if(i.length===2){i[2]=a}}else if(e instanceof geo.latlng){i=[e.x(),e.y(),a]}this.dataTime().modified();this.modified();return this};this.lowerRight=function(e){if(e===undefined){return n}else if(e instanceof Array){if(e.length>3||e.length<2){throw"Upper left point requires point in 2 or 3 dimension"}n=e.slice(0);if(n.length===2){n[2]=a}this.dataTime().modified()}else if(e instanceof geo.latlng){n=[e.x(),e.y(),a]}this.dataTime().modified();this.modified();return this};this.drawOnAsyncResourceLoad=function(e){if(e===undefined){return o}else{o=e;return this}};this._init=function(e){var t=null;r.call(this,e);t=this.style();if(t.image===undefined){t.image=null}this.style(t)};this._init(e);return this};inherit(geo.planeFeature,geo.polygonFeature);geo.geomFeature=function(e){"use strict";if(!(this instanceof geo.geomFeature)){return new geo.geomFeature(e)}e=e||{};geo.feature.call(this,e);e.style=e.style===undefined?$.extend({},{color:[1,1,1],point_sprites:false,point_sprites_image:none},e.style):e.style;this.style(e.style);return this};inherit(geo.geomFeature,geo.feature);geo.graphFeature=function(e){"use strict";if(!(this instanceof geo.graphFeature)){return new geo.graphFeature(e)}e=e||{};geo.feature.call(this,e);var t=this,i=this.style,n=null,a=null,o=[],r=this._init;this._init=function(e){r.call(this,e);var t=$.extend(true,{},{nodes:{size:5,color:[0,0,1]},lines:{color:[1,1,1]}},e.style===undefined?{}:e.style);this.style(t);if(n){this.dataTime().modified()}};this.style=function(e){var t=i.call(this,e);if(t!==this){return t}a.style(e.nodes);o.forEach(function(t){t.style(e.lines)});return this};this.nodes=function(e){var i=t.layer(),r=0;if(e===undefined){return n}n=e.slice(0);a.positions(n);n.forEach(function(e){(e.children||[]).forEach(function(n){r++;if(o.length<r){o.push(i.create("lineFeature").style(t.style().lines))}o[r-1].positions([e,n])})});o.splice(r,o.length-r).forEach(function(e){i._delete(e)});this.dataTime().modified();this.modified();return this};a=this.layer().create("pointFeature");if(e.nodes){this.nodes(e.nodes)}this._init(e);return this};inherit(geo.graphFeature,geo.feature);geo.transform={};geo.transform.osmTransformFeature=function(e,t,i){"use strict";if(!t){console.log("[warning] Invalid (null) feature");return}if(t.gcs()===e){return}if(!(t instanceof geo.pointFeature||t instanceof geo.lineFeature)){throw"Supports only point or line feature"}var n=null,a=0,o=null,r=null,s=null,l=t.gcs(),u,i=i||false,d=new proj4.Proj(l),c=new proj4.Proj(e),p,f;if(t instanceof geo.pointFeature||t instanceof geo.lineFeature){if(l!=="EPSG:4326"){geo.transform.transformFeature("EPSG:4326",t,true)}r=t.positions();o=r.length;if(!(r instanceof Array)){throw"Supports Array of 2D and 3D points"}if(r.length>0&&r[0]instanceof geo.latlng){n=2;a=1}else{n=o%2===0?2:o%3===0?3:null;a=n}if(n!==2&&n!==3){throw"Transform points require points in 2D or 3D"}for(u=0;u<o;u+=a){if(i){s=r}else{s=r.slice(0)}if(r[u]instanceof geo.latlng){f=r[u].lat()}else{f=r[u+1]}if(f>85.0511){f=85.0511}if(f<-85.0511){f=-85.0511}if(r[u]instanceof geo.latlng){s[u]=geo.latlng(geo.mercator.lat2y(f),s[u].lng())}else{s[u+1]=geo.mercator.lat2y(f)}}t.positions(s);t.gcs(e);return s}return null};geo.transform.transformFeature=function(e,t,i){"use strict";if(!t){console.log("[warning] Invalid (null) feature");return}if(t.gcs()===e){return}if(!(t instanceof geo.pointFeature||t instanceof geo.lineFeature)){throw"Supports only point or line feature"}var n=null,a=0,o=null,r=null,s=null,l=null,u=t.gcs(),d,i=i||false,c=new proj4.Proj(u),p=new proj4.Proj(e);if(t instanceof geo.pointFeature||t instanceof geo.lineFeature){r=t.positions();o=r.length;if(!(r instanceof Array)){throw"Supports Array of 2D and 3D points"}if(r.length>0&&r[0]instanceof geo.latlng){n=2;a=1}else{n=o%2===0?2:o%3===0?3:null;a=n}if(n!==2&&n!==3){throw"Transform points require points in 2D or 3D"}for(d=0;d<o;d+=a){if(n===2){l=new proj4.Point(r[d],r[d+1],0)}else{l=new proj4.Point(r[d],r[d+1],r[d+2])}proj4.transform(c,projDestGcs,l);if(i){s=r}else{s=[];s.length=r.length}if(n===2){s[d]=l.x;s[d+1]=l.y}else{s[d]=l.x;s[d+1]=l.y;s[d+2]=l.z}}t.positions(s);t.gcs(e);return s}return null};geo.transform.transformLayer=function(e,t,i){"use strict";var n,a,o;if(!t){throw"Requires valid layer for tranformation"}if(!i){throw"Requires baseLayer used by the map"}if(t===i){return}if(t instanceof geo.featureLayer){n=t.features();a=n.length;o=0;for(o=0;o<a;++o){if(e==="EPSG:3857"&&i instanceof geo.osmLayer){geo.transform.osmTransformFeature(e,n[o],true)}else{geo.transform.transformFeature(e,n[o],true)}}t.gcs(e)}else{throw"Only feature layer transformation is supported"}};geo.renderer=function(e){"use strict";if(!(this instanceof geo.renderer)){return new geo.renderer(e)}geo.sceneObject.call(this);e=e||{};var t=this,i=e.layer===undefined?null:e.layer,n=e.canvas===undefined?null:e.canvas,a=false;this.layer=function(){return i};this.canvas=function(e){if(e===undefined){return n}else{n=e;this.modified()}};this.initialized=function(e){if(e===undefined){return a}else{a=e;return this}};this.api=function(){throw"Should be implemented by derivied classes"};this.worldToGcs=function(e){throw"Should be implemented by derivied classes"};this.displayToGcs=function(e){throw"Should be implemented by derivied classes"};this.gcsToDisplay=function(e){throw"Should be implemented by derivied classes"};this.worldToDisplay=function(e){throw"Should be implemented by derivied classes"};this.displayToWorld=function(e){throw"Should be implemented by derivied classes"};this.relMouseCoords=function(e){var t=0,i=0,n=0,a=0,o=this.canvas();do{t+=o.offsetLeft-o.scrollLeft;i+=o.offsetTop-o.scrollTop}while(o=o.offsetParent);n=e.pageX-t;a=e.pageY-i;return{x:n,y:a}};this._init=function(){};this._resize=function(e,t,i,n){};this._render=function(){};this._exit=function(){};this._connectMouseEvents=function(){};return this};inherit(geo.renderer,geo.sceneObject);geo.osmLayer=function(e){"use strict";if(!(this instanceof geo.osmLayer)){return new geo.osmLayer(e)}geo.featureLayer.call(this,e);var t=this,i=0,n=1,a=2,o=3,r=n,s={},l=0,u=1e3,d=[],c=[],p=0,f=100,m=null,h=this._init,g=this._update;this.tileCacheSize=function(e){if(e===undefined){return f}f=e;this.modified()};this.toLocal=function(e){var t,i=[];if(e instanceof Array&&e.length>0){i.length=e.length;if(e[0]instanceof geo.latlng){for(t=0;t<e.length;++t){i[t]=geo.latlng(e[t]);i[t].lat(geo.mercator.lat2y(i[t].lat()))}}else{i=m_baseLayer.renderer().worldToDisplay(e).slice(0)}}else if(e instanceof geo.latlng){i.push(geo.latlng(e));i[0].lat(geo.mercator.lat2y(i[0].lat()))}else{throw"toLocal does not handle "+e}return i};this.fromLocal=function(e){var t,i=[];if(e instanceof Array&&e.length>0){i.length=e.length;if(e[0]instanceof Object){for(t=0;t<e.length;++t){i[t]={};i[t].x=e[t].x;i[t].y=geo.mercator.y2lat(e[t].y)}}else{for(t=0;t<e.length;++t){i[t]=e[t];i[t+1]=geo.mercator.y2lat(e[t+1])}}}else{throw"fromLocal does not handle "+e}return i};this._hasTile=function(e,t,i){if(!s[e]){return false}if(!s[e][t]){return false}if(!s[e][t][i]){return false}return true};this._addTile=function(e,t,i,n){if(!s[t]){s[t]={}}if(!s[t][i]){s[t][i]={}}if(s[t][i][n]){return}var a=Math.max(1,Math.pow(2,t)),o=Math.max(1,Math.pow(2,t)),r=360,l=360/a,u=r/o,c=-180+i*l,f=-r*.5+n*u,m=-180+(i+1)*l,h=-r*.5+(n+1)*u,g=null,y=new Image;y.LOADING=true;y.LOADED=false;y.REMOVED=false;y.REMOVING=false;y.crossOrigin="anonymous";y.zoom=t;y.index_x=i;y.index_y=n;y.llx=c;y.lly=f;y.urx=m;y.ury=h;y.lastused=new Date;y.src="http://otile1.mqcdn.com/tiles/1.0.0/osm/"+t+"/"+i+"/"+(Math.pow(2,t)-1-n)+".jpg";s[t][i][n]=y;d.push(y);++p;return y};this._removeTiles=function(e){var i,n,a,o,r,d=this.map().zoom();if(!s){return this}if(m===d){return this}m=d;for(r in s){if(d===r){continue}for(n in s[r]){for(a in s[r][n]){o=s[r][n][a];if(o){o.REMOVING=true;c.push(o)}}}}setTimeout(function(){var e,i;c.sort(function(e,t){return e.lastused-t.lastused});i=0;while(p>f&&i<c.length){e=c[i];if(e.zoom!==t.map().zoom()){t._delete(e.feature);delete s[e.zoom][e.index_x][e.index_y];c.splice(i,1);--p}++i}for(i=0;i<c.length;++i){e=c[i];if(e.zoom!==t.map().zoom()){e.REMOVING=false;e.REMOVED=true;e.feature.bin(l)}else{e.REMOVING=false;e.REMOVED=false;e.lastused=new Date;e.feature.bin(u)}e.feature._update()
}c=[];t._draw()},100);return this};this._addTiles=function(e){var i,n=this.renderer(),a=this.node(),o=this.map().zoom(),r=0,c=a.height(),p=a.width(),f=0,m=null,h=null,g=null,y=null,v=null,b=null,w=null,x=0,M=0,S=n.displayToWorld([r,c])[0],k=n.displayToWorld([p,f])[0];S[0]=Math.max(S[0],-180);S[0]=Math.min(S[0],180);S[1]=Math.max(S[1],-180);S[1]=Math.min(S[1],180);k[0]=Math.max(k[0],-180);k[0]=Math.min(k[0],180);k[1]=Math.max(k[1],-180);k[1]=Math.min(k[1],180);g=geo.mercator.long2tilex(S[0],o);y=geo.mercator.lat2tiley(S[1],o);v=geo.mercator.long2tilex(k[0],o);b=geo.mercator.lat2tiley(k[1],o);g=Math.max(g,0);g=Math.min(Math.pow(2,o)-1,g);y=Math.max(y,0);y=Math.min(Math.pow(2,o)-1,y);v=Math.max(v,0);v=Math.min(Math.pow(2,o)-1,v);b=Math.max(b,0);b=Math.min(Math.pow(2,o)-1,b);if(g>v){m=g;g=v;v=m}if(b>y){m=y;g=b;b=m}for(x=g;x<=v;++x){for(M=b;M<=y;++M){w=Math.pow(2,o)-1-M;if(!t._hasTile(o,x,w)){t._addTile(e,o,x,w)}else{h=s[o][x][w];h.feature.bin(u);h.lastused=new Date;h.feature._update()}}}for(x=0;x<d.length;++x){h=d[x];h.onload=function(){this.LOADING=false;this.LOADED=true;if((h.REMOVING||this.REMOVED)&&this.feature&&h.zoom!==t.map().zoom()){this.feature.bin(l);this.REMOVING=false;this.REMOVED=true}else{this.REMOVED=false;this.lastused=new Date;this.feature.bin(u)}this.feature._update();t._draw()};i=this.create("planeFeature",{drawOnAsyncResourceLoad:false}).origin([h.llx,h.lly]).upperLeft([h.llx,h.ury]).lowerRight([h.urx,h.lly]).gcs('"EPSG:3857"').style("image",h);h.feature=i}d=[]};this._updateTiles=function(e){var i=t.map().zoom();this._addTiles(e);t._removeTiles(e);t._draw();this.updateTime().modified();return this};this._init=function(){h.call(this);this.gcs("EPSG:3857");return this};this._update=function(e){this._updateTiles(e);g.call(this,e)};return this};inherit(geo.osmLayer,geo.featureLayer);ggl=ogs.namespace("geo.gl");ggl.renderer=function(e){"use strict";if(!(this instanceof ggl.renderer)){return new ggl.renderer(e)}geo.renderer.call(this,e);var t=this;this.contextRenderer=function(){throw"Should be implemented by derived classes"};return this};inherit(ggl.renderer,geo.renderer);geo.registerRenderer("vglRenderer",ggl.vglRenderer);ggl.pointFeature=function(e){"use strict";if(!(this instanceof ggl.pointFeature)){return new ggl.pointFeature(e)}e=e||{};geo.pointFeature.call(this,e);var t=this,i=null,n=vgl.timestamp(),a=this._init,o=this._update;this._init=function(e){a.call(this,e)};this._build=function(){var e=t.style();if(i){this.renderer().contextRenderer().removeActor(i)}if(e.point_sprites===true){if(!e.point_sprites_image==null){throw"[error] Invalid image for point sprites"}i=vgl.utils.createPointSprites(e.point_sprites_image,this.positions(),e.colors)}else{i=vgl.utils.createPoints(this.positions(),e.colors)}this.renderer().contextRenderer().addActor(i);this.buildTime().modified()};this._update=function(){var e=t.style();o.call(this);if(this.dataTime().getMTime()>=this.buildTime().getMTime()){this._build()}if(this.updateTime().getMTime()<=this.getMTime()){if(this.style.color instanceof vgl.lookupTable){vgl.utils.updateColorMappedMaterial(this.material(),this.style.color)}if(e.point_sprites===true){if(!e.point_sprites_image==null){throw"[error] Invalid image for point sprites"}if(e.width&&e.height){i.material().shaderProgram().uniform("pointSize").set([e.width,e.height])}else if(e.size){i.material().shaderProgram().uniform("pointSize").set([e.size,e.size])}}else{if(e.size){i.material().shaderProgram().uniform("pointSize").set(e.size)}}}this.updateTime().modified()};this._init(e);return this};inherit(ggl.pointFeature,geo.pointFeature);geo.registerFeature("vgl","pointFeature",ggl.pointFeature);ggl.geomFeature=function(e){"use strict";if(!(this instanceof ggl.geomFeature)){return new ggl.geomFeature(e)}e=e||{};geo.geomFeature.call(this,e);var t=this.style(),i=args.geom||null,n=vgl.actor(),a=vgl.mapper(),o=null,r=null,s=e.color||[1,1,1],l=null;this._build=function(){if(i!==null){r=i.sourceData(vgl.vertexAttributeKeys.Scalar),s=i.sourceData(vgl.vertexAttributeKeys.Color);a.setGeometryData(i)}this.setMapper(a);if(style.point_sprites!==undefined&&style.point_sprites&&style.point_sprites_image!==undefined&&style.point_sprites_image!==null&&m_noOfPrimitives===1&&i.primitive(0).primitiveType()===gl.POINTS){o=vgl.utils.createPointSpritesMaterial(style.point_sprites_image)}else if(r){if(s instanceof vgl.lookupTable){s.updateRange(r.scalarRange());o=vgl.utils.createColorMappedMaterial(s)}else{s=vgl.lookupTable();s.updateRange(r.scalarRange());o=vgl.utils.createColorMappedMaterial(s)}}else if(s){o=vgl.utils.createColorMaterial()}else{o=vgl.utils.createSolidColorMaterial()}n.setMaterial(o)};this._update=function(){if(l&&l.getMTime()<this.getMTime()){if(s instanceof vgl.lookupTable){vgl.utils.updateColorMappedMaterial(this.material(),this.style.color)}else{}}else{l=vgl.timestamp();l.modified()}};this.geometry=function(e){if(e===undefined){return i}else{i=e;this.modified();return this}};return this};inherit(ggl.geomFeature,geo.geomFeature);ggl.pointFeature=function(e){"use strict";if(!(this instanceof ggl.pointFeature)){return new ggl.pointFeature(e)}e=e||{};geo.pointFeature.call(this,e);var t=this,i=null,n=vgl.timestamp(),a=this._init,o=this._update;this._init=function(e){a.call(this,e)};this._build=function(){var e=t.style();if(i){this.renderer().contextRenderer().removeActor(i)}if(e.point_sprites===true){if(!e.point_sprites_image==null){throw"[error] Invalid image for point sprites"}i=vgl.utils.createPointSprites(e.point_sprites_image,this.positions(),e.colors)}else{i=vgl.utils.createPoints(this.positions(),e.colors)}this.renderer().contextRenderer().addActor(i);this.buildTime().modified()};this._update=function(){var e=t.style();o.call(this);if(this.dataTime().getMTime()>=this.buildTime().getMTime()){this._build()}if(this.updateTime().getMTime()<=this.getMTime()){if(this.style.color instanceof vgl.lookupTable){vgl.utils.updateColorMappedMaterial(this.material(),this.style.color)}if(e.point_sprites===true){if(!e.point_sprites_image==null){throw"[error] Invalid image for point sprites"}if(e.width&&e.height){i.material().shaderProgram().uniform("pointSize").set([e.width,e.height])}else if(e.size){i.material().shaderProgram().uniform("pointSize").set([e.size,e.size])}}else{if(e.size){i.material().shaderProgram().uniform("pointSize").set(e.size)}}}this.updateTime().modified()};this._init(e);return this};inherit(ggl.pointFeature,geo.pointFeature);geo.registerFeature("vgl","pointFeature",ggl.pointFeature);ggl.planeFeature=function(e){"use strict";if(!(this instanceof ggl.planeFeature)){return new ggl.planeFeature(e)}geo.planeFeature.call(this,e);var t=this,i=null;this.coords=function(){return[this.origin(),this.upperLeft(),this.lowerRight()]};this._build=function(){var e=this.origin(),n=this.upperLeft(),a=this.lowerRight(),o=this.style().image,r=null,s=null,l=null;if(i){this.renderer().contextRenderer().removeActor(i)}if(o&&o instanceof Image){r=o;s=o.onload}else if(o){r=new Image;r.src=o}if(!r){i=vgl.utils.createPlane(e[0],e[1],e[2],n[0],n[1],n[2],a[0],a[1],a[2])}else{i=vgl.utils.createTexturePlane(e[0],e[1],e[2],a[0],a[1],a[2],n[0],n[1],n[2],true);l=vgl.texture();t.visible(false);r.onload=function(){l.setImage(r);i.material().addAttribute(l);t.visible(true);if(s){s.call(this)}if(t.drawOnAsyncResourceLoad()){t._update();t.layer()._draw()}}}t.renderer().contextRenderer().addActor(i);this.buildTime().modified()};this._update=function(){if(this.buildTime().getMTime()<=this.dataTime().getMTime()){this._build()}if(this.updateTime().getMTime()<=this.getMTime()){i.setVisible(this.visible());i.material().setBinNumber(this.bin())}this.updateTime().modified()};this._exit=function(){t.renderer().contextRenderer().removeActor(i)};return this};inherit(ggl.planeFeature,geo.planeFeature);geo.registerFeature("vgl","planeFeature",ggl.planeFeature);ggl.mapInteractorStyle=function(){"use strict";if(!(this instanceof ggl.mapInteractorStyle)){return new ggl.mapInteractorStyle}vgl.interactorStyle.call(this);var e,t=this,i=3,n=false,a=false,o=false,r=false,s=false,l,u,d,c,p,f,m,h,g,y,v,b,w,x,M,S,k,C={x:0,y:0},T=new vgl.picker,I=vgl.timestamp();this.map=function(i){if(typeof i!=="undefined"){e=i;return t}return e};this.drawRegionMode=function(i){if(typeof i!=="undefined"){s=i;if(l){l.setVisible(i)}e.draw();return t}return s};this.handleMouseMove=function(i){var r=t.map(),l=null,d=null,k=null,T,I,_,P,F,O,D,E;t.m_updateRenderParams();t._computeCurrentMousePos(i);if(h===true){return true}if(n){if(s){T=e.displayToMap(g.x,g.y);t.setDrawRegion(u.lat(),u.lng(),T.y,T.x)}else{y=f.focusDisplayPoint();v=f.displayToWorld(g.x,g.y,y);b=f.displayToWorld(C.x,C.y,y);w=v[0]-b[0];x=v[1]-b[1];M=v[2]-b[2];_=m.position();m.pan(-w,-x,-M);P=m.position();O={type:geo.event.pan,last_display_pos:C,curr_display_pos:g,last_world_pos:_,curr_world_pos:P};$(t).trigger(O)}}if(o){}if(a&&c>0){S=2*(g.y-C.y)/c;if(S>0){m.zoom(1-Math.abs(S))}else{m.zoom(1+Math.abs(S))}p.resetCameraClippingRange();p.render()}C.x=g.x;C.y=g.y;return false};this.handleMouseDown=function(i){var r=t.map(),l,d;t.m_updateRenderParams();if(i.button===0){n=true}if(i.button===1){o=true}if(i.button===2){a=true}k=t.viewer().relMouseCoords(i);if(k.x<0){C.x=0}else{C.x=k.x}if(k.y<0){C.y=0}else{C.y=k.y}if(s&&n){l=e.displayToMap(C.x,C.y);u=geo.latlng(l.y,l.x);t.setDrawRegion(l.y,l.x,l.y,l.x)}return false};this.handleMouseUp=function(e){var i=t.map(),s=null,l=null,u=null;t.m_updateRenderParams();if(e.button===0){n=false;s=t.viewer().renderWindow().windowSize()[0];l=t.viewer().renderWindow().windowSize()[1];p=t.viewer().renderWindow().activeRenderer();if(C.x>=0&&C.x<=s&&C.y>=0&&C.y<=l){u=T.pick(C.x,C.y,p)}}if(e.button===1){o=false}if(e.button===2){a=false;r=false;t.zoom()}return false};this.handleMouseOut=function(e){t.m_updateRenderParams();if(n){n=false}else if(o){o=false}if(a){a=false;r=false;t.zoom()}return false};this.handleMouseWheel=function(e){t.m_updateRenderParams();var i=e.originalEvent.wheelDelta/120;i=Math.pow(1+Math.abs(i)/2,i>0?1:-1);t._computeCurrentMousePos(e);t.zoom(i);return false};this.zoom=function(e){var i,n,a;t.m_updateRenderParams();S=(g.y-C.y)/c;v=f.displayToWorld(0,0,y);b=f.displayToWorld(d,c,y);i=(b[0]-v[0])/d;if(e===undefined){if(S>0){m.zoom(1-Math.abs(S))}else{m.zoom(1+Math.abs(S))}}else{m.zoom(e)}p.resetCameraClippingRange();v=f.displayToWorld(0,0,y);b=f.displayToWorld(d,c,y);n=(b[0]-v[0])/d;a={type:geo.event.zoom,curr_zoom:_(n),last_zoom:_(i)};$(t).trigger(a)};this.lastMousePosition=function(e){if(typeof e!=="undefined"){C=e;return t}return C};this.leftMouseDown=function(e){if(typeof e!=="undefined"){n=e;return t}return n};this.setDrawRegion=function(i,n,a,o){var r,s=geo.planeFeature(geo.latlng(i,n),geo.latlng(a,o),99);e.removeLayer(l);l=geo.featureLayer({opacity:.5,showAttribution:1},s);e.addLayer(l);r=jQuery.Event(geo.event.updateDrawRegionEvent);$(t).trigger(geo.command.updateDrawRegionEvent,r);return t};this.getDrawRegion=function(){return l.features()[0].getCoords()};this._computeCurrentMousePos=function(e){t.m_updateRenderParams();h=false;k=t.viewer().relMouseCoords(e);g={x:0,y:0};if(k.x<0||k.x>d){g.x=0;h=true}else{g.x=k.x}if(k.y<0||k.y>c){g.y=0;h=true}else{g.y=k.y}};this.m_updateRenderParams=function(){if(I.getMTime()>t.getMTime()){return}f=t.viewer().renderWindow();d=f.windowSize()[0];c=f.windowSize()[1];p=t.viewer().renderWindow().activeRenderer();m=p.camera();I.modified()};function _(e){var t,i,n=156412;i=geo.mercator.deg2rad(Math.abs(e))*geo.mercator.r_major;for(t=4;t<20;++t){if(i>n/Math.pow(2,t)){return t-1}}}return this};inherit(ggl.mapInteractorStyle,vgl.interactorStyle);ggl.vglRenderer=function(e){"use strict";if(!(this instanceof ggl.vglRenderer)){return new ggl.vglRenderer(e)}ggl.renderer.call(this,e);var t=this,i=null,n=ggl.mapInteractorStyle(),a=this._init;this.displayToWorld=function(e){var t,i,n=this.canvas(),a=this.contextRenderer(),o=a.camera(),r=a.focusDisplayPoint(),s=[],l,u;if(e instanceof Array&&e.length>0){if(e[0]instanceof Object){i=1;for(t=0;t<e.length;t+=i){u=e[t];l=a.displayToWorld(vec4.fromValues(u.x,u.y,r[2],1),o.viewMatrix(),o.projectionMatrix(),n.width(),n.height());s.push({x:l[0],y:l[1],z:l[2],w:l[3]})}}else{i=e.length%3===0?3:2;for(t=0;t<e.length;t+=i){s.push(a.displayToWorld(vec4.fromValues(e[t],e[t+1],r[2],1),o.viewMatrix(),o.projectionMatrix(),n.width(),n.height()))}}}else if(e instanceof Object){l=a.displayToWorld(vec4.fromValues(e.x,e.y,r[2],1),o.viewMatrix(),o.projectionMatrix(),n.width(),n.height());s.push({x:l[0],y:l[1],z:l[2],w:l[3]})}else{throw"Display to world conversion requires array of 2D/3D points"}return s};this.worldToDisplay=function(e){var e,t,i,n,a,o,r=this.canvas(),s=this.contextRenderer(),l=s.camera(),u=l.focalPoint(),n=[];a=function(e,t,i,a){var o;a=a===undefined?false:true;if(!a){n.push(s.worldToDisplay(vec4.fromValues(e,t,i,1),l.viewMatrix(),l.projectionMatrix(),r.width(),r.height()));return}o=s.worldToDisplay(vec4.fromValues(e,t,i,1),l.viewMatrix(),l.projectionMatrix(),r.width(),r.height());n.push({x:o[0],y:o[1],z:o[2]})};if(e instanceof Array&&e.length>0){t=e.length%3===0?true:false;if(e[0]instanceof Object){o=1;for(i=0;i<e.length;i=+o){a(e[i].x,e[i].y,u[2],true)}}else if(t){o=3;for(i=0;i<e.length;i=+o){a(e[i],e[i+1],e[i+2])}}else{o=2;for(i=0;i<e.length;i=+o){a(e[i],e[i+1],u[2])}}return n}else if(e instanceof Object){a(e.x,e.y,u[2],true);return n}throw"World to display conversion requires array of 2D/3D points"};this.contextRenderer=function(){return i.renderWindow().activeRenderer()};this.api=function(){return"vgl"};this._init=function(){if(this.initialized()){return this}var e;a.call(this);if(!this.canvas()){e=$(document.createElement("canvas"));e.attr("class",".webgl-canvas");this.canvas(e);this.layer().node().append(e)}i=vgl.viewer(this.canvas().get(0));i.setInteractorStyle(n);i.init();i.renderWindow().resize(this.canvas().width(),this.canvas().height());$(n).on(geo.event.pan,function(e){t.trigger(geo.event.pan,e)});$(n).on(geo.event.zoom,function(e){t.trigger(geo.event.zoom,e)});return this};this._connectMapEvents=function(){var e=$(t.layer().map().node());e.on("mousewheel",function(e){i.handleMouseWheel(e)});e.on("mousemove",function(e){i.handleMouseMove(e)});e.on("mouseup",function(e){i.handleMouseUp(e)});e.on("mousedown",function(e){i.handleMouseDown(e)});e.on("mouseout",function(t){var n=$(e),a=n.offset(),o=n.width(),r=n.height(),s=t.pageX-a.left,l=t.pageY-a.top;if(s<0||s>=o||l<0||l>=r){i.handleMouseOut(t)}});e.on("keypress",function(e){i.handleKeyPress(e)});e.on("contextmenu",function(e){i.handleContextMenu(e)});n.map(this.layer().map())};this.on(geo.event.layerAdd,function(e){if(e.layer===t.layer()){t._connectMapEvents()}});this._resize=function(e,t,n,a){this.canvas().attr("width",n);this.canvas().attr("height",a);i.renderWindow().positionAndResize(e,t,n,a);this._render();return this};this._render=function(){i.render();return this};this._exit=function(){};return this};inherit(ggl.vglRenderer,ggl.renderer);geo.registerRenderer("vglRenderer",ggl.vglRenderer);gd3=ogs.namespace("geo.d3");(function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i=8;e.uniqueID=function(){var e=[],n;e.length=i;for(n=0;n<i;n++){e[n]=t.charAt(Math.floor(Math.random()*t.length))}return e.join("")}})(gd3);gd3.object=function(e){"use strict";if(!(this instanceof geo.object)){return new gd3.object(e)}var t="d3-"+gd3.uniqueID();this._d3id=function(){return t};geo.sceneObject.call(this);return this};inherit(gd3.object,geo.sceneObject);gd3.pointFeature=function(e){"use strict";if(!(this instanceof gd3.pointFeature)){return new gd3.pointFeature(e)}e=e||{};geo.pointFeature.call(this,e);gd3.object.call(this);var t=this;function i(e,i){if(!i&&e.hasOwnProperty("_dispx")&&e.hasOwnProperty("_dispy")){return e}var n=t.renderer(),a;a=n.worldToDisplay(e);e._dispx=function(){return a[0].x};e._dispy=function(){return a[0].y};return e}var n={cx:function(e){return i(e,true)._dispx()},cy:function(e){return i(e)._dispy()},r:"1px"},a={fill:"black",stroke:"none"};var o=this._init,r=this._update,s=geo.timestamp(),l={};this._init=function(e){o.call(this,e);return this};this._drawables=function(){return d3.selectAll("."+this._d3id())};this._build=function(){var e=this.positions(),i=this.style();r.call(this);if(!e){e=[]}l.id=t._d3id();l.data=e;l.append="circle";l.style=$.extend({},a);l.attributes=$.extend({},n);l.classes=["d3PointFeature"];l.style.fill=d3.rgb(i.color[0]*255,i.color[1]*255,i.color[2]*255);l.attributes.r=i.size.toString()+"px";l.style["fill-opacity"]=i.opacity;this.renderer().drawFeatures(l);s.modified();this.updateTime().modified();return this};this._update=function(){r.call(this);if(this.dataTime().getMTime()>=s.getMTime()){this._build()}return this};this._init(e);return this};inherit(gd3.pointFeature,geo.pointFeature);geo.registerFeature("d3","pointFeature",gd3.pointFeature);gd3.lineFeature=function(e){"use strict";if(!(this instanceof gd3.lineFeature)){return new gd3.lineFeature(e)}e=e||{};geo.lineFeature.call(this,e);gd3.object.call(this);var t=this,i=this._init,n=geo.timestamp(),a=this._update,o={};function r(e){var i=t.renderer(),n;n=i.worldToDisplay(e);return n[0]}this._init=function(e){i.call(this,e);return this};this._build=function(){var e=this.positions(),i=this.style(),s=d3.svg.line().x(function(e){return r(e).x}).y(function(e){return r(e).y}),l,u;a.call(this);if(i.nodelink){u=function(e){var t=r(e.source),i=r(e.target),n={source:t,target:i};return d3.svg.diagonal()(n)};l=[];e.forEach(function(t,i){var n,a;if(i<e.length-1){n=t;a=e[i+1];l.push({source:n,target:a})}});o.data=l;o.attributes={d:u}}else{o.data=[e];o.attributes={d:s}}o.id=t._d3id();o.append="path";o.classes=["d3LineFeature"];o.style={fill:"none",stroke:d3.rgb(i.color[0]*255,i.color[1]*255,i.color[2]*255),"stroke-width":i.width[0].toString()+"px","stroke-opacity":i.opacity};this.renderer().drawFeatures(o);n.modified();this.updateTime().modified();return this};this._update=function(){a.call(this);if(this.dataTime().getMTime()>=n.getMTime()){this._build()}return this};this._init(e);return this};inherit(gd3.lineFeature,geo.lineFeature);geo.registerFeature("d3","lineFeature",gd3.lineFeature);gd3.graphFeature=function(e){"use strict";if(!(this instanceof gd3.graphFeature)){return new gd3.graphFeature(e)}geo.graphFeature.call(this,e);return this};inherit(gd3.graphFeature,geo.graphFeature);geo.registerFeature("d3","graphFeature",gd3.graphFeature);gd3.d3Renderer=function(e){"use strict";if(!(this instanceof gd3.d3Renderer)){return new gd3.d3Renderer(e)}geo.renderer.call(this,e);gd3.object.call(this);var t=this,i=this._init,n={},a=[0,0];function o(e,t){var i;for(i in t){if(t.hasOwnProperty(i)){e.attr(i,t[i])}}}function r(){var e=t.layer();if(!e){return null}return e.map()}function s(){var e=r();if(!e){return null}return e.baseLayer()}function l(){var e=s();if(!e){return null}return e.renderer()}function u(e){if(e===undefined){a[0]=0;a[1]=0}else{a[0]+=e.x;a[1]+=e.y}t.canvas().selectAll(".group-"+t._d3id()).attr("transform","translate("+a.join()+")")}this._init=function(e){i.call(this,e);if(!this.canvas()){var t=d3.select(this.layer().node().get(0)).append("svg");t.attr("class",this._d3id());t.attr("width",this.layer().node().width());t.attr("height",this.layer().node().height());this.canvas(t)}};this.displayToWorld=function(e){var t=r();if(!t){throw"Cannot project until this layer is connected to a map."}return t.displayToGcs(e)};this.worldToDisplay=function(e){var t=r();if(!t){throw"Cannot project until this layer is connected to a map."}var i=t.gcsToDisplay(e);i.forEach(function(e){e.x-=a[0];e.y-=a[1]});return i};this.api=function(){return"d3"};this._resize=function(e,i,n,a){t.canvas().attr("width",n);t.canvas().attr("height",a);u();t.updateFeatures()};this._render=function(){};this._exit=function(){this.canvas().remove()};function d(e){var i=t.canvas(),n=i.selectAll(".group-"+e).data([0]);n.enter().append("g").attr("class","group-"+e);return n}this.drawFeatures=function(e){n[e.id]={data:e.data,index:e.dataIndex,style:e.style,attributes:e.attributes,classes:e.classes,append:e.append};return t.updateFeatures(e.id)};this.updateFeatures=function(e){var i;if(e===undefined){for(i in n){if(n.hasOwnProperty(i)){t.updateFeatures(i)}}return this}var a=d(t._d3id()),r=n[e].data,s=n[e].index,l=n[e].style,u=n[e].attributes,c=n[e].classes,p=n[e].append,f=a.selectAll("."+e).data(r,s);f.enter().append(p);f.exit().remove();o(f,u);f.attr("class",c.concat([e]).join(" "));f.style(l);return this};this.on(geo.event.pan,function(e){u({x:e.curr_display_pos.x-e.last_display_pos.x,y:e.curr_display_pos.y-e.last_display_pos.y})});this.on(geo.event.zoom,function(e){u();t.updateFeatures()});this.on(geo.event.resize,function(e){t._resize(e.x,e.y,e.width,e.height)});this._init(e);return this};inherit(gd3.d3Renderer,geo.renderer);geo.registerRenderer("d3Renderer",gd3.d3Renderer);var uiModule=ogs.namespace("ui");uiModule.gis=function(){"use strict";if(!(this instanceof uiModule.gis)){return new uiModule.gis}return this};uiModule.gis.selectedLayers=function(){"use strict";var e=[];$("#table-layers tr").each(function(t,i){if($("#selected",i)[0].checked){e.push(i.id)}});return e};uiModule.gis.createLayerList=function(e,t,i,n,a,o){"use strict";var r=uiModule.gis.createList(t,i),s=$(document.createElement("div")),l=$(document.createElement("button")),u=$(document.createElement("button")),d=$(document.createElement("button")),c=function(e){$("#table-layers tr").each(function(t,i){if($("#selected",i)[0].checked){e(i.id)}})},p=function(){var t=$(document.createElement("div"));t.attr("id","edit-layer-controls");t.width(200);t.height(200);uiModule.gis.createOpacityControl(t,e,uiModule.gis.selectedLayers);return t},f={html:true,container:"body",placement:"right",trigger:"click",title:null,content:p,delay:{show:100,hide:100}},m,h,g,y,v;s.attr("id","layer-control-btns");s.addClass("btn-group");l.attr("class","btn-toggle-layer btn-small btn-warning layer-control-btn");l.attr("disabled","true");l.html("Toggle");l.width("70px");s.append(l);l.click(function(){c(function(e){n(this,e)})});u.attr("class","btn-edit-layer btn-small btn-danger layer-control-btn");u.attr("disabled","true");u.html("Remove");u.width("70px");s.append(u);u.click(function(){c(function(e){a(this,e)})});d.attr("class","btn-small btn-success");d.attr("disabled","true");d.html("Modify");d.width("70px");s.append(d);d.popover(f);$("#drawer").on("click",function(e){d.popover("hide")});$(document).keydown(function(e){if(e.which===$.ui.keyCode.ESCAPE){d.popover("hide")}});$(document).click(function(e){if(!$(e.target).is(d)){d.popover("hide")}});h=$("<div>",{id:"animation-controls","class":"btn-group"}).append($("<button>",{id:"step-backward","class":"btn btn-small",disabled:"true"}).append($("<i>",{"class":"icon-step-backward"})),$("<button>",{id:"play","class":"btn btn-small",disabled:"true"}).append($("<i>",{"class":"icon-play"})),$("<button>",{id:"pause","class":"btn btn-small",disabled:"true"}).append($("<i>",{"class":"icon-pause"})),$("<button>",{id:"stop","class":"btn btn-small",disabled:"true"}).append($("<i>",{"class":"icon-stop"})),$("<button>",{id:"step-forward","class":"btn btn-small",disabled:"true"}).append($("<i>",{"class":"icon-step-forward"})));h.css({left:"10px"});s.append($(h));y=function(e,t){var i=[],n;$.each(e,function(e,t){var n=$("#"+t).data("dataset");if(!n.timeInfo){i.push(n)}});n=i.length;if(n===0){t(e)}$.each(i,function(i,a){o(a.name.replace(".nc",""),function(i){a.timeInfo=i;n--;if(n===0){t(e)}})})};v=function(){$("#timestep-display").fadeOut("slow");$("#timestep-display h4").html("")};$("#play",h).click(function(){$(this).addClass("active");$("#pause",h).removeClass("active");y(uiModule.gis.selectedLayers(),e.animate);$("#timestep-display").fadeIn("slow")});$("#pause",h).click(function(){$(this).addClass("active");$("#play",h).removeClass("active");e.pauseAnimation()});$("#stop",h).click(function(){$("#play",h).removeClass("active");$("#pause",h).removeClass("active");e.stopAnimation();v()});$("#step-forward",h).click(function(){y(uiModule.gis.selectedLayers(),e.stepAnimationForward);$("#timestep-display").fadeIn("slow")});$("#step-backward",h).click(function(){y(uiModule.gis.selectedLayers(),e.stepAnimationBackward);$("#timestep-display").fadeIn("slow")});$(e).on(geo.command.animateEvent,function(e){if(e.currentTime>=e.endTime){$("#play",h).removeClass("active")}});$("#table-layers").on("layer-removed",function(t){if($.inArray(t.id,uiModule.gis.selectedLayers())){e.stopAnimation(true);$("#play",h).removeClass("active");$("#pause",h).removeClass("active");v()}});$("#table-layers").on("layers-selection",function(){$.each($("#layer-control-btns button"),function(e,t){$(t).removeAttr("disabled")});$.each($("#animation-controls button"),function(e,t){$(t).removeAttr("disabled")})});$("#table-layers").on("layers-no-selection",function(){$.each($("#layer-control-btns button"),function(e,t){$(t).attr("disabled","true")});$.each($("#animation-controls button"),function(e,t){$(t).attr("disabled","true")})});g=$("<div>",{id:"timestep-display",style:"position: absolute; z-index: 99; top: 55px;"+"left: 10px; background: rgba(255,255,255,0.5); "+"padding: 5px; border-radius: 5px;"}).append($("<h4>"));i=$("h4",g);$(e).on(geo.command.animateEvent,function(e){var t=d3.time.format.utc("%Y-%m-%d");if(e.currentTime){i.html(t(e.currentTime))}});$("body").append(g);g.hide();s.hide();$("#"+t+" .accordion-inner").prepend(s)};uiModule.gis.createList=function(e,t){"use strict";var i,n,a,o,r,s,l,u,d;i=document.getElementById(e);n=document.createElement("div");n.setAttribute("class","accordion-group");i.appendChild(n);a=document.createElement("div");a.setAttribute("class","accordion-heading");n.appendChild(a);o=document.createElement("a");o.setAttribute("class","accordion-toggle");o.setAttribute("data-toggle","collapse");o.setAttribute("data-parent","#"+e);o.setAttribute("href","#collapse-"+e);o.appendChild(document.createTextNode(t));a.appendChild(o);r=document.createElement("div");r.setAttribute("class","accordion-body collapse in");r.setAttribute("id","collapse-"+e);n.appendChild(r);s=document.createElement("div");s.setAttribute("class","accordion-inner");r.appendChild(s);d=document.createElement("div");d.setAttribute("class","layer-table-container");s.appendChild(d);l=document.createElement("table");l.setAttribute("id","table-"+e);d.appendChild(l);u=document.createElement("tbody");l.appendChild(u);return l};uiModule.gis.createDataList=function(e,t,i,n,a){"use strict";var o,r,s,l,u,d,c;o=$(document.getElementById(e));r=$(document.createElement("div"));r.attr("class","accordion-group");o.append(r);c=$(document.createElement("div"));c.attr("class","accordion-heading");r.append(c);s=$(document.createElement("a"));s.attr("class","accordion-toggle");s.attr("data-toggle","collapse");s.attr("data-parent","#"+e);s.attr("href","#collapse-"+e);s.append(document.createTextNode(t));c.append(s);l=$(document.createElement("div"));l.attr("class","accordion-body collapse in");l.attr("id","collapse-"+e);r.append(l);u=$(document.createElement("div"));u.attr("class","accordion-inner");l.append(u);d=$(document.createElement("table"));d.attr("class","table-hover");u.append(d);$.each(n,function(e,t){var i,n,o,r,s,l,u,c,p,f,m;i=$(document.createElement("tr"));i.attr("class","success");d.append(i);n=$(document.createElement("td"));o=$(document.createElement("h4"));o.html(t.basename);n.append(o);i.append(n);p=["na","na"];if(t.timeInfo.rawTimes){console.log(t.timeInfo);p=t.timeInfo.rawTimes}n=$(document.createElement("td"));f=$(document.createElement("select"));f.attr("class","combobox");f.attr("id",t.name+"_tselect");n.append(f);for(s=0;s<p.length;++s){m=p[s];u=$(document.createElement("option"));u.attr("value",m);u.html(m);f.append(u)}n.append(f);i.append(n);n=$(document.createElement("td"));r=$(document.createElement("select"));r.attr("class","combobox");r.attr("id",t.name+"_vselect");n.append(r);for(s=0;s<t.variables.length;++s){l=t.variables[s].name;u=$(document.createElement("option"));u.attr("value",l);u.html(l);r.append(u)}i.append(n);n=$(document.createElement("td"));c=$(document.createElement("button"));c.attr("type","button");c.attr("class","btn btn-primary");c.attr("id","btn-add-"+t.name);c.attr("_id",t.id);c.attr("name",t.name);c.attr("basename",t.basename);c.attr("data-toggle","button");c.attr("data-loading-text","Loading...");c.html("Add");n.append(c);i.append(n);if(a!==undefined){$(c).on("click",a)}});$(".combobox").width(Math.max.apply(Math,$(".combobox").map(function(){return $(this).outerWidth()}).get()));$(".combobox").select2()};uiModule.gis.addLayer=function(e,t,i,n,a,o,r,s,l){"use strict";$("#layer-control-btns").show();var u,d,c,p,f,m,h,g,y,v,b,w,x,M,S,k;u="#"+t;p=$(i).attr("dataset_id");if(p!==null){d=$(u).find("tbody");c=$(i).attr("name");f=$(document.createElement("tr"));f.attr("id",p);$(d).append(f);f.data("dataset",i);m=$(document.createElement("td"));m.width("20px");g=$(document.createElement("input"));g.attr("type","checkbox");g.attr("id","selected");m.append(g);f.append(m);g.click(function(){var e=0;$("#table-layers tr").each(function(t,i){if($("#selected",i)[0].checked){e++}});if(e===1){$("#table-layers").trigger("layers-selection")}else if(e===0){$("#table-layers").trigger("layers-no-selection")}});m=$(document.createElement("td"));m.width("30px");y=$(document.createElement("button"));y.addClass("btn btn-success btn-mini");y.attr("data-toggle","button");y.attr("type","button");y.click(p,function(){a(this,p)});v=$(document.createElement("i"));v.addClass("icon-eye-open icon-white");y.append(v);m.append(y);f.append(m);m=$(document.createElement("td"));m.width("45px");b=$(document.createElement("button"));b.addClass("btn btn-info btn-mini");b.attr("type","button");b.click(p,function(){s(this,p)});v=$(document.createElement("i"));v.addClass("icon-wrench icon-white");b.append(v);m.append(b);f.append(m);m=$(document.createElement("td"));w=$(document.createElement("div"));w.attr("id","name");w.append($(document.createElement("h4")).html(c));if(l){x=$(document.createElement("div"));x.attr("id","progress");M=$(document.createElement("div")).addClass("progress progress-success progress-striped active");M.css({"float":"left",width:"80%"});S=$(document.createElement("div")).addClass("bar");M.append(S);S.width("0%");k=$(document.createElement("button")).addClass("btn btn-mini");k.attr("type","button");k.css({width:"20px",height:"20px",position:"relative",top:"-1px",left:"3px"});v=$(document.createElement("i"));v.addClass("icon-remove icon-black");v.css({position:"relative",left:"-4px",top:"-1px"});k.append(v);x.append(M).append(k);w.append(x);k.click(p,function(){f.trigger("cancel-download-task")})}m.append(w);f.append(m);m=$(document.createElement("td"));$(".btn-layer").width(Math.max.apply(Math,$(".btn-layer").map(function(){return $(this).outerWidth()}).get()))}$("#"+p).fadeOut(0);$("#"+p).fadeIn("slow",r)};uiModule.gis.layerAdded=function(e){"use strict";$(e).removeClass("btn-primary");$(e).addClass("btn-success");$(e).addClass("disabled");$(e).attr("data-loading-text","Added");$(e).attr("disabled","disabled");$(e).html("Added")};uiModule.gis.removeLayer=function(e,t){"use strict";var i,n=$("#btn-add-"+t);if(n!==null||n!==undefined){n.removeClass("disabled");n.removeAttr("disabled");n.removeClass("btn-success");n.removeClass("active");n.button("reset");n.addClass("btn-primary");$("#"+t).fadeOut(function(){$("#"+t).remove()});$("#table-layers").trigger("layer-removed",{id:t});return true}return false};uiModule.gis.toggleLayer=function(e,t){"use strict"};uiModule.gis.selectLayer=function(e,t){"use strict";$(e).siblings().removeClass("active");if(e!==null||e!==undefined){$(e).addClass("active")}return true};uiModule.gis.hasLayer=function(e,t){"use strict";var i=false;$("tr",$(e)).each(function(e,n){if(n.id===t){i=true;return}});return i};uiModule.gis.createMapControls=function(e,t){"use strict";var i,n,a,o,r,s,l,u;i=e.options();
n=$(t);function d(t,i){e.setZoom(i.value);e.draw()}function c(e){e.stopPropagation();return false}function p(){e.toggleCountryBoundries();e.draw()}for(a in i){if(i.hasOwnProperty(a)){o=$(document.createElement("tr"));o.attr("class","row-fluid");n.append(o);r=$(document.createElement("td"));o.append(r);s=$(document.createElement("h4"));s.html(a);r.append(s);switch(a){case"zoom":u=$(document.createElement("div"));u.slider({range:"min",min:0,max:17,step:1,value:i[a],slide:d});$(u).on("mousedown",c);r.attr("class","span10");$(r).append(u);break;case"center":break;case"country_boundries":l=$(document.createElement("input"));l.attr("type","checkbox");l.attr("checked",e.options().country_boundries);l.click(p);r.append(l);break;case"us_states":break;case"source":break}}}};uiModule.gis.createOpacityControl=function(e,t,i){"use strict";var n,a;n=$(document.createElement("div"));n.append("<h4>opacity</h4>");a=$(document.createElement("div"));a.width("100%");a.addClass("ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all");n.append(a);e.append(n);a.slider({range:"min",min:0,max:1,step:.01,value:.5});a.slider().bind("slide",function(e,n){var a=i();$.each(a,function(e,i){t.findLayerById(i).setOpacity(n.value)});t.draw()});a.on("mousedown",function(e){e.stopPropagation();return false});a.slider()};var srvModule=ogs.namespace("srv");srvModule.webSocketOptions=function(){"use strict";if(!(this instanceof srvModule.webSocketOptions)){return new srvModule.webSocketOptions}this.url="ws://"+window.location.host+"/ws";this.nodes=[];return this};srvModule.webSocket=function(e){"use strict";this.events={message_recieved:"message_recieved",opened:"opened",closed:"closed",ready:"ready"};if(!(this instanceof srvModule.webSocket)){return new srvModule.webSocket(e)}vgl.object.call(this);var t=this,i=e.url||"ws://"+window.location.host+"/ws",n=e.nodes||[],a={},o={},r=false,s,l,u;if(window.WebSocket){s=new window.WebSocket(i)}else if(window.MozWebSocket){s=window.MozWebSocket(i)}else{console.log("[WARNING] WebSocket Not Supported");return}window.onbeforeunload=function(e){s.close(1e3,"Window closed");r=false;if(!e){e=window.event}e.stopPropagation();e.preventDefault()};s.onopen=function(){r=true;$(t).trigger({type:t.events.opened});if(n.length===0){$(t).trigger({type:t.events.ready})}else{t.bind("nodemanager",function(e){a[e]=true;l=true;for(u=0;u<n.length;u++){if(!a[n[u]]){l=false}}if(l){$(t).trigger({type:t.events.ready})}});for(u=0;u<n.length;u++){t.message("nodemanager",n[u])}}};s.onclosed=function(){r=false;$(t).trigger({type:t.events.closed})};s.onmessage=function(e){$(t).trigger({type:t.events.message_recieved,message:e.data});var i=JSON.parse(e.data),n;if(o.hasOwnProperty(i.target)){for(n in o[i.target]){o[i.target][n].call(t,i.message)}}};this.signal=function(e,t,i,n){i=typeof i!=="undefined"?i:[];n=typeof n!=="undefined"?n:{};var a={target:e,message:{slot:t,args:i,kwargs:n}};s.send(JSON.stringify(a))};this.message=function(e,t){var i={target:e,message:t};s.send(JSON.stringify(i))};this.url=function(){return i};this.open=function(){return r};this.name=function(){return s};this.bind=function(e,t){if(!o.hasOwnProperty(e)){o[e]=[]}o[e].push(t)};this.unbind=function(e,t){var i;if(o.hasOwnProperty(e)){i=o[e].indexof(t);if(i!==-1){o.splice(i,1)}}};this.unbindAll=function(e){if(typeof e!=="undefined"){if(o.hasOwnProperty(e)){o[e]=[]}}else{o={}}};return this};inherit(srvModule.webSocket,vgl.object);var wflModule=ogs.namespace("wfl");"use strict";wflModule.utils={merge_options:function(e,t){var i={},n;for(n in e){i[n]=e[n]}for(n in t){i[n]=t[n]}return i},merge_options_in_place:function(e,t){var i;for(i in t){e[i]=t[i]}return e},defaultValue:function(e,t){return typeof e!=="undefined"?e:t},createIdCounter:function(e){e=wflModule.utils.defaultValue(e,-1);return function(){e+=1;return e}},moduleRegistryMap:{},debug:function(e){console.log(e)},roundRect:function(e,t,i,n,a,o,r,s){if(typeof o==="undefined"){o=5}e.beginPath();e.moveTo(t+o,i);e.lineTo(t+n-o,i);e.quadraticCurveTo(t+n,i,t+n,i+o);e.lineTo(t+n,i+a-o);e.quadraticCurveTo(t+n,i+a,t+n-o,i+a);e.lineTo(t+o,i+a);e.quadraticCurveTo(t,i+a,t,i+a-o);e.lineTo(t,i+o);e.quadraticCurveTo(t,i,t+o,i);e.closePath();if(s||typeof s==="undefined"){e.stroke()}if(r){e.fill()}}};var nextConnectionId=wflModule.utils.createIdCounter();var nextWorkflowId=wflModule.utils.createIdCounter();var nextLocationId=wflModule.utils.createIdCounter();var nextModuleId=wflModule.utils.createIdCounter();var nextPortId=wflModule.utils.createIdCounter();wflModule.workflowOptions=function(){"use strict";if(!(this instanceof wflModule.workflowOptions)){return new wflModule.workflowOptions}function e(e,t,i,n,a,o){e=wflModule.utils.defaultValue(e,"untitled");t=wflModule.utils.defaultValue(t,"1.0.2");i=wflModule.utils.defaultValue(i,[]);n=wflModule.utils.defaultValue(n,[]);a=wflModule.utils.defaultValue(a,"");o=wflModule.utils.defaultValue(o,nextWorkflowId());return{workflow:{"@name":e,"@version":t,"@{http://www.w3.org/2001/XMLSchema-instance}schemaLocation":"http://www.vistrails.org/workflow.xsd",connection:i,module:n,"@vistrail_id":a,"@id":o}}}this.data=e();this.modules={};this.connections={};this.drawStyle=climatePipesStyle;this.translated={x:0,y:0};this.moduleClass=wflModule.inputModule;return this};wflModule.workflow=function(e){"use strict";this.events={moduleAdded:"moduleAdded",connectionAdded:"connectionAdded"};if(!(this instanceof wflModule.workflow)){return new wflModule.workflow(e)}vgl.object.call(this);e=typeof e!=="undefined"?e:{};e=wflModule.utils.merge_options(wflModule.workflowOptions(),e);var t=this,i=e.data,n=e.modules,a=e.connections,o=e.drawStyle,r=e.translated,s=e.moduleClass,l=false;this.generateModulesFromData=function(){var e,a,o=0,r=nextModuleId(),l=i.workflow.module;for(e=0;e<l.length;e++){a=parseInt(l[e]["@id"],10);n[a]=s({workflow:t},l[e]);if(a>o){o=a}while(o>r){r=nextModuleId()}}};this.deleteSelectedModules=function(){var e;for(e in a){if(a.hasOwnProperty(e)){if(a[e].sourceModule().isSelected()||a[e].targetModule().isSelected()){a[e].delete();delete a[e]}}}for(e in n){if(n.hasOwnProperty(e)){if(n[e].isSelected()){n[e].delete();delete n[e]}}}};this.addNewModule=function(e,i,a){var o=JSON.parse(e),r={"@name":o["@name"],"@package":o["@package"],"@version":o["@packageVersion"],"@namespace":o["@namespace"],"@cache":"1",location:{"@x":parseFloat(i),"@y":-parseFloat(a),"@id":nextLocationId()},"@id":nextModuleId()};n[r["@id"]]=s({workflow:t},r);this.data().workflow.module.push(r)};this.addConnection=function(e,i,n,o){if(i.data()["@type"]===o.data()["@type"]){wflModule.utils.debug("Must connect output to input");return}if(e===n){wflModule.utils.debug("Cannot make connection between ports on same module.")}var r={"@id":nextConnectionId(),port:[{"@moduleName":n.data()["@name"],"@name":o.data()["@name"],"@signature":o.data()["@sigstring"],"@id":nextPortId(),"@type":o.data()["@type"],"@moduleId":n.data()["@id"]},{"@moduleName":e.data()["@name"],"@name":i.data()["@name"],"@signature":i.data()["@sigstring"],"@id":nextPortId(),"@type":i.data()["@type"],"@moduleId":e.data()["@id"]}]},l={vertical:s===wflModule.module,workflow:t};a[r["@id"]]=wflModule.connection(l,r);this.data().workflow.connection.push(r)};this.generateConnectionsFromData=function(){var e,n,o=0,r=nextConnectionId(),l=i.workflow.connection,u={vertical:s===wflModule.module,workflow:t};for(e=0;e<l.length;e++){n=parseInt(l[e]["@id"],10);a[n]=wflModule.connection(u,l[e]);if(n>o){o=n}while(o>r){r=nextConnectionId()}}};this.draw=function(e){var t,i,s,l,u,d;e.clearRect(-r.x,-r.y,e.canvas.width,e.canvas.height);e.fillStyle=o.fill;e.lineWidth=o.lineWidth;e.strokeStyle=o.stroke;e.save();e.shadowBlur=o.shadowBlur;e.shadowColor=o.shadowColor;i=e.shadowBlur;s=i-r.x;l=i-r.y;u=e.canvas.width-i*2;d=e.canvas.height-i*2;wflModule.utils.roundRect(e,s,l,u,d,o.cornerRadius,true,true);e.restore();e.save();wflModule.utils.roundRect(e,s,l,u,d,o.cornerRadius,false,false);e.clip();for(t in n){if(n.hasOwnProperty(t)){n[t].draw(e,o)}}for(t in a){if(a.hasOwnProperty(t)){a[t].draw(e,o)}}e.restore()};this.setVisible=function(e){l=e};this.visible=function(){return l};this.translated=function(){return r};this.translate=function(e,t,i){r.x+=t;r.y+=i;e.translate(t,i)};this.show=function(e){var t;this.setVisible(true);for(t in n){if(n.hasOwnProperty(t)){n[t].show(e)}}};this.hide=function(){var e;this.setVisible(false);for(e in n){if(n.hasOwnProperty(e)){n[e].hide()}}};this.modules=function(){return n};this.data=function(){return i};this.setData=function(e){i=e;n={};a={};r={x:0,y:0};this.generateModulesFromData();this.generateConnectionsFromData()};this.updateElementPositions=function(){var e;for(e in n){n[e].updateElementPositions()}};this.getModuleByName=function(e){var t;for(t in n){if(n.hasOwnProperty(t)){if(n[t].data()["@name"]===e){return n[t]}}}return null};this.setDefaultWorkflowInputs=function(e,t,i){this.getModuleByName("Dataset").setInput("file",t);this.getModuleByName("Variable").setInput("name",e);if(!isNaN(parseFloat(i))){this.getModuleByName("Variable").setInput("time",i)}};this.moduleByPos=function(e){var t,i;for(t in n){if(n.hasOwnProperty(t)){i=n[t];if(i.contains(e)){return i}}}return null};if(e.data.hasOwnProperty("workflow")){this.generateModulesFromData();this.generateConnectionsFromData()}return this};inherit(wflModule.workflow,vgl.object);var nextFunctionId=wflModule.utils.createIdCounter();wflModule.module=function(e,t){"use strict";if(!(this instanceof wflModule.module)){return new wflModule.module(e,t)}vgl.object.call(this);var i=this,n=t,a=wflModule.utils.moduleRegistryMap,o=a[t["@package"]][t["@name"]],r,s=o.portSpec,l={},u={},d=0,c=0,p=false,f,m=e.workflow;t.location["@x"]=parseFloat(t.location["@x"]);t.location["@y"]=parseFloat(t.location["@y"]);if(!(s instanceof Array)){s=[s]}if(!this.hasOwnProperty("inputPortClass")){this.inputPortClass=wflModule.port}if(!this.hasOwnProperty("outputPortClass")){this.outputPortClass=wflModule.port}function h(){var e;for(e=0;e<s.length;e++){if(s[e]["@type"]!=="output"){l[s[e]["@name"]]=i.inputPortClass({module:i},s[e]);d++}else{u[s[e]["@name"]]=i.outputPortClass({module:i},s[e]);c++}}}this.workflow=function(){return m};this.inPortCount=function(){return d};this.outPortCount=function(){return c};this.getFontMetrics=function(e,t){var i;e.save();e.font=t.module.text.font;i=e.measureText(n["@name"]);e.restore();return i};this.recomputeMetrics=function(e,t){var i=t.module.port.width,a=i+t.module.port.pad,o=d*a+t.module.text.xpad,s=c*a,p=this.getFontMetrics(e,t),f=p.width+t.module.text.xpad*2,m=Math.max(o,s+t.module.text.xpad,f,t.module.minWidth),h=12,g=t.module.port.pad*4+i*2+t.module.text.ypad*2+h,y=Math.floor(n.location["@x"]-m/2),v=-Math.floor(n.location["@y"]),b=y+t.module.port.pad,w=y+m-s,x;r={mx:y,my:v,totalPortWidth:a,inPortsWidth:o,fontMetrics:p,textWidth:f,moduleWidth:m,textHeight:h,moduleHeight:g,inPortX:b,inPortY:v+t.module.port.pad,outPortX:w,outPortY:v+g-t.module.port.pad-i};for(x in l){if(l.hasOwnProperty(x)){l[x].setPosition(b,r.inPortY);b+=i+t.module.port.pad}}for(x in u){if(u.hasOwnProperty(x)){u[x].setPosition(w,r.outPortY);w+=i+t.module.port.pad}}};this.getMetrics=function(){return r};this.getInPorts=function(){return l};this.getOutPorts=function(){return u};this.getRegistry=function(){return o};this.data=function(){return n};this.draw=function(e,t){if(!r){this.recomputeMetrics(e,t)}var i=t.module.port.width,a=r.mx,o=r.my,s;e.fillStyle=t.module.fill;e.strokeStyle=t.module.stroke;e.fillRect(a,o,r.moduleWidth,r.moduleHeight);e.strokeRect(a,o,r.moduleWidth,r.moduleHeight);for(s in l){if(l.hasOwnProperty(s)){l[s].draw(e,i)}}for(s in u){if(u.hasOwnProperty(s)){u[s].draw(e,i)}}e.fillStyle=t.module.text.fill;e.font=t.module.text.font;e.fillText(n["@name"],a+Math.floor((r.moduleWidth-r.fontMetrics.width)/2),o+r.textHeight+t.module.text.ypad)};this.contains=function(e){var t=this.getMetrics();return e.x>t.mx&&e.x<t.mx+t.moduleWidth&&e.y>t.my&&e.y<t.my+t.moduleHeight};this.portByPos=function(e){var t;for(t in l){if(l.hasOwnProperty(t)){if(l[t].contains(e)){return l[t]}}}for(t in u){if(u.hasOwnProperty(t)){if(u[t].contains(e)){return u[t]}}}return null};this.hide=function(){var e;for(e in l){if(l.hasOwnProperty(e)){l[e].hide()}}};this.show=function(e){var t;for(t in l){if(l.hasOwnProperty(t)){l[t].show(e)}}};this.getFunctionValue=function(e){var t,i;if(n.hasOwnProperty("function")){if(!$.isArray(n.function)){n.function=[n.function]}for(t=0;t<n.function.length;t++){i=n.function[t];if(i["@name"]===e){return i.parameter["@val"]}}}return null};this.toggleSelected=function(){p=!p};this.isSelected=function(){return p};this.delete=function(){var e,t=i.workflow().data().workflow.module,n;for(e=0;e<t.length;e++){if(i.data()===t[e]){t.splice(e,1);break}}for(n in l){if(l.hasOwnProperty(n)){l[n].delete()}}for(n in u){if(u.hasOwnProperty(n)){u[n].delete()}}};this.addOrUpdateFunction=function(e,t,i){var a,o;if(n.hasOwnProperty("function")){if(!$.isArray(n.function)){n.function=[n.function]}for(a=0;a<n.function.length;a++){o=n.function[a];if(o["@name"]===e){o.parameter["@val"]=t.toString();return}}}else{n.function=[]}n.function.push(this.newFunction(e,t,i))};this.newFunction=function(e,t,i,n,a,o){var r=nextFunctionId();n=wflModule.utils.defaultValue(n,"0");a=wflModule.utils.defaultValue(a,"");o=wflModule.utils.defaultValue(o,"<no description>");return{"@name":e,"#tail":"\n    ","@id":r,"@pos":n,"#text":"\n      ",parameter:{"@val":t?t.toString():"","@name":o,"#tail":"\n    ","@pos":"0","@alias":a,"@id":r,"@type":i}}};this.setHover=function(e){f=e};this.isHover=function(){return f};this.updateElementPositions=function(){};h();return this};inherit(wflModule.module,vgl.object);wflModule.connectionOptions=function(){"use strict";if(!(this instanceof wflModule.connectionOptions)){return new wflModule.connectionOptions}this.vertical=false;this.workflow=null;return this};wflModule.connection=function(e,t){"use strict";if(!(this instanceof wflModule.connection)){return new wflModule.connection(e,t)}vgl.object.call(this,e,t);e=typeof e!=="undefined"?e:{};e=wflModule.utils.merge_options(wflModule.connectionOptions(),e);var i=this,n=t,a=e.vertical,o=e.workflow,r,s;this.data=function(){return n};this.delete=function(){var e,t=o.data().workflow.connection;for(e=0;e<t.length;e++){if(i.data()===t[e]){t.splice(e,1);break}}};this.draw=function(e,t){this.drawCurve(e,t,this.computePositions(t))};this.drawCurve=function(e,t,i){var n=this.getCurveOffsets(t);e.beginPath();e.moveTo(i.cx1,i.cy1);e.bezierCurveTo(i.cx1+n.x1,i.cy1+n.y1,i.cx2+n.x2,i.cy2+n.y2,i.cx2,i.cy2);e.lineWidth=t.conn.lineWidth;e.strokeStyle=t.conn.stroke;e.stroke()};this.getCurveOffsets=function(e){return{x1:a?0:e.conn.bezierOffset,x2:a?0:-e.conn.bezierOffset,y1:!a?0:e.conn.bezierOffset,y2:!a?0:-e.conn.bezierOffset}};function l(){var e,t;for(t=0;t<n.port.length;t++){e=n.port[t];if(e["@type"]==="source"||e["@type"]==="output"){r=o.modules()[e["@moduleId"]]}else{s=o.modules()[e["@moduleId"]]}}}this.sourceModule=function(){if(typeof r==="undefined"){l()}return r};this.targetModule=function(){if(typeof s==="undefined"){l()}return s};this.computePositions=function(e){var t=i.sourceModule(),a=i.targetModule(),o,r,s=Math.floor(e.module.port.width/2),l,u;for(l=0;l<n.port.length;l++){u=n.port[l];if(u["@type"]==="source"||u["@type"]==="output"){o=t.getOutPorts()[u["@name"]]}else{r=a.getInPorts()[u["@name"]]}}return{cx1:o.x()+s,cy1:o.y()+s,cx2:r.x()+s,cy2:r.y()+s}};return this};inherit(wflModule.connection,vgl.object);wflModule.portOptions=function(){"use strict";if(!(this instanceof wflModule.portOptions)){return new wflModule.portOptions}this.module=null;this.drawStyle=climatePipesStyle;return this};wflModule.port=function(e,t){"use strict";if(!(this instanceof wflModule.port)){return new wflModule.port(e,t)}vgl.object.call(this);e=typeof e!=="undefined"?e:{};e=wflModule.utils.merge_options(wflModule.portOptions(),e);var i=this,n=t,a=e.module,o=e.drawStyle,r=0,s=0,l=o.module.port.width,u;this.drawStyle=function(){return o};this.setPosition=function(e,t){r=e;s=t};this.module=function(){return a};this.x=function(){return r};this.y=function(){return s};this.data=function(){return n};this.draw=function(e,t){e.fillStyle=o.module.port.fill;e.strokeStyle=o.module.port.stroke;e.fillRect(r,s,t,t);e.strokeRect(r,s,t,t)};this.drawAsCircle=function(e,t){e.fillStyle=o.module.port.fill;e.strokeStyle=o.module.port.stroke;e.lineWidth=o.module.port.lineWidth;var i=t/2;e.beginPath();e.arc(r+i,s+i,i,0,2*Math.PI,false);e.closePath();e.fill();e.stroke()};this.getName=function(){return this.data()["@name"]};this.contains=function(e){if(e.x>=r){if(e.y>=s){if(e.x<=r+l){if(e.y<=s+l){return true}}}}return false};this.setHover=function(e){u=e};this.hide=function(){};this.show=function(e){};this.delete=function(){};return this};inherit(wflModule.port,vgl.object);wflModule.registry={"@rootDescriptorId":"0","package":[{"@loadConfiguration":"True","@description":"basic_modules defines basic VisTrails Modules that are used in most\npipelines.","#text":"\n    ","@name":"Basic Modules","#tail":"\n  ","@version":"2.1",moduleDescriptor:[{"#text":"\n      ","@name":"Module","@package":"org.vistrails.vistrails.basic","@id":"0",portSpec:{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"0","@type":"output"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"-1"},{"#text":"\n      ","@name":"Converter","@package":"org.vistrails.vistrails.basic","@id":"1",portSpec:[{"@sortKey":"-1","@name":"in_value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"1","@type":"input"},{"@sortKey":"-1","@name":"out_value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"2","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Constant","@package":"org.vistrails.vistrails.basic","@id":"2",portSpec:{"@sortKey":"-1","@name":"value_as_string","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"3","@type":"output"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Boolean","@package":"org.vistrails.vistrails.basic","@id":"3",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"69","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"70","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"Float","@package":"org.vistrails.vistrails.basic","@id":"4",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Float","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"71","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Float","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"72","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"Integer","@package":"org.vistrails.vistrails.basic","@id":"5",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Integer","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"73","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Integer","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"74","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"4"},{"#text":"\n      ","@name":"String","@package":"org.vistrails.vistrails.basic","@id":"6",portSpec:[{"@sortKey":"-1","@name":"value_as_string","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"4","@type":"output"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"75","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"76","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"List","@package":"org.vistrails.vistrails.basic","@id":"7",portSpec:[{"@sortKey":"-1","@name":"head","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"5","@type":"input"},{"@sortKey":"-1","@name":"tail","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"6","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"77","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"78","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"Path","@package":"org.vistrails.vistrails.basic","@id":"8",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Path","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"7","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Path","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"8","@type":"output"},{"@sortKey":"-1","@name":"name","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"9","@type":"input"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"File","@package":"org.vistrails.vistrails.basic","@id":"9",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"10","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"11","@type":"output"},{"@sortKey":"-1","@name":"self","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"12","@type":"output"},{"@sortKey":"-1","@name":"create_file","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"13","@type":"input"},{"@sortKey":"-1","@name":"local_filename","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"14","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"8"},{"#text":"\n      ","@name":"Directory","@package":"org.vistrails.vistrails.basic","@id":"10",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Directory","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"15","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Directory","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"16","@type":"output"},{"@sortKey":"-1","@name":"itemList","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"17","@type":"output"},{"@sortKey":"-1","@name":"create_directory","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"18","@type":"input"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"8"},{"#text":"\n      ","@name":"OutputPath","@package":"org.vistrails.vistrails.basic","@id":"11",portSpec:{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"OutputPath","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"19","@type":"output"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"8"},{"#text":"\n      ","@name":"FileSink","@package":"org.vistrails.vistrails.basic","@id":"12",portSpec:[{"@sortKey":"-1","@name":"file","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"20","@type":"input"},{"@sortKey":"-1","@name":"outputPath","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"OutputPath","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"21","@type":"input"},{"@sortKey":"-1","@name":"overwrite","#tail":"\n      ",portSpecItem:{"@default":"True","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"22","@type":"input"},{"@sortKey":"-1","@name":"publishFile","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"23","@type":"input"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"DirectorySink","@package":"org.vistrails.vistrails.basic","@id":"13",portSpec:[{"@sortKey":"-1","@name":"dir","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Directory","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"24","@type":"input"},{"@sortKey":"-1","@name":"outputPath","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"OutputPath","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"25","@type":"input"},{"@sortKey":"-1","@name":"overwrite","#tail":"\n    ",portSpecItem:{"@default":"True","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"26","@type":"input"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"WriteFile","@package":"org.vistrails.vistrails.basic","@id":"14",portSpec:[{"@sortKey":"-1","@name":"in_value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"27","@type":"input"},{"@sortKey":"-1","@name":"suffix","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"28","@type":"input"},{"@sortKey":"-1","@name":"out_value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"29","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"1"},{"#text":"\n      ","@name":"Color","@package":"org.vistrails.vistrails.basic","@id":"15",portSpec:[{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Color","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"30","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Color","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"31","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"#text":"\n      ","@name":"StandardOutput","@package":"org.vistrails.vistrails.basic","@id":"16",portSpec:{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"32","@type":"input"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Tuple","@package":"org.vistrails.vistrails.basic","@id":"17",portSpec:{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Tuple","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"33","@type":"output"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Untuple","@package":"org.vistrails.vistrails.basic","@id":"18",portSpec:{"@sortKey":"-1","@name":"tuple","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Tuple","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"34","@type":"input"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"ConcatenateString","@package":"org.vistrails.vistrails.basic","@id":"19",portSpec:[{"@sortKey":"-1","@name":"str1","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"35","@type":"input"},{"@sortKey":"-1","@name":"str2","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"36","@type":"input"},{"@sortKey":"-1","@name":"str3","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"37","@type":"input"},{"@sortKey":"-1","@name":"str4","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"38","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"39","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Not","@package":"org.vistrails.vistrails.basic","@id":"20",portSpec:[{"@sortKey":"-1","@name":"input","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"40","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"41","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Dictionary","@package":"org.vistrails.vistrails.basic","@id":"21",portSpec:[{"@sortKey":"-1","@name":"addPair","#tail":"\n      ",portSpecItem:[{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n        ","@values":"","@module":"Module","@id":"-1","@entryType":""},{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"1","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""}],"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"42","@type":"input"},{"@sortKey":"-1","@name":"addPairs","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"43","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Dictionary","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"79","@type":"input"},{"@sortKey":"-1","@name":"value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Dictionary","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"80","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"2"},{"@name":"Null","@package":"org.vistrails.vistrails.basic","@id":"22","@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"@name":"Variant","@package":"org.vistrails.vistrails.basic","@id":"23","@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Unpickle","@package":"org.vistrails.vistrails.basic","@id":"24",portSpec:[{"@sortKey":"-1","@name":"input","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"44","@type":"input"},{"@sortKey":"-1","@name":"result","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"45","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"PythonSource","@package":"org.vistrails.vistrails.basic","@id":"25",portSpec:[{"@sortKey":"-1","@name":"source","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"46","@type":"input"},{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Module","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"47","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"SmartSource","@package":"org.vistrails.vistrails.basic","@id":"26",portSpec:{"@sortKey":"-1","@name":"source","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"48","@type":"input"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Unzip","@package":"org.vistrails.vistrails.basic","@id":"27",portSpec:[{"@sortKey":"-1","@name":"archive_file","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"49","@type":"input"},{"@sortKey":"-1","@name":"filename_in_archive","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"50","@type":"input"},{"@sortKey":"-1","@name":"file","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"File","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"51","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Round","@package":"org.vistrails.vistrails.basic","@id":"28",portSpec:[{"@sortKey":"-1","@name":"in_value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Float","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"52","@type":"input"},{"@sortKey":"-1","@name":"out_value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Integer","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"53","@type":"output"},{"@sortKey":"-1","@name":"floor","#tail":"\n    ",portSpecItem:{"@default":"True","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"54","@type":"input"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"1"},{"#text":"\n      ","@name":"TupleToList","@package":"org.vistrails.vistrails.basic","@id":"29",portSpec:[{"@sortKey":"-1","@name":"in_value","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Tuple","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"55","@type":"input"},{"@sortKey":"-1","@name":"out_value","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"List","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"56","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"1"},{"#text":"\n      ","@name":"InputPort","@package":"org.vistrails.vistrails.basic","@id":"30",portSpec:[{"@sortKey":"-1","@name":"name","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"57","@type":"input"},{"@sortKey":"-1","@name":"optional","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"58","@type":"input"},{"@sortKey":"-1","@name":"spec","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"59","@type":"input"},{"@sortKey":"-1","@name":"ExternalPipe","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"60","@type":"input"},{"@sortKey":"-1","@name":"Default","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"61","@type":"input"},{"@sortKey":"-1","@name":"InternalPipe","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"62","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"OutputPort","@package":"org.vistrails.vistrails.basic","@id":"31",portSpec:[{"@sortKey":"-1","@name":"name","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"63","@type":"input"},{"@sortKey":"-1","@name":"optional","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Boolean","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"64","@type":"input"},{"@sortKey":"-1","@name":"spec","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"65","@type":"input"},{"@sortKey":"-1","@name":"InternalPipe","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"66","@type":"input"},{"@sortKey":"-1","@name":"ExternalPipe","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variant","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"67","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Group","@package":"org.vistrails.vistrails.basic","@id":"32",portSpec:{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Group","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"True","@minConns":"0","#text":"\n        ","@id":"68","@type":"output"},"@namespace":"","#tail":"\n    ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"0"},{"@name":"SubWorkflow","@package":"org.vistrails.vistrails.basic","@id":"33","@namespace":"","#tail":"\n  ","@packageVersion":"2.1","@version":"","@baseDescriptorId":"32"}],"@identifier":"org.vistrails.vistrails.basic","@codepath":"basic_modules","@id":"0"},{"@loadConfiguration":"True","@description":"No description available","@name":"My SubWorkflows","#tail":"\n  ","@version":"1.6","@identifier":"local.abstractions","@codepath":"abstraction","@id":"1"},{"@loadConfiguration":"True","@description":"No description available","#text":"\n    ","@name":"Climate","#tail":"\n","@version":"0.9.0",moduleDescriptor:[{"#text":"\n      ","@name":"Average","@package":"org.opengeoscience.geoweb.climate","@id":"34",portSpec:[{"@sortKey":"-1","@name":"variable","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"81","@type":"input"},{"@sortKey":"-1","@name":"axis","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"82","@type":"input"},{"@sortKey":"-1","@name":"variable","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"83","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"ToGeoJSON","@package":"org.opengeoscience.geoweb.climate","@id":"35",portSpec:[{"@sortKey":"-1","@name":"variable","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"84","@type":"input"},{"@sortKey":"-1","@name":"JSON","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"85","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Dataset","@package":"org.opengeoscience.geoweb.climate","@id":"36",portSpec:[{"@sortKey":"-1","@name":"file","#tail":"\n      ",portSpecItem:{"@default":"","@package":"edu.utah.sci.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"86","@type":"input"},{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Dataset","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"87","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"Variable","@package":"org.opengeoscience.geoweb.climate","@id":"37",portSpec:[{"@sortKey":"-1","@name":"dataset","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Dataset","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"88","@type":"input"},{"@sortKey":"-1","@name":"time","#tail":"\n      ",portSpecItem:{"@default":"","@package":"edu.utah.sci.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Integer","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"89","@type":"input"},{"@sortKey":"-1","@name":"name","#tail":"\n      ",portSpecItem:{"@default":"","@package":"edu.utah.sci.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"90","@type":"input"},{"@sortKey":"-1","@name":"self","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"91","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"SubSelect","@package":"org.opengeoscience.geoweb.climate","@id":"38",portSpec:[{"@sortKey":"-1","@name":"variable","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"92","@type":"input"},{"@sortKey":"-1","@name":"axis","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"93","@type":"input"},{"@sortKey":"-1","@name":"start","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"94","@type":"input"},{"@sortKey":"-1","@name":"end","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.vistrails.vistrails.basic","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"String","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"95","@type":"input"},{"@sortKey":"-1","@name":"variable","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"96","@type":"output"}],"@namespace":"","#tail":"\n    ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"},{"#text":"\n      ","@name":"MonthlyTimeBounds","@package":"org.opengeoscience.geoweb.climate","@id":"39",portSpec:[{"@sortKey":"-1","@name":"variable","#tail":"\n      ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"97","@type":"input"},{"@sortKey":"-1","@name":"variable","#tail":"\n    ",portSpecItem:{"@default":"","@package":"org.opengeoscience.geoweb.climate","@pos":"0","@label":"","@namespace":"","#tail":"\n      ","@values":"","@module":"Variable","@id":"-1","@entryType":""},"@maxConns":"-1","@optional":"False","@minConns":"0","#text":"\n        ","@id":"98","@type":"output"}],"@namespace":"","#tail":"\n  ","@packageVersion":"0.9.0","@version":"","@baseDescriptorId":"0"}],"@identifier":"org.opengeoscience.geoweb.climate","@codepath":"Climate","@id":"2"}],"@version":"1.0.3","@{http://www.w3.org/2001/XMLSchema-instance}schemaLocation":"http://www.vistrails.org/registry.xsd","#text":"\n  ","@id":""};
wflModule.inputModule=function(e,t){"use strict";if(!(this instanceof wflModule.inputModule)){return new wflModule.inputModule(e,t)}this.inputPortClass=wflModule.inputPort;this.outputPortClass=wflModule.outputPort;wflModule.module.call(this,e,t);var i=this,n,a=this.recomputeMetrics,o=this.getMetrics;this.recomputeMetrics=function(e,t){a.call(this,e,t);var i=o.call(this),r,s=t.module.port.width,l,u=15,d=t.module.port.inputHeight+u+t.module.port.inputYPad+t.module.port.inpad,c=u+t.module.port.outpad,p=this.inPortCount()*d+t.module.text.xpad,f=this.outPortCount()*c,m=this.data(),h=this.getFontMetrics(e,t),g=h.width+t.module.text.xpad*2,y=this.getInPorts().length>0?this.getInPorts()[0].getElement().width:t.module.port.inputWidth,v=Math.max(y+s*2+t.module.port.pad*4,g+t.module.text.xpad*2,t.module.minWidth),b=Math.max(p,f,t.module.minWidth)+t.module.text.ypad*2+u,w=Math.floor(this.data().location["@x"]-v/2),x=-Math.floor(this.data().location["@y"]),M=x+t.module.port.pad+u+s*2,S=x+b-t.module.port.pad-s;r={mx:w,my:x,fontMetrics:h,textWidth:g,moduleWidth:v,textHeight:u,moduleHeight:b,inPortX:w+t.module.port.pad,inPortY:M,outPortX:w+v-t.module.port.pad-s,outPortY:S,outPortTextX:w+y+s+t.module.port.pad*4};wflModule.utils.merge_options_in_place(i,r);n=i;for(l in this.getInPorts()){if(this.getInPorts().hasOwnProperty(l)){this.getInPorts()[l].setPosition(i.inPortX,M);M+=t.module.port.inputHeight+u+t.module.port.inputYPad+t.module.port.inpad}}for(l in this.getOutPorts()){if(this.getOutPorts().hasOwnProperty(l)){this.getOutPorts()[l].setPosition(i.outPortX,S);S-=u+t.module.port.outpad}}};this.getMetrics=function(){return n};this.draw=function(e,t){if(!n){this.recomputeMetrics(e,t)}var i=t.module,a=i.port.width,o=n.mx,r=n.my,s=this.getInPorts(),l=this.getOutPorts(),u;e.fillStyle=i.fill;e.lineWidth=i.lineWidth;e.strokeStyle=this.isSelected()?i.selectedStroke:i.stroke;e.save();if(this.isHover()){e.shadowBlur=i.shadowBlur;e.shadowColor=i.shadowColor}e.translate(o,r);wflModule.utils.roundRect(e,0,0,n.moduleWidth,n.moduleHeight,i.cornerRadius,true,true);e.restore();e.fillStyle=i.port.fill;e.strokeStyle=i.port.stroke;for(u in s){if(s.hasOwnProperty(u)){s[u].draw(e,a)}}for(u in l){if(l.hasOwnProperty(u)){l[u].draw(e,a)}}e.fillStyle=i.text.fill;e.font=i.text.font;e.fillText(this.data()["@name"],o+Math.floor((n.moduleWidth-n.fontMetrics.width)/2),r+n.textHeight+i.text.ypad)};this.updateElementPositions=function(){var e,t=this.getInPorts();for(e in t){t[e].updateElementPosition(t[e].x(),t[e].y())}};this.setInput=function(e,t){var i,n,a,o,r=this.getInPorts();for(i in r){if(r.hasOwnProperty(i)){n=r[i];if(n.data()["@name"]===e){$(n.getElement()).val(t);a=n.data().portSpecItem;o=a["@module"];this.addOrUpdateFunction(e,t,o);return}}}};return this};inherit(wflModule.inputModule,wflModule.module);wflModule.outputPort=function(e,t){"use strict";if(!(this instanceof wflModule.outputPort)){return new wflModule.outputPort(e,t)}wflModule.port.call(this,e,t);var i=0;this.draw=function(e,t){this.drawAsCircle(e,t)};this.drawName=function(e,t){var n=this.drawStyle(),a;e.fillStyle=n.module.text.fill;e.font=n.module.text.font;if(i===0){a=e.measureText(this.data()["@name"]);i=a.width}e.fillText(this.data()["@name"],this.x()-t-i,this.y()+t)};return this};inherit(wflModule.outputPort,wflModule.port);wflModule.inputPort=function(e,t){"use strict";if(!(this instanceof wflModule.inputPort)){return new wflModule.inputPort(e,t)}wflModule.outputPort.call(this,e,t);var i=this,n,a=this.setPosition;this.getElement=function(){return n};this.drawName=function(e,t){var i=this.drawStyle();e.fillStyle=i.module.text.fill;e.font=i.module.text.font;e.fillText(this.data()["@name"],this.x()+t*2,this.y()+t)};function o(e){n=document.createElement("input");n.type="text";n.placeholder=wflModule.utils.defaultValue(e,"");$(n).css({position:"absolute","pointer-events":"auto"}).change(function(){i.module().addOrUpdateFunction(i.data()["@name"],$(this).val(),i.data().portSpecItem["@module"])});i.setElementValueFromData()}this.setPosition=function(e,t){a(e,t);this.updateElementPosition(e,t)};this.updateElementPosition=function(e,t){var i=this.module().workflow().translated(),a=this.drawStyle();$(n).css({top:t+i.y-a.shadowBlur,left:e+i.x+a.module.port.width+a.module.port.pad-a.shadowBlur})};this.show=function(e){e.appendChild(n);$(n).show()};this.hide=function(){$(n).hide();$(n).detach()};this.setElementValueFromData=function(){$(n).val(i.module().getFunctionValue(i.data()["@name"]))};this.delete=function(){$(n).remove()};o(this.data()["@name"]);return this};inherit(wflModule.inputPort,wflModule.outputPort);wflModule.layerSource=function(e,t,i,n,a,o,r){"use strict";if(!(this instanceof wflModule.layerSource)){return new wflModule.layerSource(e,t,i,n,a,o,r)}geo.archiveLayerSource.call(this,e,t,i,n,a,r);var s=-1,l=this,u=wflModule.utils.defaultValue(r,function(e){}),d=o;this.getData=function(e,t){var i=false,n=[],a=null,o=null;if(s===e){console.log("[info] No new data as timestamp has not changed.");return l.resultCache()}s=e;function r(e,t){if(typeof t==="number"){return t.toString()}return t}if(t){i=true}if(!isNaN(parseFloat(s))){try{d.getModuleByName("Variable").setInput("time",s)}catch(c){console.log("[info] Unable to set time on workflow")}}$.ajax({type:"POST",url:"/services/vistrail/execute/",data:{workflowJSON:JSON.stringify(d.data(),r,2)},dataType:"json",async:i,success:function(e){if(e.error!==null){a="[error] "+e.error?e.error:"no results returned from server";console.log(a);u(a)}else{o=vgl.geojsonReader();n=o.readGJObject(jQuery.parseJSON(e.result))}},error:function(e,t,i){a="Error reading "+this.name()+": "+i;console.log(a);u(a)}});if(t){t(n)}l.p_setResultCache(n);return n};this.workflow=function(){return d};return this};inherit(wflModule.layerSource,geo.archiveLayerSource);wflModule.editorOptions=function(){"use strict";if(!(this instanceof wflModule.editorOptions)){return new wflModule.editorOptions}this.div=document.createElement("div");this.drawStyle=climatePipesStyle;return this};wflModule.editor=function(e){"use strict";this.events={moduleAdded:"moduleAdded",connectionAdded:"connectionAdded"};if(!(this instanceof wflModule.editor)){return new wflModule.editor(e)}vgl.object.call(this);e=typeof e!=="undefined"?e:{};e=wflModule.utils.merge_options(wflModule.editorOptions(),e);if(typeof e.div==="string"){e.div=document.getElementById(e.div)}var t=this,i=e.div,n=e.drawStyle,a=document.createElement("div"),o=document.createElement("table"),r=document.createElement("div"),s=document.createElement("div"),l=document.createElement("canvas"),u,d;this.setWorkflow=function(e){d=e};this.workflow=function(){return d};function c(){u=l.getContext("2d")}c();this.resize=function(){var e=r.getBoundingClientRect(),i=d.translated();l.width=e.width;l.height=e.height;c();u.translate(i.x,i.y);t.drawWorkflow()};this.show=function(){t.resize();d.show(s)};function p(){var e=document.styleSheets[0],t="[draggable]",i=["{-moz-user-select: none;","-khtml-user-select: none;","-webkit-user-select: none;","user-select: none;","-khtml-user-drag: element;","-webkit-user-drag: element;","cursor: move;}"].join(""),n;if(e.insertRule){try{n=e.cssRules?e.cssRules.length:0;e.insertRule(t+i,n)}catch(a){if(e.addRule){e.addRule(t,i,-1)}}}else if(e.addRule){e.addRule(t,i,-1)}}function f(){o.appendChild(document.createElement("tBody"));a.appendChild(o);r.appendChild(l);r.appendChild(s);i.appendChild(a);i.appendChild(r)}function m(){$(a).css({height:"100%",width:225,overflow:"auto","float":"left"});$(r).css({position:"relative",height:"100%",overflow:"hidden",cursor:n.cursor});$(s).css({position:"absolute",top:n.shadowBlur,left:n.shadowBlur,bottom:n.shadowBlur,right:n.shadowBlur,overflow:"hidden","pointer-events":"none"})}function h(){var e=new Image,t=new Image;e.onload=function(){n.module.fill=u.createPattern(e,"repeat")};e.src="/common/img/squairy_light.png";t.onload=function(){n.fill=u.createPattern(t,"repeat")};t.src="/common/img/tweed.png"}function g(e){var t=0,i=0,n=l,a=d.translated();do{t+=n.offsetLeft-n.scrollLeft;i+=n.offsetTop-n.scrollTop;n=n.offsetParent}while(n);return{x:e.pageX-t-a.x,y:e.pageY-i-a.y}}function y(){var e=$(l);e.on("dragover",function(e){if(e.originalEvent){e=e.originalEvent}if(e.preventDefault){e.preventDefault()}e.dataTransfer.dropEffect="copy"});e.on("drop",function(e){var i;if(e.originalEvent){e=e.originalEvent}if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}i=g(e);d.addNewModule(e.dataTransfer.getData("Text"),i.x,i.y);d.show(s);t.drawWorkflow();return false})}function v(e,t){var i=$(document.createElement("div")),n=$(document.createElement("td")),a=$(document.createElement("tr"));i.append(e["@name"]).attr("draggable","true").data("moduleInfo",e).on("dragstart",function(e){if(e.originalEvent){e=e.originalEvent}e.dataTransfer.effectAllowed="copy";e.dataTransfer.setData("Text",JSON.stringify($(this).data("moduleInfo")))});t.append(a.append(n.append(i)))}function b(){var e=$(o).find("tbody:last"),t,i,n,a,r;for(a=0;a<wflModule.registry.package.length;a++){t=wflModule.registry.package[a];i=t["@identifier"];if(!wflModule.utils.moduleRegistryMap.hasOwnProperty(i)){wflModule.utils.moduleRegistryMap[i]={}}if(t.hasOwnProperty("moduleDescriptor")){for(r=0;r<t.moduleDescriptor.length;r++){n=t.moduleDescriptor[r];wflModule.utils.moduleRegistryMap[i][n["@name"]]=n;v(n,e)}}}}function w(){var e=$(l),i,a,o,s,c,p,f,m,h=null,y=null,v=wflModule.connection();e.mousedown(function(e){var t;a=o=g(e);t=d.moduleByPos(o);if(t!==null){c=t.portByPos(o);if(c){p=o;f=t}else{m=t}return}i=true;s=e});e.mousemove(function(a){var l;function f(){y=h.portByPos(l);if(y!==null){y.setHover(true);$(r).css("cursor",n.module.port.cursor)}}function b(){h=d.moduleByPos(l);if(h!==null){h.setHover(true);t.drawWorkflow();$(r).css("cursor",n.module.cursor)}}if(m){l=g(a);m.data().location["@x"]+=l.x-o.x;m.data().location["@y"]-=l.y-o.y;m.recomputeMetrics(e[0].getContext("2d"),n);o=l;d.draw(u)}else if(c){o=g(a);d.draw(u);v.drawCurve(u,n,{cx1:p.x,cy1:p.y,cx2:o.x,cy2:o.y})}else if(i){d.translate(this.getContext("2d"),a.clientX-s.clientX,a.clientY-s.clientY);s=a;t.drawWorkflow();d.updateElementPositions()}else{l=g(a);if(h!==null){if(!h.contains(l)){h.setHover(false);t.drawWorkflow();$(r).css("cursor",n.cursor);b()}}else{b()}if(h!==null){if(y!==null){if(!y.contains(l)){y.setHover(false);$(r).css("cursor",n.module.cursor);f()}}else{f()}}}});e.mouseup(function(e){i=false;if(c){var n,r=d.modules(),s,l;for(s in r){if(r.hasOwnProperty(s)){l=r[s];if(l.contains(o)){n=l.portByPos(o);if(n){d.addConnection(f,c,l,n);break}}}}c=null;f=null;p=null;t.drawWorkflow()}else if(m){if(a.x===o.x&&a.y===o.y){m.toggleSelected();t.drawWorkflow()}}m=null});e.mouseout(function(e){i=false})}function x(){p();f();m();h();y();b();w()}this.drawWorkflow=function(){d.draw(u,n)};x();return this};inherit(wflModule.editor,vgl.object);var baseStyle={fill:"darkgray",module:{text:{fill:"#000000",font:"15pt wingdings teal",xpad:20,ypad:10},port:{width:15,pad:5,fill:"lightgray",stroke:"black",lineWidth:1},fill:"lightgray",stroke:"black",selectedStroke:"yellow",lineWidth:2,minWidth:100,ypad:40,xpad:20},conn:{stroke:"black",lineWidth:2,bezierOffset:75}};var vistrailStyle=jQuery.extend(true,{},baseStyle);var climatePipesStyle=jQuery.extend(true,{},baseStyle);climatePipesStyle.fill="teal";climatePipesStyle.module.port.inputHeight=30;climatePipesStyle.module.port.inputWidth=220;climatePipesStyle.module.port.inputYPad=5;climatePipesStyle.module.port.inpad=10;climatePipesStyle.module.port.outpad=10;climatePipesStyle.module.port.fill="white";climatePipesStyle.module.port.stroke="lightgreen";climatePipesStyle.module.port.lineWidth=2;climatePipesStyle.module.port.cursor="crosshair";climatePipesStyle.module.shadowBlur=10;climatePipesStyle.module.shadowColor="yellow";climatePipesStyle.module.cornerRadius=25;climatePipesStyle.module.lineWidth=5;climatePipesStyle.module.stroke="lightgreen";climatePipesStyle.module.cursor="pointer";climatePipesStyle.shadowBlur=10;climatePipesStyle.shadowColor="lightblue";climatePipesStyle.cornerRadius=25;climatePipesStyle.lineWidth=5;climatePipesStyle.stroke="lightgreen";climatePipesStyle.cursor="move";climatePipesStyle.conn.stroke="lightgreen";climatePipesStyle.conn.lineWidth=4;var staticWorkflows={Default:{workflow:{"@name":"untitled","@version":"1.0.3","@{http://www.w3.org/2001/XMLSchema-instance}schemaLocation":"http://www.vistrails.org/workflow.xsd",connection:[{"#tail":"\n  ","#text":"\n    ","@id":"0",port:[{"@moduleName":"Dataset","@name":"self","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Dataset)","@id":"0","@type":"source","@moduleId":"0"},{"@moduleName":"Variable","@name":"dataset","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Dataset)","@id":"1","@type":"destination","@moduleId":"1"}]},{"#tail":"\n  ","#text":"\n    ","@id":"1",port:[{"@moduleName":"Variable","@name":"self","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"2","@type":"source","@moduleId":"1"},{"@moduleName":"ToGeoJSON","@name":"variable","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"3","@type":"destination","@moduleId":"2"}]}],module:[{"@name":"Dataset","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n  ","@x":"320.0","@y":"-120.0","@id":"0"},"#text":"\n    ","@id":"0"},{"@name":"Variable","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n  ","@x":"750.0","@y":"-160.0","@id":"1"},"#text":"\n    ","@id":"1"},{"@name":"ToGeoJSON","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n","@cache":"1",location:{"#tail":"\n  ","@x":"1200.0","@y":"-260.0","@id":"2"},"#text":"\n    ","@id":"2"}],"@vistrail_id":"","#text":"\n  ","@id":"0"}},"10 Year Average":{workflow:{"@name":"untitled","@version":"1.0.3","@{http://www.w3.org/2001/XMLSchema-instance}schemaLocation":"http://www.vistrails.org/workflow.xsd",connection:[{"#tail":"\n  ","#text":"\n    ","@id":"1",port:[{"@moduleName":"Dataset","@name":"self","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Dataset)","@id":"2","@type":"source","@moduleId":"1"},{"@moduleName":"Variable","@name":"dataset","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Dataset)","@id":"3","@type":"destination","@moduleId":"2"}]},{"#tail":"\n  ","#text":"\n    ","@id":"2",port:[{"@moduleName":"Variable","@name":"self","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"4","@type":"source","@moduleId":"2"},{"@moduleName":"SubSelect","@name":"variable","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"5","@type":"destination","@moduleId":"3"}]},{"#tail":"\n  ","#text":"\n    ","@id":"3",port:[{"@moduleName":"SubSelect","@name":"variable","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"6","@type":"source","@moduleId":"3"},{"@moduleName":"MonthlyTimeBounds","@name":"variable","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"7","@type":"destination","@moduleId":"4"}]},{"#tail":"\n  ","#text":"\n    ","@id":"4",port:[{"@moduleName":"MonthlyTimeBounds","@name":"variable","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"8","@type":"source","@moduleId":"4"},{"@moduleName":"Average","@name":"variable","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"9","@type":"destination","@moduleId":"5"}]},{"#tail":"\n  ","#text":"\n    ","@id":"5",port:[{"@moduleName":"Average","@name":"variable","#tail":"\n    ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"10","@type":"source","@moduleId":"5"},{"@moduleName":"ToGeoJSON","@name":"variable","#tail":"\n  ","@signature":"(org.opengeoscience.geoweb.climate:Variable)","@id":"11","@type":"destination","@moduleId":"6"}]}],module:[{"function":{"@name":"file","#tail":"\n  ","@id":"6","@pos":"0","#text":"\n      ",parameter:{"@val":"","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"8","@type":"org.vistrails.vistrails.basic:String"}},"@name":"Dataset","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n    ","@x":"-259.0","@y":"-33.0","@id":"1"},"#text":"\n    ","@id":"1"},{"function":{"@name":"name","#tail":"\n  ","@id":"1","@pos":"0","#text":"\n      ",parameter:{"@val":"","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"9","@type":"org.vistrails.vistrails.basic:String"}},"@name":"Variable","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n    ","@x":"50.0","@y":"-177.0","@id":"7"},"#text":"\n    ","@id":"2"},{"function":[{"@name":"axis","#tail":"\n    ","@id":"2","@pos":"0","#text":"\n      ",parameter:{"@val":"time","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"2","@type":"org.vistrails.vistrails.basic:String"}},{"@name":"end","#tail":"\n    ","@id":"3","@pos":"1","#text":"\n      ",parameter:{"@val":"1983-01-01","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"3","@type":"org.vistrails.vistrails.basic:String"}},{"@name":"start","#tail":"\n  ","@id":"4","@pos":"2","#text":"\n      ",parameter:{"@val":"1973-01-01","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"4","@type":"org.vistrails.vistrails.basic:String"}}],"@name":"SubSelect","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n    ","@x":"380.0","@y":"-208.0","@id":"3"},"#text":"\n    ","@id":"3"},{"@name":"MonthlyTimeBounds","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n  ","@x":"705.0","@y":"-336.0","@id":"4"},"#text":"\n    ","@id":"4"},{"function":{"@name":"axis","#tail":"\n  ","@id":"5","@pos":"0","#text":"\n      ",parameter:{"@val":"t","@name":"<no description>","#tail":"\n    ","@pos":"0","@alias":"","@id":"5","@type":"org.vistrails.vistrails.basic:String"}},"@name":"Average","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n  ","@cache":"1",location:{"#tail":"\n    ","@x":"992.0","@y":"-508.0","@id":"5"},"#text":"\n    ","@id":"5"},{"@name":"ToGeoJSON","@package":"org.opengeoscience.geoweb.climate","@version":"0.9.0","@namespace":"","#tail":"\n","@cache":"1",location:{"#tail":"\n  ","@x":"1317.0","@y":"-532.0","@id":"6"},"#text":"\n    ","@id":"6"}],"@vistrail_id":"","#text":"\n  ","@id":"0"}}};(function(e,t){var i={mapOpts:{center:[0,0],zoom:3},baseLayer:"openStreetMaps"};e.fn.geojsMap=function(n){this.each(function(){var a=e(this),o,r,s,l;r=e.extend(true,{},i,n);l=new t.map(e.extend({},r.mapOpts,{node:this}));if(r.baseLayer==="openStreetMaps"){s=new t.osmLayer({renderer:"vglRenderer"}).referenceLayer(true)}else{throw"Invalid base layer "+r.baseLayer}l.addLayer(s);function u(){var e=a.width(),t=a.height();l.resize(0,0,e,t)}u();o={options:r,map:l,baseLayer:s};e(window).resize(u);e(this).data("geojs",o)})}})(window.$,window.geo);
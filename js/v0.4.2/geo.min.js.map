{"version":3,"file":"geo.min.js","sources":["../src/vgl/init.js","../src/core/init.js","../src/core/version.js","../src/vgl/GL.js","../src/vgl/timestamp.js","../src/vgl/object.js","../src/vgl/event.js","../src/vgl/boundingObject.js","../src/vgl/node.js","../src/vgl/groupNode.js","../src/vgl/actor.js","../src/vgl/freezeObject.js","../src/vgl/defaultValue.js","../src/vgl/geojsonReader.js","../src/vgl/data.js","../src/vgl/geomData.js","../src/vgl/mapper.js","../src/vgl/groupMapper.js","../src/vgl/materialAttribute.js","../src/vgl/blend.js","../src/vgl/material.js","../src/vgl/renderer.js","../src/vgl/renderWindow.js","../src/vgl/camera.js","../src/vgl/interactorStyle.js","../src/vgl/trackballInteractorStyle.js","../src/vgl/pvwInteractorStyle.js","../src/vgl/viewer.js","../src/vgl/shader.js","../src/vgl/shaderProgram.js","../src/vgl/texture.js","../src/vgl/uniform.js","../src/vgl/vertexAttribute.js","../src/vgl/source.js","../src/vgl/planeSource.js","../src/vgl/pointSource.js","../src/vgl/lineSource.js","../src/vgl/utils.js","../src/vgl/picker.js","../src/vgl/shapefileReader.js","../src/vgl/vtkReader.js","../src/vgl/DataBuffers.js","../src/util/init.js","../src/util/wigglemaps.js","../src/core/object.js","../src/core/sceneObject.js","../src/core/timestamp.js","../src/core/ellipsoid.js","../src/core/mercator.js","../src/core/latlng.js","../src/core/layer.js","../src/core/featureLayer.js","../src/core/event.js","../src/core/mapInteractor.js","../src/core/clock.js","../src/core/fileReader.js","../src/core/jsonReader.js","../src/core/map.js","../src/core/feature.js","../src/core/pointFeature.js","../src/core/lineFeature.js","../src/core/pathFeature.js","../src/core/polygonFeature.js","../src/core/planeFeature.js","../src/core/vectorFeature.js","../src/core/geomFeature.js","../src/core/graphFeature.js","../src/core/transform.js","../src/core/renderer.js","../src/core/osmLayer.js","../src/gl/init.js","../src/gl/renderer.js","../src/gl/lineFeature.js","../src/gl/pointFeature.js","../src/gl/geomFeature.js","../src/gl/planeFeature.js","../src/gl/polygonFeature.js","../src/gl/vglRenderer.js","../src/d3/init.js","../src/d3/object.js","../src/d3/pointFeature.js","../src/d3/lineFeature.js","../src/d3/pathFeature.js","../src/d3/graphFeature.js","../src/d3/planeFeature.js","../src/d3/vectorFeature.js","../src/d3/d3Renderer.js","../src/ui/init.js","../src/ui/uiLayer.js","../src/ui/widget.js","../src/ui/sliderWidget.js","../src/ui/legendWidget.js","../src/plugin/jquery-plugin.js"],"names":["inherit","C","P","F","prototype","uber","constructor","geo","window","renderers","features","fileReaders","func","registerFileReader","name","undefined","createFileReader","opts","hasOwnProperty","registerRenderer","createRenderer","layer","canvas","ren","_init","registerFeature","category","createFeature","renderer","arg","api","options","$","extend","registerLayer","layers","createLayer","map","registerWidget","widgets","createWidget","requestAnimationFrame","setTimeout","Math","log2","log","apply","arguments","LN2","version","ogs","namespace","ns_string","i","parts","split","parent","slice","length","vgl","Object","size","obj","key","GL","ColorBufferBit","DepthBufferBit","m_globalModifiedTime","timestamp","this","m_modifiedTime","modified","getMTime","object","event","call","keyPress","mousePress","mouseRelease","contextMenu","configure","enable","mouseWheel","keyRelease","middleButtonPress","startInteraction","enter","rightButtonPress","middleButtonRelease","disable","endInteraction","mouseMove","mouseOut","expose","timer","leftButtonPress","leave","rightButtonRelease","leftButtonRelease","click","dblClick","boundingObject","m_bounds","m_computeBoundsTimestamp","m_boundsDirtyTimestamp","bounds","hasValidBounds","Number","MAX_VALUE","setBounds","minX","maxX","minY","maxY","minZ","maxZ","resetBounds","computeBounds","computeBoundsTimestamp","boundsDirtyTimestamp","ReferenceFrame","Relative","Absolute","node","m_parent","m_material","m_visible","m_overlay","accept","visitor","visit","material","setMaterial","visible","setVisible","flag","setParent","removeChild","overlay","setOverlay","ascend","traverse","boundsModified","groupNode","m_children","b_setVisible","addChild","childNode","indexOf","push","index","splice","removeChildren","children","hasChild","child","type","UpdateVisitor","traverseChildrenAndUpdateBounds","CullVisitor","traverseChildren","mode","TraverseAllChildren","updateBounds","vesVisitor","childBounds","istep","jstep","actor","m_transformMatrix","mat4","create","m_referenceFrame","m_mapper","matrix","setMatrix","tmatrix","referenceFrame","setReferenceFrame","mapper","setMapper","computeLocalToWorldMatrix","computeWorldToLocalMatrix","mapperBounds","minPt","maxPt","newBounds","vec3","transformMat4","freezeObject","freezedObject","freeze","o","defaultValue","a","b","EMPTY_OBJECT","geojsonReader","readScalars","coordinates","geom","size_estimate","idx","array","s","r","g","m_scalarFormat","sourceData","vertexAttributeKeys","Scalar","sourceDataSf","m_scalarRange","setScalarRange","data","addSource","pushBack","insertAt","Color","sourceDataC3fv","readPoint","geometryData","vglpoints","points","vglcoords","sourceDataP3fv","indices","Uint16Array","x","y","z","setIndices","addPrimitive","setName","readMultiPoint","pntcnt","estpntcnt","readLineString","vglline","lineStrip","setIndicesPerPrimitive","readMultiLineString","j","thisLineLength","readPolygon","thisPolyLength","vl","vgltriangle","triangles","readMultiPolygon","ccount","numPolys","indexes","vf","flip","flipped","tcount","readGJObjectInt","properties","ScalarFormat","ScalarRange","ret","next","nextset","geometries","readGJObject","geometry","console","linearizeGeoms","geoms","toString","readGeomObject","getPrimitives","buffer","JSON","parse","scalarFormat","scalarRange","raster","point","lineString","polygon","Position","Normal","TextureCoordinate","primitive","m_indicesPerPrimitive","m_primitiveType","m_indicesValueType","m_indices","createIndices","numberOfIndices","sizeInBytes","BYTES_PER_ELEMENT","primitiveType","setPrimitiveType","indicesPerPrimitive","count","indicesValueType","setIndicesValueType","indicesArray","triangleStrip","gl","TRIANGLE_STRIP","UNSIGNED_SHORT","TRIANGLES","lines","LINES","LINE_STRIP","POINTS","vertexDataP3f","m_position","vertexDataP3N3f","m_normal","vertexDataP3T3f","m_texCoordinate","m_attributesMap","m_data","m_name","Date","toISOString","vglAttributeData","m_numberOfComponents","m_dataType","m_dataTypeSize","m_normalized","m_stride","m_offset","getData","dataToFloat32Array","Float32Array","setData","Array","addAttribute","dataType","sizeOfDataType","offset","stride","noOfComponents","normalized","newAttr","sizeOfArray","lengthOfArray","keys","numberOfComponents","sizeOfAttributeDataType","hasKey","numberOfAttributes","attributeNumberOfComponents","attributeDataType","attributeOffset","attributeStride","insert","sourceDataAnyfv","FLOAT","value","sourceDataP3T3f","sourceDataP3N3f","sourceDataT2fv","m_min","m_max","m_fixedmin","m_fixedmax","min","max","sourceDataDf","m_primitives","m_sources","source","sourceName","sourceByName","numberOfSources","numberOfPrimitives","boundsDirty","dirty","ib","jb","maxv","minv","vertexIndex","attr","findClosestVertex","vi","vPos","dx","dy","dz","dist","minDist","minIndex","sqrt","getPosition","getScalar","deleteVertexBufferObjects","m_buffers","deleteBuffer","createVertexBufferObjects","m_geomData","k","ks","bufferId","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","m_dynamicDraw","DYNAMIC_DRAW","STATIC_DRAW","m_bufferVertexAttributeMap","m_glCompileTimestamp","cleanUpDrawObjects","setupDrawObjects","m_dirty","m_color","dynamicDraw","geomBounds","color","setColor","setGeometryData","updateSourceBuffer","values","bufferIndex","bufferSubData","getSourceBuffer","render","renderState","vertexAttrib3fv","noOfPrimitives","bindVertexData","drawArrays","groupMapper","m_createMappersTimestamp","m_mappers","m_geomDataArray","geometryDataArray","setGeometryDataArray","materialAttributeType","Undefined","ShaderProgram","Texture","Blend","Depth","materialAttribute","m_type","m_enabled","enabled","setup","bind","undoBind","setupVertexData","undoBindVertexData","blendFunction","destination","m_source","m_destination","blendFuncSeparate","ONE","ONE_MINUS_SRC_ALPHA","blend","m_wasEnabled","m_blendFunction","SRC_ALPHA","isEnabled","BLEND","m_shaderProgram","shaderProgram","m_binNumber","m_textureAttributes","m_attributes","binNumber","setBinNumber","binNo","exists","uniform","attribute","setAttribute","textureUnit","remove","RenderBin","Base","Default","Opaque","Transparent","Overlay","m_modelViewMatrix","m_normalMatrix","m_projectionMatrix","m_sceneRoot","m_camera","camera","m_nearClippingPlaneTolerance","m_x","m_y","m_width","m_height","m_resizable","m_resetScene","m_layer","m_resetClippingRange","width","height","setLayer","layerNo","isResizable","setResizable","backgroundColor","clearColor","setBackgroundColor","setClearColor","sceneRoot","renSt","sortedActors","mvMatrixInv","DEPTH_TEST","depthFunc","LEQUAL","clearMask","clearDepth","clear","viewport","resetCamera","sort","multiply","viewMatrix","projectionMatrix","ortho","invert","transpose","vn","directionOfProjection","visibleBounds","center","diagonals","radius","aspect","viewAspect","angle","viewAngle","distance","vup","atan","tan","sin","viewUpDirection","abs","dot","setViewUpDirection","setFocalPoint","setPosition","resetCameraClippingRange","viewPlaneNormal","position","c","d","range","vec2","getParameter","DEPTH_BITS","setClippingRange","resize","positionAndResize","setViewAspect","addActor","hasActor","addActors","actors","removeActor","removeActors","removeAllActors","worldToDisplay","worldPt","viewProjectionMatrix","winX","winY","winZ","winW","clipPt","vec4","fromValues","displayToWorld","displayPt","viewProjectionInverse","focusDisplayPoint","focalPoint","focusWorldPt","resetScene","setResetScene","reset","resetClippingRange","setResetClippingRange","renderWindow","m_canvas","m_activeRender","m_renderers","windowSize","setWindowSize","windowPosition","setWindowPosition","activeRenderer","addRenderer","hasRenderer","setClearMask","removeRenderer","getRenderer","createWindow","getContext","e","deleteWindow","m_viewAngle","PI","m_focalPoint","m_centerOfRotation","m_viewUp","m_rightDir","m_near","m_far","m_viewAspect","m_directionOfProjection","m_viewPlaneNormal","m_viewMatrix","m_computeModelViewMatrixTime","m_computeProjectMatrixTime","m_left","m_right","m_top","m_bottom","m_enableTranslation","m_enableRotation","m_enableScale","m_enableParallelProjection","m_clearColor","m_clearDepth","m_clearMask","setViewAngleDegrees","setViewAngle","centerOfRotation","setCenterOfRotation","clippingRange","near","far","enableScale","setEnableScale","enableRotation","setEnableRotation","enableTranslation","setEnableTranslation","isEnabledParallelProjection","enableParallelProjection","setEnnableParallelProjection","setParallelProjection","left","right","top","bottom","computeDirectionOfProjection","computeViewPlaneNormal","computeViewMatrix","computeProjectionMatrix","mask","setClearDepth","depth","subtract","normalize","zoom","dir","pan","computeOrthogonalAxes","cross","rotate","mat","inverseCenterOfRotation","identity","translate","lookAt","perspective","interactorStyle","m_that","m_viewer","viewer","setViewer","on","handleMouseDown","handleMouseUp","handleMouseMove","handleMouseOut","handleMouseWheel","handleKeyPress","mouseContextMenu","handleContextMenu","handleClick","handleDoubleClick","trackballInteractorStyle","m_outsideCanvas","m_leftMouseBtnDown","m_rightMouseBtnDown","m_midMouseBtnDown","m_currPos","m_lastPos","fp","fdp","fwp","dp1","dp2","wp1","wp2","coords","m_zTrans","cam","relMouseCoords","button","view","originalEvent","wheelDelta","pvwInteractorStyle","m_renderer","m_coords","m_currentMousePos","m_focusWorldPt","m_focusDisplayPt","m_displayPt1","m_displayPt2","m_worldPt1","m_worldPt2","m_dx","m_dy","m_dz","m_leftMouseButtonDown","m_rightMouseButtonDown","m_middleMouseButtonDown","m_mouseLastPos","rens","secCameras","deltaxy","m_ready","m_interactorStyle","m_renderWindow","init","setInteractorStyle","style","fixedEvent","fix","preventDefault","state","trigger","pageX","pageY","totalOffsetX","totalOffsetY","canvasX","canvasY","currentElement","offsetLeft","scrollLeft","offsetTop","scrollTop","offsetParent","bindEventHandlers","unbindEventHandlers","off","shader","m_shaderHandle","m_compileTimestamp","m_shaderType","m_shaderSource","shaderHandle","shaderType","shaderSource","setShaderSource","compile","deleteShader","createShader","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","programHandle","m_programHandle","m_shaders","m_uniforms","m_vertexAttributes","m_uniformNameToLocation","m_vertexAttributeNameToLocation","queryUniformLocation","getUniformLocation","queryAttributeLocation","getAttribLocation","addShader","addUniform","addVertexAttribute","uniformLocation","attributeLocation","updateUniforms","callGL","link","linkProgram","getProgramParameter","LINK_STATUS","use","useProgram","cleanUp","deleteVertexAndFragment","deleteProgram","createProgram","bindAttributes","bindUniforms","update","bindAttribLocation","texture","activateTextureUnit","m_textureUnit","activeTexture","TEXTURE0","TEXTURE1","TEXTURE2","TEXTURE3","TEXTURE4","TEXTURE5","TEXTURE6","TEXTURE7","TEXTURE8","TEXTURE9","TEXTURE10","TEXTURE11","TEXTURE12","TEXTURE13","TEXTURE14","TEXTURE15","m_depth","m_textureHandle","m_pixelFormat","m_pixelDataType","m_internalFormat","m_image","m_setupTimestamp","deleteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","pixelStorei","UNPACK_ALIGNMENT","UNPACK_FLIP_Y_WEBGL","updateDimensions","computeInternalFormatUsingImage","texImage2D","image","setImage","setTextureUnit","unit","setWidth","setDepth","textureHandle","internalFormat","setInternalFormat","pixelFormat","setPixelFormat","pixelDataType","setPixelDataType","RGBA","UNSIGNED_BYTE","lookupTable","m_range","m_colorTable","Uint8Array","colorTable","setColorTable","colors","setRange","updateRange","getTypeNumberOfComponents","INT","BOOL","FLOAT_VEC2","INT_VEC2","BOOL_VEC2","FLOAT_VEC3","INT_VEC3","BOOLT_VEC3","FLOAT_VEC4","INT_VEC4","BOOL_VEC4","FLOAT_MAT3","FLOAT_MAT4","m_dataArray","get","set","location","m_numberElements","uniform1iv","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","FALSE","uniformMatrix4fv","modelViewUniform","projectionUniform","floatUniform","normalMatrixUniform","CountAttributeIndex","vertexAttributeKeysIndexed","Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","vertexAttribute","program","vertexAttribPointer","enableVertexAttribArray","disableVertexAttribArray","planeSource","m_origin","m_point1","m_point2","m_xresolution","m_yresolution","m_geom","setOrigin","setPoint1","setPoint2","ii","numPts","sourceTexCoords","tc","v1","v2","pts","posIndex","normIndex","colorIndex","texCoordIndex","positions","normals","texCoords","tristrip","sourcePositions","sourceColors","pointSource","m_this","m_positions","m_colors","m_textureCoords","m_size","getPositions","setPositions","getColors","setColors","getSize","setSize","setTextureCoordinates","texcoords","pointsPrimitive","sourceSize","lineSource","linesPrimitive","utils","computePowerOfTwo","pow","createTextureVertexShader","vertexShaderSource","join","VERTEX_SHADER","createTextureFragmentShader","fragmentShaderSource","FRAGMENT_SHADER","createRgbaTextureFragmentShader","createVertexShader","createPointVertexShader","createVertexShaderSolidColor","createVertexShaderColorMap","createFragmentShader","createPhongVertexShader","createPhongFragmentShader","createFragmentShaderSolidColor","context","createFragmentShaderColorMap","createPointSpritesVertexShader","createPointSpritesFragmentShader","createTextureMaterial","isRgba","prog","vertexShader","fragmentShader","posVertAttr","texCoordVertAttr","pointsizeUniform","samplerUniform","opacityUniform","createGeometryMaterial","pointSize","opacity","colorVertAttr","createPointGeometryMaterial","sizeVertAttr","createPhongMaterial","normalVertAttr","normalUniform","createColorMaterial","createColorMappedMaterial","lut","scalarVertAttr","lutMinUniform","lutMaxUniform","updateColorMappedMaterial","lutMin","lutMax","createSolidColorMaterial","createPointSpritesMaterial","heightUniform","vertexColorWeightUniform","scalarsToColors","useScalarsToColors","useVertexColors","createPlane","originX","originY","originZ","point1X","point1Y","point1Z","point2X","point2Y","point2Z","createTexturePlane","createPoints","createPointSprites","createLines","createColorLegend","varname","origin","countMajor","countMinor","createLabels","pt1","pt2","delta","axisLabelOffset","create2DTexture","toFixed","createTicksAndLabels","pt1X","pt1Y","pt1Z","pt2X","pt2Y","pt2Z","heightMajor","concat","group","textToWrite","textSize","font","alignment","baseline","bold","document","getElementById","ctx","createElement","display","fillStyle","fillRect","textAlign","textBaseline","fillText","picker","m_actors","getActors","pick","selectionX","selectionY","bb","tmin","tmax","tymin","tymax","tzmin","tzmax","fpoint","focusDisplayPt","cameraPos","ray","shapefileReader","SHP_NULL","SHP_POINT","SHP_POLYGON","SHP_POLYLINE","int8","charCodeAt","bint32","lint32","bint16","lint16","ldbl64","b0","b1","b2","b3","b4","b5","b6","b7","sign","exp","frac","lfloat32","str","chars","readHeader","code","shapetype","xmin","ymin","xmax","ymax","Box","vect","loadShx","appendIndex","Shapefile","path","ajax","url","mimeType","success","dbf_data","loadShp","localShapefile","shxFile","shx","shpFile","shp","dbfFile","dbf","shxReader","FileReader","onloadend","result","shpReader","shpData","dbfReader","dbfData","readAsBinaryString","loadDBF","level","num_entries","header_size","record_size","FIELDS_START","HEADER_LENGTH","header_offset","headers","records","record_offset","declare","record","header","trim","parseFloat","readRing","start","end","ring","readRecord","geom_type","num_parts","num_points","parts_start","points_start","rings","feature","vtkReader","m_base64Chars","m_reverseBase64Chars","m_vtkRenderedList","m_vtkObjectCount","m_vtkScene","m_node","END_OF_INPUT","m_base64Str","m_base64Count","m_pos","ntos","n","unN","unescape","readReverseBase64","nextCharacter","charAt","decode64","inBuffer","done","readNumber","ss","v","readF3Array","numberOfPoints","test","Int8Array","readColorArray","vglcolors","tmp","parseObject","vtkObject","colorMapData","shaderProg","atob","String","fromCharCode","parseLineData","parseMeshData","parsePointData","parseColorMapData","title","hasTransparency","numberOfIndex","temp","m","vgllines","p","copy","tcoord","vgltriangles","pn","vglVertexes","numColors","tmpArray","xrgb","numOfColors","orientation","numOfLabels","parseSceneMetadata","bgc","localWidth","localHeight","sceneRenderer","Renderers","LookAt","Background1","initScene","createViewer","deleteViewer","updateCanvas","numObjects","setVtkScene","scene","DataBuffers","initialSize","current","copyArray","dst","src","min_expand","new_size","newArray","len","oldArray","alloc","num","write","repeat","elem","setNumeric","isFinite","util","pointInPolygon","outer","inner","inside","forEach","vert","intersect","hole","isFunction","f","ensureFunction","randomString","floor","random","substring","convertColor","cssColors","parseInt","normalizeCoordinates","isArray","latlng","lng","lat","longitude","lon","latitude","elevation","elev","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","Vector2D","RangeNode","subtree","xrange","x_in","yrange","y_in","subquery","box","y_left","x_right","search","contains","x_left","RangeTree","root","_box","clone","y_right","area","vertex","intersects","union","centroid","add","sub","scale","div","zero","tol","omega","cos","xp","yp","intersect2dt","denom","num_t","t","intersect2dpos","num_s","m_eventHandlers","m_idleHandlers","m_deferredCount","onIdle","handler","addDeferred","defer","geoOn","geoTrigger","args","geoOff","filter","_exit","sceneObject","s_exit","s_trigger","s_addDeferred","s_onIdle","draw","childrenOnly","geoArgs","stopPropagation","_triggeredBy","ellipsoid","m_radii","m_radiiSquared","m_minimumRadius","m_maximumRadius","radii","radiiSquared","maximumRadius","minimumRadius","computeGeodeticSurfaceNormal","cosLatitude","transformPoint","gamma","transformGeometry","sourceDataArray","WGS84","UNIT_SPHERE","mercator","r_major","r_minor","spherical","long2tilex","rad","lat2tiley","long2tilex2","lat2tiley2","tilex2long","tiley2lat","y2lat","lat2y","deg2rad","rad2deg","ll2m","es","eccent","phi","sinphi","con","com","con2","ts","m2ll","pjPhi2","dphi","N_ITER","HALFPI","TOL","eccnth","Phi","arg1","arg2","arg3","m_lat","m_lng","m_elv","elv","val","m_style","bin","m_id","id","newLayerId","m_gcs","m_timeRange","m_map","m_isReference","m_initialized","m_rendererName","m_dataTime","m_updateTime","m_drawTime","m_sticky","sticky","m_active","active","gcs","transform","transformLayer","baseLayer","timeRange","append","dataTime","updateTime","drawTime","query","referenceLayer","initialized","toLocal","input","fromLocal","css","_update","_resize","w","h","currentId","spec","warn","featureLayer","m_features","s_init","s_update","s_draw","featureName","newFeature","deleteFeature","_render","request","layerAdd","layerRemove","drawEnd","mousemove","mouseclick","brush","brushend","brushstart","transitionstart","transitionend","clock","play","stop","pause","change","mouseover","mouseout","mouseon","mouseoff","mapInteractor","eventMatch","modifiers","m_mouse","buttons","alt","meta","shift","ctrl","calcSpeed","doRespond","m_disableThrottle","m_wait","m_wheelQueue","m_throttleTime","modifyVelocity","deltaT","sf","springForce","speed","vx","vy","m_options","momentum","drag","minSpeed","xplus","xminus","yplus","yminus","spring","ul","gcsToDisplay","lr","springConstant","m_keyboard","m_state","$node","m_selectionLayer","m_selectionPlane","panMoveButton","panMoveModifiers","zoomMoveButton","zoomMoveModifiers","panWheelEnabled","panWheelModifiers","zoomWheelEnabled","zoomWheelModifiers","wheelScaleX","wheelScaleY","zoomScale","selectionButton","selectionModifiers","maxSpeed","page","middle","time","deltaTime","velocity","_connectEvents","_disconnectEvents","_handleMouseMove","_handleMouseDown","_handleMouseUp","_handleMouseWheel","_getMousePosition","evt","dt","valueOf","displayToGcs","_getMouseButton","which","_getMouseModifiers","altKey","ctrlKey","metaKey","shiftKey","_getSelection","mouse","upperLeft","lowerRight","upperRight","lowerLeft","cancel","action","out","deleteLayer","screenCoordinates","fillOpacity","_handleMouseMoveDocument","_handleMouseUpDocument","selectionObj","oldAction","springBack","zoomFactor","direction","deltaFactor","deltaX","deltaY","initialVelocity","last","transition","_handleDoubleClick","destroy","keyboard","simulateEvent","Event","m_now","m_start","m_end","m_step","m_rate","m_loop","POSITIVE_INFINITY","m_currentLoop","m_currentAnimation","m_object","_attached","now","previous","step","loop","_animate","framerate","stepForward","_setNextFrame","stepBackward","frame","myAnimation","fileReader","newFileReader","progress","reader","onprogress","error","canRead","read","file","_getString","readAsText","_getArrayBuffer","jsonReader","strokeWidth","strokeColor","strokeOpacity","fillColor","File","match","_featureArray","_readObject","onDone","fileString","fail","_featureType","_getCoordinates","_getStyle","_done","allFeatures","fill","_addFeature","stroke","_buildData","coord","_style","line","resizeSelf","m_uigcs","uigcs","m_center","m_zoom","m_baseLayer","m_fileReader","m_interactor","m_validZoomRange","m_transition","m_queuedTransition","m_clock","autoResize","clampBounds","base","recenter","zoomLevel","screenPosition","eventType","_updateBounds","force","pt","corner1","corner2","screenDelta","newCenter","currentCenter","layerName","newLayer","target","toggle","layerToggle","world","output","save","readerType","addLayer","exit","interactor","dataTransfer","dropEffect","files","zoomRange","interp1","p0","p1","defaultInterp","zoom2z","z2zoom","anim","defaultOpts","duration","ease","interp","zCoord","cancelNavigation","cancelAnimation","l","m_selectionAPI","selectionAPI","m_bin","m_buildTime","m_selectedFeatures","_bindMouseHandlers","_unbindMouseHandlers","_handleMousemove","_handleMouseclick","_handleBrushend","_handleBrush","pointSearch","found","over","newFeatures","oldFeatures","lastTop","eventID","boxSearch","all","toLowerCase","drawables","_drawables","buildTime","_build","pointFeature","m_rangeTree","s_data","s_style","m_maxRadius","_updateRangeTree","ifound","q","pos","_boundingBox","defaultStyle","sprites","sprites_image","lineFeature","lineDist2","u","l2","dist2","ceil","err","partial","strokeStyle","pathFeature","polygonFeature","getCoordinates","posFunc","polyFunc","m_coordinates","poly","d0","m_polygon","coordinate","planeFeature","m_upperLeft","m_lowerRight","m_defaultDepth","m_drawOnAsyncResourceLoad","drawOnAsyncResourceLoad","vectorFeature","geomFeature","point_sprites","point_sprites_image","graphFeature","m_nodes","m_points","m_links","nodes","links","linkType","nodeFeature","linkFeatures","nLinks","osmTransformFeature","destGcs","inplace","yCoord","pointOffset","inPos","outPos","srcGcs","transformFeature","projPoint","projSrcGcs","proj4","Proj","projDestGcs","Point","osmLayer","transformCoordinates","handleLatLngCoordinates","xAcc","yAcc","writer","handleArrayCoordinates","zAcc","handleObjectCoordinates","xCoord","worldToGcs","isTileVisible","tile","m_visibleTilesRange","index_x","startX","endX","index_y","startY","endY","drawTiles","_removeTiles","m_pendingNewTilesStat","m_updateTimerId","updateOSMTiles","m_lastVisibleZoom","_addTiles","m_tileUrl","m_tiles","m_hiddenBinNumber","m_lastVisibleBinNumber","m_visibleBinNumber","m_pendingNewTiles","m_pendingInactiveTiles","m_numberOfCachedTiles","m_tileCacheSize","m_baseUrl","m_mapOpacity","m_imageFormat","m_updateDefer","baseUrl","mapOpacity","imageFormat","displayLast","tileUrl","tileCacheSize","_hasTile","_addTile","noOfTilesX","noOfTilesY","totalLatDegrees","lonPerTile","latPerTile","llx","lly","urx","ury","Image","LOADING","LOADED","REMOVED","REMOVING","INVALID","crossOrigin","lastused","currZoom","lastZoom","tileOnLoad","Deferred","updateTimerId","total","resolve","lastStartX","lastStartY","lastEndX","lastEndY","currStartX","currStartY","currEndX","currEndY","distWorldDeltaPerTile","tile1x","tile1y","tile2x","tile2y","invJ","worldPt1","worldPt2","worldDeltaY","displayDeltaY","worldDelta","displayDelta","noOfTilesRequired","worldDeltaPerTile","minDistWorldDeltaPerTile","round","onload","_updateTiles","clearTimeout","updateBaseUrl","contextRenderer","createGLLines","lineItem","lineItemData","vertTemp","posIdx3","posBuf","nextBuf","prevBuf","offsetBuf","indicesBuf","strokeWidthBuf","strokeColorBuf","strokeOpacityBuf","dest","dest3","numSegments","strkWidthFunc","strkColorFunc","strkOpacityFunc","order","featureVertices","getBuffer","prev","srcName","m_actor","m_pixelWidthUnif","m_aspectUniform","verticesPerFeature","vs","fs","posAttr","prvAttr","nxtAttr","offAttr","strkWidthAttr","strkColorAttr","strkOpacityAttr","mviUnif","prjUnif","posData","prvPosData","nxtPosData","offPosData","strkWidthData","strkColorData","strkOpacityData","pointPolygon","verts","m_primitiveShape","createGLPoints","posVal","unitBuf","radiusVal","radFunc","strokeVal","strokeFunc","strokeWidthVal","strokeWidthFunc","strokeOpacityVal","strokeOpactityFunc","strokeColorVal","strokeColorFunc","fillVal","fillFunc","fillOpacityVal","fillOpacityFunc","fillColorVal","fillColorFunc","item","ivpf","ivpf3","iunit","i3","vpf","m_pixelWidthUniform","primitiveShape","unitAttr","radAttr","strokeWidthAttr","fillColorAttr","fillAttr","strokeColorAttr","strokeAttr","fillOpacityAttr","strokeOpacityAttr","sourceUnits","sourceRadius","sourceStrokeWidth","sourceFillColor","sourceFill","sourceStrokeColor","sourceStroke","sourceAlpha","sourceStrokeOpacity","m_scalar","m_noOfPrimitives","m_onloadCallback","or","img","complete","createGLPolygons","itemIndex","polygonItemCoordIndex","fillColorNew","fillOpacityNew","polygonItem","buffers","sourceFillOpacity","trianglePrimitive","holes","extRing","extIndex","extLength","intIndex","posInstance","triangulator","PNLTRI","Triangulator","triangList","newTriangList","fillColorInstance","currentIndex","extRingCoords","intRingCoords","triangulate_polygon","newIndices","polygonIndex","polygonItemCoords","_vglViewerInstances","viewers","maps","vglViewerInstance","makeViewer","mapIdx","deleteCache","vglRenderer","m_contextRenderer","_updateRendererCamera","cr","focusPoint","centerDisplay","centerGeo","newCenterDisplay","newCenterGeo","newZ","d3","strLength","uniqueID","strArray","d3Rescale","_d3id","select","_removeFeature","pos_func","attributes","_convertScale","cx","cy","classes","_drawFeatures","svg","wrapStyle","ln","diag","diagonal","trg","selection","fill_color","markerID","updateMarkers","sel","_definitions","selectAll","_convertColor","getScale","scaleFactor","orig_func","size_func","cache","NEGATIVE_INFINITY","x1","y1","x2","y2","marker-end","d3Renderer","setAttrs","attrs","setStyles","styles","getMap","getGroup","m_svg","initCorners","m_corners","setTransform","m_scale","baseToLocal","localToBase","m_defs","rgb","_convertPosition","shadow","dataIndex","__render","gui","uiLayer","widgetName","newWidget","deleteWidget","widget","_deleteFeature","_createFeature","sliderWidget","put_icon","icon","m_xscale","m_yscale","m_plus","m_minus","m_track","m_nub","m_plusIcon","m_minusIcon","m_group","m_lowContrast","m_nubSize","m_highlightDur","respond","trans","zrange","x0","y0","linear","domain","classed","datum","cursor","mouseOver","clamp","legendWidget","m_categories","m_border","m_spacing","m_padding","categories","text","getBBox","applyColor","_scale","labels","nw","margin","stroke-width","fill-opacity","load","isColorKey","makeColorScale","acc","wrap","cannotHandle","doNotHandle","categorical","category10","category20","fn","geojsMap","Error","baseRenderer","_create","_map","element","_baseLayer","_layers","scl","_size","extent","redraw"],"mappings":"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","sourcesContent":["//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nif(typeof ogs === 'undefined') {\n  var ogs = {};\n}\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create namespace for the given name\n *\n * @param ns_string\n * @returns {*|{}}\n */\n//////////////////////////////////////////////////////////////////////////////\nogs.namespace = function(ns_string) {\n  'use strict';\n\n  var parts = ns_string.split('.'), parent = ogs, i;\n\n  // strip redundant leading global\n  if (parts[0] === \"ogs\") {\n    parts = parts.slice(1);\n  }\n  for (i = 0; i < parts.length; i += 1) {\n    // create a property if it doesn't exist\n    if (typeof parent[parts[i]] === \"undefined\") {\n      parent[parts[i]] = {};\n    }\n    parent = parent[parts[i]];\n  }\n  return parent;\n};\n\n/** vgl namespace */\nvar vgl = ogs.namespace(\"gl\");\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to define JS inheritance\n *\n * @param C\n * @param P\n */\n//////////////////////////////////////////////////////////////////////////////\nfunction inherit(C, P) {\n  \"use strict\";\n\n  var F = function() {\n  };\n  F.prototype = P.prototype;\n  C.prototype = new F();\n  C.uber = P.prototype;\n  C.prototype.constructor = C;\n}\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to get size of an object\n *\n * @param obj\n * @returns {number} *\n */\n//////////////////////////////////////////////////////////////////////////////\nObject.size = function(obj) {\n  \"use strict\";\n\n  var size = 0, key = null;\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      size++;\n    }\n  }\n  return size;\n};\n","/** @namespace */\nvar geo = {};     // jshint ignore: line\nwindow.geo = geo; // jshint ignore: line\n\ngeo.renderers = {};\ngeo.features = {};\ngeo.fileReaders = {};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to define JS inheritance\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.inherit = function (C, P) { // jshint ignore: line\n  \"use strict\";\n\n  var F = inherit.func();\n  F.prototype = P.prototype;\n  C.prototype = new F();\n  C.prototype.constructor = C;\n};\ngeo.inherit.func = function () {\n  \"use strict\";\n  return function () {};\n};\n\n// Should get rid of this at some point.\nwindow.inherit = geo.inherit;\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new file reader type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerFileReader = function (name, func) {\n  \"use strict\";\n\n  if (geo.fileReaders === undefined) {\n    geo.fileReaders = {};\n  }\n\n  geo.fileReaders[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new file reader\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createFileReader = function (name, opts) {\n  \"use strict\";\n\n  if (geo.fileReaders.hasOwnProperty(name)) {\n    return geo.fileReaders[name](opts);\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new renderer type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerRenderer = function (name, func) {\n  \"use strict\";\n\n  if (geo.renderers === undefined) {\n    geo.renderers = {};\n  }\n\n  geo.renderers[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the renderer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createRenderer  = function (name, layer, canvas) {\n  \"use strict\";\n\n  if (geo.renderers.hasOwnProperty(name)) {\n    var ren = geo.renderers[name](\n      {\"layer\": layer, \"canvas\": canvas}\n    );\n    ren._init();\n    return ren;\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new feature type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerFeature = function (category, name, func) {\n  \"use strict\";\n\n  if (geo.features === undefined) {\n    geo.features = {};\n  }\n\n  if (!(category in geo.features)) {\n    geo.features[category] = {};\n  }\n\n  // TODO Add warning if the name already exists\n  geo.features[category][name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the renderer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createFeature  = function (name, layer, renderer, arg) {\n  \"use strict\";\n\n  var category = renderer.api(),\n      options = {\"layer\": layer, \"renderer\": renderer};\n  if (category in geo.features && name in geo.features[category]) {\n    if (arg !== undefined) {\n      $.extend(true, options, arg);\n    }\n    return geo.features[category][name](options);\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new layer type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerLayer = function (name, func) {\n  \"use strict\";\n\n  if (geo.layers === undefined) {\n    geo.layers = {};\n  }\n\n  geo.layers[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the layer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createLayer = function (name, map, arg) {\n  \"use strict\";\n\n  /// Default renderer is vgl\n  var options = {\"map\": map, \"renderer\": \"vgl\"},\n      layer = null;\n\n  if (name in geo.layers) {\n    if (arg !== undefined) {\n      $.extend(true, options, arg);\n    }\n    layer = geo.layers[name](options);\n    layer._init();\n    return layer;\n  } else {\n    return null;\n  }\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new widget type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerWidget = function (category, name, func) {\n  \"use strict\";\n\n  if (geo.widgets === undefined) {\n    geo.widgets = {};\n  }\n\n  if (!(category in geo.widgets)) {\n    geo.widgets[category] = {};\n  }\n\n  // TODO Add warning if the name already exists\n  geo.widgets[category][name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the widget\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createWidget  = function (name, layer, renderer, arg) {\n  \"use strict\";\n\n  var category = renderer.api(),\n      options = {\"layer\": layer, \"renderer\": renderer};\n  if (category in geo.widgets && name in geo.widgets[category]) {\n    if (arg !== undefined) {\n      $.extend(true, options, arg);\n    }\n    return geo.widgets[category][name](options);\n  }\n  return null;\n};\n\n// Add a polyfill for window.requestAnimationFrame.\nif (!window.requestAnimationFrame) {\n  window.requestAnimationFrame = function (func) {\n    \"use strict\";\n\n    window.setTimeout(func, 15);\n  };\n}\n\n// Add a polyfill for Math.log2\nif (!Math.log2) {\n  Math.log2 = function () {\n    \"use strict\";\n\n    return Math.log.apply(Math, arguments) / Math.LN2;\n  };\n}\n","/*global geo*/\n\ngeo.version = \"0.4.1\";\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n/*global vgl, gl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Wrap GL enums. Currently to get values of the enums we need to create\n * or access the context.\n *\n * Using enums from here:\n * https://github.com/toji/dart-gl-enums/blob/master/lib/gl_enums.dart\n *\n * @class\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.GL = {\n   ColorBufferBit : 0x00004000,\n   DepthBufferBit : 0x00000100\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class timestamp\n *\n * @class\n * @returns {vgl.timestamp}\n */\n//////////////////////////////////////////////////////////////////////////////\nvar m_globalModifiedTime = 0;\n\nvgl.timestamp = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.timestamp)) {\n    return new vgl.timestamp();\n  }\n\n  var m_modifiedTime = 0;\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update modified time\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.modified = function() {\n    ++m_globalModifiedTime;\n    m_modifiedTime = m_globalModifiedTime;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get modified time\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.getMTime = function() {\n    return m_modifiedTime;\n  };\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class object\n *\n * @class\n * @returns {vgl.object}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.object = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.object)) {\n    return new vgl.object();\n  }\n\n  /** @private */\n  var m_modifiedTime = vgl.timestamp();\n  m_modifiedTime.modified();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Mark the object modified\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.modified = function() {\n    m_modifiedTime.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return modified time of the object\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getMTime = function() {\n    return m_modifiedTime.getMTime();\n  };\n\n  return this;\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class event\n *\n * @class event\n * @returns {vgl.event}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.event = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.event)) {\n    return new vgl.event();\n  }\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(vgl.event, vgl.object);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n *  types\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.event.keyPress = \"vgl.event.keyPress\";\nvgl.event.mousePress = \"vgl.event.mousePress\";\nvgl.event.mouseRelease = \"vgl.event.mouseRelease\";\nvgl.event.contextMenu = \"vgl.event.contextMenu\";\nvgl.event.configure = \"vgl.event.configure\";\nvgl.event.enable = \"vgl.event.enable\";\nvgl.event.mouseWheel = \"vgl.event.mouseWheel\";\nvgl.event.keyRelease = \"vgl.event.keyRelease\";\nvgl.event.middleButtonPress = \"vgl.event.middleButtonPress\";\nvgl.event.startInteraction = \"vgl.event.startInteraction\";\nvgl.event.enter = \"vgl.event.enter\";\nvgl.event.rightButtonPress = \"vgl.event.rightButtonPress\";\nvgl.event.middleButtonRelease = \"vgl.event.middleButtonRelease\";\nvgl.event.char = \"vgl.event.char\";\nvgl.event.disable = \"vgl.event.disable\";\nvgl.event.endInteraction = \"vgl.event.endInteraction\";\nvgl.event.mouseMove = \"vgl.event.mouseMove\";\nvgl.event.mouseOut = \"vgl.event.mouseOut\";\nvgl.event.expose = \"vgl.event.expose\";\nvgl.event.timer = \"vgl.event.timer\";\nvgl.event.leftButtonPress = \"vgl.event.leftButtonPress\";\nvgl.event.leave = \"vgl.event.leave\";\nvgl.event.rightButtonRelease = \"vgl.event.rightButtonRelease\";\nvgl.event.leftButtonRelease = \"vgl.event.leftButtonRelease\";\nvgl.event.click = \"vgl.event.click\";\nvgl.event.dblClick = \"vgl.event.dblClick\";\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class boundingObject\n *\n * @class\n * @return {vgl.boundingObject}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.boundingObject = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.boundingObject)) {\n    return new vgl.boundingObject();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_bounds = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0],\n      m_computeBoundsTimestamp = vgl.timestamp(),\n      m_boundsDirtyTimestamp = vgl.timestamp();\n\n  m_computeBoundsTimestamp.modified();\n  m_boundsDirtyTimestamp.modified();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get current bounds of the object\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bounds = function() {\n    return m_bounds;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if bounds are valid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasValidBounds = function(bounds) {\n    if (bounds[0] == Number.MAX_VALUE ||\n        bounds[1] == -Number.MAX_VALUE ||\n        bounds[2] == Number.MAX_VALUE ||\n        bounds[3] == -Number.MAX_VALUE ||\n        bounds[4] == Number.MAX_VALUE ||\n        bounds[5] == -Number.MAX_VALUE)  {\n      return false;\n    }\n\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set current bounds of the object\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBounds = function(minX, maxX, minY, maxY, minZ, maxZ) {\n    if (!this.hasValidBounds([minX, maxX, minY, maxY, minZ, maxZ])) {\n      return;\n    }\n\n    m_bounds[0] = minX;\n    m_bounds[1] = maxX;\n    m_bounds[2] = minY;\n    m_bounds[3] = maxY;\n    m_bounds[4] = minZ;\n    m_bounds[5] = maxZ;\n\n    this.modified();\n    m_computeBoundsTimestamp.modified();\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset bounds to default values\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetBounds = function() {\n    m_bounds[0] = Number.MAX_VALUE;\n    m_bounds[1] = -Number.MAX_VALUE;\n    m_bounds[2] = Number.MAX_VALUE;\n    m_bounds[3] = -Number.MAX_VALUE;\n    m_bounds[4] = Number.MAX_VALUE;\n    m_bounds[5] = -Number.MAX_VALUE;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the object\n   *\n   * Should be implemented by the concrete class\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds computation modification time\n   *\n   * @returns {vgl.timestamp}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBoundsTimestamp = function() {\n    return m_computeBoundsTimestamp;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds dirty timestamp\n   *\n   * @returns {vgl.timestamp}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boundsDirtyTimestamp = function() {\n    return m_boundsDirtyTimestamp;\n  };\n\n  this.resetBounds();\n\n  return this;\n};\n\nvgl.boundingObject.ReferenceFrame = {\n  \"Relative\" : 0,\n  \"Absolute\" : 1\n};\n\ninherit(vgl.boundingObject, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class node\n *\n * @class\n * @returns {vgl.node}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.node = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.node)) {\n    return new vgl.node();\n  }\n  vgl.boundingObject.call(this);\n\n  /** @private */\n  var m_parent = null,\n      m_material = null,\n      m_visible = true,\n      m_overlay = false;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Accept visitor for scene traversal\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n    visitor.visit(this);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active material used by the node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.material = function() {\n    return m_material;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set material to be used the node\n   *\n   * @param material\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMaterial = function(material) {\n    if (material !== m_material) {\n      m_material = material;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the node is visible or node\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function() {\n    return m_visible;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn ON/OFF visibility of the node\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVisible = function(flag) {\n    if (flag !== m_visible) {\n      m_visible = flag;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return current parent of the node\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parent = function() {\n    return m_parent;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set parent of the node\n   *\n   * @param parent\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setParent = function(parent) {\n    if (parent !== m_parent) {\n      if (m_parent !== null) {\n        m_parent.removeChild(this);\n      }\n      m_parent = parent;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the node is an overlay node\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.overlay = function() {\n    return m_overlay;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set if the node is an overlay node or not\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setOverlay = function(flag) {\n    if (m_overlay !== flag) {\n      m_overlay = flag;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n   * Traverse parent and their parent and so on\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ascend = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse children\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverse = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Mark that the bounds are modified\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boundsModified = function() {\n    // @todo Implement this\n    this.boundsDirtyTimestamp().modified();\n\n    if (m_parent !== null) {\n      m_parent.boundsModified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.node, vgl.boundingObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class groupNode\n *\n * @class\n * @returns {vgl.groupNode}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.groupNode = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.groupNode)) {\n    return new vgl.groupNode();\n  }\n  vgl.node.call(this);\n\n  var m_children = [];\n\n  // Reference to base class methods\n  this.b_setVisible = this.setVisible;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn on / off visibility\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVisible = function(flag) {\n    var i;\n\n    if (this.b_setVisible(flag) !== true) {\n      return false;\n    }\n\n    for (i = 0; i < m_children.length; ++i) {\n      m_children[i].setVisible(flag);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Make the incoming node as child of the group node\n   *\n   * @param childNode\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addChild = function(childNode) {\n    if (childNode instanceof vgl.node) {\n      if (m_children.indexOf(childNode) === -1) {\n        childNode.setParent(this);\n        m_children.push(childNode);\n        this.boundsDirtyTimestamp().modified();\n        return true;\n      }\n      return false;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove parent-child relationship between the group and incoming node\n   *\n   * @param childNode\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeChild = function(childNode) {\n    if (childNode.parent() === this) {\n      var index = m_children.indexOf(childNode);\n      m_children.splice(index, 1);\n      this.boundsDirtyTimestamp().modified();\n      return true;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove parent-child relationship between child nodes and the group node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeChildren = function() {\n    var i;\n    for (i = 0; i < m_children.length; ++i) {\n      this.removeChild(m_children[i]);\n    }\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return children of this group node\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.children = function() {\n    return m_children;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return true if this group node has node as a child, false otherwise.\n   *\n   * @param node\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasChild = function(node) {\n    var i = 0, child = false;\n\n    for (i = 0; i < m_children.length; i++) {\n      if (m_children[i] === node) {\n        child = true;\n        break;\n      }\n    }\n\n    return child;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Accept a visitor and traverse the scene tree\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n    visitor.visit(this);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse the scene\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverse = function(visitor) {\n    switch (visitor.type()) {\n      case visitor.UpdateVisitor:\n        this.traverseChildrenAndUpdateBounds(visitor);\n        break;\n      case visitor.CullVisitor:\n        this.traverseChildren(visitor);\n        break;\n      default:\n        break;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse all of the children and update the bounds for each\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverseChildrenAndUpdateBounds = function(visitor) {\n    var i;\n\n    if (this.m_parent && this.boundsDirtyTimestamp().getMTime() >\n      this.computeBoundsTimestamp().getMTime()) {\n      // Flag parents bounds dirty.\n      this.m_parent.boundsDirtyTimestamp.modified();\n    }\n\n    this.computeBounds();\n\n    if (visitor.mode() === visitor.TraverseAllChildren) {\n      for (i = 0; i < m_children.length(); ++i) {\n        m_children[i].accept(visitor);\n        this.updateBounds(m_children[i]);\n      }\n    }\n\n    this.computeBoundsTimestamp().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse children of the group node\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverseChildren = function(visitor) {\n    var i;\n\n    if (visitor.mode() === vgl.vesVisitor.TraverseAllChildren) {\n      for (i = 0; i < m_children.length(); ++i) {\n        m_children[i].accept(visitor);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds for the group node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    var i = 0;\n\n    if (this.computeBoundsTimestamp().getMTime() >\n        this.boundsDirtyTimestamp().getMTime()) {\n      return;\n    }\n\n    for (i = 0; i < m_children.length; ++i) {\n      this.updateBounds(m_children[i]);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update bounds for the group node\n   *\n   * This method is used internally to update bounds of the group node by\n   * traversing each of its child.\n   *\n   * @param child\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateBounds = function(child) {\n    // FIXME: This check should not be required and possibly is incorrect\n    if (child.overlay()) {\n      return;\n    }\n\n    // Make sure that child bounds are upto date\n    child.computeBounds();\n\n    var bounds = this.bounds(),\n        childBounds = child.bounds(),\n        istep = 0,\n        jstep = 0,\n        i;\n\n    for (i = 0; i < 3; ++i) {\n      istep = i * 2;\n      jstep = i * 2 + 1;\n      if (childBounds[istep] < bounds[istep]) {\n        bounds[istep] = childBounds[istep];\n      }\n      if (childBounds[jstep] > bounds[jstep]) {\n        bounds[jstep] = childBounds[jstep];\n      }\n    }\n\n    this.setBounds(bounds[0], bounds[1], bounds[2], bounds[3],\n                   bounds[4], bounds[5]);\n  };\n\n  return this;\n};\n\ninherit(vgl.groupNode, vgl.node);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class actor\n *\n * @class\n * @returns {vgl.actor}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.actor = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.actor)) {\n    return new vgl.actor();\n  }\n  vgl.node.call(this);\n\n  /** @private */\n  var m_transformMatrix = mat4.create(),\n      m_referenceFrame = vgl.boundingObject.ReferenceFrame.Relative,\n      m_mapper = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get transformation matrix used by the actor\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.matrix = function() {\n    return m_transformMatrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set transformation matrix for the actor\n   *\n   * @param {mat4} 4X4 transformation matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMatrix = function(tmatrix) {\n    if (tmatrix !== m_transformMatrix) {\n      m_transformMatrix = tmatrix;\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get reference frame for the transformations\n   *\n   * @returns {String} Possible values are Absolute or Relative\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.referenceFrame = function() {\n    return m_referenceFrame;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set reference frame for the transformations\n   *\n   * @param {vgl.boundingObject.ReferenceFrame}\n   * referenceFrame Possible values are (Absolute | Relative)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setReferenceFrame = function(referenceFrame) {\n    if (referenceFrame !== m_referenceFrame) {\n      m_referenceFrame = referenceFrame;\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return mapper where actor gets it behavior and data\n   *\n   * @returns {vgl.mapper}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.mapper = function() {\n    return m_mapper;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect an actor to its data source\n   *\n   * @param {vgl.mapper}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMapper = function(mapper) {\n    if (mapper !== m_mapper) {\n      m_mapper = mapper;\n      this.boundsModified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ascend = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute object space to world space matrix\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeLocalToWorldMatrix = function(matrix, visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute world space to object space matrix\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeWorldToLocalMatrix = function(matrix, visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute actor bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_mapper === null || m_mapper === undefined) {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        mapperBounds, minPt, maxPt, actorMatrix, newBounds;\n\n    if (this.boundsDirtyTimestamp().getMTime() > computeBoundsTimestamp.getMTime() ||\n      m_mapper.boundsDirtyTimestamp().getMTime() > computeBoundsTimestamp.getMTime()) {\n\n      m_mapper.computeBounds();\n      mapperBounds = m_mapper.bounds();\n\n      minPt = [mapperBounds[0], mapperBounds[2], mapperBounds[4]];\n      maxPt = [mapperBounds[1], mapperBounds[3], mapperBounds[5]];\n\n      vec3.transformMat4(minPt, minPt, m_transformMatrix);\n      vec3.transformMat4(maxPt, maxPt, m_transformMatrix);\n\n      newBounds = [\n        minPt[0] > maxPt[0] ? maxPt[0] : minPt[0],\n        minPt[0] > maxPt[0] ? minPt[0] : maxPt[0],\n        minPt[1] > maxPt[1] ? maxPt[1] : minPt[1],\n        minPt[1] > maxPt[1] ? minPt[1] : maxPt[1],\n        minPt[2] > maxPt[2] ? maxPt[2] : minPt[2],\n        minPt[2] > maxPt[2] ? minPt[2] : maxPt[2]\n      ];\n\n      this.setBounds(newBounds[0], newBounds[1],\n                     newBounds[2], newBounds[3],\n                     newBounds[4], newBounds[5]);\n\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.actor, vgl.node);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Freeze javascript object\n *\n * @param obj\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.freezeObject = function(obj) {\n  'use strict';\n\n  /**\n   * Freezes an object, using Object.freeze if available, otherwise returns\n   * the object unchanged.  This function should be used in setup code to prevent\n   * errors from completely halting JavaScript execution in legacy browsers.\n   *\n   * @exports freezeObject\n   */\n  var freezedObject = Object.freeze(obj);\n  if (typeof freezedObject === 'undefined') {\n    freezedObject = function(o) {\n      return o;\n    };\n  }\n\n  return freezedObject;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Returns the first parameter if not undefined,\n * otherwise the second parameter.\n *\n * @class\n * @returns {vgl.defaultValue}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.defaultValue = function(a, b) {\n  'use strict';\n\n  if (typeof a !== 'undefined') {\n    return a;\n  }\n  return b;\n};\n\nvgl.defaultValue.EMPTY_OBJECT = vgl.freezeObject({});\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $, Uint16Array*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geojson reader\n *\n * This contains code that reads a geoJSON file and produces rendering\n * primitives from it.\n *\n * @class\n * @returns {vgl.geojsonReader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.geojsonReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.geojsonReader)) {\n    return new vgl.geojsonReader();\n  }\n\n  var m_scalarFormat = \"none\",\n      m_scalarRange = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read scalars\n   *\n   * @param coordinates\n   * @param geom\n   * @param size_estimate\n   * @param idx\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readScalars = function(coordinates, geom, size_estimate, idx) {\n    var array = null,\n        s = null,\n        r  = null,\n        g = null,\n        b = null;\n\n    if (this.m_scalarFormat === \"values\" && coordinates.length === 4)\n    {\n      s = coordinates[3];\n      array = geom.sourceData(vgl.vertexAttributeKeys.Scalar);\n\n      if (!array) {\n        array = new vgl.sourceDataSf();\n        if (this.m_scalarRange) {\n          array.setScalarRange(this.m_scalarRange[0],this.m_scalarRange[1]);\n        }\n        if (size_estimate !== undefined) {\n          //array.length = size_estimate; //no, slow on Safari\n          array.data().length = size_estimate;\n        }\n        geom.addSource(array);\n      }\n      if (size_estimate === undefined) {\n        array.pushBack(s);\n      } else {\n        array.insertAt(idx, s);\n      }\n    } else if (this.m_scalarFormat === \"rgb\" && coordinates.length === 6) {\n      array = geom.sourceData(vgl.vertexAttributeKeys.Color);\n      if (!array) {\n        array = new vgl.sourceDataC3fv();\n        if (size_estimate !== undefined) {\n          array.length = size_estimate*3;\n        }\n        geom.addSource(array);\n      }\n      r = coordinates[3];\n      g = coordinates[4];\n      b = coordinates[5];\n      if (size_estimate === undefined) {\n        array.pushBack([r,g,b]);\n      } else {\n        array.insertAt(idx, [r,g,b]);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read point data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readPoint = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglpoints = new vgl.points(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = new Uint16Array(1),\n        x = null,\n        y = null,\n        z = null,\n        i = null;\n\n    geom.addSource(vglcoords);\n    for (i = 0; i < 1; i++) {\n      indices[i] = i;\n\n      x = coordinates[0];\n      y = coordinates[1];\n      z = 0.0;\n      if (coordinates.length>2) {\n        z = coordinates[2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates, geom);\n    }\n\n    vglpoints.setIndices(indices);\n    geom.addPrimitive(vglpoints);\n    geom.setName(\"aPoint\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multipoint data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiPoint = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglpoints = new vgl.points(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = new Uint16Array(coordinates.length),\n        pntcnt = 0,\n        estpntcnt = coordinates.length,\n        x = null,\n        y = null,\n        z = null,\n        i;\n\n    //preallocate with size estimate\n    vglcoords.data().length = estpntcnt * 3; //x,y,z\n\n    for (i = 0; i < coordinates.length; i++) {\n      indices[i] = i;\n      x = coordinates[i][0];\n      y = coordinates[i][1];\n      z = 0.0;\n      if (coordinates[i].length>2) {\n        z = coordinates[i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.insertAt(pntcnt, [x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[i], geom, estpntcnt, pntcnt);\n\n      pntcnt++;\n    }\n\n    vglpoints.setIndices(indices);\n    geom.addPrimitive(vglpoints);\n    geom.addSource(vglcoords);\n    geom.setName(\"manyPoints\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read line string data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readLineString = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglline = new vgl.lineStrip(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = [],\n        i = null,\n        x = null,\n        y = null,\n        z = null;\n\n    vglline.setIndicesPerPrimitive(coordinates.length);\n\n    for (i = 0; i < coordinates.length; i++) {\n      indices.push(i);\n      x = coordinates[i][0];\n      y = coordinates[i][1];\n      z = 0.0;\n      if (coordinates[i].length>2) {\n        z = coordinates[i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[i], geom);\n    }\n\n    vglline.setIndices(indices);\n    geom.addPrimitive(vglline);\n    geom.addSource(vglcoords);\n    geom.setName(\"aLineString\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multi line string\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiLineString = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        pntcnt = 0,\n        //lines should be at least 2 verts long, underest OK\n        estpntcnt = coordinates.length * 2,\n        i = null,\n        j = null,\n        x = null,\n        y = null,\n        z = null,\n        indices = null,\n        vglline = null,\n        thisLineLength = null;\n\n    // Preallocate with size estimate\n    vglcoords.data().length = estpntcnt*3; //x,y,z\n\n    for (j = 0; j < coordinates.length; j++) {\n      indices = [];\n      //console.log(\"getting line \" + j);\n      vglline = new vgl.lineStrip();\n      thisLineLength = coordinates[j].length;\n      vglline.setIndicesPerPrimitive(thisLineLength);\n      for (i = 0; i < thisLineLength; i++) {\n        indices.push(pntcnt);\n        x = coordinates[j][i][0];\n        y = coordinates[j][i][1];\n        z = 0.0;\n        if (coordinates[j][i].length>2) {\n          z = coordinates[j][i][2];\n        }\n\n        //console.log(\"read \" + x + \",\" + y + \",\" + z);\n        vglcoords.insertAt(pntcnt, [x,y,z]);\n\n        //attributes\n        this.readScalars(coordinates[j][i], geom, estpntcnt*2, pntcnt);\n\n        pntcnt++;\n      }\n\n      vglline.setIndices(indices);\n      geom.addPrimitive(vglline);\n    }\n\n    geom.setName(\"aMultiLineString\");\n    geom.addSource(vglcoords);\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read polygon data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readPolygon = function(coordinates) {\n    //TODO: ignoring holes given in coordinates[1...]\n    //TODO: ignoring convex\n    //TODO: implement ear clipping in VGL instead of this to handle both\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        x = null,\n        y = null,\n        z  = null,\n        thisPolyLength = coordinates[0].length,\n        vl = 1,\n        i = null,\n        indices = null,\n        vgltriangle = null;\n\n\n    for (i = 0; i < thisPolyLength; i++) {\n      x = coordinates[0][i][0];\n      y = coordinates[0][i][1];\n      z = 0.0;\n      if (coordinates[0][i].length>2) {\n        z = coordinates[0][i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[0][i], geom);\n\n      if (i > 1) {\n        //console.log(\"Cutting new triangle 0,\"+ vl+ \",\"+ i);\n        indices = new Uint16Array([0,vl,i]);\n        vgltriangle = new vgl.triangles();\n        vgltriangle.setIndices(indices);\n        geom.addPrimitive(vgltriangle);\n        vl = i;\n      }\n    }\n\n    geom.setName(\"POLY\");\n    geom.addSource(vglcoords);\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multi polygon data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiPolygon = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        ccount = 0,\n        numPolys = coordinates.length,\n        pntcnt = 0,\n        estpntcnt = numPolys* 3, // assume triangles, underest is fine\n        vgltriangle = new vgl.triangles(),\n        indexes = [],\n        i = null,\n        j = null,\n        x = null,\n        y = null,\n        z  = null,\n        thisPolyLength = null,\n        vf = null,\n        vl = null,\n        flip = null,\n        flipped = false,\n        tcount = 0;\n\n\n    //var time1 = new Date().getTime()\n    //var a = 0;\n    //var b = 0;\n    //var c = 0;\n    //var d = 0;\n\n    //preallocate with size estimate\n    vglcoords.data().length = numPolys*3; //x,y,z\n    for (j = 0; j < numPolys; j++) {\n      //console.log(\"getting poly \" + j);\n\n      thisPolyLength = coordinates[j][0].length;\n      vf = ccount;\n      vl = ccount+1;\n      flip = [false,false,false];\n      for (i = 0; i < thisPolyLength; i++) {\n        //var timea = new Date().getTime()\n\n        x = coordinates[j][0][i][0];\n        y = coordinates[j][0][i][1];\n        z = 0.0;\n        if (coordinates[j][0][i].length>2) {\n          z = coordinates[j][0][i][2];\n        }\n        flipped = false;\n        if (x > 180) {\n          flipped = true;\n          x = x - 360;\n        }\n        if (i === 0) {\n          flip[0] = flipped;\n        } else {\n          flip[1+(i-1)%2] = flipped;\n        }\n        //var timeb = new Date().getTime();\n        //console.log(\"read \" + x + \",\" + y + \",\" + z);\n\n        vglcoords.insertAt(pntcnt, [x,y,z]);\n        //var timec = new Date().getTime();\n\n        //attributes\n        this.readScalars(coordinates[j][0][i], geom, estpntcnt, pntcnt);\n        pntcnt++;\n        //var timed = new Date().getTime()\n\n        if (i > 1) {\n          //if (vl < 50) {\n            //console.log(\"Cutting new triangle \" + tcount + \":\" + vf + \",\" + vl + \",\" + ccount);\n            //console.log(indexes);\n          //}\n          if (flip[0] === flip[1] && flip[1] === flip[2]) {\n              //indexes = indexes.concat([vf,vl,ccount]); //no, very slow in Safari\n              indexes[tcount*3+0] = vf\n              indexes[tcount*3+1] = vl\n              indexes[tcount*3+2] = ccount\n              tcount++;\n          }\n          //else {\n          //  //TODO: duplicate triangles that straddle boundary on either side\n          //}\n\n          vl = ccount;\n        }\n        ccount++;\n        //var timee = new Date().getTime()\n        //a = a + (timeb-timea)\n        //b = b + (timec-timeb)\n        //c = c + (timed-timec)\n        //d = d + (timee-timed)\n      }\n    }\n    vgltriangle.setIndices(indexes);\n    geom.addPrimitive(vgltriangle);\n\n    //console.log(\"NUMPOLYS \" + pntcnt);\n    //console.log(\"RMP: \", a, \",\", b, \",\", c, \",\", d)\n    //var time2 = new Date().getTime()\n\n    geom.setName(\"aMultiPoly\");\n    geom.addSource(vglcoords);\n    //var time3 = new Date().getTime()\n    //console.log(\"RMP: \", time2-time1, \",\", time3-time2)\n\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @param object\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readGJObjectInt = function(object) {\n    if (!object.hasOwnProperty('type')) {\n      //console.log(\"uh oh, not a geojson object\");\n      return null;\n    }\n\n    //look for properties type annotation\n    if (object.properties &&\n        object.properties.ScalarFormat &&\n        object.properties.ScalarFormat === \"values\") {\n      this.m_scalarFormat = \"values\";\n      if (object.properties.ScalarRange) {\n        this.m_scalarRange = object.properties.ScalarRange;\n      }\n    }\n    if (object.properties &&\n        object.properties.ScalarFormat &&\n        object.properties.ScalarFormat === \"rgb\") {\n      this.m_scalarFormat = \"rgb\";\n    }\n\n    //TODO: ignoring \"crs\" and \"bbox\" and misc meta data on all of these,\n    //best to handle as references into original probably\n    var ret,\n        type = object.type,\n        next = null,\n        nextset = null,\n        i = null;\n\n    switch (type) {\n      case \"Point\":\n        //console.log(\"parsed Point\");\n        ret = this.readPoint(object.coordinates);\n        break;\n      case \"MultiPoint\":\n        //console.log(\"parsed MultiPoint\");\n        ret = this.readMultiPoint(object.coordinates);\n        break;\n      case \"LineString\":\n        //console.log(\"parsed LineString\");\n        ret = this.readLineString(object.coordinates);\n        break;\n      case \"MultiLineString\":\n        //console.log(\"parsed MultiLineString\");\n        ret = this.readMultiLineString(object.coordinates);\n        break;\n      case \"Polygon\":\n        //console.log(\"parsed Polygon\");\n        ret = this.readPolygon(object.coordinates);\n        break;\n      case \"MultiPolygon\":\n        //console.log(\"parsed MultiPolygon\");\n        ret = this.readMultiPolygon(object.coordinates);\n        break;\n      case \"GeometryCollection\":\n        //console.log(\"parsed GeometryCollection\");\n        nextset = [];\n        for (i = 0; i < object.geometries.length; i++) {\n          next = this.readGJObject(object.geometries[i]);\n          nextset.push(next);\n        }\n        ret = nextset;\n        break;\n      case \"Feature\":\n        //console.log(\"parsed Feature\");\n        next = this.readGJObject(object.geometry);\n        ret = next;\n        break;\n      case \"FeatureCollection\":\n        //console.log(\"parsed FeatureCollection\");\n        nextset = [];\n        for (i = 0; i < object.features.length; i++) {\n          next = this.readGJObject(object.features[i]);\n          nextset.push(next);\n        }\n        ret = nextset;\n        break;\n      default:\n        console.log(\"Don't understand type \" + type);\n        ret = null;\n      break;\n    }\n    return ret;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @param object\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readGJObject = function(object) {\n    //var time1, time2;\n    var ret;\n    //time1 = new Date().getTime()\n    ret = this.readGJObjectInt(object);\n    //time2 = new Date().getTime()\n    //console.log(\"ELAPSED: \", time2-time1)\n    return ret;\n  };\n\n  /**\n   * Linearize geometries\n   *\n   * @param geoms\n   * @param geom\n   */\n  this.linearizeGeoms = function(geoms, geom) {\n    var i = null;\n\n    if( Object.prototype.toString.call( geom ) === '[object Array]' ) {\n      for (i = 0; i < geom.length; i++) {\n        this.linearizeGeoms(geoms, geom[i]);\n      }\n    }\n    else {\n     geoms.push(geom);\n   }\n };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read geometries from geojson object\n   *\n   * @param object\n   * @returns {Array}\n   */\n ////////////////////////////////////////////////////////////////////////////\n this.readGeomObject = function(object) {\n    var geom,\n        geoms = [];\n\n    geom = this.readGJObject(object);\n    this.linearizeGeoms(geoms, geom);\n    return geoms;\n };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Given a buffer get rendering primitives\n   *\n   * @param buffer\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPrimitives = function(buffer) {\n    //console.log(\"Parsing geoJSON\");\n    if (!buffer) {\n      return [];\n    }\n\n    var obj = JSON.parse(buffer),\n      geom = this.readGJObject(obj),\n      geoms = [];\n\n    this.m_scalarFormat = \"none\";\n    this.m_scalarRange = null;\n\n    this.linearizeGeoms(geoms, geom);\n\n    return { \"geoms\":geoms,\n             \"scalarFormat\":this.m_scalarFormat,\n             \"scalarRange\":this.m_scalarRange };\n  };\n\n  return this;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.data = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.data)) {\n    return new vgl.data();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return data type. Should be implemented by the derived class\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n  };\n};\n\nvgl.data.raster = 0;\nvgl.data.point = 1;\nvgl.data.lineString = 2;\nvgl.data.polygon = 3;\nvgl.data.geometry = 10;","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, Uint16Array, gl, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Vertex attribute keys\n *\n * @type {{Position: number, Normal: number, TextureCoordinate: number,\n *         Color: number, Scalar: number}}\n */\n//////////////////////////////////////////////////////////////////////////////\nvar vertexAttributeKeys = {\n  \"Position\" : 0,\n  \"Normal\" : 1,\n  \"TextureCoordinate\" : 2,\n  \"Color\" : 3,\n  \"Scalar\" : 4\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class primitive\n *\n * @class\n * @return {vgl.primitive}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.primitive = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.primitive)) {\n    return new vgl.primitive();\n  }\n\n  /** @private */\n  var m_indicesPerPrimitive = 0,\n      m_primitiveType = 0,\n      m_indicesValueType = 0,\n      m_indices = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get indices of the primitive\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indices = function() {\n    return m_indices;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create indices array for the primitive\n   * @param type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createIndices = function(type) {\n    // TODO Check for the type\n    m_indices = new Uint16Array();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the number of indices\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfIndices = function() {\n    return m_indices.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of indices in bytes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeInBytes = function() {\n    return m_indices.length * Uint16Array.BYTES_PER_ELEMENT;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n   * Return primitive type g\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.primitiveType = function() {\n    return m_primitiveType;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set primitive type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPrimitiveType = function(type) {\n    m_primitiveType = type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return count of indices that form a primitives\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indicesPerPrimitive = function() {\n    return m_indicesPerPrimitive;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set count of indices that form a primitive\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndicesPerPrimitive = function(count) {\n    m_indicesPerPrimitive = count;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return indices value type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indicesValueType = function() {\n    return m_indicesValueType;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set indices value type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndicesValueType = function(type) {\n    m_indicesValueType = type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set indices from a array\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndices = function(indicesArray) {\n    // TODO Check for the type\n    m_indices = new Uint16Array(indicesArray);\n  };\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class triangleStrip\n *\n * @returns {vgl.triangleStrip}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.triangleStrip = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.triangleStrip)) {\n    return new vgl.triangleStrip();\n  }\n\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.TRIANGLE_STRIP);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(3);\n\n  return this;\n};\n\ninherit(vgl.triangleStrip, vgl.primitive);\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class triangles\n *\n * @returns {vgl.triangles}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.triangles = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.triangles)) {\n    return new vgl.triangles();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.TRIANGLES);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(3);\n\n  return this;\n};\n\ninherit(vgl.triangles, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * create a instance of lines primitive type\n *\n * @returns {vgl.lines}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lines = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lines)) {\n    return new vgl.lines();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.LINES);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(2);\n\n  return this;\n};\ninherit(vgl.lines, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * create a instance of line strip primitive type\n *\n * @returns {vgl.lineStrip}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lineStrip = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lineStrip)) {\n    return new vgl.lineStrip();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.LINE_STRIP);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(2);\n\n  return this;\n};\ninherit(vgl.lineStrip, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class points\n *\n * @returns {vgl.points}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.points = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.points)) {\n    return new vgl.points();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.POINTS);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(1);\n\n  return this;\n};\n\ninherit(vgl.points, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3f\n *\n * @returns {vgl.vertexDataP3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3f)) {\n    return new vgl.vertexDataP3f();\n  }\n\n  /** @private */\n  this.m_position = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3N3f\n *\n * @class\n * @returns {vgl.vertexDataP3N3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3N3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3N3f)) {\n    return new vgl.vertexDataP3N3f();\n  }\n\n  this.m_position = [];\n  this.m_normal = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3T3f\n *\n * @class\n * @returns {vgl.vertexDataP3T3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3T3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3T3f)) {\n    return new vgl.vertexDataP3T3f();\n  }\n\n  this.m_position = [];\n  this.m_texCoordinate = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceData\n * @class\n * @returns {vgl.sourceData}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceData = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceData)) {\n    return new vgl.sourceData(arg);\n  }\n\n  arg = arg || {};\n  var m_attributesMap = {},\n      m_data = [],\n      m_name = arg.name || \"Source \" + new Date().toISOString(),\n\n      ////////////////////////////////////////////////////////////////////////////\n      /**\n       * Attribute data for the source\n       */\n      ////////////////////////////////////////////////////////////////////////////\n      vglAttributeData = function() {\n        // Number of components per group\n        // Type of data type (GL_FLOAT etc)\n        this.m_numberOfComponents = 0;\n            // Size of data type\n        this.m_dataType = 0;\n        this.m_dataTypeSize = 0;\n        // Specifies whether fixed-point data values should be normalized\n        // (true) or converted directly as fixed-point values (false)\n        // when they are accessed.\n        this.m_normalized = false;\n        // Strides for each attribute.\n        this.m_stride = 0;\n        // Offset\n        this.m_offset = 0;\n      };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return raw data for this source\n   *\n   * @returns {Array or Float32Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function() {\n    return m_data;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n /**\n   * Return raw data for this source\n   *\n   * @returns {Array or Float32Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getData = function() {\n    return data();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * If the raw data is not a Float32Array, convert it to one.  Then, return\n   * raw data for this source\n   *\n   * @returns {Float32Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.dataToFloat32Array = function () {\n    if (!(m_data instanceof Float32Array)) {\n      m_data = new Float32Array(m_data);\n    }\n    return m_data;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set data for this source\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setData = function (data) {\n    if (!(data instanceof Array) && !(data instanceof Float32Array)) {\n      console.log(\"[error] Requires array\");\n      return;\n    }\n    if (data instanceof Float32Array) {\n      m_data = data;\n    } else {\n      m_data = data.slice(0);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new attribute data to the source\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addAttribute = function(key, dataType, sizeOfDataType, offset, stride,\n                               noOfComponents, normalized) {\n\n    if (!m_attributesMap.hasOwnProperty(key)) {\n      var newAttr = new vglAttributeData();\n      newAttr.m_dataType = dataType;\n      newAttr.m_dataTypeSize = sizeOfDataType;\n      newAttr.m_offset = offset;\n      newAttr.m_stride = stride;\n      newAttr.m_numberOfComponents = noOfComponents;\n      newAttr.m_normalized = normalized;\n      m_attributesMap[key] = newAttr;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeOfArray = function() {\n    return Object.size(m_data);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return length of array\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.lengthOfArray = function() {\n    return m_data.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the source data in bytes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n    * TODO: code below is probably wrong.\n    *   Example:\n    *            format P3N3f\n    *            m_data = [ 1, 2, 3, 4, 5, 6 ]; // contains one vertex, one normal, m_data.length == 6\n    *\n    *       The inner loop computes:\n    *             sizeInBytes += 3 * 4; // for position\n    *             sizeInBytes += 3 * 4; // for normal\n    *\n    *        Then sizeInBytes *= 6; // m_data.length == 6\n    *        which gives sizeInBytes == 144 bytes when it should have been 4*6 = 24\n    */\n  this.sizeInBytes = function() {\n    var sizeInBytes = 0,\n        keys = this.keys(), i;\n\n    for (i = 0; i < keys.length(); ++i) {\n      sizeInBytes += this.numberOfComponents(keys[i])\n                     * this.sizeOfAttributeDataType(keys[i]);\n    }\n\n    sizeInBytes *= this.sizeOfArray();\n\n    return sizeInBytes;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if there is attribute exists of a given key type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasKey = function(key) {\n    return m_attributesMap.hasOwnProperty(key);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return keys of all attributes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.keys = function() {\n    return Object.keys(m_attributesMap);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of attributes of source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfAttributes = function() {\n    return Object.size(m_attributesMap);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of components of the attribute data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeNumberOfComponents = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_numberOfComponents;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if the attribute data is normalized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.normalized = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_normalized;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the attribute data type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeOfAttributeDataType = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_dataTypeSize;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute data type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeDataType = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_dataType;\n    }\n\n    return undefined;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute offset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeOffset = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_offset;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute stride\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeStride = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_stride;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual function to insert new vertex data at the end\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pushBack = function(vertexData) {\n    // Should be implemented by the base class\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Insert new data block to the raw data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.insert = function(data) {\n    var i;\n\n    //m_data = m_data.concat(data); //no, slow on Safari\n    /* If we will are given a Float32Array and don't have any other data, use\n     * it directly. */\n    if (!m_data.length && data.length && data instanceof Float32Array) {\n      m_data = data;\n      return;\n    }\n    /* If our internal array is immutable and we will need to change it, create\n     * a regular mutable array from it. */\n    if (!m_data.slice && (m_data.length || !data.slice)) {\n      m_data = Array.prototype.slice.call(m_data);\n    }\n    if (!data.length) {\n      /* data is a singular value, so append it to our array */\n      m_data[m_data.length] = data;\n    } else {\n      /* We don't have any data currently, so it is faster to copy the data\n       * using slice. */\n      if (!m_data.length && data.slice) {\n        m_data = data.slice(0);\n      } else {\n        for (i = 0; i < data.length; i++) {\n          m_data[m_data.length] = data[i];\n        }\n      }\n    }\n  };\n\n  this.insertAt = function(index, data) {\n    var i;\n\n    if (!data.length) {\n      m_data[index] = data;\n    } else {\n      for (i = 0; i < data.length; i++) {\n        m_data[index*data.length+i] = data[i];\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return name of the source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set name of the source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setName = function(name) {\n    m_name = name;\n  };\n\n\n  return this;\n};\n\n\nvgl.sourceDataAnyfv = function(size, key, arg) {\n  if (!(this instanceof vgl.sourceDataAnyfv)) {\n      return new vgl.sourceDataAnyfv(size, key, arg);\n    }\n\n    vgl.sourceData.call(this, arg);\n    this.addAttribute(key, gl.FLOAT,\n                      4, 0, size * 4, size, false);\n\n    this.pushBack = function(value) {\n      this.insert(value);\n    };\n\n    return this;\n};\ninherit(vgl.sourceDataAnyfv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3T3f\n *\n * @returns {vgl.sourceDataP3T3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3T3f = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3T3f)) {\n    return new vgl.sourceDataP3T3f(arg);\n  }\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 6 * 4, 3,\n                    false);\n  this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate, gl.FLOAT, 4, 12,\n                    6 * 4, 3, false);\n\n  this.pushBack = function(value) {\n    this.insert(value.m_position);\n    this.insert(value.m_texCoordinate);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3T3f, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3N3f\n *\n * @returns {vgl.sourceDataP3N3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3N3f = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3N3f)) {\n    return new vgl.sourceDataP3N3f(arg);\n  }\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 6 * 4, 3,\n                    false);\n  this.addAttribute(vgl.vertexAttributeKeys.Normal, gl.FLOAT, 4, 12, 6 * 4, 3,\n                    false);\n\n  this.pushBack = function(value) {\n    this.insert(value.m_position);\n    this.insert(value.m_normal);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3N3f, vgl.sourceData);\n\n/////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3fv\n *\n * @returns {vgl.sourceDataP3fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3fv = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3fv)) {\n    return new vgl.sourceDataP3fv(arg);\n  }\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 3 * 4, 3,\n                    false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataT2fv\n *\n * @returns {vgl.sourceDataT2fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataT2fv = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataT2fv)) {\n    return new vgl.sourceDataT2fv(arg);\n  }\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate, gl.FLOAT, 4, 0,\n                    2 * 4, 2, false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataT2fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataC3fv\n *\n * @returns {vgl.sourceDataC3fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataC3fv = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataC3fv)) {\n    return new vgl.sourceDataC3fv(arg);\n  }\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Color, gl.FLOAT, 4, 0, 3 * 4, 3, false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataC3fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataSf meant to hold scalar float values\n *\n * @class\n * @returns {vgl.sourceDataSf}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataSf = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataSf)) {\n    return new vgl.sourceDataSf(arg);\n  }\n\n  var m_min = null,\n      m_max = null,\n      m_fixedmin = null,\n      m_fixedmax = null;\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Scalar, gl.FLOAT, 4, 0, 4, 1, false);\n\n  this.pushBack = function(value) {\n    if (m_max === null || value > m_max) {\n      m_max = value;\n    }\n    if (m_min === null || value < m_min) {\n      m_min = value;\n    }\n    //this.insert(value); //no, slow on Safari\n    this.data()[this.data().length] = value;\n  };\n\n  this.insertAt = function(index, value) {\n    if (m_max === null || value > m_max) {\n      m_max = value;\n    }\n    if (m_min === null || value < m_min) {\n      m_min = value;\n    }\n    //call superclass ??\n    //vgl.sourceData.insertAt.call(this, index, value);\n    this.data()[index] = value;\n  };\n\n  this.scalarRange = function() {\n    if (m_fixedmin === null || m_fixedmax === null) {\n      return [m_min, m_max];\n    }\n\n    return [m_fixedmin, m_fixedmax];\n  };\n\n  this.setScalarRange = function(min, max) {\n    m_fixedmin = min;\n    m_fixedmax = max;\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataSf, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataDf meant to hold data float values\n *\n * This source array is the best way to pass a array of floats to the shader\n * that has one entry for each of the vertices.\n *\n * @class\n * @returns {vgl.sourceDataDf}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataDf = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataDf)) {\n    return new vgl.sourceDataDf(arg);\n  }\n\n  var m_min = null,\n      m_max = null,\n      m_fixedmin = null,\n      m_fixedmax = null;\n\n  vgl.sourceData.call(this, arg);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Scalar, gl.FLOAT,\n                    4, 0, 4, 1, false);\n\n  this.pushBack = function(value) {\n    this.data()[this.data().length] = value;\n  };\n\n  this.insertAt = function(index, value) {\n    this.data()[index] = value;\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataDf, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class geometryData\n *\n * @class\n * @returns {vgl.geometryData}\n */\n /////////////////////////////////////////////////////////////////////////////\nvgl.geometryData = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.geometryData)) {\n    return new vgl.geometryData();\n  }\n  vgl.data.call(this);\n\n  /** @private */\n  var m_name = \"\",\n      m_primitives = [],\n      m_sources = [],\n      m_bounds = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0],\n      m_computeBoundsTimestamp = vgl.timestamp(),\n      m_boundsDirtyTimestamp = vgl.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return vgl.data.geometry;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return ID of the geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set name of the geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setName = function(name) {\n    m_name = name;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new source\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addSource = function(source, sourceName) {\n    // @todo Check if the incoming source has duplicate keys\n\n    if (sourceName !== undefined) {\n        source.setName(sourceName);\n    }\n    // NOTE This might not work on IE8 or lower\n    if (m_sources.indexOf(source) === -1) {\n      m_sources.push(source);\n\n      if (source.hasKey(vgl.vertexAttributeKeys.Position)) {\n        m_boundsDirtyTimestamp.modified();\n      }\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return source for a given index. Returns 0 if not found.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.source = function(index) {\n    if (index < m_sources.length) {\n      return m_sources[index];\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return source with a specified name.  Returns 0 if not found.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sourceByName = function (sourceName) {\n    for (var i = 0; i < m_sources.length; i += 1) {\n      if (m_sources[i].name() === sourceName) {\n        return m_sources[i];\n      }\n    }\n    return 0;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of sources\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfSources = function() {\n    return m_sources.length;\n  };\n\n  /**\n   * Return source data given a key\n   */\n  this.sourceData = function(key) {\n    var i;\n\n    for (i = 0; i < m_sources.length; ++i) {\n      if (m_sources[i].hasKey(key)) {\n        return m_sources[i];\n      }\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new primitive\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addPrimitive = function(primitive) {\n    m_primitives.push(primitive);\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return primitive for a given index. Returns null if not found.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.primitive = function(index) {\n    if (index < m_primitives.length) {\n      return m_primitives[index];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of primitives\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfPrimitives = function() {\n    return m_primitives.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds [minX, maxX, minY, maxY, minZ, maxZ]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bounds = function() {\n    if (m_boundsDirtyTimestamp.getMTime() > m_computeBoundsTimestamp.getMTime()) {\n      this.computeBounds();\n    }\n    return m_bounds;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if bounds are dirty or mark them as such.\n   *\n   * @param dirty: true to set bounds as dirty.\n   * Return true if bounds are dirty.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boundsDirty = function (dirty) {\n    if (dirty) {\n      m_boundsDirtyTimestamp.modified();\n    }\n    return m_boundsDirtyTimestamp.getMTime() > m_computeBoundsTimestamp.getMTime();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetBounds = function() {\n    m_bounds[0] = 0.0;\n    m_bounds[1] = 0.0;\n    m_bounds[2] = 0.0;\n    m_bounds[3] = 0.0;\n    m_bounds[4] = 0.0;\n    m_bounds[5] = 0.0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBounds = function(minX, maxX, minY, maxY, minZ, maxZ) {\n    m_bounds[0] = minX;\n    m_bounds[1] = maxX;\n    m_bounds[2] = minY;\n    m_bounds[3] = maxY;\n    m_bounds[4] = minZ;\n    m_bounds[5] = maxZ;\n\n    m_computeBoundsTimestamp.modified();\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_boundsDirtyTimestamp.getMTime() > m_computeBoundsTimestamp.getMTime()) {\n      var attr = vgl.vertexAttributeKeys.Position,\n          sourceData = this.sourceData(attr),\n          data = sourceData.data(),\n          numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n          stride = sourceData.attributeStride(attr),\n          offset = sourceData.attributeOffset(attr),\n          sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n          count = data.length,\n          j, ib, jb, maxv, minv,\n          value = null,\n          vertexIndex;\n\n      // We advance by index, not by byte\n      stride /= sizeOfDataType;\n      offset /= sizeOfDataType;\n\n      this.resetBounds();\n\n      for (j = 0; j < numberOfComponents; ++j) {\n        ib = j * 2;\n        jb = j * 2 + 1;\n        if (count) {\n          maxv = minv = m_bounds[jb] = data[offset + j];\n        } else {\n          maxv = minv = 0;\n        }\n        for (vertexIndex = offset + stride + j; vertexIndex < count;\n             vertexIndex += stride) {\n          value = data[vertexIndex];\n          if (value > maxv) {\n            maxv = value;\n          }\n          if (value < minv) {\n            minv = value;\n          }\n        }\n        m_bounds[ib] = minv;  m_bounds[jb] = maxv;\n      }\n\n      m_computeBoundsTimestamp.modified();\n    }\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the vertex closest to a given position\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.findClosestVertex = function(point) {\n    var attr = vgl.vertexAttributeKeys.Position,\n        sourceData = this.sourceData(attr),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n        numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n        data = sourceData.data(),\n        stride = sourceData.attributeStride(attr) / sizeOfDataType,\n        offset = sourceData.attributeOffset(attr) / sizeOfDataType,\n        minDist = Number.MAX_VALUE,\n        minIndex = null,\n        vi, vPos, dx, dy, dz, dist, i;\n\n    // assume positions are always triplets\n    if (numberOfComponents !== 3) {\n      console.log('[warning] Find closest vertex assumes three' +\n        'component vertex ');\n    }\n\n    if (!point.z) {\n      point = {x:point.x, y:point.y, z:0};\n    }\n\n    for (vi = offset, i = 0; vi < data.length; vi += stride, i++) {\n      vPos = [data[vi],\n              data[vi + 1],\n              data[vi + 2]];\n\n      dx = vPos[0] - point.x;\n      dy = vPos[1] - point.y;\n      dz = vPos[2] - point.z;\n      dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n      if (dist < minDist) {\n        minDist = dist;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the requested vertex position\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPosition = function(index) {\n    var attr = vgl.vertexAttributeKeys.Position,\n        sourceData = this.sourceData(attr),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n        numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n        data = sourceData.data(),\n        stride = sourceData.attributeStride(attr) / sizeOfDataType,\n        offset = sourceData.attributeOffset(attr) / sizeOfDataType;\n\n    // assume positions are always triplets\n    if (numberOfComponents !== 3) {\n      console.log(\"[warning] getPosition assumes three component data\");\n    }\n\n    return [ data[offset + index*stride],\n             data[offset + index*stride + 1],\n             data[offset + index*stride + 2] ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the scalar corresponding to a given vertex index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getScalar = function(index) {\n    var attr = vgl.vertexAttributeKeys.Scalar,\n        sourceData = this.sourceData(attr),\n        numberOfComponents, sizeOfDataType, data, stride, offset;\n\n    if (!sourceData) {\n      return null;\n    }\n\n    numberOfComponents = sourceData.attributeNumberOfComponents(attr);\n    sizeOfDataType = sourceData.sizeOfAttributeDataType(attr);\n    data = sourceData.data();\n    stride = sourceData.attributeStride(attr) / sizeOfDataType;\n    offset = sourceData.attributeOffset(attr) / sizeOfDataType;\n\n    //console.log(\"index for scalar is \" + index);\n    //console.log(\"offset for scalar is \" + offset);\n    //console.log(\"stride for scalar is \" + stride);\n\n    //console.log(\"have \" + data.length + \" scalars\");\n\n    if (index * stride + offset >= data.length) {\n      console.log(\"access out of bounds in getScalar\");\n    }\n\n    return data[index * stride + offset];\n  };\n\n  return this;\n};\n\ninherit(vgl.geometryData, vgl.data);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, Float32Array, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class mapper\n *\n * @class\n * @returns {vgl.mapper}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.mapper = function(arg) {\n  'use strict';\n\n  if (!(this instanceof vgl.mapper)) {\n    return new vgl.mapper(arg);\n  }\n  vgl.boundingObject.call(this);\n\n  /** @private */\n  arg = arg || {};\n\n  var m_dirty = true,\n      m_color = [ 0.0, 1.0, 1.0 ],\n      m_geomData = null,\n      m_buffers = [],\n      m_bufferVertexAttributeMap = {},\n      m_dynamicDraw = arg.dynamicDraw === undefined ? false : arg.dynamicDraw,\n      m_glCompileTimestamp = vgl.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete cached VBO if any\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function deleteVertexBufferObjects() {\n    var i;\n    for (i = 0; i < m_buffers.length; ++i) {\n      gl.deleteBuffer(m_buffers[i]);\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create new VBO for all its geometryData sources and primitives\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function createVertexBufferObjects() {\n    if (m_geomData) {\n      var numberOfSources = m_geomData.numberOfSources(),\n          i, j, k, bufferId = null, keys, ks, numberOfPrimitives, data;\n\n      for (i = 0; i < numberOfSources; ++i) {\n        bufferId = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);\n        data = m_geomData.source(i).data();\n        if (!(data instanceof Float32Array)) {\n          data = new Float32Array(data);\n        }\n        gl.bufferData(gl.ARRAY_BUFFER, data,\n                      m_dynamicDraw ? gl.DYNAMIC_DRAW : gl.STATIC_DRAW);\n\n        keys = m_geomData.source(i).keys();\n        ks = [];\n\n        for (j = 0; j < keys.length; ++j) {\n          ks.push(keys[j]);\n        }\n\n        m_bufferVertexAttributeMap[i] = ks;\n        m_buffers[i] = bufferId;\n      }\n\n      numberOfPrimitives = m_geomData.numberOfPrimitives();\n      for (k = 0; k < numberOfPrimitives; ++k) {\n        bufferId = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);\n        gl.bufferData(gl.ARRAY_BUFFER, m_geomData.primitive(k)\n            .indices(), gl.STATIC_DRAW);\n        m_buffers[i++] = bufferId;\n      }\n\n      m_glCompileTimestamp.modified();\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear cache related to buffers\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function cleanUpDrawObjects() {\n    m_bufferVertexAttributeMap = {};\n    m_buffers = [];\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Setup draw objects; Delete old ones and create new ones\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setupDrawObjects() {\n    // Delete buffer objects from past if any.\n    deleteVertexBufferObjects();\n\n    // Clear any cache related to buffers\n    cleanUpDrawObjects();\n\n    // Now construct the new ones.\n    createVertexBufferObjects();\n\n    m_dirty = false;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_geomData === null || typeof m_geomData === 'undefined') {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        boundsDirtyTimestamp = this.boundsDirtyTimestamp(),\n        geomBounds = null;\n\n    if (boundsDirtyTimestamp.getMTime() > computeBoundsTimestamp.getMTime()) {\n      geomBounds = m_geomData.bounds();\n\n      this.setBounds(geomBounds[0], geomBounds[1], geomBounds[2],\n        geomBounds[3], geomBounds[4], geomBounds[5]) ;\n\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get solid color of the geometry\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.color = function() {\n    return m_color;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set solid color of the geometry. Default is teal [1.0, 1.0, 1.0]\n   *\n   * @param r Red component of the color [0.0 - 1.0]\n   * @param g Green component of the color [0.0 - 1.0]\n   * @param b Blue component of the color [0.0 - 1.0]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColor = function(r, g, b) {\n    m_color[0] = r;\n    m_color[1] = g;\n    m_color[2] = b;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryData = function() {\n    return m_geomData;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryData = function(geom) {\n    if (m_geomData !== geom) {\n      m_geomData = geom;\n\n      this.modified();\n      this.boundsDirtyTimestamp().modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the buffer used for a named source.\n   *\n   * @param {String} sourceName The name of the source to update.\n   * @param {Object[] or Float32Array} values The values to use for the source.\n   *    If not specified, use the source's own buffer.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateSourceBuffer = function (sourceName, values) {\n    var bufferIndex = -1;\n    for (var i = 0; i < m_geomData.numberOfSources(); i += 1) {\n      if (m_geomData.source(i).name() === sourceName) {\n        bufferIndex = i;\n        break;\n      }\n    }\n    if (bufferIndex < 0 || bufferIndex >= m_buffers.length) {\n      return false;\n    }\n    if (!values) {\n      values = m_geomData.source(i).dataToFloat32Array();\n    }\n    gl.bindBuffer(gl.ARRAY_BUFFER, m_buffers[bufferIndex]);\n    if (values instanceof Float32Array) {\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, values);\n    } else {\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, new Float32Array(values));\n    }\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the buffer used for a named source.  If the current buffer isn't a\n   * Float32Array, it is converted to one.  This array can then be modified\n   * directly, after which updateSourceBuffer can be called to update the\n   * GL array.\n   *\n   * @param {String} sourceName The name of the source to update.\n   * @returns {Float32Array} An array used for this source.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getSourceBuffer = function (sourceName) {\n    var source = m_geomData.sourceByName(sourceName);\n    if (!source) {\n      return new Float32Array();\n    }\n    return source.dataToFloat32Array();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the mapper\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    if (this.getMTime() > m_glCompileTimestamp.getMTime()) {\n      setupDrawObjects(renderState);\n    }\n\n    // Fixed vertex color\n    gl.vertexAttrib3fv(vgl.vertexAttributeKeys.Color, this.color());\n\n    // TODO Use renderState\n    var bufferIndex = 0,\n        j = 0, i, noOfPrimitives = null, primitive = null;\n\n    for (i in m_bufferVertexAttributeMap) {\n      if (m_bufferVertexAttributeMap.hasOwnProperty(i)) {\n        gl.bindBuffer(gl.ARRAY_BUFFER, m_buffers[bufferIndex]);\n        for (j = 0; j < m_bufferVertexAttributeMap[i].length; ++j) {\n          renderState.m_material\n              .bindVertexData(renderState, m_bufferVertexAttributeMap[i][j]);\n        }\n        ++bufferIndex;\n      }\n    }\n\n    noOfPrimitives = m_geomData.numberOfPrimitives();\n    for (j = 0; j < noOfPrimitives; ++j) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, m_buffers[bufferIndex++]);\n      primitive = m_geomData.primitive(j);\n      switch(primitive.primitiveType()) {\n        case gl.POINTS:\n          gl.drawArrays (gl.POINTS, 0, primitive.numberOfIndices());\n          break;\n        case gl.LINES:\n          gl.drawArrays (gl.LINES, 0, primitive.numberOfIndices());\n          break;\n        case gl.LINE_STRIP:\n          gl.drawArrays (gl.LINE_STRIP, 0, primitive.numberOfIndices());\n          break;\n        case gl.TRIANGLES:\n          gl.drawArrays (gl.TRIANGLES, 0, primitive.numberOfIndices());\n          break;\n        case gl.TRIANGLE_STRIP:\n          gl.drawArrays (gl.TRIANGLE_STRIP, 0, primitive.numberOfIndices());\n          break;\n      }\n      gl.bindBuffer (gl.ARRAY_BUFFER, null);\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.mapper, vgl.boundingObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.groupMapper = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.groupMapper)) {\n    return new vgl.groupMapper();\n  }\n  vgl.mapper.call(this);\n\n  /** @private */\n  var m_createMappersTimestamp = vgl.timestamp(),\n      m_mappers = [],\n      m_geomDataArray = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data if any\n   *\n   * @param index optional\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryData = function(index) {\n    if (index !== undefined && index < m_geomDataArray.length ) {\n      return m_geomDataArray[index];\n    }\n\n    if (m_geomDataArray.length > 0) {\n      return m_geomDataArray[0];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   *\n   * @param geom {vgl.geomData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryData = function(geom) {\n    if (m_geomDataArray.length === 1) {\n      if (m_geomDataArray[0] === geom) {\n        return;\n      }\n    }\n    m_geomDataArray = [];\n    m_geomDataArray.push(geom);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data array if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryDataArray = function() {\n    return m_geomDataArray;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   *\n   * @param geoms {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryDataArray = function(geoms) {\n    if (geoms instanceof Array) {\n      if (m_geomDataArray !== geoms) {\n        m_geomDataArray = [];\n        m_geomDataArray = geoms;\n        this.modified();\n        return true;\n      }\n    } else {\n      console.log('[error] Requies array of geometry data');\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_geomDataArray === null ||\n        m_geomDataArray === undefined) {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        boundsDirtyTimestamp = this.boundsDirtyTimestamp(),\n        m_bounds = this.bounds(),\n        geomBounds = null,\n        i = null;\n\n    if (boundsDirtyTimestamp.getMTime() >\n        computeBoundsTimestamp.getMTime()) {\n\n      for (i = 0; i < m_geomDataArray.length; ++i) {\n        geomBounds = m_geomDataArray[i].bounds();\n\n        if (m_bounds[0] > geomBounds[0]) {\n          m_bounds[0] = geomBounds[0];\n        }\n        if (m_bounds[1] < geomBounds[1]) {\n          m_bounds[1] = geomBounds[1];\n        }\n        if (m_bounds[2] > geomBounds[2]) {\n          m_bounds[2] = geomBounds[2];\n        }\n        if (m_bounds[3] < geomBounds[3]) {\n          m_bounds[3] = geomBounds[3];\n        }\n        if (m_bounds[4] > geomBounds[4]) {\n          m_bounds[4] = geomBounds[4];\n        }\n        if (m_bounds[5] < geomBounds[5]) {\n          m_bounds[5] = geomBounds[5];\n        }\n      }\n\n      this.modified();\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the mapper\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    var i = null;\n\n    if (this.getMTime() > m_createMappersTimestamp.getMTime()) {\n      // NOTE Hoping that it will release the graphics resources\n      for (i = 0; i < m_geomDataArray.length; ++i) {\n        m_mappers.push(vgl.mapper());\n        m_mappers[i].setGeometryData(m_geomDataArray[i]);\n      }\n        m_createMappersTimestamp.modified();\n    }\n\n    for (i = 0; i < m_mappers.length; ++i) {\n      m_mappers[i].render(renderState);\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.groupMapper, vgl.mapper);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.materialAttributeType = {\n  \"Undefined\" : 0x0,\n  \"ShaderProgram\" : 0x1,\n  \"Texture\" : 0x2,\n  \"Blend\" : 0x3,\n  \"Depth\" : 0x4\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class materialAttribute\n *\n * @class\n * @param type\n * @returns {vgl.materialAttribute}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.materialAttribute = function(type) {\n  'use strict';\n\n  if (!(this instanceof vgl.materialAttribute)) {\n    return new vgl.materialAttribute();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_type = type,\n      m_enabled = true;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return tyep of the material attribute\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return m_type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if material attribute is enabled or not\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enabled = function() {\n    return m_enabled;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Setup (initialize) the material attribute\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate the material attribute\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind and deactivate the material\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize vertex data for the material attribute\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setupVertexData = function(renderState, key) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate vertex specific data\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind and deactivate vertex specific data\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    return false;\n  };\n\n  return this;\n};\n\ninherit(vgl.materialAttribute, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of clas blendFunction\n *\n * @class\n * @param source\n * @param destination\n * @returns {vgl.blendFunction}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.blendFunction = function(source, destination) {\n  'use strict';\n\n  if (!(this instanceof vgl.blendFunction)) {\n    return new vgl.blendFunction(source, destination);\n  }\n\n  /** @private */\n  var m_source = source,\n      m_destination = destination;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Apply blend function to the current state\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.apply = function(renderState) {\n    gl.blendFuncSeparate(m_source, m_destination, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n  };\n\n  return this;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class blend\n *\n * @returns {vgl.blend}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.blend = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.blend)) {\n    return new vgl.blend();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.Blend);\n\n  /** @private */\n  var m_wasEnabled = false,\n      m_blendFunction = vgl.blendFunction(gl.SRC_ALPHA,\n                                                gl.ONE_MINUS_SRC_ALPHA);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind blend attribute\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    m_wasEnabled = gl.isEnabled(gl.BLEND);\n\n    if (this.enabled()) {\n      gl.enable(gl.BLEND);\n      m_blendFunction.apply(renderState);\n    }\n    else {\n      gl.disable(gl.BLEND);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind blend attribute\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    if (m_wasEnabled) {\n      gl.enable(gl.BLEND);\n    }\n    else {\n      gl.disable(gl.BLEND);\n    }\n\n    return true;\n  };\n\n  return this;\n};\n\ninherit(vgl.blend, vgl.materialAttribute);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class material\n *\n * @class\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.material = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.material)) {\n    return new vgl.material();\n  }\n  vgl.object.call(this);\n\n  // / Private member variables\n  var m_shaderProgram = new vgl.shaderProgram(),\n      m_binNumber = 100,\n      m_textureAttributes = {},\n      m_attributes = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bin number for the material\n   *\n   * @default 100\n   * @returns {number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.binNumber = function() {\n    return m_binNumber;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set bin number for the material\n   *\n   * @param binNo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBinNumber = function(binNo) {\n    m_binNumber = binNo;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if incoming attribute already exists in the material\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.exists = function(attr) {\n    if (attr.type() === vgl.materialAttribute.Texture) {\n      return m_textureAttributes.hasOwnProperty(attr);\n    }\n\n    return m_attributes.hasOwnProperty(attr);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform given a name\n\n   * @param name Uniform name\n   * @returns {vgl.uniform}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.uniform = function(name) {\n    if (m_shaderProgram) {\n      return m_shaderProgram.uniform(name);\n    }\n\n    return null;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get material attribute\n\n   * @param attr Attribute name\n   * @returns {vgl.materialAttribute}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attribute = function(name) {\n    if (m_attributes.hasOwnProperty(name)) {\n      return m_attributes[name];\n    }\n\n    if (m_textureAttributes.hasOwnProperty(name)) {\n      return m_textureAttributes[name];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set a new attribute for the material\n   *\n   * This method replace any existing attribute except for textures as\n   * materials can have multiple textures.\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setAttribute = function(attr) {\n    if (attr.type() === vgl.materialAttributeType.Texture &&\n        m_textureAttributes[attr.textureUnit()] !== attr) {\n      m_textureAttributes[attr.textureUnit()] = attr;\n      this.modified();\n      return true;\n    }\n\n    if (m_attributes[attr.type()] === attr) {\n      return false;\n    }\n\n    // Shader is a very special attribute\n    if (attr.type() === vgl.materialAttributeType.ShaderProgram) {\n      m_shaderProgram = attr;\n    }\n\n    m_attributes[attr.type()] = attr;\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new attribute to the material.\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addAttribute = function(attr) {\n    if (this.exists(attr)) {\n      return false;\n    }\n\n    if (attr.type() === vgl.materialAttributeType.Texture) {\n      // TODO Currently we don't check if we are replacing or not.\n      // It would be nice to have a flag for it.\n      m_textureAttributes[attr.textureUnit()] = attr;\n      this.modified();\n      return true;\n    }\n\n    // Shader is a very special attribute\n    if (attr.type() === vgl.materialAttributeType.ShaderProgram) {\n      m_shaderProgram = attr;\n    }\n\n    m_attributes[attr.type()] = attr;\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return shader program used by the material\n   *\n   * @returns {vgl.shaderProgram}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.shaderProgram = function() {\n    return m_shaderProgram;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Activate the material\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    this.bind(renderState);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Deactivate the material\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.remove = function(renderState) {\n    this.undoBind(renderState);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate material states\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    var key = null;\n\n    for (key in m_attributes) {\n      if (m_attributes.hasOwnProperty(key)) {\n        m_attributes[key].bind(renderState);\n      }\n    }\n\n    for (key in m_textureAttributes) {\n      if (m_textureAttributes.hasOwnProperty(key)) {\n        m_textureAttributes[key].bind(renderState);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo-bind and de-activate material states\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    var key = null;\n    for (key in m_attributes) {\n      if (m_attributes.hasOwnProperty(key)) {\n        m_attributes[key].undoBind(renderState);\n      }\n    }\n\n    for (key in m_textureAttributes) {\n      if (m_textureAttributes.hasOwnProperty(key)) {\n        m_textureAttributes[key].undoBind(renderState);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    var i = null;\n\n    for (i in m_attributes) {\n      if (m_attributes.hasOwnProperty(i)) {\n        m_attributes[i].bindVertexData(renderState, key);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    var i = null;\n\n    for (i in m_attributes) {\n      if (m_attributes.hasOwnProperty(i)) {\n        m_attributes.undoBindVertexData(renderState, key);\n      }\n    }\n  };\n\n  return this;\n};\n\nvgl.material.RenderBin = {\n  \"Base\" : 0,\n  \"Default\" : 100,\n  \"Opaque\" : 100,\n  \"Transparent\" : 1000,\n  \"Overlay\" : 10000\n};\n\ninherit(vgl.material, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, bitwise:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec2, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderState\n *\n * @returns {vgl.renderState}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.renderState = function() {\n  'use strict';\n\n  this.m_modelViewMatrix = mat4.create();\n  this.m_normalMatrix = mat4.create();\n  this.m_projectionMatrix = null;\n  this.m_material = null;\n  this.m_mapper = null;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderer *\n *\n * @returns {vgl.renderer}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.renderer = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.renderer)) {\n    return new vgl.renderer();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_sceneRoot = new vgl.groupNode(),\n      m_camera = new vgl.camera(),\n      m_nearClippingPlaneTolerance = null,\n      m_x = 0,\n      m_y = 0,\n      m_width = 0,\n      m_height = 0,\n      m_resizable = true,\n      m_resetScene = true,\n      m_layer = 0,\n      m_resetClippingRange = true;\n\n  m_camera.addChild(m_sceneRoot);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get width of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function() {\n    return m_width;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get height of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function() {\n    return m_height;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer this renderer is associated with\n   *\n   * @return {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n     return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the layer this renderer is associated with.\n   *\n   * @param layerNo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setLayer = function(layerNo) {\n    m_layer = layerNo;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.isResizable = function() {\n    return m_resizable;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResizable = function(r) {\n    m_resizable = r;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get background color\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.backgroundColor = function() {\n    return m_camera.clearColor();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set background color of the renderer\n   *\n   * @param r\n   * @param g\n   * @param b\n   * @param a\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBackgroundColor = function(r, g, b, a) {\n    m_camera.setClearColor(r, g, b, a);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get scene root\n   *\n   * @returns {vgl.groupNode}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sceneRoot = function() {\n    return m_sceneRoot;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get main camera of the renderer\n   *\n   * @returns {vgl.camera}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.camera = function() {\n    return m_camera;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    var i, renSt, children, actor = null, sortedActors = [],\n        mvMatrixInv = mat4.create(), clearColor = null;\n\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n\n    if (m_camera.clearMask() & vgl.GL.ColorBufferBit) {\n      clearColor = m_camera.clearColor();\n      gl.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);\n    }\n\n    if (m_camera.clearMask() & vgl.GL.DepthBufferBit) {\n      gl.clearDepth(m_camera.clearDepth());\n    }\n\n    gl.clear(m_camera.clearMask());\n\n    // Set the viewport for this renderer\n    gl.viewport(m_x, m_y, m_width, m_height);\n\n    renSt = new vgl.renderState();\n    children = m_sceneRoot.children();\n\n    if (children.length > 0 && m_resetScene) {\n      this.resetCamera();\n      m_resetScene = false;\n    }\n\n    for ( i = 0; i < children.length; ++i) {\n      actor = children[i];\n\n      // Compute the bounds even if the actor is not visible\n      actor.computeBounds();\n\n      // If bin number is < 0, then don't even bother\n      // rendering the data\n      if (!actor.visible() || actor.material().binNumber() < 0) {\n        continue;\n      }\n\n      sortedActors.push([actor.material().binNumber(), actor]);\n    }\n\n    // Now perform sorting\n    sortedActors.sort(function(a, b) {return a[0] - b[0];});\n\n    for ( i = 0; i < sortedActors.length; ++i) {\n      actor = sortedActors[i][1];\n      if (actor.referenceFrame() ===\n          vgl.boundingObject.ReferenceFrame.Relative) {\n        mat4.multiply(renSt.m_modelViewMatrix, m_camera.viewMatrix(),\n          actor.matrix());\n        renSt.m_projectionMatrix = m_camera.projectionMatrix();\n      } else {\n        renSt.m_modelViewMatrix = actor.matrix();\n        renSt.m_projectionMatrix = mat4.create();\n        mat4.ortho(renSt.m_projectionMatrix, 0, m_width, 0, m_height, -1, 1);\n      }\n\n      mat4.invert(mvMatrixInv, renSt.m_modelViewMatrix);\n      mat4.transpose(renSt.m_normalMatrix, mvMatrixInv);\n      renSt.m_material = actor.material();\n      renSt.m_mapper = actor.mapper();\n\n      // TODO Fix this shortcut\n      renSt.m_material.render(renSt);\n      renSt.m_mapper.render(renSt);\n      renSt.m_material.remove(renSt);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Automatically set up the camera based on visible actors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetCamera = function() {\n    m_camera.computeBounds();\n\n    var vn = m_camera.directionOfProjection(),\n        visibleBounds = m_camera.bounds(),\n        center = [\n          (visibleBounds[0] + visibleBounds[1]) / 2.0,\n          (visibleBounds[2] + visibleBounds[3]) / 2.0,\n          (visibleBounds[4] + visibleBounds[5]) / 2.0\n        ],\n        diagonals = [\n          visibleBounds[1] - visibleBounds[0],\n          visibleBounds[3] - visibleBounds[2],\n          visibleBounds[5] - visibleBounds[4]\n        ],\n        radius = 0.0,\n        aspect = m_camera.viewAspect(),\n        angle = m_camera.viewAngle(),\n        distance = null,\n        vup = null;\n\n    if (diagonals[0] > diagonals[1]) {\n      if (diagonals[0] > diagonals[2]) {\n        radius = diagonals[0] / 2.0;\n      } else {\n        radius = diagonals[2] / 2.0;\n      }\n    } else {\n      if (diagonals[1] > diagonals[2]) {\n        radius = diagonals[1] / 2.0;\n      } else {\n        radius = diagonals[2] / 2.0;\n      }\n    }\n\n    // @todo Need to figure out what's happening here\n    if (aspect >= 1.0) {\n      angle = 2.0 * Math.atan(Math.tan(angle * 0.5) / aspect);\n    } else {\n      angle = 2.0 * Math.atan(Math.tan(angle * 0.5) * aspect);\n    }\n\n    distance = radius / Math.sin(angle * 0.5);\n    vup = m_camera.viewUpDirection();\n\n    if (Math.abs(vec3.dot(vup, vn)) > 0.999) {\n      m_camera.setViewUpDirection(-vup[2], vup[0], vup[1]);\n    }\n\n    m_camera.setFocalPoint(center[0], center[1], center[2]);\n    m_camera.setPosition(center[0] + distance * -vn[0],\n      center[1] + distance * -vn[1], center[2] + distance * -vn[2]);\n\n    this.resetCameraClippingRange(visibleBounds);\n  };\n\n  this.hasValidBounds = function(bounds) {\n    if (bounds[0] == Number.MAX_VALUE ||\n        bounds[1] == -Number.MAX_VALUE ||\n        bounds[2] == Number.MAX_VALUE ||\n        bounds[3] == -Number.MAX_VALUE ||\n        bounds[4] == Number.MAX_VALUE ||\n        bounds[5] == -Number.MAX_VALUE)  {\n      return false;\n    }\n\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Recalculate camera's clipping range\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetCameraClippingRange = function(bounds) {\n    if (typeof bounds === 'undefined') {\n      m_camera.computeBounds();\n      bounds = m_camera.bounds();\n    }\n\n    if (!this.hasValidBounds(bounds)) {\n      return;\n    }\n\n    var vn = m_camera.viewPlaneNormal(),\n        position = m_camera.position(),\n        a = -vn[0],\n        b = -vn[1],\n        c = -vn[2],\n        d = -(a*position[0] + b*position[1] + c*position[2]),\n        range = vec2.create(),\n        dist = null,\n        i = null,\n        j = null,\n        k = null;\n\n    if (!m_resetClippingRange) {\n        return;\n    }\n\n    // Set the max near clipping plane and the min far clipping plane\n    range[0] = a * bounds[0] + b * bounds[2] + c * bounds[4] + d;\n    range[1] = 1e-18;\n\n    // Find the closest / farthest bounding box vertex\n    for (k = 0; k < 2; k++ ) {\n      for (j = 0; j < 2; j++) {\n        for (i = 0; i < 2; i++) {\n          dist = a * bounds[i] + b * bounds[2 + j] + c * bounds[4 + k] + d;\n          range[0] = (dist < range[0]) ? (dist) : (range[0]);\n          range[1] = (dist > range[1]) ? (dist) : (range[1]);\n        }\n      }\n    }\n\n    // Do not let the range behind the camera throw off the calculation.\n    if (range[0] < 0.0) {\n      range[0] = 0.0;\n    }\n\n    // Give ourselves a little breathing room\n    range[0] = 0.99 * range[0] - (range[1] - range[0]) * 0.5;\n    range[1] = 1.01 * range[1] + (range[1] - range[0]) * 0.5;\n\n    // Make sure near is not bigger than far\n    range[0] = (range[0] >= range[1]) ? (0.01 * range[1]) : (range[0]);\n\n    // Make sure near is at least some fraction of far - this prevents near\n    // from being behind the camera or too close in front. How close is too\n    // close depends on the resolution of the depth buffer.\n    if (!m_nearClippingPlaneTolerance) {\n      m_nearClippingPlaneTolerance = 0.01;\n\n      if (gl !== null && gl.getParameter(gl.DEPTH_BITS) > 16) {\n        m_nearClippingPlaneTolerance = 0.001;\n      }\n    }\n\n    // make sure the front clipping range is not too far from the far clippnig\n    // range, this is to make sure that the zbuffer resolution is effectively\n    // used.\n    if (range[0] < m_nearClippingPlaneTolerance*range[1]) {\n       range[0] = m_nearClippingPlaneTolerance*range[1];\n    }\n\n    m_camera.setClippingRange(range[0], range[1]);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize viewport given a width and height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function(width, height) {\n    // @note: where do m_x and m_y come from?\n    this.positionAndResize(m_x, m_y, width, height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize viewport given a position, width and height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.positionAndResize = function(x, y, width, height) {\n    // TODO move this code to camera\n    if (x < 0 || y < 0 || width < 0 || height < 0) {\n      console.log('[error] Invalid position and resize values',\n        x, y, width, height);\n    }\n\n    //If we're allowing this renderer to resize ...\n    if (m_resizable) {\n      m_width = width;\n      m_height = height;\n\n      m_camera.setViewAspect(m_width / m_height);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new actor to the collection\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addActor = function(actor) {\n    if (actor instanceof vgl.actor) {\n      m_sceneRoot.addChild(actor);\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return true if this renderer has this actor attached, false otherwise.\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasActor = function(actor) {\n      return m_sceneRoot.hasChild(actor);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add an array of actors to the collection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addActors = function(actors) {\n    var i = null;\n    if (actors instanceof Array) {\n      for (i = 0; i < actors.length; ++i) {\n        m_sceneRoot.addChild(actors[i]);\n      }\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove the actor from the collection\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeActor = function(actor) {\n    if (m_sceneRoot.children().indexOf(actor) !== -1) {\n      m_sceneRoot.removeChild(actor);\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove actors from the collection\n   *\n   * @param actors\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeActors = function(actors) {\n    if (!(actors instanceof Array)) {\n      return false;\n    }\n\n    var i;\n    for (i = 0; i < actors.length; ++i) {\n      m_sceneRoot.removeChild(actors[i]);\n    }\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove all actors for a renderer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeAllActors = function() {\n    return m_sceneRoot.removeChildren();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in the world space to display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function(worldPt, viewMatrix, projectionMatrix, width,\n                                 height) {\n    var viewProjectionMatrix = mat4.create(),\n        winX = null,\n        winY = null,\n        winZ = null,\n        winW = null,\n        clipPt = null;\n\n\n    mat4.multiply(viewProjectionMatrix, projectionMatrix, viewMatrix);\n\n    // Transform world to clipping coordinates\n    clipPt = vec4.create();\n    vec4.transformMat4(clipPt, worldPt, viewProjectionMatrix);\n\n    if (clipPt[3] !== 0.0) {\n      clipPt[0] = clipPt[0] / clipPt[3];\n      clipPt[1] = clipPt[1] / clipPt[3];\n      clipPt[2] = clipPt[2] / clipPt[3];\n      clipPt[3] = 1.0;\n    }\n\n    winX = (((clipPt[0]) + 1) / 2.0) * width;\n    // We calculate -point3D.getY() because the screen Y axis is\n    // oriented top->down\n    winY = ((1 - clipPt[1]) / 2.0) * height;\n    winZ = clipPt[2];\n    winW = clipPt[3];\n\n    return vec4.fromValues(winX, winY, winZ, winW);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param displayPt\n   * @param viewMatrix\n   * @param projectionMatrix\n   * @param width\n   * @param height\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function(displayPt, viewMatrix, projectionMatrix,\n                                 width, height) {\n    var x = (2.0 * displayPt[0] / width) - 1,\n        y = -(2.0 * displayPt[1] / height) + 1,\n        z = displayPt[2],\n        viewProjectionInverse = mat4.create(),\n        worldPt = null;\n\n    mat4.multiply(viewProjectionInverse, projectionMatrix, viewMatrix);\n    mat4.invert(viewProjectionInverse, viewProjectionInverse);\n\n    worldPt = vec4.fromValues(x, y, z, 1);\n    vec4.transformMat4(worldPt, worldPt, viewProjectionInverse);\n    if (worldPt[3] !== 0.0) {\n      worldPt[0] = worldPt[0] / worldPt[3];\n      worldPt[1] = worldPt[1] / worldPt[3];\n      worldPt[2] = worldPt[2] / worldPt[3];\n      worldPt[3] = 1.0;\n    }\n\n    return worldPt;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focusDisplayPoint = function() {\n    var focalPoint = m_camera.focalPoint(),\n      focusWorldPt = vec4.fromValues(\n        focalPoint[0], focalPoint[1], focalPoint[2], 1);\n\n    return this.worldToDisplay(\n      focusWorldPt, m_camera.viewMatrix(),\n      m_camera.projectionMatrix(), m_width, m_height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Will the scene be reset.\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetScene = function() {\n    return m_resetScene;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * If true the scene will be reset, otherwise the scene will not be\n   * automatically reset.\n   *\n   * @param reset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResetScene = function(reset) {\n     if (m_resetScene !== reset) {\n       m_resetScene = reset;\n       this.modified()\n     }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Will the clipping range be reset\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetClippingRange = function() {\n    return m_resetClippingRange;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * If true the camera clipping range will be reset, otherwise the scene will\n   * not be automatically reset.\n   *\n   * @param reset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResetClippingRange = function(reset) {\n     if (m_resetClippingRange !== reset) {\n       m_resetClippingRange = reset;\n       this.modified()\n     }\n  };\n\n  return this;\n};\n\ninherit(vgl.renderer, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n// TODO Current we support only one context\nvar gl = null;\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderWindow\n *\n * @class\n * @returns {vgl.renderWindow}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.renderWindow = function(canvas) {\n  'use strict';\n\n  if (!(this instanceof vgl.renderWindow)) {\n    return new vgl.renderWindow(canvas);\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_x = 0,\n      m_y = 0,\n      m_width = 400,\n      m_height = 400,\n      m_canvas = canvas,\n      m_activeRender = null,\n      m_renderers = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get size of the render window\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.windowSize = function() {\n    return [ m_width, m_height ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set size of the render window\n   *\n   * @param width\n   * @param height\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setWindowSize = function(width, height) {\n\n    if (m_width !== width || m_height !== height) {\n      m_width = width;\n      m_height = height;\n\n      this.modified();\n\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get window position (top left coordinates)\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.windowPosition = function() {\n    return [ m_x, m_y ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set window position (top left coordinates)\n   *\n   * @param x\n   * @param y\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setWindowPosition = function(x, y) {\n    if ((m_x !== x) || (m_y !== y)) {\n      m_x = x;\n      m_y = y;\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return all renderers contained in the render window\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderers = function() {\n    return m_renderers;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get active renderer of the the render window\n   *\n   * @returns vgl.renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.activeRenderer = function() {\n    return m_activeRender;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add renderer to the render window\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addRenderer = function(ren) {\n    if (this.hasRenderer(ren) === false) {\n      m_renderers.push(ren);\n      if (m_activeRender === null) {\n        m_activeRender = ren;\n      }\n      if (ren.layer() !== 0) {\n        ren.camera().setClearMask(vgl.GL.DepthBufferBit);\n      }\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove renderer from the render window\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeRenderer = function(ren) {\n    var index = m_renderers.indexOf(ren);\n    if (index !== -1) {\n      if (m_activeRender === ren) {\n        m_activeRender = null;\n      }\n      m_renderers.splice(index, 1);\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return a renderer at a given index\n   *\n   * @param index\n   * @returns {vgl.renderer}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getRenderer = function(index) {\n    if (index < m_renderers.length) {\n      return m_renderers[index];\n    }\n\n    console.log(\"[WARNING] Out of index array\");\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the renderer exists\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasRenderer = function(ren) {\n    var i;\n    for (i = 0; i < m_renderers.length; ++i) {\n      if (ren === m_renderers[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize window\n   *\n   * @param width\n   * @param height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function(width, height) {\n    this.positionAndResize(m_x, m_y, width, height);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize and reposition the window\n   *\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.positionAndResize = function(x, y, width, height) {\n    m_x = x;\n    m_y = y;\n    m_width = width;\n    m_height = height;\n    var i;\n    for (i = 0; i < m_renderers.length; ++i) {\n      m_renderers[i].positionAndResize(m_x, m_y, m_width, m_height);\n    }\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create the window\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createWindow = function() {\n    // Initialize the global variable gl to null.\n    gl = null;\n\n    try {\n      // Try to grab the standard context. If it fails, fallback to\n      // experimental.\n      gl = m_canvas.getContext(\"webgl\")\n           || m_canvas.getContext(\"experimental-webgl\");\n\n      // Set width and height of renderers if not set already\n      var i;\n      for (i = 0; i < m_renderers.length; ++i) {\n        if ((m_renderers[i].width() > m_width) || m_renderers[i].width() === 0\n            || (m_renderers[i].height() > m_height)\n            || m_renderers[i].height() === 0) {\n          m_renderers[i].resize(m_x, m_y, m_width, m_height);\n        }\n      }\n\n      return true;\n    }\n    catch (e) {\n    }\n\n    // If we don't have a GL context, give up now\n    if (!gl) {\n      console(\"[ERROR] Unable to initialize WebGL. Your browser may not support it.\");\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete this window and release any graphics resources\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteWindow = function() {\n    // TODO\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    var i;\n    m_renderers.sort(function(a, b) {return a.layer() - b.layer();});\n    for (i = 0; i < m_renderers.length; ++i) {\n      m_renderers[i].render();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the focusDisplayPoint from the activeRenderer\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focusDisplayPoint = function() {\n    return m_activeRender.focusDisplayPoint();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param {Number} x\n   * @param {Number} y\n   * @param {vec4} focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function(x, y, focusDisplayPoint, ren) {\n    ren = ren === undefined ? ren = m_activeRender : ren;\n\n    var camera = ren.camera();\n    if(!focusDisplayPoint) {\n      focusDisplayPoint = ren.focusDisplayPoint();\n    }\n\n    return ren.displayToWorld(\n      vec4.fromValues(x, y, focusDisplayPoint[2], 1.0), camera.viewMatrix(),\n      camera.projectionMatrix(), m_width, m_height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param {Number} x\n   * @param {Number} y\n   * @param {vec4} focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function(x, y, z, ren) {\n    ren = ren === undefined ? ren = m_activeRender : ren;\n\n    var camera = ren.camera();\n\n    return ren.worldToDisplay(\n      vec4.fromValues(x, y, z, 1.0), camera.viewMatrix(),\n      camera.projectionMatrix(), m_width, m_height);\n  };\n\n  return this;\n};\n\ninherit(vgl.renderWindow, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n/*global vgl, gl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class camera\n *\n * @class\n * @returns {vgl.camera}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.camera = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.camera)) {\n    return new vgl.camera();\n  }\n  vgl.groupNode.call(this);\n\n  /** @private */\n  var m_viewAngle = (Math.PI * 30) / 180.0,\n      m_position = vec4.fromValues(0.0, 0.0, 1.0, 1.0),\n      m_focalPoint = vec4.fromValues(0.0, 0.0, 0.0, 1.0),\n      m_centerOfRotation = vec3.fromValues(0.0, 0.0, 0.0),\n      m_viewUp = vec4.fromValues(0.0, 1.0, 0.0, 0.0),\n      m_rightDir = vec4.fromValues(1.0, 0.0, 0.0, 0.0),\n      m_near = 0.01,\n      m_far = 10000.0,\n      m_viewAspect = 1.0,\n      m_directionOfProjection = vec4.fromValues(0.0, 0.0, -1.0, 0.0),\n      m_viewPlaneNormal = vec4.fromValues(0.0, 0.0, 1.0, 0.0),\n      m_viewMatrix = mat4.create(),\n      m_projectionMatrix = mat4.create(),\n      m_computeModelViewMatrixTime = vgl.timestamp(),\n      m_computeProjectMatrixTime = vgl.timestamp(),\n      m_left = -1.0,\n      m_right = 1.0,\n      m_top = +1.0,\n      m_bottom = -1.0,\n      m_enableTranslation = true,\n      m_enableRotation = true,\n      m_enableScale = true,\n      m_enableParallelProjection = false,\n      m_clearColor = [1.0, 1.0, 1.0, 1.0],\n      m_clearDepth = 1.0,\n      m_clearMask = vgl.GL.ColorBufferBit |\n                    vgl.GL.DepthBufferBit;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view angle of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewAngle = function() {\n    return m_viewAngle;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view angle of the camera in degrees, which is converted to radians.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAngleDegrees = function(a) {\n    m_viewAngle = (Math.PI * a) / 180.0;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view angle of the camera in degrees, which is converted to radians.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAngle = function(a) {\n    if (m_enableScale) {\n      m_viewAngle = a;\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get position of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function() {\n    return m_position;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set position of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPosition = function(x, y, z) {\n    if (m_enableTranslation) {\n      m_position = vec4.fromValues(x, y, z, 1.0);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get focal point of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focalPoint = function() {\n    return m_focalPoint;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set focal point of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setFocalPoint = function(x, y, z) {\n    if (m_enableRotation && m_enableTranslation) {\n      m_focalPoint = vec4.fromValues(x, y, z, 1.0);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view-up direction of camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewUpDirection = function() {\n    return m_viewUp;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view-up direction of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewUpDirection = function(x, y, z) {\n    m_viewUp = vec4.fromValues(x, y, z, 0);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get center of rotation for camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.centerOfRotation = function() {\n    return m_centerOfRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set center of rotation for camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setCenterOfRotation = function(centerOfRotation) {\n    m_centerOfRotation = centerOfRotation;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get clipping range of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clippingRange = function() {\n    return [m_near, m_far];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clipping range of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClippingRange = function(near, far) {\n    m_near = near;\n    m_far = far;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view aspect\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewAspect = function() {\n    return m_viewAspect;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view aspect\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAspect = function(aspect) {\n    m_viewAspect = aspect;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for scaling (enabled / disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableScale = function(flag) {\n    return m_enableScale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable/disable scaling\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableScale = function(flag) {\n    if (flag !== m_enableScale) {\n      m_enableScale = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableScale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for rotation (enabled / disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableRotation = function(f) {\n    return m_enableRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable rotation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableRotation = function(flag) {\n    if (flag !== m_enableRotation) {\n      m_enableRotation = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for translation (enabled/disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableTranslation = function(flag) {\n    return m_enableTranslation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable translation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableTranslation = function(flag) {\n    if (flag !== m_enableTranslation) {\n      m_enableTranslation = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableTranslation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if parallel projection is enabled\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.isEnabledParallelProjection = function() {\n    return m_enableParallelProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable parallel projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableParallelProjection = function(flag) {\n    if (flag !== m_enableParallelProjection) {\n      m_enableParallelProjection = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableParallelProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable parallel projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnnableParallelProjection = function(flag) {\n    return enableParallelProjection();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set parallel projection parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setParallelProjection = function(left, right, top, bottom) {\n    m_left = left;\n    m_right = right;\n    m_top = top;\n    m_bottom = bottom;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return direction of projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.directionOfProjection = function() {\n    this.computeDirectionOfProjection();\n    return m_directionOfProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return view plane normal direction\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewPlaneNormal = function() {\n    this.computeViewPlaneNormal();\n    return m_viewPlaneNormal;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return view-matrix for the camera This method does not compute the\n   * view-matrix for the camera. It is assumed that a call to computeViewMatrix\n   * has been made earlier.\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewMatrix = function() {\n    return this.computeViewMatrix();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return camera projection matrix This method does not compute the\n   * projection-matrix for the camera. It is assumed that a call to\n   * computeProjectionMatrix has been made earlier.\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.projectionMatrix = function() {\n    return this.computeProjectionMatrix();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return clear mask used by this camera\n   *\n   * @returns {number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearMask = function() {\n    return m_clearMask;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clear mask for camera\n   *\n   * @param mask\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearMask = function(mask) {\n    m_clearMask = mask;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get clear color (background color) of the camera\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearColor = function() {\n    return m_clearColor;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clear color (background color) for the camera\n   *\n   * @param color RGBA\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearColor = function(r, g, b, a) {\n    m_clearColor[0] = r;\n    m_clearColor[1] = g;\n    m_clearColor[2] = b;\n    m_clearColor[3] = a;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   * @returns {{1.0: null}}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearDepth = function() {\n    return m_clearDepth;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   * @param depth\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearDepth = function(depth) {\n    m_clearDepth = depth;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute direction of projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeDirectionOfProjection = function() {\n    vec3.subtract(m_directionOfProjection, m_focalPoint, m_position);\n    vec3.normalize(m_directionOfProjection, m_directionOfProjection);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute view plane normal\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeViewPlaneNormal = function() {\n    m_viewPlaneNormal[0] = -m_directionOfProjection[0];\n    m_viewPlaneNormal[1] = -m_directionOfProjection[1];\n    m_viewPlaneNormal[2] = -m_directionOfProjection[2];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Move camera closer or further away from the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoom = function(d, dir) {\n    if (d === 0) {\n      return;\n    }\n\n    if (!m_enableTranslation) {\n      return;\n    }\n\n    d = d * vec3.distance(m_focalPoint, m_position);\n    if (!dir) {\n      dir = m_directionOfProjection;\n      m_position[0] = m_focalPoint[0] - d * dir[0];\n      m_position[1] = m_focalPoint[1] - d * dir[1];\n      m_position[2] = m_focalPoint[2] - d * dir[2];\n    } else {\n      m_position[0] = m_position[0]  + d * dir[0];\n      m_position[1] = m_position[1]  + d * dir[1];\n      m_position[2] = m_position[2]  + d * dir[2];\n    }\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Move camera sideways\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pan = function(dx, dy, dz) {\n    if (!m_enableTranslation) {\n      return;\n    }\n\n    m_position[0] += dx;\n    m_position[1] += dy;\n    m_position[2] += dz;\n\n    m_focalPoint[0] += dx;\n    m_focalPoint[1] += dy;\n    m_focalPoint[2] += dz;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera coordinate axes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeOrthogonalAxes = function() {\n    this.computeDirectionOfProjection();\n    vec3.cross(m_rightDir, m_directionOfProjection, m_viewUp);\n    vec3.normalize(m_rightDir, m_rightDir);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Rotate camera around center of rotation\n   * @param dx Rotation around vertical axis in degrees\n   * @param dy Rotation around horizontal axis in degrees\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.rotate = function(dx, dy) {\n    if (!m_enableRotation) {\n      return;\n    }\n\n    // Convert degrees into radians\n    dx = 0.5 * dx * (Math.PI / 180.0);\n    dy = 0.5 * dy * (Math.PI / 180.0);\n\n    var mat = mat4.create(),\n        inverseCenterOfRotation = new vec3.create();\n\n    mat4.identity(mat);\n\n    inverseCenterOfRotation[0] = -m_centerOfRotation[0];\n    inverseCenterOfRotation[1] = -m_centerOfRotation[1];\n    inverseCenterOfRotation[2] = -m_centerOfRotation[2];\n\n    mat4.translate(mat, mat, m_centerOfRotation);\n    mat4.rotate(mat, mat, dx, m_viewUp);\n    mat4.rotate(mat, mat, dy, m_rightDir);\n    mat4.translate(mat, mat, inverseCenterOfRotation);\n\n    vec4.transformMat4(m_position, m_position, mat);\n    vec4.transformMat4(m_focalPoint, m_focalPoint, mat);\n\n    // Update viewup vector\n    vec4.transformMat4(m_viewUp, m_viewUp, mat);\n    vec4.normalize(m_viewUp, m_viewUp);\n\n    // Update direction of projection\n    this.computeOrthogonalAxes();\n\n    // Mark modified\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera view matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeViewMatrix = function() {\n    if (m_computeModelViewMatrixTime.getMTime() < this.getMTime()) {\n      mat4.lookAt(m_viewMatrix, m_position, m_focalPoint, m_viewUp);\n      m_computeModelViewMatrixTime.modified();\n    }\n    return m_viewMatrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera projection matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeProjectionMatrix = function() {\n    if (m_computeProjectMatrixTime.getMTime() < this.getMTime()) {\n      if (!m_enableParallelProjection) {\n        mat4.perspective(m_projectionMatrix, m_viewAngle, m_viewAspect, m_near, m_far);\n      } else {\n        console.log('paralle projection');\n        mat4.ortho(m_projectionMatrix,\n          m_left, m_right, m_bottom, m_top, m_near, m_far);\n      }\n\n      m_computeProjectMatrixTime.modified();\n    }\n\n    return m_projectionMatrix;\n  };\n\n  this.computeDirectionOfProjection();\n\n  return this;\n};\n\ninherit(vgl.camera, vgl.groupNode);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class interactorStyle\n *\n * @class vgl.interactorStyle\n * interactorStyle is a base class for all interactor styles\n * @returns {vgl.interactorStyle}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.interactorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.interactorStyle)) {\n    return new vgl.interactorStyle();\n  }\n  vgl.object.call(this);\n\n  // Private member variables\n  var m_that = this,\n      m_viewer = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return viewer referenced by the interactor style\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewer = function() {\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set viewer for the interactor style\n   *\n   * @param viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewer = function(viewer) {\n    if (viewer !== m_viewer) {\n      m_viewer = viewer;\n      $(m_viewer).on(vgl.event.mousePress, m_that.handleMouseDown);\n      $(m_viewer).on(vgl.event.mouseRelease, m_that.handleMouseUp);\n      $(m_viewer).on(vgl.event.mouseMove, m_that.handleMouseMove);\n      $(m_viewer).on(vgl.event.mouseOut, m_that.handleMouseOut);\n      $(m_viewer).on(vgl.event.mouseWheel, m_that.handleMouseWheel);\n      $(m_viewer).on(vgl.event.keyPress, m_that.handleKeyPress);\n      $(m_viewer).on(vgl.event.mouseContextMenu, m_that.handleContextMenu);\n      $(m_viewer).on(vgl.event.click, m_that.handleClick);\n      $(m_viewer).on(vgl.event.dblClick, m_that.handleDoubleClick);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseOut = function(event) {\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleClick = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleDoubleClick = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle key press event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleKeyPress = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle context menu event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleContextMenu = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function() {\n    return true;\n  };\n\n  return this;\n};\n\ninherit(vgl.interactorStyle, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of trackballInteractorStyle\n *\n * @class vgl.trackballInteractorStyle\n * @returns {vgl.trackballInteractorStyle}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.trackballInteractorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.trackballInteractorStyle)) {\n    return new vgl.trackballInteractorStyle();\n  }\n  vgl.interactorStyle.call(this);\n  var m_that = this,\n      m_leftMouseBtnDown = false,\n      m_rightMouseBtnDown = false,\n      m_midMouseBtnDown = false,\n      m_outsideCanvas,\n      m_currPos = {x: 0, y: 0},\n      m_lastPos = {x: 0, y: 0};\n\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    var canvas = m_that.viewer().canvas(),\n        width = m_that.viewer().renderWindow().windowSize()[0],\n        height = m_that.viewer().renderWindow().windowSize()[1],\n        ren = m_that.viewer().renderWindow().activeRenderer(),\n        cam = ren.camera(), coords = m_that.viewer().relMouseCoords(event),\n        fp, fdp, fwp, dp1, dp2, wp1, wp2, coords, dx, dy, dz,\n        coords, m_zTrans;\n\n    m_outsideCanvas = false;\n    m_currPos = {x: 0, y: 0};\n\n    if ((coords.x < 0) || (coords.x > width)) {\n      m_currPos.x = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currPos.x = coords.x;\n    }\n    if ((coords.y < 0) || (coords.y > height)) {\n      m_currPos.y = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currPos.y = coords.y;\n    }\n    if (m_outsideCanvas === true) {\n      return;\n    }\n\n    fp = cam.focalPoint();\n    fwp = vec4.fromValues(fp[0], fp[1], fp[2], 1);\n    fdp = ren.worldToDisplay(fwp, cam.viewMatrix(),\n                              cam.projectionMatrix(), width, height);\n\n    dp1 = vec4.fromValues(m_currPos.x, m_currPos.y, fdp[2], 1.0);\n    dp2 = vec4.fromValues(m_lastPos.x, m_lastPos.y, fdp[2], 1.0);\n\n    wp1 = ren.displayToWorld(dp1, cam.viewMatrix(), cam.projectionMatrix(),\n                             width, height);\n    wp2 = ren.displayToWorld(dp2, cam.viewMatrix(), cam.projectionMatrix(),\n                             width, height);\n\n    dx = wp1[0] - wp2[0];\n    dy = wp1[1] - wp2[1];\n    dz = wp1[2] - wp2[2];\n\n    if (m_midMouseBtnDown) {\n      cam.pan(-dx, -dy, -dz);\n      m_that.viewer().render();\n    }\n    if (m_leftMouseBtnDown) {\n      cam.rotate((m_lastPos.x - m_currPos.x),\n      (m_lastPos.y - m_currPos.y));\n      ren.resetCameraClippingRange();\n      m_that.viewer().render();\n    }\n    if (m_rightMouseBtnDown) {\n      /// 2.0 is the speed up factor\n      m_zTrans = 2.0 * (m_currPos.y - m_lastPos.y) / height;\n\n      // Calculate zoom scale here\n      if (m_zTrans > 0) {\n        cam.zoom(1 - Math.abs(m_zTrans));\n      } else {\n        cam.zoom(1 + Math.abs(m_zTrans));\n      }\n      ren.resetCameraClippingRange();\n      m_that.viewer().render();\n    }\n    m_lastPos.x = m_currPos.x;\n    m_lastPos.y = m_currPos.y;\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    var coords;\n\n    if (event.button === 0) {\n      m_leftMouseBtnDown = true;\n    }\n    if (event.button === 1) {\n      m_midMouseBtnDown = true;\n    }\n    if (event.button === 2) {\n      m_rightMouseBtnDown = true;\n    }\n    coords = m_that.view.relMouseCoords(event);\n    if (coords.x < 0) {\n      m_lastPos.x = 0;\n    } else {\n      m_lastPos.x = coords.x;\n    }\n    if (coords.y < 0) {\n      m_lastPos.y = 0;\n    } else {\n      m_lastPos.y = coords.y;\n    }\n    return false;\n  };\n\n  // @note We never get mouse up from scroll bar: See the bug report here\n  // http://bugs.jquery.com/ticket/8184\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    if (event.button === 0) {\n      m_leftMouseBtnDown = false;\n    }\n    if (event.button === 1) {\n      m_midMouseBtnDown = false;\n    }\n    if (event.button === 2) {\n      m_rightMouseBtnDown = false;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    var ren = m_that.viewer().renderWindow().activeRenderer(),\n        cam = ren.camera();\n\n    // TODO Compute zoom factor intelligently\n    if (event.originalEvent.wheelDelta < 0) {\n      cam.zoom(0.9);\n    } else {\n      cam.zoom(1.1);\n    }\n    ren.resetCameraClippingRange();\n    m_that.viewer().render();\n    return true;\n  };\n\n  return this;\n};\ninherit(vgl.trackballInteractorStyle, vgl.interactorStyle);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pvwInteractorStyle (for ParaViewWeb)\n *\n * @class vgl.pvwInteractorStyle\n * @returns {vgl.pvwInteractorStyle}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.pvwInteractorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.pvwInteractorStyle)) {\n    return new vgl.pvwInteractorStyle();\n  }\n  vgl.trackballInteractorStyle.call(this);\n  var m_that = this,\n      m_leftMouseButtonDown = false,\n      m_rightMouseButtonDown = false,\n      m_middleMouseButtonDown = false,\n      m_width,\n      m_height,\n      m_renderer,\n      m_camera,\n      m_outsideCanvas,\n      m_coords,\n      m_currentMousePos,\n      m_focalPoint,\n      m_focusWorldPt,\n      m_focusDisplayPt,\n      m_displayPt1,\n      m_displayPt2,\n      m_worldPt1,\n      m_worldPt2,\n      m_dx,\n      m_dy,\n      m_dz,\n      m_zTrans,\n      m_mouseLastPos = {\n        x: 0,\n        y: 0\n      };\n\n  function render() {\n    m_renderer.resetCameraClippingRange();\n    m_that.viewer().render();\n  }\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    var rens = [], i = null, secCameras = [], deltaxy = null;\n        m_width = m_that.viewer().renderWindow().windowSize()[0];\n        m_height = m_that.viewer().renderWindow().windowSize()[1];\n        m_renderer = m_that.viewer().renderWindow().activeRenderer();\n        m_camera = m_renderer.camera();\n        m_outsideCanvas = false;\n        m_coords = m_that.viewer().relMouseCoords(event);\n        m_currentMousePos = {\n          x: 0,\n          y: 0\n        };\n\n    // Get secondary cameras\n    rens = m_that.viewer().renderWindow().renderers();\n    for (i = 0; i < rens.length; ++i) {\n      if (m_renderer !== rens[i]) {\n        secCameras.push(rens[i].camera());\n      }\n    }\n\n    if ((m_coords.x < 0) || (m_coords.x > m_width)) {\n      m_currentMousePos.x = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currentMousePos.x = m_coords.x;\n    }\n    if ((m_coords.y < 0) || (m_coords.y > m_height)) {\n      m_currentMousePos.y = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currentMousePos.y = m_coords.y;\n    }\n    if (m_outsideCanvas === true) {\n      return;\n    }\n    m_focalPoint = m_camera.focalPoint();\n    m_focusWorldPt = vec4.fromValues(m_focalPoint[0], m_focalPoint[1], m_focalPoint[2], 1);\n    m_focusDisplayPt = m_renderer.worldToDisplay(m_focusWorldPt, m_camera.viewMatrix(),\n      m_camera.projectionMatrix(), m_width, m_height);\n    m_displayPt1 = vec4.fromValues(\n      m_currentMousePos.x, m_currentMousePos.y, m_focusDisplayPt[2], 1.0);\n    m_displayPt2 = vec4.fromValues(\n      m_mouseLastPos.x, m_mouseLastPos.y, m_focusDisplayPt[2], 1.0);\n    m_worldPt1 = m_renderer.displayToWorld(\n      m_displayPt1, m_camera.viewMatrix(), m_camera.projectionMatrix(), m_width, m_height);\n    m_worldPt2 = m_renderer.displayToWorld(\n      m_displayPt2, m_camera.viewMatrix(), m_camera.projectionMatrix(), m_width, m_height);\n\n    m_dx = m_worldPt1[0] - m_worldPt2[0];\n    m_dy = m_worldPt1[1] - m_worldPt2[1];\n    m_dz = m_worldPt1[2] - m_worldPt2[2];\n\n    if (m_middleMouseButtonDown) {\n      m_camera.pan(-m_dx, -m_dy, -m_dz);\n      render();\n    }\n    if (m_leftMouseButtonDown) {\n      deltaxy = [(m_mouseLastPos.x - m_currentMousePos.x),\n      (m_mouseLastPos.y - m_currentMousePos.y)];\n      m_camera.rotate(deltaxy[0], deltaxy[1]);\n\n      // Apply rotation to all other cameras\n      for (i = 0; i < secCameras.length; ++i) {\n        secCameras[i].rotate(deltaxy[0], deltaxy[1]);\n      }\n\n      // Apply rotation to all other cameras\n      for (i = 0; i < rens.length; ++i) {\n        rens[i].resetCameraClippingRange();\n      }\n      render();\n    }\n    if (m_rightMouseButtonDown) {\n      /// 2.0 is the speed up factor.\n      m_zTrans = 2.0 * (m_currentMousePos.y - m_mouseLastPos.y) / m_height;\n\n      // Calculate zoom scale here\n      if (m_zTrans > 0) {\n        m_camera.zoom(1 - Math.abs(m_zTrans));\n      } else {\n        m_camera.zoom(1 + Math.abs(m_zTrans));\n      }\n      render();\n    }\n    m_mouseLastPos.x = m_currentMousePos.x;\n    m_mouseLastPos.y = m_currentMousePos.y;\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    if (event.button === 0) {\n      m_leftMouseButtonDown = true;\n    }\n    if (event.button === 1) {\n      m_middleMouseButtonDown = true;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = true;\n    }\n    m_coords = m_that.viewer().relMouseCoords(event);\n    if (m_coords.x < 0) {\n      m_mouseLastPos.x = 0;\n    } else {\n      m_mouseLastPos.x = m_coords.x;\n    }\n    if (m_coords.y < 0) {\n      m_mouseLastPos.y = 0;\n    } else {\n      m_mouseLastPos.y = m_coords.y;\n    }\n    return false;\n  };\n\n  // @note We never get mouse up from scroll bar: See the bug report here\n  // http://bugs.jquery.com/ticket/8184\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    var canvas = m_that.viewer().canvas();\n    if (event.button === 0) {\n      m_leftMouseButtonDown = false;\n    }\n    if (event.button === 1) {\n      m_middleMouseButtonDown = false;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = false;\n    }\n    return false;\n  };\n\n  return this;\n};\ninherit(vgl.pvwInteractorStyle, vgl.trackballInteractorStyle);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global window, vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class viewer\n *\n * @param canvas\n * @returns {vgl.viewer}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.viewer = function(canvas) {\n  'use strict';\n\n  if (!(this instanceof vgl.viewer)) {\n    return new vgl.viewer(canvas);\n  }\n\n  vgl.object.call(this);\n\n  var m_that = this,\n      m_canvas = canvas,\n      m_ready = true,\n      m_interactorStyle = null,\n      m_renderer = vgl.renderer(),\n      m_renderWindow = vgl.renderWindow(m_canvas);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas of the viewer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function() {\n    return m_canvas;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return render window of the viewer\n   *\n   * @returns {vgl.renderWindow}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderWindow = function() {\n    return m_renderWindow;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize the viewer\n   *\n   * This is a must call or otherwise render context may not initialized\n   * properly.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.init = function() {\n    if (m_renderWindow !== null) {\n      m_renderWindow.createWindow();\n    }\n    else {\n      console.log(\"[ERROR] No render window attached\");\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get interactor style of the viewer\n   *\n   * @returns {vgl.interactorStyle}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.interactorStyle = function() {\n    return m_interactorStyle;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set interactor style to be used by the viewer\n   *\n   * @param {vgl.interactorStyle} style\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setInteractorStyle = function(style) {\n    if (style !== m_interactorStyle) {\n      m_interactorStyle = style;\n      m_interactorStyle.setViewer(this);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      // Only prevent default action for right mouse button\n      if (event.button === 2) {\n        fixedEvent.preventDefault();\n      }\n      fixedEvent.state = 'down';\n      fixedEvent.type = vgl.event.mousePress;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.state = 'up';\n      fixedEvent.type = vgl.event.mouseRelease;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseMove;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel scroll\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseWheel;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseOut = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseOut;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle key press event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleKeyPress = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.keyPress;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle context menu event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleContextMenu = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.contextMenu;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleClick = function(event) {\n   if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.click;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleDoubleClick = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.dblClick;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get mouse coodinates related to canvas\n   *\n   * @param event\n   * @returns {{x: number, y: number}}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.relMouseCoords = function(event) {\n    if (event.pageX === undefined || event.pageY === undefined) {\n      throw \"Missing attributes pageX and pageY on the event\";\n    }\n\n    var totalOffsetX = 0,\n        totalOffsetY = 0,\n        canvasX = 0,\n        canvasY = 0,\n        currentElement = m_canvas;\n\n    do {\n      totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;\n      totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;\n    } while (currentElement = currentElement.offsetParent);\n\n    canvasX = event.pageX - totalOffsetX;\n    canvasY = event.pageY - totalOffsetY;\n\n    return {\n      x: canvasX,\n      y: canvasY\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    m_renderWindow.render();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind canvas mouse events to their default handlers\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindEventHandlers = function() {\n    $(m_canvas).on('mousedown', this.handleMouseDown);\n    $(m_canvas).on('mouseup', this.handleMouseUp);\n    $(m_canvas).on('mousemove', this.handleMouseMove);\n    $(m_canvas).on('mousewheel', this.handleMouseWheel);\n    $(m_canvas).on('contextmenu', this.handleContextMenu);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo earlier binded  handlers for canvas mouse events\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.unbindEventHandlers = function() {\n    $(m_canvas).off('mousedown', this.handleMouseDown);\n    $(m_canvas).off('mouseup', this.handleMouseUp);\n    $(m_canvas).off('mousemove', this.handleMouseMove);\n    $(m_canvas).off('mousewheel', this.handleMouseWheel);\n    $(m_canvas).off('contextmenu', this.handleContextMenu);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function() {\n    this.bindEventHandlers();\n    m_renderWindow.addRenderer(m_renderer);\n  }\n\n  this._init();\n  return this;\n};\n\ninherit(vgl.viewer, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global gl, vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class shader\n *\n * @param type\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shader = function(type) {\n  'use strict';\n\n  if (!(this instanceof vgl.shader)) {\n    return new vgl.shader(type);\n  }\n  vgl.object.call(this);\n\n  var m_shaderHandle = null,\n      m_compileTimestamp = vgl.timestamp(),\n      m_shaderType = type,\n      m_shaderSource = \"\";\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get shader handle\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderHandle = function() {\n    return m_shaderHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get type of the shader\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderType = function() {\n    return m_shaderType;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get shader source\n   *\n   * @returns {string}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderSource = function() {\n    return m_shaderSource;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set shader source\n   *\n   * @param {string} source\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setShaderSource = function(source) {\n    m_shaderSource = source;\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compile the shader\n   *\n   * @returns {null}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.compile = function() {\n    if (this.getMTime() < m_compileTimestamp.getMTime()) {\n      return m_shaderHandle;\n    }\n\n    gl.deleteShader(m_shaderHandle);\n    m_shaderHandle = gl.createShader(m_shaderType);\n    gl.shaderSource(m_shaderHandle, m_shaderSource);\n    gl.compileShader(m_shaderHandle);\n\n    // See if it compiled successfully\n    if (!gl.getShaderParameter(m_shaderHandle, gl.COMPILE_STATUS)) {\n      console.log(\"[ERROR] An error occurred compiling the shaders: \"\n                  + gl.getShaderInfoLog(m_shaderHandle));\n      console.log(m_shaderSource);\n      gl.deleteShader(m_shaderHandle);\n      return null;\n    }\n\n    m_compileTimestamp.modified();\n\n    return m_shaderHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Attach shader to the program\n   *\n   * @param programHandle\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.attachShader = function(programHandle) {\n    gl.attachShader(programHandle, m_shaderHandle);\n  };\n};\n\ninherit(vgl.shader, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instace of class shaderProgram\n *\n * @class\n * @returns {vgl.shaderProgram}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shaderProgram = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.shaderProgram)) {\n    return new vgl.shaderProgram();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.ShaderProgram);\n\n  /** @private */\n  var m_programHandle = 0,\n      m_compileTimestamp = vgl.timestamp(),\n      m_shaders = [],\n      m_uniforms = [],\n      m_vertexAttributes = {},\n      m_uniformNameToLocation = {},\n      m_vertexAttributeNameToLocation = {};\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Query uniform location in the program\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.queryUniformLocation = function(name) {\n    return gl.getUniformLocation(m_programHandle, name);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Query attribute location in the program\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.queryAttributeLocation = function(name) {\n    return gl.getAttribLocation(m_programHandle, name);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new shader to the program\n   *\n   * @param shader\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addShader = function(shader) {\n    if (m_shaders.indexOf(shader) > -1) {\n      return false;\n    }\n\n    var i;\n    for (i = 0; i < m_shaders.length; ++i) {\n      if (m_shaders[i].shaderType() === shader.shaderType()) {\n        m_shaders.splice(m_shaders.indexOf(shader), 1);\n      }\n    }\n\n    m_shaders.push(shader);\n\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new uniform to the program\n   *\n   * @param uniform\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addUniform = function(uniform) {\n    if (m_uniforms.indexOf(uniform) > -1) {\n      return false;\n    }\n\n    m_uniforms.push(uniform);\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new vertex attribute to the program\n   *\n   * @param attr\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addVertexAttribute = function(attr, key) {\n    m_vertexAttributes[key] = attr;\n\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform location\n   *\n   * This method does not perform any query into the program but relies on\n   * the fact that it depends on a call to queryUniformLocation earlier.\n   *\n   * @param name\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.uniformLocation = function(name) {\n    return m_uniformNameToLocation[name];\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get attribute location\n   *\n   * This method does not perform any query into the program but relies on the\n   * fact that it depends on a call to queryUniformLocation earlier.\n   *\n   * @param name\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.attributeLocation = function(name) {\n    return m_vertexAttributeNameToLocation[name];\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform object using name as the key\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.uniform = function(name) {\n    var i;\n    for (i = 0; i < m_uniforms.length; ++i) {\n      if (m_uniforms[i].name() === name) {\n        return m_uniforms[i];\n      }\n    }\n\n    return null;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update all uniforms\n   *\n   * This method should be used directly unless required\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateUniforms = function() {\n    var i;\n\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniforms[i].callGL(m_uniformNameToLocation[m_uniforms[i].name()]);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Link shader program\n   *\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.link = function() {\n    gl.linkProgram(m_programHandle);\n\n    // If creating the shader program failed, alert\n    if (!gl.getProgramParameter(m_programHandle, gl.LINK_STATUS)) {\n      console.log(\"[ERROR] Unable to initialize the shader program.\");\n      return false;\n    }\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Use the shader program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.use = function() {\n    gl.useProgram(m_programHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Peform any clean up required when the program gets deleted\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.cleanUp = function() {\n    this.deleteVertexAndFragment();\n    this.deleteProgram();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete the shader program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.deleteProgram = function() {\n    gl.deleteProgram(m_programHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete vertex and fragment shaders\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.deleteVertexAndFragment = function() {\n    var i;\n    for (i = 0; i < m_shaders.length; ++i) {\n      gl.deleteShader(m_shaders[i].shaderHandle());\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind the program with its shaders\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    var i = 0;\n\n    if (m_programHandle === 0\n        || (m_compileTimestamp.getMTime() < this.getMTime())) {\n      m_programHandle = gl.createProgram();\n\n      if (m_programHandle === 0) {\n        console.log(\"[ERROR] Cannot create Program Object\");\n        return false;\n      }\n\n      // Compile shaders\n      for (i = 0; i < m_shaders.length; ++i) {\n        m_shaders[i].compile();\n        m_shaders[i].attachShader(m_programHandle);\n      }\n\n      this.bindAttributes();\n\n      // link program\n      if (!this.link()) {\n        console.log(\"[ERROR] Failed to link Program\");\n        this.cleanUp();\n      }\n\n      this.use();\n      this.bindUniforms();\n      m_compileTimestamp.modified();\n    }\n    else {\n      this.use();\n    }\n\n    // Call update callback.\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniforms[i].update(renderState, this);\n    }\n\n    // Now update values to GL.\n    this.updateUniforms();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo binding of the shader program\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    // Do nothing\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    if (m_vertexAttributes.hasOwnProperty(key)) {\n      m_vertexAttributes[key].bindVertexData(renderState, key);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vetex data\n   *\n   * @param renderState\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    if (m_vertexAttributes.hasOwnProperty(key)) {\n      m_vertexAttributes[key].undoBindVertexData(renderState, key);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind uniforms\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindUniforms = function() {\n    var i;\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniformNameToLocation[m_uniforms[i].name()] = this\n          .queryUniformLocation(m_uniforms[i].name());\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex attributes\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindAttributes = function() {\n    var key, name;\n    for (key in m_vertexAttributes) {\n      name = m_vertexAttributes[key].name();\n      gl.bindAttribLocation(m_programHandle, key, name);\n      m_vertexAttributeNameToLocation[name] = key;\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.shaderProgram, vgl.materialAttribute);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global Uint8Array, vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class texture\n *\n * @class\n * @returns {vgl.texture}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.texture = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.texture)) {\n    return new vgl.texture();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.Texture);\n\n  this.m_width = 0;\n  this.m_height = 0;\n  this.m_depth = 0;\n\n  this.m_textureHandle = null;\n  this.m_textureUnit = 0;\n\n  this.m_pixelFormat = null;\n  this.m_pixelDataType = null;\n\n  this.m_internalFormat = null;\n\n  this.m_image = null;\n\n  var m_setupTimestamp = vgl.timestamp(),\n      m_that = this;\n\n  function activateTextureUnit() {\n    switch (m_that.m_textureUnit) {\n      case 0:\n        gl.activeTexture(gl.TEXTURE0);\n        break;\n      case 1:\n        gl.activeTexture(gl.TEXTURE1);\n        break;\n      case 2:\n        gl.activeTexture(gl.TEXTURE2);\n        break;\n      case 3:\n        gl.activeTexture(gl.TEXTURE3);\n        break;\n      case 4:\n        gl.activeTexture(gl.TEXTURE4);\n        break;\n      case 5:\n        gl.activeTexture(gl.TEXTURE5);\n        break;\n      case 6:\n        gl.activeTexture(gl.TEXTURE6);\n        break;\n      case 7:\n        gl.activeTexture(gl.TEXTURE7);\n        break;\n      case 8:\n        gl.activeTexture(gl.TEXTURE8);\n        break;\n      case 9:\n        gl.activeTexture(gl.TEXTURE9);\n        break;\n      case 10:\n        gl.activeTexture(gl.TEXTURE10);\n        break;\n      case 11:\n        gl.activeTexture(gl.TEXTURE11);\n        break;\n      case 12:\n        gl.activeTexture(gl.TEXTURE12);\n        break;\n      case 13:\n        gl.activeTexture(gl.TEXTURE13);\n        break;\n      case 14:\n        gl.activeTexture(gl.TEXTURE14);\n        break;\n      case 15:\n        gl.activeTexture(gl.TEXTURE15);\n        break;\n      default:\n        throw \"[error] Texture unit \"  + this.m_textureUnit +\n              \" is not supported\";\n    }\n  }\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create texture, update parameters, and bind data\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    activateTextureUnit();\n\n    gl.deleteTexture(this.m_textureHandle);\n    this.m_textureHandle = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n    if (this.m_image !== null) {\n      this.updateDimensions();\n      this.computeInternalFormatUsingImage();\n\n      // console.log(\"m_internalFormat \" + this.m_internalFormat);\n      // console.log(\"m_pixelFormat \" + this.m_pixelFormat);\n      // console.log(\"m_pixelDataType \" + this.m_pixelDataType);\n\n      // FOR now support only 2D textures\n      gl.texImage2D(gl.TEXTURE_2D, 0, this.m_internalFormat,\n                    this.m_pixelFormat, this.m_pixelDataType, this.m_image);\n    }\n    else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, this.m_internalFormat,\n                    this.m_pixelFormat, this.m_pixelDataType, null);\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    m_setupTimestamp.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create texture and if already created use it\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    // TODO Call setup via material setup\n    if (this.getMTime() > m_setupTimestamp.getMTime()) {\n      this.setup(renderState);\n    }\n\n    activateTextureUnit();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn off the use of this texture\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get image used by the texture\n   *\n   * @returns {vgl.image}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.image = function() {\n    return this.m_image;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set image for the texture\n   *\n   * @param {vgl.image} image\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setImage = function(image) {\n    if (image !== null) {\n      this.m_image = image;\n      this.updateDimensions();\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get texture unit of the texture\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.textureUnit = function() {\n    return this.m_textureUnit;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set texture unit of the texture. Default is 0.\n   *\n   * @param {number} unit\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setTextureUnit = function(unit) {\n    if (this.m_textureUnit === unit) {\n      return false;\n    }\n\n    this.m_textureUnit = unit;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get width of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.width = function() {\n    return this.m_width;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set width of the texture\n   *\n   * @param {number} width\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setWidth = function(width) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_width = width;\n    this.modified();\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get depth of the texture\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.depth = function() {\n    return this.m_depth;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set depth of the texture\n   *\n   * @param {number} depth\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setDepth = function(depth) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_depth = depth;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the texture handle (id) of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.textureHandle = function() {\n    return this.m_textureHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal format of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.internalFormat = function() {\n    return this.m_internalFormat;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set internal format of the texture\n   *\n   * @param internalFormat\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setInternalFormat = function(internalFormat) {\n    if (this.m_internalFormat !== internalFormat) {\n      this.m_internalFormat = internalFormat;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get pixel format of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.pixelFormat = function() {\n    return this.m_pixelFormat;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set pixel format of the texture\n   *\n   * @param pixelFormat\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setPixelFormat = function(pixelFormat) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_pixelFormat = pixelFormat;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get pixel data type\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.pixelDataType = function() {\n    return this.m_pixelDataType;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set pixel data type\n   *\n   * @param pixelDataType\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setPixelDataType = function(pixelDataType) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_pixelDataType = pixelDataType;\n\n    this.modified();\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute internal format of the texture\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.computeInternalFormatUsingImage = function() {\n    // Currently image does not define internal format\n    // and hence it's pixel format is the only way to query\n    // information on how color has been stored.\n    // switch (this.m_image.pixelFormat()) {\n    // case gl.RGB:\n    // this.m_internalFormat = gl.RGB;\n    // break;\n    // case gl.RGBA:\n    // this.m_internalFormat = gl.RGBA;\n    // break;\n    // case gl.Luminance:\n    // this.m_internalFormat = gl.Luminance;\n    // break;\n    // case gl.LuminanceAlpha:\n    // this.m_internalFormat = gl.LuminanceAlpha;\n    // break;\n    // // Do nothing when image pixel format is none or undefined.\n    // default:\n    // break;\n    // };\n\n    // TODO Fix this\n    this.m_internalFormat = gl.RGBA;\n    this.m_pixelFormat = gl.RGBA;\n    this.m_pixelDataType = gl.UNSIGNED_BYTE;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update texture dimensions\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateDimensions = function() {\n    if (this.m_image !== null) {\n      this.m_width = this.m_image.width;\n      this.m_height = this.m_image.height;\n      this.m_depth = 0; // Only 2D images are supported now\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.texture, vgl.materialAttribute);\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lookupTable\n *\n * @class\n * @returns {vgl.lookupTable}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.lookupTable = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lookupTable)) {\n    return new vgl.lookupTable();\n  }\n  vgl.texture.call(this);\n\n  var m_setupTimestamp = vgl.timestamp(),\n      m_range = [0,0];\n\n  this.m_colorTable = //paraview bwr colortable\n    [0.07514311,0.468049805,1,1,\n     0.247872569,0.498782363,1,1,\n     0.339526309,0.528909511,1,1,\n     0.409505078,0.558608486,1,1,\n     0.468487184,0.588057293,1,1,\n     0.520796675,0.617435078,1,1,\n     0.568724526,0.646924167,1,1,\n     0.613686735,0.676713218,1,1,\n     0.656658579,0.707001303,1,1,\n     0.698372844,0.738002964,1,1,\n     0.739424025,0.769954435,1,1,\n     0.780330104,0.803121429,1,1,\n     0.821573924,0.837809045,1,1,\n     0.863634967,0.874374691,1,1,\n     0.907017747,0.913245283,1,1,\n     0.936129275,0.938743558,0.983038586,1,\n     0.943467973,0.943498599,0.943398095,1,\n     0.990146732,0.928791426,0.917447482,1,\n     1,0.88332677,0.861943246,1,\n     1,0.833985467,0.803839606,1,\n     1,0.788626485,0.750707739,1,\n     1,0.746206642,0.701389973,1,\n     1,0.70590052,0.654994046,1,\n     1,0.667019783,0.610806959,1,\n     1,0.6289553,0.568237474,1,\n     1,0.591130233,0.526775617,1,\n     1,0.552955184,0.485962266,1,\n     1,0.513776083,0.445364274,1,\n     1,0.472800903,0.404551679,1,\n     1,0.428977855,0.363073592,1,\n     1,0.380759558,0.320428137,1,\n     0.961891484,0.313155629,0.265499262,1,\n     0.916482116,0.236630659,0.209939162,1].map(\n             function(x) {return x*255;});\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create lookup table, initialize parameters, and bind data to it\n   *\n   * @param {vgl.renderState} renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    if (this.textureUnit() === 0) {\n      gl.activeTexture(gl.TEXTURE0);\n    } else if (this.textureUnit() === 1) {\n      gl.activeTexture(gl.TEXTURE1);\n    }\n\n    gl.deleteTexture(this.m_textureHandle);\n    this.m_textureHandle = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\n    this.m_width = this.m_colorTable.length/4;\n    this.m_height = 1;\n    this.m_depth = 0;\n    gl.texImage2D(gl.TEXTURE_2D,\n                  0, gl.RGBA, this.m_width, this.m_height, this.m_depth,\n                  gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array(this.m_colorTable));\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    m_setupTimestamp.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get color table used by the lookup table\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.colorTable = function() {\n    return this.m_colorTable;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set color table used by the lookup table\n   *\n   * @param colors\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setColorTable = function(colors) {\n    if (this.m_colorTable === colors) {\n      return false;\n    }\n\n    this.m_colorTable = colors;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get scalar range\n   *\n   * @returns {Array}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.range = function() {\n    return m_range;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set scalar range for the lookup table\n   *\n   * @param range\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setRange = function(range) {\n    if (m_range === range) {\n      return false;\n    }\n    m_range = range;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Given a [min,max] range update the lookup table range\n   *\n   * @param range\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateRange = function(range) {\n    if (!(range instanceof Array)) {\n      console.log('[error] Invalid data type for range. Requires array [min,max]');\n    }\n\n    if (range[0] < m_range[0]) {\n      m_range[0] = range[0];\n      this.modified();\n    }\n\n    if (range[1] > m_range[1]) {\n      m_range[1] = range[1];\n      this.modified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.lookupTable, vgl.texture);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec2, vec3, vec4, mat3, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class uniform\n *\n * @param type\n * @param name\n * @returns {vgl.uniform} OpenGL uniform encapsulation\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.uniform = function(type, name) {\n  'use strict';\n\n  if (!(this instanceof vgl.uniform)) {\n    return new vgl.uniform();\n  }\n\n  this.getTypeNumberOfComponents = function(type) {\n    switch (type) {\n      case gl.FLOAT:\n      case gl.INT:\n      case gl.BOOL:\n        return 1;\n\n      case gl.FLOAT_VEC2:\n      case gl.INT_VEC2:\n      case gl.BOOL_VEC2:\n        return 2;\n\n      case gl.FLOAT_VEC3:\n      case gl.INT_VEC3:\n      case gl.BOOLT_VEC3:\n        return 3;\n\n      case gl.FLOAT_VEC4:\n      case gl.INT_VEC4:\n      case gl.BOOL_VEC4:\n        return 4;\n\n      case gl.FLOAT_MAT3:\n        return 9;\n\n      case gl.FLOAT_MAT4:\n        return 16;\n\n      default:\n        return 0;\n    }\n  };\n\n  var m_type = type,\n      m_name = name,\n      m_dataArray = [],\n      m_numberOfElements = 1;\n\n  m_dataArray.length = this.getTypeNumberOfComponents(m_type);\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get name of the uniform\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get type of the uniform\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return m_type;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get value of the uniform\n   *\n   * @returns {Array}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.get = function() {\n    return m_dataArray;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set value of the uniform\n   *\n   * @param value\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.set = function(value) {\n    var i = 0;\n    if (m_dataArray.length === 16) {\n      for (i = 0; i < 16; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 9) {\n      for (i = 0; i < 9; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 4) {\n      for (i = 0; i < 4; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 3) {\n      for (i = 0; i < 3; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 2) {\n      for (i = 0; i < 2; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else {\n      m_dataArray[0] = value;\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call GL and pass updated values to the current shader\n   *\n   * @param location\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.callGL = function(location) {\n    if (this.m_numberElements < 1) {\n      return;\n    }\n\n    switch (m_type) {\n      case gl.BOOL:\n      case gl.INT:\n        gl.uniform1iv(location, m_dataArray);\n        break;\n      case gl.FLOAT:\n        gl.uniform1fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC2:\n        gl.uniform2fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC3:\n        gl.uniform3fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC4:\n        gl.uniform4fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_MAT3:\n        gl.uniformMatrix3fv(location, gl.FALSE, m_dataArray);\n        break;\n      case gl.FLOAT_MAT4:\n        gl.uniformMatrix4fv(location, gl.FALSE, m_dataArray);\n        break;\n      default:\n        break;\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual method to update the uniform\n   *\n   * Should be implemented by the derived class.\n   *\n   * @param renderState\n   * @param program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    // Should be implemented by the derived class\n  };\n\n  return this;\n};\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of class modelViewUniform\n *\n * @param name\n * @returns {vgl.modelViewUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.modelViewUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.modelViewUniform)) {\n    return new vgl.modelViewUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"modelViewMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.shaderProgram} program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_modelViewMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.modelViewUniform, vgl.uniform);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class projectionUniform\n *\n * @param name\n * @returns {vgl.projectionUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.projectionUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.projectionUniform)) {\n    return new vgl.projectionUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"projectionMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param renderState\n   * @param program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_projectionMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.projectionUniform, vgl.uniform);\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class floatUniform\n *\n * @param name\n * @param value\n * @returns {vgl.floatUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.floatUniform = function(name, value) {\n  'use strict';\n\n  if (!(this instanceof vgl.floatUniform)) {\n    return new vgl.floatUniform(name, value);\n  }\n\n  if (name.length === 0) {\n    name = \"floatUniform\";\n  }\n\n  value = value === undefined ? 1.0 : value;\n\n  vgl.uniform.call(this, gl.FLOAT, name);\n\n  this.set(value);\n};\n\ninherit(vgl.floatUniform, vgl.uniform);\n\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of class normalMatrixUniform\n *\n * @param name\n * @returns {vgl.normalMatrixUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.normalMatrixUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.normalMatrixUniform)) {\n    return new vgl.normalMatrixUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"normalMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.shaderProgram} program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_normalMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.normalMatrixUniform, vgl.uniform);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Keys to identify vertex attributes\n *\n * @type {{Position: number, Normal: number, TextureCoordinate: number,\n *         Color: number, Scalar: number, Scalar2: number, Scalar3: number,\n *         Scalar4: number, Scalar5: number, Scalar6: number, Scalar7: number,\n *         CountAttributeIndex: number}}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexAttributeKeys = {\n  \"Position\" : 0,\n  \"Normal\" : 1,\n  \"TextureCoordinate\" : 2,\n  \"Color\" : 3,\n  \"CountAttributeIndex\" : 4\n};\n\nvgl.vertexAttributeKeysIndexed = {\n  \"Zero\" : 0,\n  \"One\" : 1,\n  \"Two\" : 2,\n  \"Three\" : 3,\n  \"Four\" : 4,\n  \"Five\" : 5,\n  \"Six\" : 6,\n  \"Seven\" : 7,\n  \"Eight\" : 8,\n  \"Nine\" : 9\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertexAttribute\n *\n * @param {string} name\n * @returns {vgl.vertexAttribute}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexAttribute = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexAttribute)) {\n    return new vgl.vertexAttribute(name);\n  }\n\n  var m_name = name;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get name of the vertex attribute\n   *\n   * @returns {string}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data to the given render state\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.vertexAttributeKeys} key\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    var geometryData = renderState.m_mapper.geometryData(),\n        sourceData = geometryData.sourceData(key),\n        program = renderState.m_material.shaderProgram();\n\n    gl.vertexAttribPointer(program.attributeLocation(m_name), sourceData\n        .attributeNumberOfComponents(key), sourceData.attributeDataType(key),\n                           sourceData.normalized(key), sourceData\n                               .attributeStride(key), sourceData\n                               .attributeOffset(key));\n\n    gl.enableVertexAttribArray(program.attributeLocation(m_name));\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vertex data for a given render state\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.vertexAttributeKeys} key\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    var program = renderState.m_material.shaderProgram();\n\n    gl.disableVertexAttribArray(program.attributeLocation(m_name));\n  };\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class source\n *\n * @returns {vgl.source}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.source = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.source)) {\n    return new vgl.source();\n  }\n\n  vgl.object.call(this);\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual function to create a source instance\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n  };\n\n  return this;\n};\n\ninherit(vgl.source, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class planeSource\n *\n * @class\n * @returns {vgl.planeSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.planeSource = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.planeSource)) {\n    return new vgl.planeSource();\n  }\n  vgl.source.call(this);\n\n  var m_origin = [ 0.0, 0.0, 0.0 ],\n      m_point1 = [ 1.0, 0.0, 0.0 ],\n      m_point2 = [ 0.0, 1.0, 0.0 ],\n      m_normal = [ 0.0, 0.0, 1.0 ],\n      m_xresolution = 1,\n      m_yresolution = 1,\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set origin of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setOrigin = function(x, y, z) {\n    m_origin[0] = x;\n    m_origin[1] = y;\n    m_origin[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set point that defines the first axis of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPoint1 = function(x, y, z) {\n    m_point1[0] = x;\n    m_point1[1] = y;\n    m_point1[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set point that defines the first axis of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPoint2 = function(x, y, z) {\n    m_point2[0] = x;\n    m_point2[1] = y;\n    m_point2[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a plane geometry given input parameters\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    m_geom = new vgl.geometryData();\n\n    var x = [], tc = [], v1 = [], v2 = [],\n        pts = [], i, j, k, ii, numPts, numPolys,\n        posIndex = 0, normIndex = 0, colorIndex = 0, texCoordIndex = 0,\n        positions = [], normals = [], colors = [],\n        texCoords = [], indices = [], tristrip = null,\n        sourcePositions = null, sourceColors = null, sourceTexCoords;\n\n    x.length = 3;\n    tc.length = 2;\n    v1.length = 3;\n    v2.length = 3;\n    pts.length = 3;\n\n    // Check input\n    for (i = 0; i < 3; i++) {\n      v1[i] = m_point1[i] - m_origin[i];\n      v2[i] = m_point2[i] - m_origin[i];\n    }\n\n    // TODO Compute center and normal\n    // Set things up; allocate memory\n    numPts = (m_xresolution + 1) * (m_yresolution + 1);\n    numPolys = m_xresolution * m_yresolution * 2;\n    positions.length = 3 * numPts;\n    normals.length = 3 * numPts;\n    texCoords.length = 2 * numPts;\n    indices.length = numPts;\n\n    for (k = 0, i = 0; i < (m_yresolution + 1); i++) {\n      tc[1] = i / m_yresolution;\n\n      for (j = 0; j < (m_xresolution + 1); j++) {\n        tc[0] = j / m_xresolution;\n\n        for (ii = 0; ii < 3; ii++) {\n          x[ii] = m_origin[ii] + tc[0] * v1[ii] + tc[1] * v2[ii];\n        }\n\n        positions[posIndex++] = x[0];\n        positions[posIndex++] = x[1];\n        positions[posIndex++] = x[2];\n\n        colors[colorIndex++] = 1.0;\n        colors[colorIndex++] = 1.0;\n        colors[colorIndex++] = 1.0;\n\n        normals[normIndex++] = m_normal[0];\n        normals[normIndex++] = m_normal[1];\n        normals[normIndex++] = m_normal[2];\n\n        texCoords[texCoordIndex++] = tc[0];\n        texCoords[texCoordIndex++] = tc[1];\n      }\n    }\n\n    /// Generate polygon connectivity\n    for (i = 0; i < m_yresolution; i++) {\n      for (j = 0; j < m_xresolution; j++) {\n        pts[0] = j + i * (m_xresolution + 1);\n        pts[1] = pts[0] + 1;\n        pts[2] = pts[0] + m_xresolution + 2;\n        pts[3] = pts[0] + m_xresolution + 1;\n      }\n    }\n\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    tristrip = new vgl.triangleStrip();\n    tristrip.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(positions);\n\n    sourceColors = vgl.sourceDataC3fv();\n    sourceColors.pushBack(colors);\n\n    sourceTexCoords = vgl.sourceDataT2fv();\n    sourceTexCoords.pushBack(texCoords);\n\n    m_geom.addSource(sourcePositions);\n    m_geom.addSource(sourceColors);\n    m_geom.addSource(sourceTexCoords);\n    m_geom.addPrimitive(tristrip);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.planeSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pointSource\n *\n * @class\n * @returns {vgl.pointSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.pointSource = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.pointSource)) {\n    return new vgl.pointSource();\n  }\n  vgl.source.call(this);\n\n  var m_this = this,\n      m_positions = [],\n      m_colors = [],\n      m_textureCoords = [],\n      m_size = [],\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get positions for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPositions = function(positions) {\n    return m_positions;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set positions for the source\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPositions = function(positions) {\n    if (positions instanceof Array) {\n      m_positions = positions;\n    }\n    else {\n      console\n          .log(\"[ERROR] Invalid data type for positions. Array is required.\");\n    }\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get colors for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getColors = function(positions) {\n    return m_colors;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the points\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColors = function(colors) {\n    if (colors instanceof Array) {\n      m_colors = colors;\n    }\n    else {\n      console.log(\"[ERROR] Invalid data type for colors. Array is required.\");\n    }\n\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get colors for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getSize = function(positions) {\n    return m_size;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the points\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setSize = function(size) {\n    m_size = size;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set texture coordinates for the points\n   *\n   * @param texcoords\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setTextureCoordinates = function(texcoords) {\n    if (texcoords instanceof Array) {\n      m_textureCoords = texcoords;\n    }\n    else {\n      console.log(\"[ERROR] Invalid data type for \"\n                  + \"texture coordinates. Array is required.\");\n    }\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a point geometry given input parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    m_geom = new vgl.geometryData();\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[ERROR] Invalid length of the points array\");\n      return;\n    }\n\n    var numPts = m_positions.length / 3,\n        i = 0,\n        indices = [],\n        pointsPrimitive,\n        sourcePositions,\n        sourceColors,\n        sourceTexCoords,\n        sourceSize;\n\n    indices.length = numPts;\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    /// Generate array of size if needed\n    sourceSize = vgl.sourceDataDf();\n    if (numPts !== m_size.length) {\n      for (i = 0; i < numPts; ++i) {\n       sourceSize.pushBack(m_size);\n      }\n    } else {\n      sourceSize.setData(m_size);\n    }\n    m_geom.addSource(sourceSize);\n\n    pointsPrimitive = new vgl.points();\n    pointsPrimitive.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(m_positions);\n    m_geom.addSource(sourcePositions);\n\n    if ((m_colors.length > 0) && m_colors.length === m_positions.length) {\n      sourceColors = vgl.sourceDataC3fv();\n      sourceColors.pushBack(m_colors);\n      m_geom.addSource(sourceColors);\n    }\n    else if ((m_colors.length > 0) && m_colors.length !== m_positions.length) {\n      console\n          .log(\"[ERROR] Number of colors are different than number of points\");\n    }\n\n    if ((m_textureCoords.length > 0)\n        && m_textureCoords.length === m_positions.length) {\n      sourceTexCoords = vgl.sourceDataT2fv();\n      sourceTexCoords.pushBack(m_textureCoords);\n      m_geom.addSource(sourceTexCoords);\n    }\n    else if ((m_textureCoords.length > 0)\n             && (m_textureCoords.length / 2) !== (m_positions.length / 3)) {\n      console\n          .log(\"[ERROR] Number of texture coordinates are different than number of points\");\n    }\n\n\n    m_geom.addPrimitive(pointsPrimitive);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.pointSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineSource\n *\n * @class\n * @returns {vgl.lineSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lineSource = function(positions, colors) {\n  'use strict';\n\n  if (!(this instanceof vgl.lineSource)) {\n    return new vgl.lineSource();\n  }\n  vgl.source.call(this);\n\n  var m_positions = positions,\n      m_colors = colors,\n      m_height = null,\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set start positions for the lines\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPositions = function(positions) {\n    if (positions instanceof Array) {\n      m_positions = positions;\n      this.modified();\n      return true;\n    }\n\n    console\n      .log(\"[ERROR] Invalid data type for positions. Array is required.\");\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the lines\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColors = function(colors) {\n    if (colors instanceof Array) {\n      m_colors = colors;\n      this.modified();\n      return true;\n    }\n\n    console.log(\"[ERROR] Invalid data type for colors. Array is required.\");\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a point geometry given input parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    if (!m_positions) {\n      console.log(\"[error] Invalid positions\");\n      return;\n    }\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[error] Line source requires 3d points\");\n      return;\n    }\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[ERROR] Invalid length of the points array\");\n      return;\n    }\n\n    var m_geom = new vgl.geometryData(),\n        numPts = m_positions.length / 3,\n        i,\n        indices = [],\n        linesPrimitive,\n        sourcePositions,\n        sourceColors;\n\n    indices.length = numPts;\n\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    linesPrimitive = new vgl.lines();\n    linesPrimitive.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(m_positions);\n    m_geom.addSource(sourcePositions);\n\n    if ( m_colors && (m_colors.length > 0) &&\n         m_colors.length === m_positions.length) {\n      sourceColors = vgl.sourceDataC3fv();\n      sourceColors.pushBack(m_colors);\n      m_geom.addSource(sourceColors);\n    }\n    else if (m_colors && (m_colors.length > 0) &&\n             m_colors.length !== m_positions.length) {\n      console\n        .log(\"[error] Number of colors are different than number of points\");\n    }\n\n    m_geom.addPrimitive(linesPrimitive);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.lineSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global document, vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class utils\n *\n * Utility class provides helper functions such as functions to create\n * shaders, geometry etc.\n *\n * @returns {vgl.utils}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.utils)) {\n    return new vgl.utils();\n  }\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(vgl.utils, vgl.object);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Helper function to compute power of 2 number\n *\n * @param value\n * @param pow\n *\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.computePowerOfTwo = function(value, pow) {\n  'use strict';\n  pow = pow || 1;\n  while (pow < value) {\n    pow *= 2;\n  }\n  return pow;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader that uses a texture\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 textureCoord;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iTextureCoord = textureCoord;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default fragment shader that uses a texture\n *\n * Helper function to create default fragment shader with sampler\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying highp vec3 iTextureCoord;',\n        'uniform sampler2D sampler2d;',\n        'uniform mediump float opacity;',\n        'void main(void) {',\n        'gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyz, opacity);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create variation of createTextureFragmentShader which uses texture alpha\n *\n * Helper function to create default fragment shader with sampler\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createRgbaTextureFragmentShader = function (context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying highp vec3 iTextureCoord;',\n        'uniform sampler2D sampler2d;',\n        'uniform mediump float opacity;',\n        'void main(void) {',\n        '  mediump vec4 color = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyzw);',\n        '  color.w *= opacity;',\n        '  gl_FragColor = color;',\n        '}'\n      ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'attribute float vertexSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize =  vertexSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader with a solid color\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShaderSolidColor = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        '}' ].join('\\n'),\n    shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader that passes values through\n * for color mapping\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShaderColorMap = function(context, min, max) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute float vertexScalar;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'uniform float lutMin;',\n        'uniform float lutMax;',\n        'varying mediump float iVertexScalar;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        'iVertexScalar = (vertexScalar-lutMin)/(lutMax-lutMin);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default fragment shader\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [ 'varying mediump vec3 iVertexColor;',\n                              'uniform mediump float opacity;',\n                              'void main(void) {',\n                              'gl_FragColor = vec4(iVertexColor, opacity);',\n                              '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a Phong vertex shader\n *\n * Helper function to create Phong vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongVertexShader = function(context) {\n  'use strict';\n\n  var vertexShaderSource = [\n      'attribute highp vec3 vertexPosition;',\n      'attribute mediump vec3 vertexNormal;',\n      'attribute mediump vec3 vertexColor;',\n\n      'uniform highp mat4 projectionMatrix;',\n      'uniform mat4 modelViewMatrix;',\n      'uniform mat4 normalMatrix;',\n\n      'varying highp vec4 varPosition;',\n      'varying mediump vec3 varNormal;',\n      'varying mediump vec3 iVertexColor;',\n\n      'void main(void)',\n      '{',\n      'varPosition = modelViewMatrix * vec4(vertexPosition, 1.0);',\n      'gl_Position = projectionMatrix * varPosition;',\n      'varNormal = vec3(normalMatrix * vec4(vertexNormal, 0.0));',\n      'iVertexColor = vertexColor;',\n      '}' ].join('\\n'),\n\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of Phong fragment shader\n *\n * Helper function to create Phong fragment shader\n *\n * NOTE: Shader assumes directional light\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n    'precision mediump float;',\n    'varying vec3 varNormal;',\n    'varying vec4 varPosition;',\n    'varying mediump vec3 iVertexColor;',\n    'const vec3 lightPos = vec3(0.0, 0.0,10000.0);',\n    'const vec3 ambientColor = vec3(0.01, 0.01, 0.01);',\n    'const vec3 specColor = vec3(1.0, 1.0, 1.0);',\n\n    'void main() {',\n    'vec3 normal = normalize(varNormal);',\n    'vec3 lightDir = normalize(lightPos);',\n    'vec3 reflectDir = -reflect(lightDir, normal);',\n    'vec3 viewDir = normalize(-varPosition.xyz);',\n\n    'float lambertian = max(dot(lightDir,normal), 0.0);',\n    'float specular = 0.0;',\n\n    'if(lambertian > 0.0) {',\n    'float specAngle = max(dot(reflectDir, viewDir), 0.0);',\n    'specular = pow(specAngle, 64.0);',\n    '}',\n    'gl_FragColor = vec4(ambientColor +',\n    'lambertian*iVertexColor +',\n    'specular*specColor, 1.0);',\n    '}' ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader with an assigned constant color.\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShaderSolidColor = function(context, color) {\n  'use strict';\n  var fragmentShaderSource = ['uniform mediump float opacity;',\n                              'void main(void) {',\n                              'gl_FragColor = vec4(' + color[0] + ',' + color[1] + ',' + color[2] + ', opacity);',\n                              '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader that maps values into colors bia lookup table\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShaderColorMap = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying mediump float iVertexScalar;',\n        'uniform sampler2D sampler2d;',\n        'uniform mediump float opacity;',\n        'void main(void) {',\n        'gl_FragColor = vec4(texture2D(sampler2d, vec2(iVertexScalar, 0.0)).xyz, opacity);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader for point sprites\n *\n * Helper function to create default point sprites vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'uniform mediump vec2 pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'uniform float height;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp float iVertexScalar;',\n        'void main(void)',\n        '{',\n        'mediump float realPointSize = pointSize.y;',\n        'if (pointSize.x > pointSize.y) {',\n        '  realPointSize = pointSize.x;}',\n        'gl_PointSize = realPointSize ;',\n        'iVertexScalar = vertexPosition.z;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition.xy, height, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader for point sprites\n *\n * Helper function to create default point sprites fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying mediump vec3 iVertexColor;',\n        'varying highp float iVertexScalar;',\n        'uniform sampler2D opacityLookup;',\n        'uniform highp float lutMin;',\n        'uniform highp float lutMax;',\n        'uniform sampler2D scalarsToColors;',\n        'uniform int useScalarsToColors;',\n        'uniform int useVertexColors;',\n        'uniform mediump vec2 pointSize;',\n        'uniform mediump float vertexColorWeight;',\n        'void main(void) {',\n        'mediump vec2 realTexCoord;',\n        'if (pointSize.x > pointSize.y) {',\n        '  realTexCoord = vec2(1.0, pointSize.y/pointSize.x) * gl_PointCoord;',\n        '} else {',\n        '  realTexCoord = vec2(pointSize.x/pointSize.y, 1.0) * gl_PointCoord;',\n        '}',\n        'highp float texOpacity = texture2D(opacityLookup, realTexCoord).w;',\n        'if (useScalarsToColors == 1) {',\n        '  gl_FragColor = vec4(texture2D(scalarsToColors, vec2((iVertexScalar - lutMin)/(lutMax - lutMin), 0.0)).xyz, texOpacity);',\n        '} else if (useVertexColors == 1) {',\n        '  gl_FragColor = vec4(iVertexColor, texOpacity);',\n        '} else {',\n        '  gl_FragColor = vec4(texture2D(opacityLookup, realTexCoord).xyz, texOpacity);',\n        '}}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of texture material\n *\n * Helper function to create a texture material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureMaterial = function(isRgba) {\n  'use strict';\n  var mat = new vgl.material(),\n    blend = new vgl.blend(),\n    prog = new vgl.shaderProgram(),\n    vertexShader = vgl.utils.createTextureVertexShader(gl),\n    fragmentShader = null,\n    posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n    texCoordVertAttr = new vgl.vertexAttribute(\"textureCoord\"),\n    pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n    modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n    projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n    samplerUniform = new vgl.uniform(gl.INT, \"sampler2d\"),\n    opacityUniform = null;\n\n  samplerUniform.set(0);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(texCoordVertAttr,\n                          vgl.vertexAttributeKeys.TextureCoordinate);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n\n  if (isRgba) {\n    fragmentShader = vgl.utils.createRgbaTextureFragmentShader(gl);\n  } else {\n    fragmentShader = vgl.utils.createTextureFragmentShader(gl);\n  }\n  opacityUniform = new vgl.floatUniform('opacity', 1.0);\n  prog.addUniform(opacityUniform);\n\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createGeometryMaterial = function() {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       pointSize = 5.0,\n       opacity = 0.5,\n       vertexShader = vgl.utils.createVertexShader(gl),\n       fragmentShader = vgl.utils.createFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       pointsizeUniform = new vgl.floatUniform(\"pointSize\", pointSize),\n       opacityUniform = new vgl.floatUniform(\"opacity\", opacity),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointGeometryMaterial = function(opacity) {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       opacity = opacity === undefined ? 1.0 : opacity,\n       vertexShader = vgl.utils.createPointVertexShader(gl),\n       fragmentShader = vgl.utils.createFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       sizeVertAttr = new vgl.vertexAttribute(\"vertexSize\"),\n       opacityUniform = new vgl.floatUniform(\"opacity\", opacity),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addVertexAttribute(sizeVertAttr, vgl.vertexAttributeKeys.Scalar);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material with the phong shader\n *\n * Helper function to create color phong shaded geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongMaterial = function() {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       vertexShader = vgl.utils.createPhongVertexShader(gl),\n       fragmentShader = vgl.utils.createPhongFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       normalVertAttr = new vgl.vertexAttribute(\"vertexNormal\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       opacityUniform = new vgl.floatUniform(\"opacity\", 1.0),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       normalUniform = new vgl.normalMatrixUniform(\"normalMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(normalVertAttr, vgl.vertexAttributeKeys.Normal);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addUniform(normalUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of colored geometry material\n *\n * Helper function to create color geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorMaterial = function() {\n  'use strict';\n  var mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShader(gl),\n      fragmentShader = vgl.utils.createFragmentShader(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      texCoordVertAttr = new vgl.vertexAttribute(\"textureCoord\"),\n      colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 0.5),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addVertexAttribute(texCoordVertAttr,\n                          vgl.vertexAttributeKeys.TextureCoordinate);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorMappedMaterial = function(lut) {\n  'use strict';\n  if (!lut) {\n    lut = new vgl.lookupTable();\n  }\n\n  var scalarRange = lut.range(),\n      mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShaderColorMap(\n        gl,scalarRange[0],scalarRange[1]),\n      fragmentShader = vgl.utils.createFragmentShaderColorMap(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      scalarVertAttr = new vgl.vertexAttribute(\"vertexScalar\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 0.5),\n      lutMinUniform = new vgl.floatUniform(\"lutMin\", scalarRange[0]),\n      lutMaxUniform = new vgl.floatUniform(\"lutMax\", scalarRange[1]),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n      samplerUniform = new vgl.uniform(gl.FLOAT, \"sampler2d\"),\n      lookupTable = lut;\n\n  samplerUniform.set(0);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(scalarVertAttr, vgl.vertexAttributeKeys.Scalar);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(lutMinUniform);\n  prog.addUniform(lutMaxUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n  mat.addAttribute(lookupTable);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Update color mapped material\n *\n * @param mat\n * @param scalarRange\n * @param lut\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.updateColorMappedMaterial = function(mat, lut) {\n  'use strict';\n  if (!mat) {\n    console.log('[warning] Invalid material. Nothing to update.');\n    return;\n  }\n\n  if (!lut) {\n    console.log('[warning] Invalid lookup table. Nothing to update.');\n    return;\n  }\n\n\n  var lutMin = mat.shaderProgram().uniform('lutMin'),\n      lutMax = mat.shaderProgram().uniform('lutMax');\n\n  lutMin.set(lut.range()[0]);\n  lutMax.set(lut.range()[1]);\n\n  // This will replace the existing lookup table\n  mat.setAttribute(lut);\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of solid color material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createSolidColorMaterial = function(color) {\n  'use strict';\n  if (!color) {\n    color = [1.0,1.0,1.0];\n  }\n\n  var mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShaderSolidColor(gl),\n      fragmentShader = vgl.utils.createFragmentShaderSolidColor(gl, color),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 1.0),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of point sprites material\n *\n * Helper function to create point sprites material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesMaterial = function(image, lut) {\n  'use strict';\n  var scalarRange = lut === undefined ? [0, 1] : lut.range(),\n      mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createPointSpritesVertexShader(gl),\n      fragmentShader = vgl.utils.createPointSpritesFragmentShader(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n      heightUniform = new vgl.floatUniform(\"height\", 0.0),\n      vertexColorWeightUniform =\n        new vgl.floatUniform(\"vertexColorWeight\", 0.0),\n      lutMinUniform = new vgl.floatUniform(\"lutMin\", scalarRange[0]),\n      lutMaxUniform = new vgl.floatUniform(\"lutMax\", scalarRange[1]),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n      samplerUniform = new vgl.uniform(gl.INT, \"opacityLookup\"),\n      scalarsToColors = new vgl.uniform(gl.INT, \"scalarsToColors\"),\n      useScalarsToColors = new vgl.uniform(gl.INT, \"useScalarsToColors\"),\n      useVertexColors = new vgl.uniform(gl.INT, \"useVertexColors\"),\n      pointSize = new vgl.uniform(gl.FLOAT_VEC2, \"pointSize\"),\n      texture = new vgl.texture();\n\n  samplerUniform.set(0);\n  scalarsToColors.set(1);\n  useScalarsToColors.set(0);\n  useVertexColors.set(0);\n  pointSize.set([1.0, 1.0]);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(heightUniform);\n  prog.addUniform(vertexColorWeightUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addUniform(samplerUniform);\n  prog.addUniform(useVertexColors);\n  prog.addUniform(useScalarsToColors);\n  prog.addUniform(pointSize);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  if (lut) {\n    prog.addUniform(scalarsToColors);\n    useScalarsToColors.set(1);\n    prog.addUniform(lutMinUniform);\n    prog.addUniform(lutMaxUniform);\n    lut.setTextureUnit(1);\n    mat.addAttribute(lut);\n  }\n\n  texture.setImage(image);\n  texture.setTextureUnit(0);\n  mat.addAttribute(texture);\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains a plane geometry\n *\n * Function to create a plane node This method will create a plane actor\n * with texture coordinates, eventually normal, and plane material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPlane = function(originX, originY, originZ,\n                                       point1X, point1Y, point1Z,\n                                       point2X, point2Y, point2Z) {\n  'use strict';\n  var mapper = new vgl.mapper(),\n      planeSource = new vgl.planeSource(),\n      mat = vgl.utils.createGeometryMaterial(),\n      actor = new vgl.actor();\n\n  planeSource.setOrigin(originX, originY, originZ);\n  planeSource.setPoint1(point1X, point1Y, point1Z);\n  planeSource.setPoint2(point2X, point2Y, point2Z);\n\n  mapper.setGeometryData(planeSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains a texture plane geometry\n *\n * Helper function to create a plane textured node This method will create\n * a plane actor with texture coordinates, eventually normal, and plane\n * material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTexturePlane = function(originX, originY, originZ,\n                                              point1X, point1Y, point1Z,\n                                              point2X, point2Y, point2Z,\n                                              isRgba) {\n  'use strict';\n  var mapper = new vgl.mapper(),\n      planeSource = new vgl.planeSource(),\n      mat = vgl.utils.createTextureMaterial(isRgba),\n      actor = new vgl.actor();\n\n  planeSource.setOrigin(originX, originY, originZ);\n  planeSource.setPoint1(point1X, point1Y, point1Z);\n  planeSource.setPoint2(point2X, point2Y, point2Z);\n  mapper.setGeometryData(planeSource.create());\n\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains points\n *\n * Helper function to create a point node This method will create a point\n * actor with texture coordinates, eventually normal, and plane material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPoints = function(positions, size, colors, texcoords, opacity) {\n  'use strict';\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var opacity = opacity === undefined ? 1.0 : opacity,\n      mapper = new vgl.mapper(),\n      pointSource = new vgl.pointSource(),\n      mat = vgl.utils.createPointGeometryMaterial(opacity),\n      actor = new vgl.actor();\n\n  pointSource.setPositions(positions);\n  if (colors) {\n    pointSource.setColors(colors);\n  }\n\n  if (texcoords) {\n    pointSource.setTextureCoordinates(texcoords);\n  }\n\n  if (size) {\n    pointSource.setSize(size)\n  } else {\n    pointSource.setSize(1.0);\n  }\n\n  mapper.setGeometryData(pointSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains point sprites\n *\n * Helper function to create a point sprites node This method will create\n * a point sprites actor with texture coordinates, normals, and a point sprites\n * material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSprites = function(image, positions, colors,\n                                              texcoords) {\n  'use strict';\n  if (!image) {\n    console.log(\"[ERROR] Point sprites requires an image\");\n    return null;\n  }\n\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var mapper = new vgl.mapper(),\n      pointSource = new vgl.pointSource(),\n      mat = vgl.utils.createPointSpritesMaterial(image),\n      actor = new vgl.actor();\n\n  pointSource.setPositions(positions);\n  if (colors) {\n    pointSource.setColors(colors);\n  }\n\n  if (texcoords) {\n    pointSource.setTextureCoordinates(texcoords);\n  }\n\n  mapper.setGeometryData(pointSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create lines given positions, colors, and desired length\n *\n * @param positions\n * @param colors\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createLines = function(positions, colors) {\n  'use strict';\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var mapper = new vgl.mapper(),\n      lineSource = new vgl.lineSource(),\n      mat = vgl.utils.createGeometryMaterial(),\n      actor = new vgl.actor();\n\n  lineSource.setPositions(positions);\n  if (colors) {\n    lineSource.setColors(colors);\n  }\n\n  mapper.setGeometryData(lineSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create color legend\n *\n * @param lookupTable\n * @param width\n * @param height\n * @param origin\n * @param divs\n * @returns {Array}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorLegend = function(varname, lookupTable, origin,\n                                             width, height, countMajor,\n                                             countMinor) {\n  'use strict';\n\n  if (!lookupTable) {\n    console.log('[error] Invalid lookup table');\n    return [];\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create labels for the legend\n   *\n   * @param ticks\n   * @param range\n   * @param divs\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  function createLabels(varname, positions, range) {\n    if (!positions) {\n      console.log('[error] Create labels requires positions (x,y,z) array');\n      return;\n    }\n\n    if (positions.length % 3 !== 0) {\n      console.log('[error] Create labels require positions array contain 3d points');\n      return;\n    }\n\n    if (!range) {\n      console.log('[error] Create labels requires Valid range');\n      return;\n    }\n\n    var actor = null,\n        size = vgl.utils.computePowerOfTwo(48),\n        index = 0,\n        actors = [],\n        origin = [],\n        pt1 = [],\n        pt2 = [],\n        delta = (positions[6] - positions[0]),\n        axisLabelOffset = 4, i;\n\n    origin.length = 3;\n    pt1.length = 3;\n    pt2.length = 3;\n\n    // For now just create labels for end points\n    for (i = 0; i < 2; ++i) {\n      index = i * (positions.length - 3);\n\n      origin[0] = positions[index] - delta;\n      origin[1] = positions[index + 1] - 2 * delta;\n      origin[2] = positions[index + 2];\n\n      pt1[0] = positions[index] + delta;\n      pt1[1] = origin[1];\n      pt1[2] = origin[2];\n\n      pt2[0] = origin[0];\n      pt2[1] = positions[1];\n      pt2[2] = origin[2];\n\n      actor = vgl.utils.createTexturePlane(\n        origin[0], origin[1], origin[2],\n        pt1[0], pt1[1], pt1[2],\n        pt2[0], pt2[1], pt2[2], true);\n\n      actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n      actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n      actor.material().addAttribute(vgl.utils.create2DTexture(\n        range[i].toFixed(2).toString(), 12, null));\n      actors.push(actor);\n    }\n\n    // Create axis label\n    origin[0] = (positions[0] + positions[positions.length - 3]  - size) * 0.5;\n    origin[1] = positions[1] + axisLabelOffset;\n    origin[2] = positions[2];\n\n    pt1[0] = origin[0] + size;\n    pt1[1] = origin[1];\n    pt1[2] = origin[2];\n\n    pt2[0] = origin[0];\n    pt2[1] = origin[1] + size;\n    pt2[2] = origin[2];\n\n    actor = vgl.utils.createTexturePlane(\n      origin[0], origin[1], origin[2],\n      pt1[0], pt1[1], pt1[2],\n      pt2[0], pt2[1], pt2[2], true);\n    actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n    actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n    actor.material().addAttribute(vgl.utils.create2DTexture(\n      varname, 24, null));\n    actors.push(actor);\n\n    return actors;\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // TODO Currently we assume that the ticks are laid on x-axis\n  // and this is on a 2D plane (ignoring Z axis. For now lets\n  // not draw minor ticks.\n  /**\n   * Create ticks and labels\n   *\n   * @param originX\n   * @param originY\n   * @param originZ\n   * @param pt1X\n   * @param pt1Y\n   * @param pt1Z\n   * @param pt2X\n   * @param pt2Y\n   * @param pt2Z\n   * @param divs\n   * @param heightMajor\n   * @param heightMinor\n   * @returns {Array} Returns array of vgl.actor\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  function createTicksAndLabels(varname, lut,\n                        originX, originY, originZ,\n                        pt1X, pt1Y, pt1Z,\n                        pt2X, pt2Y, pt2Z,\n                        countMajor, countMinor,\n                        heightMajor, heightMinor) {\n    var width = pt2X - pt1X,\n        index = null,\n        delta = width / countMajor,\n        positions = [],\n        actor = null,\n        actors = [];\n\n    for (index = 0; index <= countMajor; ++index) {\n      positions.push(pt1X + delta * index);\n      positions.push(pt1Y);\n      positions.push(pt1Z);\n\n      positions.push(pt1X + delta * index);\n      positions.push(pt1Y + heightMajor);\n      positions.push(pt1Z);\n    }\n\n    // TODO: Fix this\n    //actor = vgl.utils.createLines(positions, null);\n    //actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n    //actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n    //actors.push(actor);\n\n    actors = actors.concat(createLabels(varname, positions, lut.range()));\n    return actors;\n  }\n\n  // TODO Currently we create only one type of legend\n  var pt1X = origin[0] + width,\n      pt1Y = origin[1],\n      pt1Z = 0.0,\n      pt2X = origin[0],\n      pt2Y = origin[1] + height,\n      pt2Z = 0.0,\n      actors = [],\n      actor = null,\n      mapper = null,\n      mat = null,\n      group = vgl.groupNode();\n\n  actor = vgl.utils.createTexturePlane(\n    origin[0], origin[1], origin[2],\n    pt1X, pt1Y, pt1Z,\n    pt2X, pt2Y, pt2Z, true\n  );\n\n  mat = actor.material();\n  mat.addAttribute(lookupTable);\n  actor.setMaterial(mat);\n  group.addChild(actor);\n  actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n  actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n  actors.push(actor);\n  actors = actors.concat(createTicksAndLabels(\n                          varname,\n                          lookupTable,\n                          origin[0], origin[1], origin[1],\n                          pt2X, pt1Y, pt1Z,\n                          pt1X, pt1Y, pt1Z,\n                          countMajor, countMinor, 5, 3));\n\n  // TODO This needs to change so that we can return a group node\n  // which should get appended to the scene graph\n  return actors;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create 2D texture by rendering text using canvas2D context\n *\n * @param textToWrite\n * @param textSize\n * @param color\n * @returns {vgl.texture}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.create2DTexture = function(textToWrite, textSize,\n  color, font, alignment, baseline, bold) {\n  'use strict';\n\n  var canvas = document.getElementById('textRendering'),\n      ctx = null,\n      texture = vgl.texture();\n\n  font = font || 'sans-serif';\n  alignment = alignment || 'center';\n  baseline = baseline || 'bottom';\n\n  if (typeof bold === 'undefined') {\n    bold = true;\n  }\n\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n  }\n  ctx = canvas.getContext('2d');\n\n  canvas.setAttribute('id', 'textRendering');\n  canvas.style.display = 'none';\n\n  // Make width and height equal so that we get pretty looking text.\n  canvas.height = vgl.utils.computePowerOfTwo(8 * textSize);\n  canvas.width = canvas.height;\n\n  ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n  // This determines the text colour, it can take a hex value or rgba value (e.g. rgba(255,0,0,0.5))\n  ctx.fillStyle = 'rgba(200, 85, 10, 1.0)';\n\n  // This determines the alignment of text, e.g. left, center, right\n  ctx.textAlign = alignment;\n\n  // This determines the baseline of the text, e.g. top, middle, bottom\n  ctx.textBaseline = baseline;\n\n  // This determines the size of the text and the font family used\n  ctx.font = 4 * textSize + \"px \" + font;\n  if (bold) {\n    ctx.font = \"bold \" + ctx.font;\n  }\n\n  ctx.fillText(textToWrite, canvas.width/2, canvas.height/2, canvas.width);\n\n  texture.setImage(canvas);\n  texture.updateDimensions();\n\n  return texture;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class picker\n *\n * @class vgl.picker\n * @returns {vgl.picker}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.picker = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.picker)) {\n    return new vgl.picker();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_that = this,\n      m_tolerance = 0.025,\n      m_actors = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get actors intersected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getActors = function() {\n    return m_actors;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Perform pick operation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pick = function(selectionX, selectionY, renderer) {\n    // Check if variables are acceptable\n    if (typeof(selectionX) === \"undefined\"){\n      return 0;\n    }\n    if (typeof(selectionY) === \"undefined\"){\n      return 0;\n    }\n    if (typeof(renderer) === \"undefined\"){\n      return 0;\n    }\n\n    // Clean list of actors intersected previously\n    m_actors = [];\n\n    //\n    var camera = renderer.camera(),\n        width = renderer.width(),\n        height = renderer.height(),\n        fpoint = camera.focalPoint(),\n        focusWorldPt = vec4.fromValues(fpoint[0], fpoint[1], fpoint[2], 1.0),\n        focusDisplayPt = renderer.worldToDisplay(\n          focusWorldPt, camera.viewMatrix(),\n        camera.projectionMatrix(), width, height),\n        displayPt = vec4.fromValues(selectionX,\n                      selectionY, focusDisplayPt[2], 1.0),\n        // Convert selection point into world coordinates\n        worldPt = renderer.displayToWorld(displayPt, camera.viewMatrix(),\n                    camera.projectionMatrix(), width, height),\n        cameraPos = camera.position(), ray = [], actors, count, i, bb,\n        tmin, tmax, tymin, tymax, tzmin, tzmax, actor;\n\n    for (i = 0; i < 3; ++i){\n      ray[i] = worldPt[i] - cameraPos[i];\n    }\n\n    // Go through all actors and check if intersects\n    actors = renderer.sceneRoot().children();\n    count = 0;\n\n    for (i = 0; i < actors.length; ++i) {\n      actor = actors[i];\n      if (actor.visible() === true) {\n        bb = actor.bounds();\n        // Ray-aabb intersection - Smits' method\n        if (ray[0] >= 0){\n          tmin = (bb[0] - cameraPos[0])/ray[0];\n          tmax = (bb[1] - cameraPos[0])/ray[0];\n        } else {\n          tmin = (bb[1] - cameraPos[0])/ray[0];\n          tmax = (bb[0] - cameraPos[0])/ray[0];\n        }\n        if (ray[1] >= 0){\n          tymin = (bb[2] - cameraPos[1])/ray[1];\n          tymax = (bb[3] - cameraPos[1])/ray[1];\n        } else {\n          tymin = (bb[3] - cameraPos[1])/ray[1];\n          tymax = (bb[2] - cameraPos[1])/ray[1];\n        }\n        if ((tmin > tymax) || (tymin > tmax)) {\n          continue;\n        }\n\n\n        if (tymin > tmin) {\n          tmin = tymin;\n        }\n        if (tymax < tmax) {\n          tmax = tymax;\n        }\n        if (ray[2] >= 0) {\n          tzmin = (bb[4] - cameraPos[2])/ray[2];\n          tzmax = (bb[5] - cameraPos[2])/ray[2];\n        } else {\n          tzmin = (bb[5] - cameraPos[2])/ray[2];\n          tzmax = (bb[4] - cameraPos[2])/ray[2];\n        }\n        if ((tmin > tzmax) || (tzmin > tmax)) {\n          continue;\n        }\n        if (tzmin > tmin) {\n          tmin = tzmin;\n        }\n        if (tzmax < tmax) {\n          tmax = tzmax;\n        }\n\n        m_actors[count++] = actor;\n      }\n    }\n    return count;\n  };\n\n  return this;\n};\n\ninherit(vgl.picker, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $, Uint16Array*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of shapefile reader\n *\n * This contains code that reads a shapefile and produces vgl geometries\n *\n * @class\n * @returns {vgl.shapefileReader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shapefileReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.shapefileReader)) {\n    return new vgl.shapefileReader();\n  }\n\n  var m_that = this;\n  var SHP_HEADER_LEN = 8;\n  var SHP_NULL = 0;\n  var SHP_POINT = 1;\n  var SHP_POLYGON = 5;\n  var SHP_POLYLINE = 3;\n\n  this.int8 = function (data, offset) {\n      return data.charCodeAt (offset);\n  };\n\n  this.bint32 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset) & 0xff) << 24) +\n        ((data.charCodeAt (offset + 1) & 0xff) << 16) +\n        ((data.charCodeAt (offset + 2) & 0xff) << 8) +\n        (data.charCodeAt (offset + 3) & 0xff)\n    );\n  };\n\n  this.lint32 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset + 3) & 0xff) << 24) +\n        ((data.charCodeAt (offset + 2) & 0xff) << 16) +\n        ((data.charCodeAt (offset + 1) & 0xff) << 8) +\n        (data.charCodeAt (offset) & 0xff)\n    );\n  };\n\n  this.bint16 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset) & 0xff) << 8) +\n        (data.charCodeAt (offset + 1) & 0xff)\n    );\n  };\n\n  this.lint16 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset + 1) & 0xff) << 8) +\n        (data.charCodeAt (offset) & 0xff)\n    );\n  };\n\n  this.ldbl64 = function (data, offset) {\n    var b0 = data.charCodeAt (offset) & 0xff;\n    var b1 = data.charCodeAt (offset + 1) & 0xff;\n    var b2 = data.charCodeAt (offset + 2) & 0xff;\n    var b3 = data.charCodeAt (offset + 3) & 0xff;\n    var b4 = data.charCodeAt (offset + 4) & 0xff;\n    var b5 = data.charCodeAt (offset + 5) & 0xff;\n    var b6 = data.charCodeAt (offset + 6) & 0xff;\n    var b7 = data.charCodeAt (offset + 7) & 0xff;\n\n    var sign = 1 - 2 * (b7 >> 7);\n    var exp = (((b7 & 0x7f) << 4) + ((b6 & 0xf0) >> 4)) - 1023;\n    //var frac = (b6 & 0x0f) * Math.pow (2, -4) + b5 * Math.pow (2, -12) + b4 *\n    // Math.pow (2, -20) + b3 * Math.pow (2, -28) + b2 * Math.pow (2, -36) + b1 *\n    // Math.pow (2, -44) + b0 * Math.pow (2, -52);\n\n    //return sign * (1 + frac) * Math.pow (2, exp);\n    var frac = (b6 & 0x0f) * Math.pow (2, 48) + b5 * Math.pow (2, 40) + b4 *\n                 Math.pow (2, 32) + b3 * Math.pow (2, 24) + b2 *\n                 Math.pow (2, 16) + b1 * Math.pow (2, 8) + b0;\n\n    return sign * (1 + frac * Math.pow (2, -52)) * Math.pow (2, exp);\n  };\n\n  this.lfloat32 = function (data, offset) {\n    var b0 = data.charCodeAt (offset) & 0xff;\n    var b1 = data.charCodeAt (offset + 1) & 0xff;\n    var b2 = data.charCodeAt (offset + 2) & 0xff;\n    var b3 = data.charCodeAt (offset + 3) & 0xff;\n\n    var sign = 1 - 2 * (b3 >> 7);\n    var exp = (((b3 & 0x7f) << 1) + ((b2 & 0xfe) >> 7)) - 127;\n    var frac = (b2 & 0x7f) * Math.pow (2, 16) + b1 * Math.pow (2, 8) + b0;\n\n    return sign * (1 + frac * Math.pow (2, -23)) * Math.pow (2, exp);\n  };\n\n  this.str = function (data, offset, length) {\n    var chars = [];\n    var index = offset;\n    while (index < offset + length) {\n      var c = data[index];\n      if (c.charCodeAt (0) !== 0)\n        chars.push (c);\n      else {\n        break;\n      }\n      index ++;\n    }\n    return chars.join ('');\n  };\n\n  this.readHeader = function (data) {\n    var code = this.bint32(data, 0);\n    var length = this.bint32(data, 24);\n    var version = this.lint32(data, 28);\n    var shapetype = this.lint32(data, 32);\n\n    var xmin = this.ldbl64(data, 36);\n    var ymin = this.ldbl64(data, 44);\n    var xmax = this.ldbl64(data, 52);\n    var ymax = this.ldbl64(data, 60);\n    return {\n      code: code,\n      length: length,\n      version: version,\n      shapetype: shapetype,\n      bounds: new Box (vect (xmin, ymin), vect (xmax, ymax))\n    };\n  };\n\n  this.loadShx = function (data) {\n    var indices = [];\n    var appendIndex = function (offset) {\n      indices.push (2 * m_that.bint32(data, offset));\n      return offset + 8;\n    };\n    var offset = 100;\n    while (offset < data.length) {\n      offset = appendIndex (offset);\n    }\n    return indices;\n  };\n\n  this.Shapefile = function (options) {\n    var path = options.path;\n    $.ajax ({\n      url: path + '.shx',\n      mimeType: 'text/plain; charset=x-user-defined',\n      success: function (data) {\n        var indices = this.loadShx(data);\n        $.ajax ({\n          url: path + '.shp',\n          mimeType: 'text/plain; charset=x-user-defined',\n          success: function (data) {\n            $.ajax ({\n              url: path + '.dbf',\n              mimeType: 'text/plain; charset=x-user-defined',\n              success: function (dbf_data) {\n                var layer = this.loadShp (data, dbf_data, indices, options);\n                options.success (layer);\n              }\n            });\n          }\n        });\n      }\n    });\n  };\n\n  this.localShapefile = function(options) {\n    var shxFile = options.shx;\n    var shpFile = options.shp;\n    var dbfFile = options.dbf;\n    var shxReader = new FileReader();\n    shxReader.onloadend = function() {\n      var indices = m_that.loadShx(shxReader.result);\n      var shpReader = new FileReader();\n\n      shpReader.onloadend = function() {\n        var shpData = shpReader.result;\n\n        var dbfReader = new FileReader();\n        dbfReader.onloadend = function() {\n          var dbfData = dbfReader.result;\n          var layer = m_that.loadShp(shpData, dbfData, indices, options);\n          options.success(layer);\n        };\n        dbfReader.readAsBinaryString(dbfFile);\n      };\n      shpReader.readAsBinaryString(shpFile);\n    };\n    shxReader.readAsBinaryString(shxFile);\n  };\n\n  this.loadDBF = function (data) {\n    var readHeader = function (offset) {\n      var name = m_that.str(data, offset, 10);\n      var type = m_that.str(data, offset + 11, 1);\n      var length = m_that.int8(data, offset + 16);\n      return {\n        name: name,\n        type: type,\n        length: length\n      };\n    };\n\n    // Level of the dBASE file\n    var level = m_that.int8(data, 0);\n    if (level == 4) {\n      throw \"Level 7 dBASE not supported\";\n    }\n\n    // Date of last update\n    var year = m_that.int8(data, 1);\n    var month = m_that.int8(data, 2);\n    var day = m_that.int8(data, 3);\n\n    var num_entries = m_that.lint32(data, 4);\n    var header_size = m_that.lint16(data, 8);\n    var record_size = m_that.lint16(data, 10);\n\n    var FIELDS_START = 32;\n    var HEADER_LENGTH = 32;\n\n    var header_offset = FIELDS_START;\n    var headers = [];\n    while (header_offset < header_size - 1) {\n      headers.push (readHeader(header_offset));\n      header_offset += HEADER_LENGTH;\n    }\n\n    var records = [];\n    var record_offset = header_size;\n    while (record_offset < header_size + num_entries * record_size) {\n      var declare = m_that.str(data, record_offset, 1);\n      if (declare == '*') {\n        // Record size in the header include the size of the delete indicator\n        record_offset += record_size;\n      }\n      else {\n        // Move offset to the start of the actual data\n        record_offset ++;\n        var record = {};\n        for (var i = 0; i < headers.length; i ++) {\n          var header = headers[i];\n          var value;\n          if (header.type == 'C') {\n              value = m_that.str(data, record_offset, header.length).trim ();\n          }\n          else if (header.type == 'N') {\n              value = parseFloat (m_that.str (data, record_offset, header.length));\n          }\n          record_offset += header.length;\n          record[header.name] = value;\n        }\n        records.push(record);\n      }\n    }\n    return records;\n  };\n\n  this.loadShp = function (data, dbf_data, indices, options) {\n    var features = [];\n    var readRing = function (offset, start, end) {\n      var ring = [];\n      for (var i = end - 1; i >= start; i --) {\n        var x = m_that.ldbl64(data, offset + 16 * i);\n        var y = m_that.ldbl64(data, offset + 16 * i + 8);\n        ring.push ([x, y]);\n      }\n      //if (ring.length <= 3)\n      // return [];\n      return ring;\n    };\n\n    var readRecord = function (offset) {\n      var index = m_that.bint32(data, offset);\n      var record_length = m_that.bint32(data, offset + 4);\n      var record_offset = offset + 8;\n      var geom_type = m_that.lint32(data, record_offset);\n\n      if (geom_type == SHP_NULL) {\n        console.log (\"NULL Shape\");\n        //return offset + 12;\n      }\n      else if (geom_type == SHP_POINT) {\n        var x = m_that.ldbl64(data, record_offset + 4);\n        var y = m_that.ldbl64(data, record_offset + 12);\n\n        features.push ({\n          type: 'Point',\n          attr: {},\n          geom: [[x, y]]\n        });\n      }\n      else if (geom_type == SHP_POLYGON) {\n        var num_parts = m_that.lint32(data, record_offset + 36);\n        var num_points = m_that.lint32(data, record_offset + 40);\n\n        var parts_start = offset + 52;\n        var points_start = offset + 52 + 4 * num_parts;\n\n        var rings = [];\n        for (var i = 0; i < num_parts; i ++) {\n          var start = m_that.lint32(data, parts_start + i * 4);\n          var end;\n          if (i + 1 < num_parts) {\n            end = m_that.lint32(data, parts_start + (i + 1) * 4);\n          }\n          else {\n            end = num_points;\n          }\n          var ring = readRing (points_start, start, end);\n          rings.push (ring);\n        }\n        features.push ({\n          type: 'Polygon',\n          attr: {},\n          geom: [rings]\n        });\n      }\n      else if (geom_type == SHP_POLYLINE) {\n        var num_parts = m_that.lint32(data, record_offset + 36);\n        var num_points = m_that.lint32(data, record_offset + 40);\n\n        var parts_start = offset + 52;\n        var points_start = offset + 52 + 4 * num_parts;\n\n        var rings = [];\n        for (var i = 0; i < num_parts; i ++) {\n          var start = m_that.lint32(data, parts_start + i * 4);\n          var end;\n          if (i + 1 < num_parts) {\n              end = m_that.lint32(data, parts_start + (i + 1) * 4);\n          }\n          else {\n              end = num_points;\n          }\n          var ring = readRing (points_start, start, end);\n          rings.push (ring);\n        }\n        features.push ({\n          type: 'Polyline',\n          attr: {},\n          geom: [rings]\n        });\n      }\n      else {\n        throw \"Not Implemented: \" + geom_type;\n      }\n      //return offset + 2 * record_length + SHP_HEADER_LEN;\n    };\n\n    var attr = this.loadDBF(dbf_data);\n\n    //var offset = 100;\n    //while (offset < length * 2) {\n    // offset = readRecord (offset);\n    //}\n    for (var i = 0; i < indices.length; i ++) {\n      var offset = indices[i];\n      readRecord (offset);\n    }\n\n    var layer = []; //new Layer ();\n\n    for (var i = 0; i < features.length; i ++) {\n      var feature = features[i];\n      feature.attr = attr[i];\n      layer.push (feature);\n    }\n    return layer;\n  };\n\n  return this;\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n\n/*global vgl, vec4, mat4, inherit, unescape*/\n/*global Float32Array, Int8Array, gl, Uint16Array, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n//\n// vbgModule.vtkReader class\n// This contains code that unpack a json base64 encoded vtkdataset,\n// such as those produced by ParaView's webGL exporter (where much\n// of the code originated from) and convert it to VGL representation.\n//\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.vtkReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vtkReader)) {\n    return new vgl.vtkReader();\n  }\n\n  var m_base64Chars =\n    ['A','B','C','D','E','F','G','H','I','J','K','L','M',\n     'N','O','P','Q','R','S','T','U','V','W','X','Y','Z',\n     'a','b','c','d','e','f','g','h','i','j','k','l','m',\n     'n','o','p','q','r','s','t','u','v','w','x','y','z',\n     '0','1','2','3','4','5','6','7','8','9','+','/'],\n  m_reverseBase64Chars = [],\n  m_vtkObjectList = {},\n  m_vglObjects = {},\n  m_vtkRenderedList = {},\n  m_vtkObjHashList = {},\n  m_vtkObjectCount = 0,\n  m_vtkScene = null,\n  m_node = null,\n  END_OF_INPUT = -1,\n  m_base64Str = \"\",\n  m_base64Count = 0,\n  m_pos = 0,\n  m_viewer = null,\n  i = 0;\n\n  //initialize the array here if not already done.\n  if (m_reverseBase64Chars.length === 0) {\n    for ( i = 0; i < m_base64Chars.length; i++) {\n      m_reverseBase64Chars[m_base64Chars[i]] = i;\n    }\n  }\n\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * ntos\n   *\n   * @param n\n   * @returns unescaped n\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ntos = function (n) {\n    var unN;\n\n    unN = n.toString(16);\n    if (unN.length === 1) {\n      unN = '0' + unN;\n    }\n    unN = '%' + unN;\n\n    return unescape(unN);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readReverseBase64\n   *\n   * @returns\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readReverseBase64 = function () {\n    var nextCharacter;\n\n    if (!m_base64Str) {\n      return END_OF_INPUT;\n    }\n\n    while (true) {\n      if (m_base64Count >= m_base64Str.length) {\n        return END_OF_INPUT;\n      }\n      nextCharacter = m_base64Str.charAt(m_base64Count);\n      m_base64Count++;\n\n      if (m_reverseBase64Chars[nextCharacter]) {\n        return m_reverseBase64Chars[nextCharacter];\n      }\n      if (nextCharacter === 'A') {\n        return 0;\n      }\n    }\n\n    return END_OF_INPUT;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * decode64\n   *\n   * @param str\n   * @returns result\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.decode64 = function(str) {\n    var result = '',\n        inBuffer = new Array(4),\n        done = false;\n\n    m_base64Str = str;\n    m_base64Count = 0;\n\n    while (!done &&\n           (inBuffer[0] = this.readReverseBase64()) !== END_OF_INPUT &&\n           (inBuffer[1] = this.readReverseBase64()) !== END_OF_INPUT) {\n      inBuffer[2] = this.readReverseBase64();\n      inBuffer[3] = this.readReverseBase64();\n      result += this.ntos((((inBuffer[0] << 2) & 0xff) | inBuffer[1] >> 4));\n      if (inBuffer[2] !== END_OF_INPUT) {\n        result +=  this.ntos((((inBuffer[1] << 4) & 0xff) | inBuffer[2] >> 2));\n        if (inBuffer[3] !== END_OF_INPUT) {\n          result +=  this.ntos((((inBuffer[2] << 6) & 0xff) | inBuffer[3]));\n        } else {\n          done = true;\n        }\n      } else {\n        done = true;\n      }\n    }\n\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readNumber\n   *\n   * @param ss\n   * @returns v\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readNumber = function(ss) {\n    var v = ((ss[m_pos++]) +\n             (ss[m_pos++] << 8) +\n             (ss[m_pos++] << 16) +\n             (ss[m_pos++] << 24));\n    return v;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readF3Array\n   *\n   * @param numberOfPoints\n   * @param ss\n   * @returns points\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readF3Array = function(numberOfPoints, ss) {\n    var size = numberOfPoints*4*3, test = new Int8Array(size),\n        points = null, i;\n\n    for(i = 0; i < size; i++) {\n      test[i] = ss[m_pos++];\n    }\n\n    points = new Float32Array(test.buffer);\n\n    return points;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readColorArray\n   *\n   * @param numberOfPoints\n   * @param ss\n   * @param vglcolors\n   * @returns points\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readColorArray = function (numberOfPoints, ss, vglcolors) {\n    var i,r,g,b,idx = 0, tmp = new Array(numberOfPoints*3);\n    for(i = 0; i < numberOfPoints; i++) {\n      tmp[idx++] = ss[m_pos++]/255.0;\n      tmp[idx++] = ss[m_pos++]/255.0;\n      tmp[idx++] = ss[m_pos++]/255.0;\n      m_pos++;\n    }\n    vglcolors.insert(tmp);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseObject\n   *\n   * @param buffer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseObject = function(vtkObject) {\n    var geom = new vgl.geometryData(), mapper = vgl.mapper(), ss = [],\n        type = null, data = null, size, matrix = null, material = null,\n        actor, colorMapData, shaderProg, opacityUniform, lookupTable,\n        colorTable, windowSize, width, height, position;\n\n    //dehexlify\n//    data = this.decode64(vtkObject.data);\n    data = atob(vtkObject.data);\n    for(i = 0; i < data.length; i++) {\n      ss[i] = data.charCodeAt(i) & 0xff;\n    }\n\n    //Determine the Object type\n    m_pos = 0;\n    size = this.readNumber(ss);\n    type = String.fromCharCode(ss[m_pos++]);\n    geom.setName(type);\n\n    // Lines\n    if (type === 'L') {\n      matrix = this.parseLineData(geom, ss);\n      material = vgl.utils.createGeometryMaterial();\n    }\n    // Mesh\n    else if (type === 'M') {\n      matrix = this.parseMeshData(geom, ss);\n      material = vgl.utils.createPhongMaterial();\n    }\n    // Points\n    else if (type === 'P'){\n      matrix = this.parsePointData(geom, ss);\n      material = vgl.utils.createGeometryMaterial();\n    }\n    // ColorMap\n    else if (type === 'C') {\n      colorMapData = this.parseColorMapData(geom, ss, size);\n      colorTable = [];\n\n      for (i = 0; i < colorMapData.colors.length; i++) {\n          colorTable.push(colorMapData.colors[i][1])\n          colorTable.push(colorMapData.colors[i][2])\n          colorTable.push(colorMapData.colors[i][3])\n          colorTable.push(colorMapData.colors[i][0] * 255)\n      }\n\n      lookupTable = new vgl.lookupTable();\n      lookupTable.setColorTable(colorTable);\n\n      windowSize = m_viewer.renderWindow().windowSize();\n      width = colorMapData.size[0]*windowSize[0];\n      height = colorMapData.size[1]*windowSize[1];\n\n      position = [colorMapData.position[0]*windowSize[0],\n                  (1-colorMapData.position[1])*windowSize[1], 0];\n      position[1] = position[1]-height;\n\n      // For now hardcode the height\n      height = 30;\n\n      return vgl.utils.createColorLegend(colorMapData.title,\n          lookupTable, position, width, height, 3, 0);\n    }\n    // Unknown\n    else {\n      console.log(\"Ignoring unrecognized encoded data type \" + type);\n    }\n\n    mapper.setGeometryData(geom);\n\n    //default opacity === solid. If were transparent, set it lower.\n    if (vtkObject.hasTransparency) {\n      shaderProg = material.shaderProgram();\n      opacityUniform = shaderProg.uniform(\"opacity\");\n      shaderProg.addUniform(new vgl.floatUniform(\"opacity\", 0.5));\n      material.setBinNumber(1000);\n    }\n\n    actor = vgl.actor();\n    actor.setMapper(mapper);\n    actor.setMaterial(material);\n    actor.setMatrix(mat4.transpose(mat4.create(), matrix));\n\n    return [actor];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseLineData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseLineData = function(geom, ss) {\n    var vglpoints = null, vglcolors = null, vgllines = null,\n        matrix = mat4.create(),\n        numberOfIndex, numberOfPoints, points,\n        temp, index, size, m, i,\n        p = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    p = new Array(numberOfPoints*3);\n\n    //Getting Points\n    vglpoints = new vgl.sourceDataP3fv();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    for(i = 0; i < numberOfPoints; i++) {\n      p[idx++] = points[i*3/*+0*/];\n      p[idx++] = points[i*3+1];\n      p[idx++] =  points[i*3+2];\n    }\n    vglpoints.insert(p);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    vgllines = new vgl.lines();\n    geom.addPrimitive(vgllines);\n    numberOfIndex = this.readNumber(ss);\n\n    temp = new Int8Array(numberOfIndex*2);\n    for(i = 0; i < numberOfIndex*2; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    index = new Uint16Array(temp.buffer);\n    vgllines.setIndices(index);\n    vgllines.setPrimitiveType(gl.LINES);\n\n    //Getting Matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i=0; i<size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseMeshData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseMeshData = function(geom, ss) {\n    var vglpoints = null, vglcolors = null, vgllines = null,\n        normals = null, matrix = mat4.create(), v1 = null,\n        vgltriangles = null, numberOfIndex, numberOfPoints,\n        points, temp, index, size, m, i, tcoord,\n        pn = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    pn = new Array(numberOfPoints*6);\n    //Getting Points\n    vglpoints = new vgl.sourceDataP3N3f();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    //Getting Normals\n    normals = this.readF3Array(numberOfPoints, ss);\n    for(i = 0; i < numberOfPoints; i++) {\n      pn[idx++] = points[i*3/*+0*/];\n      pn[idx++] = points[i*3+1];\n      pn[idx++] = points[i*3+2];\n      pn[idx++] = normals[i*3/*+0*/];\n      pn[idx++] = normals[i*3+1];\n      pn[idx++] = normals[i*3+2];\n    }\n    vglpoints.insert(pn);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    temp = [];\n    vgltriangles = new vgl.triangles();\n    numberOfIndex = this.readNumber(ss);\n\n    temp = new Int8Array(numberOfIndex*2);\n    for(i = 0; i < numberOfIndex*2; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    index = new Uint16Array(temp.buffer);\n    vgltriangles.setIndices(index);\n    geom.addPrimitive(vgltriangles);\n\n    //Getting Matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i = 0; i < size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    //Getting TCoord\n    //TODO: renderer is not doing anything with this yet\n    tcoord = null;\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parsePointData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parsePointData = function(geom, ss) {\n    var numberOfPoints, points, indices, temp, size,\n        matrix = mat4.create(), vglpoints = null,\n        vglcolors = null, vglVertexes = null, m,\n        p = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    p = new Array(numberOfPoints*3);\n\n    //Getting Points and creating 1:1 connectivity\n    vglpoints = new vgl.sourceDataP3fv();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    indices = new Uint16Array(numberOfPoints);\n\n    for (i = 0; i < numberOfPoints; i++) {\n      indices[i] = i;\n      p[idx++] = points[i*3/*+0*/];\n      p[idx++] = points[i*3+1];\n      p[idx++] = points[i*3+2];\n    }\n    vglpoints.insert(p);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    vglVertexes = new vgl.points();\n    vglVertexes.setIndices(indices);\n    geom.addPrimitive(vglVertexes);\n\n    //Getting matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i = 0; i < size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseColorMapData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseColorMapData = function(geom, ss, numColors) {\n\n    var tmpArray, size, xrgb, i, c, obj = {};\n\n    // Set number of colors\n    obj.numOfColors = numColors;\n\n    // Getting Position\n    size = 8;\n    tmpArray = new Int8Array(size);\n    for(i=0; i < size; i++) {\n        tmpArray[i] = ss[m_pos++];\n    }\n    obj.position = new Float32Array(tmpArray.buffer);\n\n    // Getting Size\n    size = 8;\n    tmpArray = new Int8Array(size);\n    for(i=0; i < size; i++) {\n        tmpArray[i] = ss[m_pos++];\n    }\n    obj.size = new Float32Array(tmpArray.buffer);\n\n    //Getting Colors\n    obj.colors = [];\n    for(c=0; c < obj.numOfColors; c++){\n      tmpArray = new Int8Array(4);\n      for(i=0; i < 4; i++) {\n        tmpArray[i] = ss[m_pos++];\n      }\n\n      xrgb = [\n        new Float32Array(tmpArray.buffer)[0],\n        ss[m_pos++],\n        ss[m_pos++],\n        ss[m_pos++]\n      ];\n      obj.colors[c] = xrgb;\n    }\n\n    obj.orientation = ss[m_pos++];\n    obj.numOfLabels = ss[m_pos++];\n    obj.title = \"\";\n    while(m_pos < ss.length) {\n      obj.title += String.fromCharCode(ss[m_pos++]);\n    }\n\n    return obj;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseSceneMetadata\n   *\n   * @param data\n   * @returns renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseSceneMetadata = function(renderer, layer) {\n\n    var sceneRenderer = m_vtkScene.Renderers[layer],\n        camera = renderer.camera(), bgc, localWidth, localHeight;\n\n    localWidth = (sceneRenderer.size[0] - sceneRenderer.origin[0])*m_node.width;\n    localHeight = (sceneRenderer.size[1] - sceneRenderer.origin[1])*m_node.height;\n    renderer.resize(localWidth, localHeight);\n\n    /// We are setting the center to the focal point because of\n    /// a possible paraview web bug. The center of rotation isn't\n    /// getting updated correctly on resetCamera.\n    camera.setCenterOfRotation(\n      [sceneRenderer.LookAt[1], sceneRenderer.LookAt[2],\n       sceneRenderer.LookAt[3]]);\n    camera.setViewAngleDegrees(sceneRenderer.LookAt[0]);\n    camera.setPosition(\n      sceneRenderer.LookAt[7], sceneRenderer.LookAt[8],\n      sceneRenderer.LookAt[9]);\n    camera.setFocalPoint(\n      sceneRenderer.LookAt[1], sceneRenderer.LookAt[2],\n      sceneRenderer.LookAt[3]);\n    camera.setViewUpDirection(\n      sceneRenderer.LookAt[4], sceneRenderer.LookAt[5],\n      sceneRenderer.LookAt[6]);\n\n    if (layer === 0)\n    {\n      bgc = sceneRenderer.Background1;\n      renderer.setBackgroundColor(bgc[0], bgc[1], bgc[2], 1);\n    } else {\n        renderer.setResizable(false);\n    }\n    renderer.setLayer(layer);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * initScene\n   *\n   * @returns viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initScene = function() {\n    var renderer, layer;\n\n    if ( m_vtkScene === null ) {\n      return m_viewer;\n    }\n    for(layer = m_vtkScene.Renderers.length - 1; layer >= 0; layer--) {\n\n      renderer = this.getRenderer(layer);\n      this.parseSceneMetadata(renderer, layer);\n    }\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * createViewer - Creates a viewer object.\n   *\n   * @param\n   *\n   * @returns viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createViewer = function(node) {\n    var interactorStyle;\n\n    if(m_viewer === null) {\n      m_node = node;\n      m_viewer = vgl.viewer(node);\n      m_viewer.init();\n      m_vtkRenderedList[0] = m_viewer.renderWindow().activeRenderer();\n      m_viewer.renderWindow().resize(node.width, node.height);\n      interactorStyle = vgl.pvwInteractorStyle();\n      m_viewer.setInteractorStyle(interactorStyle);\n    }\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * deleteViewer - Deletes the viewer object associated with the reader.\n   *\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteViewer = function() {\n      m_vtkRenderedList = {};\n      m_viewer = null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * updateCanvas -\n   *\n   * @param\n   *\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateCanvas = function(node) {\n    m_node = node;\n    m_viewer.renderWindow().resize(node.width, node.height);\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * clearVtkObjectData - Clear out the list of VTK geometry data.\n   *\n   * @param void\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numObjects = function() {\n    return m_vtkObjectCount;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * getRenderer - Gets (or creates) the renderer for a layer.\n   *\n   * @param layer\n   * @returns renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getRenderer = function(layer) {\n    var renderer;\n\n    renderer = m_vtkRenderedList[layer];\n    if (renderer === null || typeof renderer === 'undefined') {\n      renderer = new vgl.renderer();\n      renderer.setResetScene(false);\n      renderer.setResetClippingRange(false);\n      m_viewer.renderWindow().addRenderer(renderer);\n\n      if (layer !== 0) {\n          renderer.camera().setClearMask(vgl.GL.DepthBufferBit);\n      }\n\n      m_vtkRenderedList[layer] = renderer;\n    }\n\n    return renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * setVtkScene - Set the VTK scene data for camera initialization.\n   *\n   * @param scene\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVtkScene = function(scene) {\n    m_vtkScene = scene;\n  };\n\n  return this;\n};\n","vgl.DataBuffers = function (initialSize) {\n    if (!(this instanceof vgl.DataBuffers)) {\n      return new vgl.DataBuffers(initialSize);\n    }\n\n    var data = {};\n\n    var size;\n    if (!initialSize && initialSize !== 0)\n        size = 256;\n    else\n        size = initialSize;\n\n    var current = 0;\n\n    var copyArray = function (dst, src, start, count) {\n        if (!dst)\n            console.log ('ack');\n        if (!start)\n            start = 0;\n        if (!count)\n            count = src.length;\n        for (var i = 0; i < count; i ++) {\n            dst[start + i] = src[i];\n        }\n    };\n\n    var resize = function (min_expand) {\n        var new_size = size;\n        /* If the array would increase substantially, don't just double its\n         * size.  If the array has been increasing gradually, double it as the\n         * expectation is that it will increase again. */\n        if (new_size * 2 < min_expand) {\n            new_size = min_expand;\n        }\n        while (new_size < min_expand)\n            new_size *= 2;\n        size = new_size;\n        for (var name in data) {\n            var newArray = new Float32Array (new_size * data[name].len);\n            var oldArray = data[name].array;\n            copyArray (newArray, oldArray);\n            data[name].array = newArray;\n            data[name].dirty = true;\n        }\n    };\n\n    this.create = function (name, len) {\n        if (!len)\n            throw \"Length of buffer must be a positive integer\";\n        var array = new Float32Array (size * len);\n        data[name] = {\n            array: array,\n            len: len,\n            dirty: false\n        };\n        return data[name].array;\n    };\n\n    this.alloc = function (num) {\n        if ((current + num) >= size)\n            resize (current + num);\n        var start = current;\n        current += num;\n        return start;\n    };\n\n    this.get = function (name) {\n        return data[name].array;\n    };\n\n    this.write = function (name, array, start, count) {\n        copyArray (data[name].array, array, start * data[name].len, count * data[name].len);\n        data[name].dirty = true;\n    };\n\n    this.repeat = function (name, elem, start, count) {\n        for (var i = 0; i < count; i ++) {\n            copyArray (data[name].array, elem,\n                       (start + i) * data[name].len, data[name].len);\n        }\n        data[name].dirty = true;\n    };\n\n    this.count = function () {\n        return current;\n    };\n\n    this.data = function (name) {\n        return data[name].array;\n    };\n};\n","\n(function () {\n  \"use strict\";\n\n  var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n  /**\n   * Takes a variable number of arguments and returns the first numeric value\n   * it finds.\n   * @private\n   */\n  function setNumeric() {\n    var i;\n    for (i = 0; i < arguments.length; i += 1) {\n      if (isFinite(arguments[i])) {\n        return arguments[i];\n      }\n    }\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Contains utility classes and methods used by geojs.\n   * @namespace\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  geo.util = {\n    /**\n     * Returns true if the given point lies in the given polygon.\n     * Algorithm description:\n     *   http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n     * @param {geo.screenPosition} point The test point\n     * @param {geo.screenPosition[]} outer The outer boundary of the polygon\n     * @param {geo.screenPosition[][]?} inner Inner boundaries (holes)\n     */\n    pointInPolygon: function (point, outer, inner) {\n      var inside = false, n = outer.length;\n\n      if (n < 3) {\n        // we need 3 coordinates for this to make sense\n        return false;\n      }\n\n      outer.forEach(function (vert, i) {\n        var j = (n + i - 1) % n;\n        var intersect = (\n          ((outer[i].y > point.y) !== (outer[j].y > point.y)) &&\n          (point.x < (outer[j].x - outer[i].x) *\n                     (point.y - outer[i].y) /\n                     (outer[j].y - outer[i].y) + outer[i].x)\n        );\n        if (intersect) {\n          inside = !inside;\n        }\n      });\n\n      (inner || []).forEach(function (hole) {\n        inside = inside && !geo.util.pointInPolygon(point, hole);\n      });\n\n      return inside;\n    },\n\n    /**\n     * Returns true if the argument is a function.\n     */\n    isFunction: function (f) {\n      return typeof f === \"function\";\n    },\n\n    /**\n     * Returns the argument if it is function, otherwise returns a function\n     * that returns the argument.\n     */\n    ensureFunction: function (f) {\n      if (geo.util.isFunction(f)) {\n        return f;\n      } else {\n        return function () { return f; };\n      }\n    },\n\n    /**\n     * Return a random string of length n || 8.\n     */\n    randomString: function (n) {\n      var s, i, r;\n      n = n || 8;\n      s = \"\";\n      for (i = 0; i < n; i += 1) {\n        r = Math.floor(Math.random() * chars.length);\n        s += chars.substring(r, r + 1);\n      }\n      return s;\n    },\n\n    /**\n     * Convert a color from hex value or css name to rgb objects\n     */\n    convertColor: function (color) {\n      if (color.r !== undefined && color.g !== undefined &&\n          color.b !== undefined) {\n        return color;\n      }\n      if (typeof color === \"string\") {\n        if (geo.util.cssColors.hasOwnProperty(color)) {\n          color = geo.util.cssColors[color];\n        } else if (color.charAt(0) === \"#\") {\n          color = parseInt(color.slice(1), 16);\n        }\n      }\n      // jshint -W016\n      if (isFinite(color)) {\n        color = {\n          r: ((color & 0xff0000) >> 16) / 255,\n          g: ((color & 0xff00) >> 8) / 255,\n          b: ((color & 0xff)) / 255\n        };\n      }\n      // jshint +W016\n      return color;\n    },\n\n    /**\n     * Normalize a coordinate object into {x: ..., y: ..., z: ... } form.\n     * Accepts 2-3d arrays,\n     * latlng objects\n     * latitude -> lat -> y\n     * longitude -> lon -> lng -> x\n     */\n    normalizeCoordinates: function (p) {\n      p = p || {};\n      if (Array.isArray(p)) {\n        return {\n          x: p[0],\n          y: p[1],\n          z: p[2] || 0\n        };\n      }\n      if (p instanceof geo.latlng) {\n        return {\n          x: p.lng(),\n          y: p.lat(),\n          z: 0\n        };\n      }\n      return {\n        x: setNumeric(\n          p.x,\n          p.longitude,\n          p.lng,\n          p.lon,\n          0\n        ),\n        y: setNumeric(\n          p.y,\n          p.latitude,\n          p.lat,\n          0\n        ),\n        z: setNumeric(\n          p.z,\n          p.elevation,\n          p.elev,\n          p.height,\n          0\n        )\n      };\n    }\n  };\n\n  geo.util.cssColors = {\n    aliceblue: 0xf0f8ff,\n    antiquewhite: 0xfaebd7,\n    aqua: 0x00ffff,\n    aquamarine: 0x7fffd4,\n    azure: 0xf0ffff,\n    beige: 0xf5f5dc,\n    bisque: 0xffe4c4,\n    black: 0x000000,\n    blanchedalmond: 0xffebcd,\n    blue: 0x0000ff,\n    blueviolet: 0x8a2be2,\n    brown: 0xa52a2a,\n    burlywood: 0xdeb887,\n    cadetblue: 0x5f9ea0,\n    chartreuse: 0x7fff00,\n    chocolate: 0xd2691e,\n    coral: 0xff7f50,\n    cornflowerblue: 0x6495ed,\n    cornsilk: 0xfff8dc,\n    crimson: 0xdc143c,\n    cyan: 0x00ffff,\n    darkblue: 0x00008b,\n    darkcyan: 0x008b8b,\n    darkgoldenrod: 0xb8860b,\n    darkgray: 0xa9a9a9,\n    darkgreen: 0x006400,\n    darkgrey: 0xa9a9a9,\n    darkkhaki: 0xbdb76b,\n    darkmagenta: 0x8b008b,\n    darkolivegreen: 0x556b2f,\n    darkorange: 0xff8c00,\n    darkorchid: 0x9932cc,\n    darkred: 0x8b0000,\n    darksalmon: 0xe9967a,\n    darkseagreen: 0x8fbc8f,\n    darkslateblue: 0x483d8b,\n    darkslategray: 0x2f4f4f,\n    darkslategrey: 0x2f4f4f,\n    darkturquoise: 0x00ced1,\n    darkviolet: 0x9400d3,\n    deeppink: 0xff1493,\n    deepskyblue: 0x00bfff,\n    dimgray: 0x696969,\n    dimgrey: 0x696969,\n    dodgerblue: 0x1e90ff,\n    firebrick: 0xb22222,\n    floralwhite: 0xfffaf0,\n    forestgreen: 0x228b22,\n    fuchsia: 0xff00ff,\n    gainsboro: 0xdcdcdc,\n    ghostwhite: 0xf8f8ff,\n    gold: 0xffd700,\n    goldenrod: 0xdaa520,\n    gray: 0x808080,\n    green: 0x008000,\n    greenyellow: 0xadff2f,\n    grey: 0x808080,\n    honeydew: 0xf0fff0,\n    hotpink: 0xff69b4,\n    indianred: 0xcd5c5c,\n    indigo: 0x4b0082,\n    ivory: 0xfffff0,\n    khaki: 0xf0e68c,\n    lavender: 0xe6e6fa,\n    lavenderblush: 0xfff0f5,\n    lawngreen: 0x7cfc00,\n    lemonchiffon: 0xfffacd,\n    lightblue: 0xadd8e6,\n    lightcoral: 0xf08080,\n    lightcyan: 0xe0ffff,\n    lightgoldenrodyellow: 0xfafad2,\n    lightgray: 0xd3d3d3,\n    lightgreen: 0x90ee90,\n    lightgrey: 0xd3d3d3,\n    lightpink: 0xffb6c1,\n    lightsalmon: 0xffa07a,\n    lightseagreen: 0x20b2aa,\n    lightskyblue: 0x87cefa,\n    lightslategray: 0x778899,\n    lightslategrey: 0x778899,\n    lightsteelblue: 0xb0c4de,\n    lightyellow: 0xffffe0,\n    lime: 0x00ff00,\n    limegreen: 0x32cd32,\n    linen: 0xfaf0e6,\n    magenta: 0xff00ff,\n    maroon: 0x800000,\n    mediumaquamarine: 0x66cdaa,\n    mediumblue: 0x0000cd,\n    mediumorchid: 0xba55d3,\n    mediumpurple: 0x9370db,\n    mediumseagreen: 0x3cb371,\n    mediumslateblue: 0x7b68ee,\n    mediumspringgreen: 0x00fa9a,\n    mediumturquoise: 0x48d1cc,\n    mediumvioletred: 0xc71585,\n    midnightblue: 0x191970,\n    mintcream: 0xf5fffa,\n    mistyrose: 0xffe4e1,\n    moccasin: 0xffe4b5,\n    navajowhite: 0xffdead,\n    navy: 0x000080,\n    oldlace: 0xfdf5e6,\n    olive: 0x808000,\n    olivedrab: 0x6b8e23,\n    orange: 0xffa500,\n    orangered: 0xff4500,\n    orchid: 0xda70d6,\n    palegoldenrod: 0xeee8aa,\n    palegreen: 0x98fb98,\n    paleturquoise: 0xafeeee,\n    palevioletred: 0xdb7093,\n    papayawhip: 0xffefd5,\n    peachpuff: 0xffdab9,\n    peru: 0xcd853f,\n    pink: 0xffc0cb,\n    plum: 0xdda0dd,\n    powderblue: 0xb0e0e6,\n    purple: 0x800080,\n    red: 0xff0000,\n    rosybrown: 0xbc8f8f,\n    royalblue: 0x4169e1,\n    saddlebrown: 0x8b4513,\n    salmon: 0xfa8072,\n    sandybrown: 0xf4a460,\n    seagreen: 0x2e8b57,\n    seashell: 0xfff5ee,\n    sienna: 0xa0522d,\n    silver: 0xc0c0c0,\n    skyblue: 0x87ceeb,\n    slateblue: 0x6a5acd,\n    slategray: 0x708090,\n    slategrey: 0x708090,\n    snow: 0xfffafa,\n    springgreen: 0x00ff7f,\n    steelblue: 0x4682b4,\n    tan: 0xd2b48c,\n    teal: 0x008080,\n    thistle: 0xd8bfd8,\n    tomato: 0xff6347,\n    turquoise: 0x40e0d0,\n    violet: 0xee82ee,\n    wheat: 0xf5deb3,\n    white: 0xffffff,\n    whitesmoke: 0xf5f5f5,\n    yellow: 0xffff00,\n    yellowgreen: 0x9acd32\n  };\n}());\n","//////////////////////////////////////////////////////////////////////////////\n/*\n * Includes several support classes adapted from wigglemaps.\n *\n * https://github.com/dotskapes/wigglemaps\n *\n * Copyright 2013 Preston and Krejci (dotSkapes Virtual Lab)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n//////////////////////////////////////////////////////////////////////////////\n\n/* jshint ignore: start */\n(function () {\n    'use strict';\n\n    var RangeNode = function (elem, start, end, current) {\n        this.data = elem[current];\n        this.left = null;\n        this.right = null;\n        if (start != current)\n            this.left = new RangeNode (elem, start, current - 1, parseInt ((start + (current - 1)) / 2, 10));\n        if (end != current)\n            this.right = new RangeNode (elem, current + 1, end, parseInt ((end + (current + 1)) / 2, 10));\n        this.subtree = [];\n        for (var i = start; i <= end; i ++) {\n            this.subtree.push (elem[i]);\n        }\n        this.subtree.sort (function (a, b) {\n            return a.y - b.y;\n        });\n\n        var xrange = function (b) {\n            return (b.x_in (elem[start]) && b.x_in (elem[end]));\n        };\n\n        this.yrange = function (b, start, end) {\n            return (b.y_in (this.subtree[start]) && b.y_in (this.subtree[end]));\n        };\n\n        this.subquery = function (result, box, start, end, current) {\n            if (this.yrange (box, start, end)) {\n                for (var i = start; i <= end; i ++) {\n                    result.push (this.subtree[i]);\n                }\n                return;\n            }\n            if (box.y_in (this.subtree[current]))\n                result.push (this.subtree[current]);\n            if (box.y_left (this.subtree[current])){\n                if (current != end)\n                    this.subquery (result, box, current + 1, end, parseInt ((end + (current + 1)) / 2, 10));\n            }\n            else if (box.x_right (this.subtree[current])) {\n                if (current != start)\n                    this.subquery (result, box, start, current - 1, parseInt ((start + (current - 1)) / 2, 10));\n            }\n            else {\n                if (current != end)\n                    this.subquery (result, box, current + 1, end, parseInt ((end + (current + 1)) / 2, 10));\n                if (current != start)\n                    this.subquery (result, box, start, current - 1, parseInt ((start + (current - 1)) / 2, 10));\n            }\n        };\n        \n        this.search = function (result, box) {\n            if (xrange (box)) {\n                this.subquery (result, box, 0, this.subtree.length - 1, parseInt ((this.subtree.length - 1) / 2, 10));\n                return;\n            }\n            else {\n                if (box.contains (this.data))\n                    result.push (this.data);\n                if (box.x_left (this.data)) {\n                    if (this.right)\n                        this.right.search (result, box);\n                }\n                else if (box.x_right (this.data)) {\n                    if (this.left)\n                        this.left.search (result, box);\n                }\n                else {\n                    if (this.left)\n                        this.left.search (result, box);\n                    if (this.right)\n                        this.right.search (result, box);\n                }\n            }\n        };\n    };\n\n    var RangeTree = function (elem) {\n        elem.sort (function (a, b) {\n            return a.x - b.x;\n        });\n        if (elem.length > 0)\n            this.root = new RangeNode (elem, 0, elem.length - 1, parseInt ((elem.length - 1) / 2, 10));\n        else\n            this.root = null;\n\n        this.search = function (_box) {\n            if (!this.root)\n                return [];\n            //var box = new Box (min, max);\n            var box = _box.clone ();\n            var result = [];\n            this.root.search (result, box);\n            return result;\n        };\n    };\n\n    var Box = function (v1, v2) {\n        this.min = v1.clone ();\n        this.max = v2.clone ();\n        this.contains = function (p) {\n            return (v1.x <= p.x) && (v2.x >= p.x) && (v1.y <= p.y) && (v2.y >= p.y);\n        };\n\n        this.x_in = function (p) {\n            return (v1.x <= p.x) && (v2.x >= p.x);\n        };\n\n        this.x_left = function (p) {\n            return (v1.x >= p.x);\n        };\n\n        this.x_right = function (p) {\n            return (v2.x <= p.x);\n        };\n\n        this.y_in = function (p) {\n            return (v1.y <= p.y) && (v2.y >= p.y);\n        };\n\n        this.y_left = function (p) {\n            return (v1.y >= p.y);\n        };\n\n        this.y_right = function (p) {\n            return (v2.y <= p.y);\n        };\n\n        this.area = function () {\n            return (this.max.x - this.min.x) * (this.max.y - this.min.y);\n        };\n\n        this.height = function () {\n            return this.max.y - this.min.y;\n        };\n\n        this.width = function () {\n            return this.max.x - this.min.x;\n        };\n        \n        this.vertex = function (index) {\n            switch (index) {\n            case 0:\n                return this.min.clone ();\n            case 1:\n                return new vect (this.max.x, this.min.y);\n            case 2:\n                return this.max.clone ();\n            case 3:\n                return new vect (this.min.x, this.max.y);\n            default:\n                throw \"Index out of bounds: \" + index ;\n            }\n        };\n\n        this.intersects = function (box) {\n            for (var i = 0; i < 4; i ++) {\n                for (var j = 0; j < 4; j ++) {\n                    if (vect.intersects (this.vertex (i), this.vertex ((i + 1) % 4),\n                                         box.vertex (j), box.vertex ((j + 1) % 4)))\n                        return true;\n                }\n            }\n            if (this.contains (box.min) &&\n                this.contains (box.max) &&\n                this.contains (new vect (box.min.x, box.max.y)) &&\n                this.contains (new vect (box.max.x, box.min.y)))\n                return true;\n            if (box.contains (this.min) &&\n                box.contains (this.max) &&\n                box.contains (new vect (this.min.x, this.max.y)) &&\n                box.contains (new vect (this.max.x, this.min.y)))\n                return true;\n            return false;\n        };\n\n        this.union = function (b) {\n            this.min.x = Math.min (this.min.x, b.min.x);\n            this.min.y = Math.min (this.min.y, b.min.y);\n\n            this.max.x = Math.max (this.max.x, b.max.x);\n            this.max.y = Math.max (this.max.y, b.max.y);\n        };\n\n        this.centroid = function () {\n            return new vect ((this.max.x + this.min.x) / 2, (this.max.y + this.min.y) / 2);\n        };\n\n        this.clone = function () {\n            return new Box (v1, v2);\n        };\n    };\n\n    // A basic vector type. Supports standard 2D vector operations\n    var Vector2D = function (x, y) {\n        this.x = x;\n        this.y = y;\n\n        this.add = function (v) {\n            this.x += v.x;\n            this.y += v.y;\n            return this;\n        };\n        this.sub = function (v) {\n            this.x -= v.x;\n            this.y -= v.y;\n            return this;\n        };\n        this.scale = function (s) {\n            this.x *= s;\n            this.y *= s;\n            return this;\n        };\n        this.length = function () {\n            return Math.sqrt (this.x * this.x + this.y * this.y);\n        };\n        this.normalize = function () {\n            var scale = this.length ();\n            if (scale === 0)\n                return this;\n            this.x /= scale;\n            this.y /= scale;\n            return this;\n        };\n        this.div = function (v) {\n            this.x /= v.x;\n            this.y /= v.y;\n            return this;\n        };\n        this.floor = function () {\n            this.x = Math.floor (this.x);\n            this.y = Math.floor (this.y);\n            return this;\n        };\n        this.zero = function (tol) {\n            tol = tol || 0;\n            return (this.length() <= tol);\n        };\n        this.dot = function (v) {\n            return (this.x * v.x) + (this.y * v.y);\n        };\n        this.cross = function (v) {\n            return (this.x * v.y) - (this.y * v.x);\n        };\n        this.rotate = function (omega) {\n            var cos = Math.cos (omega);\n            var sin = Math.sin (omega);\n            xp = cos * this.x - sin * this.y;\n            yp = sin * this.x + cos * this.y;\n            this.x = xp;\n            this.y = yp;\n            return this;\n        };\n        this.clone = function () {\n            return new Vector2D (this.x, this.y); \n        };\n\n        this.array = function () {\n            return [this.x, this.y];\n        };\n    };\n\n    // A shortcut for the vector constructor\n    function vect (x, y) {\n        return new Vector2D (x, y);\n    }\n\n    // Shorthand operations for vectors for operations that make new vectors\n\n    vect.scale = function (v, s) {\n        return v.clone ().scale (s);\n    };\n\n    vect.add = function (v1, v2) {\n        return v1.clone ().add (v2);\n    };\n\n    vect.sub = function (v1, v2) {\n        return v1.clone ().sub (v2);\n    };\n\n    vect.dist = function (v1, v2) {\n        return v1.clone ().sub (v2).length ();\n    };\n\n    vect.dir = function (v1, v2) {\n        return v1.clone ().sub (v2).normalize ();\n    };\n\n    vect.dot = function (v1, v2) {\n        return (v1.x * v2.x) + (v1.y * v2.y);\n    };\n\n    vect.cross = function (v1, v2) {\n        return (v1.x * v2.y) - (v1.y * v2.x);\n    };\n\n    vect.left = function (a, b, c, tol) {\n        if (!tol)\n            tol = 0;\n        var v1 = vect.sub (b, a);\n        var v2 = vect.sub (c, a);\n        return (vect.cross (v1, v2) >= -tol);\n    };\n\n    vect.intersects = function (a, b, c, d, tol) {\n        if (!tol)\n            tol = 0;\n        return (vect.left (a, b, c, tol) != vect.left (a, b, d, tol) &&\n                vect.left (c, d, b, tol) != vect.left (c, d, a, tol));\n    };\n\n    vect.intersect2dt = function (a, b, c, d) {\n        var denom = a.x * (d.y - c.y) +\n            b.x * (c.y - d.y) +\n            d.x * (b.y - a.y) +\n            c.x * (a.y - b.y);\n\n        if (denom === 0)\n            return Infinity;\n        \n        var num_s = a.x * (d.y - c.y) +\n            c.x * (a.y - d.y) +\n            d.x * (c.y - a.y);\n        var s = num_s / denom;\n\n        var num_t = -(a.x * (c.y - b.y) +\n                      b.x * (a.y - c.y) +\n                      c.x * (b.y - a.y));\n        var t = num_t / denom;\n        \n        return t;\n    };\n\n    vect.intersect2dpos = function (a, b, c, d) {\n        var denom = a.x * (d.y - c.y) +\n            b.x * (c.y - d.y) +\n            d.x * (b.y - a.y) +\n            c.x * (a.y - b.y);\n\n        if (denom === 0)\n            return Infinity;\n        \n        var num_s = a.x * (d.y - c.y) +\n            c.x * (a.y - d.y) +\n            d.x * (c.y - a.y);\n        var s = num_s / denom;\n\n        /*var num_t = -(a.x * (c.y - b.y) +\n                      b.x * (a.y - c.y) +\n                      c.x * (b.y - a.y));\n        var t = num_t / denom;*/\n        \n        var dir = vect.sub (b, a);\n        dir.scale (s);\n        return vect.add (a, dir);\n    };\n\n    vect.rotate = function (v, omega) {\n        var cos = Math.cos (omega);\n        var sin = Math.sin (omega);\n        xp = cos * v.x - sin * v.y;\n        yp = sin * v.x + cos * v.y;\n        var c = new vect (xp, yp);\n        return c;\n    };\n\n    vect.normalize = function (v) {\n        return v.clone ().normalize ();\n    };\n\n    // Export to geo.util module\n    geo.util.RangeTree = RangeTree;\n    geo.util.Box = Box;\n    geo.util.vect = vect;\n}());\n/* jshint ignore: end */\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class object\n *\n * @class\n * @extends vgl.object\n * @returns {geo.object}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.object = function () {\n  \"use strict\";\n  if (!(this instanceof geo.object)) {\n    return new geo.object();\n  }\n\n  var m_this = this,\n      m_eventHandlers = {},\n      m_idleHandlers = [],\n      m_deferredCount = 0;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Bind a handler that will be called once when all deferreds are resolved.\n   *\n   *  @param {function} handler A function taking no arguments\n   *  @returns {geo.object[]|geo.object} this\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.onIdle = function (handler) {\n    if (m_deferredCount) {\n      m_idleHandlers.push(handler);\n    } else {\n      handler();\n    }\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Add a new deferred object preventing idle event handlers from being called.\n   *\n   *  @param {$.defer} defer A jquery defered object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addDeferred = function (defer) {\n    m_deferredCount += 1;\n    defer.done(function () {\n      m_deferredCount -= 1;\n      if (!m_deferredCount) {\n        m_idleHandlers.splice(0, m_idleHandlers.length)\n          .forEach(function (handler) {\n            handler();\n          });\n      }\n    });\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Bind an event handler to this object\n   *\n   *  @param {String} event\n   *    An event from {geo.events}\n   *  @param {function} handler\n   *    A function that will be called when ``event`` is triggered.  The\n   *    function will be given an event object as a first parameter and\n   *    optionally a second argument provided by the triggerer.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.geoOn = function (event, handler) {\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.geoOn(e, handler);\n      });\n      return m_this;\n    }\n    if (!m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event] = [];\n    }\n    m_eventHandlers[event].push(handler);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Trigger an event (or events) on this object and call all handlers\n   *\n   *  @param {String} event An event from {geo.events}\n   *  @param {Object} args An optional argument to pass to handlers\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.geoTrigger = function (event, args) {\n\n    // if we have an array of events, recall with single events\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.geoTrigger(e, args);\n      });\n      return m_this;\n    }\n\n    if (m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event].forEach(function (handler) {\n        handler.call(m_this, args);\n      });\n    }\n\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Remove handlers from an event (or an array of events).  If no event is\n   *  provided all hanlders will be removed.\n   *\n   *  @param {string?} event An event from {geo.events}\n   *  @param {object?} arg A function or array of functions to remove from the events\n   *                      or if falsey remove all handlers from the events\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.geoOff = function (event, arg) {\n    if (event === undefined) {\n      m_eventHandlers = {};\n      m_idleHandlers = [];\n      m_deferredCount = 0;\n    }\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.geoOff(e, arg);\n      });\n      return m_this;\n    }\n    if (!arg) {\n      m_eventHandlers[event] = [];\n    } else if (Array.isArray(arg)) {\n      arg.forEach(function (handler) {\n        m_this.geoOff(event, handler);\n      });\n      return m_this;\n    }\n    // What do we do if the handler is not already bound?\n    //   ignoring for now...\n    if (m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event] = m_eventHandlers[event].filter(function (f) {\n          return f !== arg;\n        }\n      );\n    }\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Free all resources and destroy the object.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.geoOff();\n  };\n\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(geo.object, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sceneObject, which extends the object's\n * event handling with a tree-based event propagation.\n *\n * @class\n * @extends geo.object\n * @returns {geo.sceneObject}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.sceneObject = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.sceneObject)) {\n    return new geo.sceneObject();\n  }\n  geo.object.call(this, arg);\n\n  var m_this = this,\n      m_parent = null,\n      m_children = [],\n      s_exit = this._exit,\n      s_trigger = this.geoTrigger,\n      s_addDeferred = this.addDeferred,\n      s_onIdle = this.onIdle;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Override object.addDeferred to propagate up the scene tree.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addDeferred = function (defer) {\n    if (m_parent) {\n      m_parent.addDeferred(defer);\n    } else {\n      s_addDeferred(defer);\n    }\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Override object.onIdle to propagate up the scene tree.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.onIdle = function (handler) {\n    if (m_parent) {\n      m_parent.onIdle(handler);\n    } else {\n      s_onIdle(handler);\n    }\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Get/set parent of the object\n   *  @param {?geo.sceneObject} parent\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.parent = function (arg) {\n    if (arg === undefined) {\n      return m_parent;\n    }\n    m_parent = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Add a child (or an array of children) to the object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addChild = function (child) {\n    if (Array.isArray(child)) {\n      child.forEach(m_this.addChild);\n      return m_this;\n    }\n    child.parent(m_this);\n    m_children.push(child);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Remove a child (or array of children) from the object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.removeChild = function (child) {\n    if (Array.isArray(child)) {\n      child.forEach(m_this.removeChild);\n      return m_this;\n    }\n    m_children = m_children.filter(function (c) { return c !== child; });\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Get an array of child objects\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.children = function () {\n    return m_children.slice();\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Force redraw of a scene object, to be implemented by subclasses.\n   *  Base class just calls draw of child objects.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.draw = function (arg) {\n    m_this.children().forEach(function (child) {\n      child.draw(arg);\n    });\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Trigger an event (or events) on this object and call all handlers.\n   *  @param {String} event the event to trigger\n   *  @param {Object} args arbitrary argument to pass to the handler\n   *  @param {Boolean} childrenOnly if true, only propagate down the tree\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.geoTrigger = function (event, args, childrenOnly) {\n\n    var geoArgs;\n\n    args = args || {};\n    geoArgs = args.geo || {};\n    args.geo = geoArgs;\n\n    // stop propagation if requested by the handler\n    if (geoArgs.stopPropagation) {\n      return m_this;\n    }\n\n    // If the event was not triggered by the parent, just propagate up the tree\n    if (!childrenOnly && m_parent && geoArgs._triggeredBy !== m_parent) {\n      geoArgs._triggeredBy = m_this;\n      m_parent.geoTrigger(event, args);\n      return m_this;\n    }\n\n    // call the object's own handlers\n    s_trigger.call(m_this, event, args);\n\n    // stop propagation if requested by the handler\n    if (geoArgs.stopPropagation) {\n      return m_this;\n    }\n\n    // trigger the event on the children\n    m_children.forEach(function (child) {\n      geoArgs._triggeredBy = m_this;\n      child.geoTrigger(event, args);\n    });\n\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Free all resources and destroy the object.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.children = [];\n    delete m_this.parent;\n    s_exit();\n  };\n\n  return this;\n};\n\ninherit(geo.sceneObject, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class timestamp\n *\n * @class\n * @extends vgl.timestamp\n * @returns {geo.timestamp}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.timestamp = function () {\n  'use strict';\n  if (!(this instanceof geo.timestamp)) {\n    return new geo.timestamp();\n  }\n  vgl.timestamp.call(this);\n};\n\ninherit(geo.timestamp, vgl.timestamp);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create an instance of quadratic surface generator\n * in Cartesian coordinates by the equation\n * <code>(x / a)^2 + (y / b)^2 + (z / c)^2 = 1</code>. Used\n * primarily to create planetary bodies\n *\n * @class\n * @param {Number} [x=0]  Radius in X direction\n * @param {Number} [y=0]  Radius in Y direction\n * @param {Number} [z=0]  Radius in Z direction\n *\n * @returns {geo.ellipsoid}\n */\n //////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid = function (x, y, z) {\n  'use strict';\n  if (!(this instanceof geo.ellipsoid)) {\n    return new geo.ellipsoid(x, y, z);\n  }\n\n  x = vgl.defaultValue(x, 0.0);\n  y = vgl.defaultValue(y, 0.0);\n  z = vgl.defaultValue(z, 0.0);\n\n  if (x < 0.0 || y < 0.0 || z < 0.0) {\n    return console.log('[error] Al radii components must be greater than zero');\n  }\n\n  var m_this = this,\n      m_radii = new vec3.fromValues(x, y, z),\n      m_radiiSquared = new vec3.fromValues(\n        x * x, y * y, z * z),\n      m_minimumRadius = Math.min(x, y, z),\n      m_maximumRadius = Math.max(x, y, z);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return radii of ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.radii = function () {\n    return m_radii;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return squared radii of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.radiiSquared = function () {\n    return m_radiiSquared;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return maximum radius of the ellipsoid\n   *\n   * @return {Number} The maximum radius of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.maximumRadius = function () {\n    return m_maximumRadius;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return minimum radius of the ellipsoid\n   *\n   * @return {Number} The maximum radius of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.minimumRadius = function () {\n    return m_minimumRadius;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Computes the normal of the plane tangent to the surface of\n   * the ellipsoid at the provided position\n   *\n   * @param {Number} lat The cartographic latitude for which\n   *  to to determine the geodetic normal\n   * @param {Number} lon The cartographic longitude for which\n   *  to to determine the geodetic normal\n   *\n   * @return {vec3}\n   *\n   * @exception {DeveloperError} cartographic is required.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeGeodeticSurfaceNormal = function (lat, lon) {\n    if (typeof lat === 'undefined' || typeof lon === 'undefined') {\n      throw '[error] Valid latitude and longitude is required';\n    }\n\n    var cosLatitude = Math.cos(lat),\n        result = vec3.create();\n\n    result[0] = cosLatitude * Math.cos(lon);\n    result[1] = cosLatitude * Math.sin(lon);\n    result[2] = Math.sin(lat);\n\n    vec3.normalize(result, result);\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Converts the provided geographic latitude, longitude,\n   * and height to WGS84 coordinate system\n   *\n   * @param {Number} lat Latitude in radians\n   * @param {Number} lon Longitude in radians\n   * @param {Number} elev Elevation\n   * @return {vec3} Position in the WGS84 coordinate system\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transformPoint = function (lat, lon, elev) {\n    lat = lat *  (Math.PI / 180.0);\n    lon = lon * (Math.PI / 180.0);\n\n    var n = m_this.computeGeodeticSurfaceNormal(lat, lon),\n        k = vec3.create(),\n        gamma  = Math.sqrt(vec3.dot(n, k)),\n        result = vec3.create();\n\n    vec3.multiply(k, m_radiiSquared, n);\n    vec3.scale(k, k, 1 / gamma);\n    vec3.scale(n, n, elev);\n    vec3.add(result, n, k);\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Converts the provided geographic latitude, longitude,\n   * and height to WGS84 coordinate system\n   *\n   * @param {vgl.geometryData} geom\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transformGeometry = function (geom) {\n    if (!geom) {\n      throw '[error] Failed to transform to cartesian. Invalid geometry.';\n    }\n\n    var sourceData = geom.sourceData(vgl.vertexAttributeKeys.Position),\n        sourceDataArray = sourceData.data(),\n        noOfComponents =  sourceData.attributeNumberOfComponents(\n          vgl.vertexAttributeKeys.Position),\n        stride = sourceData.attributeStride(\n          vgl.vertexAttributeKeys.Position),\n        offset = sourceData.attributeOffset(\n          vgl.vertexAttributeKeys.Position),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(\n          vgl.vertexAttributeKeys.Position),\n        index = null,\n        count = sourceDataArray.length * (1.0 / noOfComponents),\n        gamma = null,\n        n = null,\n        j = 0,\n        k = vec3.create(),\n        result = vec3.create();\n\n    stride /= sizeOfDataType;\n    offset /= sizeOfDataType;\n\n    if (noOfComponents !== 3) {\n      throw ('[error] Requires positions with three components');\n    }\n\n    for (j = 0; j < count; j += 1) {\n      index = j * stride + offset;\n\n      sourceDataArray[index] = sourceDataArray[index] * (Math.PI / 180.0);\n      sourceDataArray[index + 1] = sourceDataArray[index + 1] * (Math.PI / 180.0);\n\n      n = m_this.computeGeodeticSurfaceNormal(sourceDataArray[index + 1],\n                                            sourceDataArray[index]);\n      vec3.multiply(k, m_radiiSquared, n);\n      gamma = Math.sqrt(vec3.dot(n, k));\n      vec3.scale(k, k, 1 / gamma);\n      vec3.scale(n, n, sourceDataArray[index + 2]);\n      vec3.add(result, n, k);\n\n      sourceDataArray[index] = result[0];\n      sourceDataArray[index + 1] = result[1];\n      sourceDataArray[index + 2] = result[2];\n    }\n  };\n\n  return m_this;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * An Ellipsoid instance initialized to the WGS84 standard.\n * @memberof ellipsoid\n *\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid.WGS84 = vgl.freezeObject(\n  geo.ellipsoid(6378137.0, 6378137.0, 6356752.3142451793));\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * An Ellipsoid instance initialized to radii of (1.0, 1.0, 1.0).\n * @memberof ellipsoid\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid.UNIT_SPHERE = vgl.freezeObject(\n  geo.ellipsoid(1.0, 1.0, 1.0));\n","/** @namespace */\ngeo.mercator = {\n  r_major: 6378137.0  //Equatorial Radius, WGS84\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Returns the polar radius based on the projection.\n *\n * @param {Boolean} sperical\n * @returns {Number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.r_minor = function (spherical) {\n  'use strict';\n\n  var r_minor;\n\n  spherical = spherical !== undefined ? spherical : false;\n\n  if (spherical) {\n    r_minor = 6378137.0;\n  } else {\n    r_minor = 6356752.314245179;\n  }\n\n  return r_minor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * 1/f=(a-b)/a , a=r_major, b=r_minor\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.f = function (spherical) {\n  'use strict';\n\n  return (geo.mercator.r_major - geo.mercator.r_minor(spherical)) / geo.mercator.r_major;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert longitude (Degree) to Tile X\n *\n *  @param {float} lon\n *  @param {integer} z\n *  @returns {integer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.long2tilex = function (lon, z) {\n  'use strict';\n  var rad = (lon + 180.0) / 360.0,\n      f = Math.floor(rad * Math.pow(2.0, z));\n  return f;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latitude (Degree) to Tile Y\n *\n *  @param {float} lat\n *  @param {integer} z\n *  @returns {integer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2tiley = function (lat, z) {\n  'use strict';\n  var rad = lat * Math.PI / 180.0;\n  return Math.floor((1.0 - rad / Math.PI) / 2.0 * Math.pow(2.0, z));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Longitute (Degree) to Tile X and fraction.\n *\n *  @param {float} lon\n *  @param {integer} z\n *  @returns {number[]}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.long2tilex2 = function (lon, z) {\n  'use strict';\n  var rad = (lon + 180.0) / 360.0,\n      f = rad * Math.pow(2.0, z),\n      ret = Math.floor(f),\n      frac = f - ret;\n  return [ret, frac];\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Latitude (Degree) to Tile Y and fraction\n *\n *  @param {float} lat\n *  @param {integer} z\n *  @returns {number[]}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2tiley2 = function (lat, z) {\n  'use strict';\n  var rad = lat * Math.PI / 180.0,\n      f = (1.0 - Math.log(Math.tan(rad) + 1.0 / Math.cos(rad)) /\n           Math.PI) / 2.0 * Math.pow(2.0, z),\n      ret = Math.floor(f),\n      frac = f - ret;\n  return [ret, frac];\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Tile X to Longitute (Degree)\n *\n *  @param {integer} x\n *  @param {integer} z\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.tilex2long = function (x, z) {\n  'use strict';\n  return x / Math.pow(2.0, z) * 360.0 - 180.0;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Tile Y to Latitute (Degree)\n *\n *  @param {integer} y\n *  @param {integer} z\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.tiley2lat = function (y, z) {\n  'use strict';\n  var n = Math.PI - 2.0 * Math.PI * y / Math.pow(2.0, z);\n  return 180.0 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert spherical mercator Y to latitude\n *\n *  @param {float} a\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.y2lat = function (a) {\n  'use strict';\n  return 180 / Math.PI * (2 * Math.atan(Math.exp(a * Math.PI / 180)) - Math.PI / 2);\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latitude into Y position in spherical mercator\n *\n *  @param {float} a\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2y = function (a) {\n  'use strict';\n  return 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + a * (Math.PI / 180) / 2));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n *\n * @param {float} d\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.deg2rad = function (d) {\n  'use strict';\n  var r = d * (Math.PI / 180.0);\n  return r;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert radian to degree\n *\n * @param {float} r\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.rad2deg = function (r) {\n  'use strict';\n  var d = r / (Math.PI / 180.0);\n  return d;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latlon to mercator\n *\n * @param {float} lon\n * @param {float} lat\n * @returns {object}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.ll2m = function (lon, lat, spherical) {\n  'use strict';\n\n  if (lat > 89.5) {\n    lat = 89.5;\n  }\n\n  if (lat < -89.5) {\n    lat = -89.5;\n  }\n\n  var x = this.r_major * this.deg2rad(lon),\n      temp = this.r_minor(spherical) / this.r_major,\n      es = 1.0 - (temp * temp),\n      eccent = Math.sqrt(es),\n      phi = this.deg2rad(lat),\n      sinphi = Math.sin(phi),\n      con = eccent * sinphi,\n      com = 0.5 * eccent,\n      con2 = Math.pow((1.0 - con) / (1.0 + con), com),\n      ts = Math.tan(0.5 * (Math.PI * 0.5 - phi)) / con2,\n      y = -this.r_major * Math.log(ts),\n      ret = {'x': x, 'y': y};\n\n  return ret;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert mercator to lat lon\n *\n * @param {float} x\n * @param {float} y\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.m2ll = function (x, y, spherical) {\n  'use strict';\n  var lon = this.rad2deg((x / this.r_major)),\n      temp = this.r_minor(spherical) / this.r_major,\n      e = Math.sqrt(1.0 - (temp * temp)),\n      lat = this.rad2deg(this.pjPhi2(Math.exp(-(y / this.r_major)), e)),\n      ret = {'lon': lon, 'lat': lat};\n\n  return ret;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * pjPhi2\n *\n * @param {float} ts\n * @param {float} e\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.pjPhi2 = function (ts, e) {\n  'use strict';\n  var N_ITER = 15,\n      HALFPI = Math.PI / 2,\n      TOL = 0.0000000001,\n      con, dphi,\n      i = N_ITER,\n      eccnth = 0.5 * e,\n      Phi = HALFPI - 2.0 * Math.atan(ts);\n\n  do {\n    con = e * Math.sin(Phi);\n    dphi = HALFPI - 2.0 * Math.atan(ts * Math.pow(\n            (1.0 - con) / (1.0 + con), eccnth)) - Phi;\n    Phi += dphi;\n    i -= 1;\n  } while (Math.abs(dphi) > TOL && i);\n  return Phi;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of latlng\n *\n * A latlng encapsulates geodesy coordinates defined by latitude and\n * longitude (depreciated)\n *\n * @class\n * @returns {geo.latlng}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.latlng = function (arg1, arg2, arg3) {\n  \"use strict\";\n  if (!(this instanceof geo.latlng)) {\n    return new geo.latlng(arg1, arg2, arg3);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_lat = arg2 === undefined && arg3 === undefined ? arg1.lat() : arg1,\n      m_lng = arg2 === undefined && arg3 === undefined ? arg1.lng() : arg2,\n      m_elv = arg2 === undefined && arg3 === undefined ? arg1.elv() : arg3;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return latitude\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.lat = function (val) {\n    if (val === undefined) {\n      return m_lat;\n    } else {\n      m_lat = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return longitude\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.lng = function (val) {\n    if (val === undefined) {\n      return m_lng;\n    } else {\n      m_lng = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return elevation\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.elv = function (val) {\n    if (val === undefined) {\n      return m_elv;\n    } else {\n      m_elv = val;\n    }\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return x coordinate\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.x = function (val) {\n    if (val === undefined) {\n      return m_this.lng();\n    } else {\n      m_lng = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return y coordinate\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.y = function (val) {\n    if (val === undefined) {\n      return m_this.lat();\n    } else {\n      m_lat = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return z coordinate\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.z = function (val) {\n    if (val === undefined) {\n      return m_this.elv();\n    } else {\n      m_elv = val;\n    }\n  };\n\n\n  return this;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @class\n * @extends geo.sceneObject\n * @returns {geo.layer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.layer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.layer)) {\n    return new geo.layer(arg);\n  }\n  arg = arg || {};\n  geo.sceneObject.call(this, arg);\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_exit = this._exit,\n      m_style = arg.style === undefined ? {\"opacity\": 0.5,\n                                           \"color\": [0.8, 0.8, 0.8],\n                                           \"visible\": true,\n                                           \"bin\": 100} : arg.style,\n      m_id = arg.id === undefined ? geo.layer.newLayerId() : arg.id,\n      m_name = \"\",\n      m_gcs = \"EPSG:4326\",\n      m_timeRange = null,\n      m_source = arg.source || null,\n      m_map = arg.map === undefined ? null : arg.map,\n      m_isReference = false,\n      m_x = 0,\n      m_y = 0,\n      m_width = 0,\n      m_height = 0,\n      m_node = null,\n      m_canvas = null,\n      m_renderer = null,\n      m_initialized = false,\n      m_rendererName = arg.renderer  === undefined ? \"vgl\" : arg.renderer,\n      m_dataTime = geo.timestamp(),\n      m_updateTime = geo.timestamp(),\n      m_drawTime = geo.timestamp(),\n      m_sticky = arg.sticky === undefined ? true : arg.sticky,\n      m_active = arg.active === undefined ? true : arg.active;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get whether or not the layer is sticky (navigates with the map).\n   *\n   * @returns {Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sticky = function () {\n    return m_sticky;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get whether or not the layer is active.  An active layer will receive\n   * native mouse when the layer is on top.  Non-active layers will never\n   * receive native mouse events.\n   *\n   * @returns {Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.active = function () {\n    return m_active;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set root node of the layer\n   *\n   * @returns {div}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.node = function () {\n    return m_node;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set id of the layer\n   *\n   * @returns {String}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.id = function (val) {\n    if (val === undefined) {\n      return m_id;\n    }\n    m_id = geo.newLayerId();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set name of the layer\n   *\n   * @returns {String}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.name = function (val) {\n    if (val === undefined) {\n      return m_name;\n    }\n    m_name = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set opacity of the layer\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.opacity = function (val) {\n    if (val === undefined) {\n      return m_style.opacity;\n    }\n    m_style.opacity = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set visibility of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function (val) {\n    if (val === undefined) {\n      return m_style.visible;\n    }\n    m_style.visible = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set bin of the layer\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bin = function (val) {\n    if (val === undefined) {\n      return m_style.bin;\n    }\n    m_style.bin = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set projection of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (val) {\n    if (val === undefined) {\n      return m_gcs;\n    }\n    m_gcs = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform layer to the reference layer gcs\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transform = function (val) {\n    geo.transform.transformLayer(val, m_this, m_map.baseLayer());\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set time range of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.timeRange = function (val) {\n    if (val === undefined) {\n      return m_timeRange;\n    }\n    m_timeRange = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set source of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.source = function (val) {\n    if (val === undefined) {\n      return m_source;\n    }\n    m_source = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set map of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function (val) {\n    if (val === undefined) {\n      return m_map;\n    }\n    m_map = val;\n    m_map.node().append(m_node);\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get renderer for the layer if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderer = function () {\n    return m_renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas of the layer\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function () {\n    return m_canvas;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get viewport of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewport = function () {\n    return [m_x, m_y, m_width, m_height];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return last time data got changed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.dataTime = function () {\n    return m_dataTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the modified time for the last update that did something\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateTime = function () {\n    return m_updateTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the modified time for the last draw call that did something\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawTime = function () {\n    return m_drawTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Run query and return results for it\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.query = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set layer as the reference layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.referenceLayer = function (val) {\n    if (val !== undefined) {\n      m_isReference = val;\n      m_this.modified();\n      return m_this;\n    }\n    return m_isReference;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if the layer has been initialized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initialized = function (val) {\n    if (val !== undefined) {\n      m_initialized = val;\n      return m_this;\n    }\n    return m_initialized;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in GCS space to\n   * local space of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toLocal = function (input) {\n    return input;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in local space to\n   * latitude-longitude space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fromLocal = function (input) {\n    return input;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Init layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_initialized) {\n      return m_this;\n    }\n\n    // Create top level div for the layer\n    m_node = $(document.createElement(\"div\"));\n    m_node.attr(\"id\", m_name);\n    // TODO: need to position according to offsets from the map element\n    //       and maybe respond to events in case the map element moves\n    //       around the page.\n    m_node.css(\"position\", \"absolute\");\n\n    if (m_map) {\n      m_map.node().append(m_node);\n\n    }\n\n    // Share context if have valid one\n    if (m_canvas) {\n      m_renderer = geo.createRenderer(m_rendererName, m_this, m_canvas);\n    } else {\n      m_renderer = geo.createRenderer(m_rendererName, m_this);\n      m_canvas = m_renderer.canvas();\n    }\n\n    if (!m_this.active()) {\n      m_node.css(\"pointerEvents\", \"none\");\n    }\n\n    m_initialized = true;\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clean up resouces\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_renderer._exit();\n    m_node.off();\n    m_node.remove();\n    m_node = null;\n    arg = {};\n    m_canvas = null;\n    m_renderer = null;\n    s_exit();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Respond to resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    m_x = x;\n    m_y = y;\n    m_width = w;\n    m_height = h;\n    m_node.width(w);\n    m_node.height(h);\n\n    m_this.modified();\n    m_this.geoTrigger(geo.event.resize,\n      {x: x, y: y, width: m_width, height: m_height});\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the width of the layer in pixels\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function () {\n    return m_width;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the height of the layer in pixels\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function () {\n    return m_height;\n  };\n\n  return this;\n};\n\n/**\n * Gets a new id number for a layer.\n * @protected\n * @instance\n * @returns {number}\n */\ngeo.layer.newLayerId = (function () {\n    \"use strict\";\n    var currentId = 1;\n    return function () {\n      var id = currentId;\n      currentId += 1;\n      return id;\n    };\n  }()\n);\n\n/**\n * General object specification for feature types.\n * @typedef geo.layer.spec\n * @type {object}\n * @property {string} [type=\"feature\"] For feature compatibility\n * with more than one kind of creatable layer\n * @property {object[]} [data=[]] The default data array to\n * apply to each feature if none exists\n * @property {string} [renderer=\"vgl\"] The renderer to use\n * @property {geo.feature.spec[]} [features=[]] Features\n * to add to the layer\n */\n\n/**\n * Create a layer from an object.  Any errors in the creation\n * of the layer will result in returning null.\n * @param {geo.map} map The map to add the layer to\n * @param {geo.layer.spec} spec The object specification\n * @returns {geo.layer|null}\n */\ngeo.layer.create = function (map, spec) {\n  \"use strict\";\n\n  spec = spec || {};\n\n  // add osmLayer later\n  spec.type = \"feature\";\n  if (spec.type !== \"feature\") {\n    console.warn(\"Unsupported layer type\");\n    return null;\n  }\n\n  spec.renderer = spec.renderer || \"vgl\";\n  if (spec.renderer !== \"d3\" && spec.renderer !== \"vgl\") {\n    console.warn(\"Invalid renderer\");\n    return null;\n  }\n\n  var layer = map.createLayer(spec.type, spec);\n  if (!layer) {\n    console.warn(\"Unable to create a layer\");\n    return null;\n  }\n\n  // probably move this down to featureLayer eventually\n  spec.features.forEach(function (f) {\n    f.data = f.data || spec.data;\n    f.feature = geo.feature.create(layer, f);\n  });\n\n  return layer;\n};\n\ninherit(geo.layer, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Layer to draw points, lines, and polygons on the map The polydata layer\n * provide mechanisms to create and draw geometrical shapes such as points,\n * lines, and polygons.\n * @class\n * @extends geo.layer\n * @returns {geo.featureLayer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.featureLayer = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.featureLayer)) {\n    return new geo.featureLayer(arg);\n  }\n  geo.layer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_features = [],\n      s_init = this._init,\n      s_exit = this._exit,\n      s_update = this._update,\n      s_draw = this.draw;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create feature give a name\n   *\n   * @returns {geo.Feature} Will return a new feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createFeature = function (featureName, arg) {\n\n    var newFeature = geo.createFeature(\n      featureName, m_this, m_this.renderer(), arg);\n\n    m_this.addChild(newFeature);\n    m_features.push(newFeature);\n    m_this.features(m_features);\n    m_this.modified();\n    return newFeature;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete feature\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteFeature = function (feature) {\n    var i;\n\n    for (i = 0; i < m_features.length; i += 1) {\n      if (m_features[i] === feature) {\n        m_features[i]._exit();\n        m_this.dataTime().modified();\n        m_this.modified();\n        m_features.splice(i, 1);\n      }\n    }\n    m_this.removeChild(feature);\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set drawables\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.features = function (val) {\n    if (val === undefined) {\n      return m_features;\n    } else {\n      m_features = val.slice(0);\n      m_this.dataTime().modified();\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Do not call parent _init method as its already been executed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_this.initialized()) {\n      return m_this;\n    }\n\n    /// Call super class init\n    s_init.call(m_this);\n\n    /// Bind events to handlers\n    m_this.geoOn(geo.event.resize, function (event) {\n      m_this.renderer()._resize(event.x, event.y, event.width, event.height);\n      m_this._update({});\n      m_this.renderer()._render();\n    });\n\n    m_this.geoOn(geo.event.pan, function (event) {\n      m_this._update({event: event});\n      m_this.renderer()._render();\n    });\n\n    m_this.geoOn(geo.event.zoom, function (event) {\n      m_this._update({event: event});\n      m_this.renderer()._render();\n    });\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    var i;\n\n    if (!m_features.length) {\n      return m_this;\n    }\n\n    /// Call base class update\n    s_update.call(m_this, request);\n\n    if (!m_this.source() && m_features && m_features.length === 0) {\n      console.log(\"[info] No valid data source found.\");\n      return;\n    }\n\n    if (m_this.dataTime().getMTime() > m_this.updateTime().getMTime()) {\n      for (i = 0; i < m_features.length; i += 1) {\n        m_features[i].renderer(m_this.renderer());\n      }\n    }\n\n    for (i = 0; i < m_features.length; i += 1) {\n      m_features[i]._update();\n    }\n\n    m_this.updateTime().modified();\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Free all resources\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.clear();\n    s_exit();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Draw\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    // Call sceneObject.draw, which calls draw on all child objects.\n    s_draw();\n\n    // Now call render on the renderer. In certain cases it may not do\n    // anything if the if the child objects are drawn on the screen already.\n    m_this.renderer()._render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear all features in layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clear = function () {\n    var i;\n\n    if (!m_features.length) {\n      return m_this;\n    }\n\n    for (i = 0; i < m_features.length; i += 1) {\n      m_features[i]._exit();\n      m_this.removeChild(m_features[i]);\n    }\n\n    m_this.dataTime().modified();\n    m_this.modified();\n    m_features = [];\n\n    return m_this;\n  };\n\n  return m_this;\n};\n\ninherit(geo.featureLayer, geo.layer);\n\n// Now register it\ngeo.registerLayer(\"feature\", geo.featureLayer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Common object containing all event types that are provided by the GeoJS\n * API.  Each property contained here is a valid target for event handling\n * via {@link geo.object#geoOn}.  The event object provided to handlers is\n * different for each event type.  Each handler will generally be called\n * with a the <code>this</code> context being the class that caused the event.<br>\n * <br>\n * The following properties are common to all event objects:\n *\n * @namespace\n * @property type {string} The event type that was triggered\n * @property geo {object} A universal event object for controlling propagation\n *\n * @example\n * map.geoOn(geo.event.layerAdd, function (event) {\n *   // event is an object with type: {@link geo.event.layerAdd}\n * });\n *\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event = {};\n\n//////////////////////////////////////////////////////////////////////////////\n/*\n * Event types\n */\n//////////////////////////////////////////////////////////////////////////////\n\n// The following were not triggered nor used anywhere.  Removing until their\n// purpose is defined more clearly.\n//\n// geo.event.update = \"geo_update\";\n// geo.event.opacityUpdate = \"geo_opacityUpdate\";\n// geo.event.layerToggle = \"geo_layerToggle\";\n// geo.event.layerSelect = \"geo_layerSelect\";\n// geo.event.layerUnselect = \"geo_layerUnselect\";\n// geo.event.rotate = \"geo_rotate\";\n// geo.event.query = \"geo_query\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when a layer is added to the map.\n *\n * @property target {geo.map} The current map\n * @property layer {geo.layer} The new layer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.layerAdd = \"geo_layerAdd\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when a layer is removed from the map.\n *\n * @property target {geo.map} The current map\n * @property layer {geo.layer} The old layer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.layerRemove = \"geo_layerRemove\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when the map's zoom level is changed.  Note that zoom is never\n * triggered on the map itself.  Instead it is triggered individually on\n * layers, starting with the base layer.\n *\n * @property zoomLevel {Number} New zoom level\n * @property screenPosition {object} The screen position of mouse pointer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.zoom = \"geo_zoom\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when the map is panned either by user interaction or map\n * transition.\n *\n * @property screenDelta {object} The number of pixels to pan the map by\n * @property center {object} The new map center\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.pan = \"geo_pan\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when the map's canvas is resized.\n *\n * @property width {Number} The new width in pixels\n * @property height {Number} The new height in pixels\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.resize = \"geo_resize\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered on every call to {@link geo.map#draw} before the map is rendered.\n *\n * @property target {geo.map} The current map\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.draw = \"geo_draw\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered on every call to {@link geo.map#draw} after the map is rendered.\n *\n * @property target {geo.map} The current map\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.drawEnd = \"geo_drawEnd\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered on every \"mousemove\" over the map's DOM element.  The event\n * object extends {@link geo.mouseState}.\n * @mixes geo.mouseState\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.mousemove = \"geo_mousemove\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered on every \"mousedown\" over the map's DOM element.  The event\n * object extends {@link geo.mouseState}.\n * @mixes geo.mouseState\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.mouseclick = \"geo_mouseclick\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered on every \"mousemove\" during a brushing selection.\n * The event object extends {@link geo.brushSelection}.\n * @mixes geo.brushSelection\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.brush = \"geo_brush\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered after a brush selection ends.\n * The event object extends {@link geo.brushSelection}.\n * @mixes geo.brushSelection\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.brushend = \"geo_brushend\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered when a brush selection starts.\n * The event object extends {@link geo.brushSelection}.\n * @mixes geo.brushSelection\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.brushstart = \"geo_brushstart\";\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered before a map navigation animation begins.  Set\n * <code>event.geo.cancelAnimation</code> to cancel the animation\n * of the navigation.  This will cause the map to navigate to the\n * target location immediately.  Set <code>event.geo.cancelNavigation</code>\n * to cancel the navigation completely.  The transition options can\n * be modified in place.\n *\n * @property {geo.geoPosition} center The target center\n * @property {Number} zoom The target zoom level\n * @property {Number} duration The duration of the transition in milliseconds\n * @property {function} ease The easing function\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.transitionstart = \"geo_transitionstart\";\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Triggered after a map navigation animation ends.\n *\n * @property {geo.geoPosition} center The target center\n * @property {Number} zoom The target zoom level\n * @property {Number} duration The duration of the transition in milliseconds\n * @property {function} ease The easing function\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.event.transitionend = \"geo_transitionend\";\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * @namespace\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.event.clock = {\n  play: \"geo_clock_play\",\n  stop: \"geo_clock_stop\",\n  pause: \"geo_clock_pause\",\n  change: \"geo_clock_change\"\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * This event object provides mouse/keyboard events that can be handled\n * by the features.  This provides a similar interface as core events,\n * but with different names so the events don't interfere.  Subclasses\n * can override this to provide custom events.\n *\n * These events will only be triggered on features which were instantiated\n * with the option \"selectionAPI\".\n * @namespace\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.event.feature = {\n  mousemove:  \"geo_feature_mousemove\",\n  mouseover:  \"geo_feature_mouseover\",\n  mouseout:   \"geo_feature_mouseout\",\n  mouseon:    \"geo_feature_mouseon\",\n  mouseoff:   \"geo_feature_mouseoff\",\n  mouseclick: \"geo_feature_mouseclick\",\n  brushend:   \"geo_feature_brushend\",\n  brush:      \"geo_feature_brush\"\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of mapInteractor\n *\n * @class\n * @extends geo.object\n * @returns {geo.mapInteractor}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mapInteractor = function (args) {\n  'use strict';\n  if (!(this instanceof geo.mapInteractor)) {\n    return new geo.mapInteractor(args);\n  }\n  geo.object.call(this);\n\n  var m_options = args || {},\n      m_this = this,\n      m_mouse,\n      m_keyboard,\n      m_state,\n      $node,\n      m_wheelQueue = { x: 0, y: 0 },\n      m_throttleTime = 10,\n      m_wait = false,\n      m_disableThrottle = true,\n      m_selectionLayer = null,\n      m_selectionPlane = null;\n\n  // Helper method to decide if the current button/modifiers match a set of\n  // conditions.\n  // button: 'left' | 'right' | 'middle'\n  // modifiers: [ 'alt' | 'meta' | 'ctrl' | 'shift' ]\n  function eventMatch(button, modifiers) {\n    /* jshint -W018 */\n    return (button === 'wheel' || m_mouse.buttons[button]) &&\n      (!!m_mouse.modifiers.alt)   === (!!modifiers.alt)   &&\n      (!!m_mouse.modifiers.meta)  === (!!modifiers.meta)  &&\n      (!!m_mouse.modifiers.shift) === (!!modifiers.shift) &&\n      (!!m_mouse.modifiers.ctrl)  === (!!modifiers.ctrl);\n    /* jshint +W018 */\n  }\n\n  // Helper method to calculate the speed from a velocity\n  function calcSpeed(v) {\n    var x = v.x, y = v.y;\n    return Math.sqrt(x * x + y * y);\n  }\n\n  // For throttling mouse events this is a function that\n  // returns true if no actions are in progress and starts\n  // a timer to block events for the next `m_throttleTime` ms.\n  // If it returns false, the caller should ignore the\n  // event.\n  function doRespond() {\n    if (m_disableThrottle) {\n      return true;\n    }\n    if (m_wait) {\n      return false;\n    }\n    m_wait = true;\n    window.setTimeout(function () {\n      m_wait = false;\n      m_wheelQueue = {\n        x: 0,\n        y: 0\n      };\n    }, m_throttleTime);\n    return true;\n  }\n\n  // copy the options object with defaults\n  m_options = $.extend(\n    true,\n    {\n      panMoveButton: 'left',\n      panMoveModifiers: {},\n      zoomMoveButton: 'right',\n      zoomMoveModifiers: {},\n      panWheelEnabled: false,\n      panWheelModifiers: {},\n      zoomWheelEnabled: true,\n      zoomWheelModifiers: {},\n      wheelScaleX: 1,\n      wheelScaleY: 1,\n      zoomScale: 1,\n      selectionButton: 'left',\n      selectionModifiers: {'shift': true},\n      momentum: {\n        enabled: true,\n        maxSpeed: 2.5,\n        minSpeed: 0.01,\n        drag: 0.01\n      },\n      spring: {\n        enabled: false,\n        springConstant: 0.00005\n      }\n    },\n    m_options\n  );\n\n  // options supported:\n  // {\n  //   // button that must be pressed to initiate a pan on mousedown\n  //   panMoveButton: 'right' | 'left' | 'middle'\n  //\n  //   // modifier keys that must be pressed to initiate a pan on mousemove\n  //   panMoveModifiers: { 'ctrl' | 'alt' | 'meta' | 'shift' }\n  //\n  //   // button that must be pressed to initiate a zoom on mousedown\n  //   zoomMoveButton: 'right' | 'left' | 'middle'\n  //\n  //   // modifier keys that must be pressed to initiate a zoom on mousemove\n  //   zoomMoveModifiers: { 'ctrl' | 'alt' | 'meta' | 'shift' }\n  //\n  //   // enable or disable panning with the mouse wheel\n  //   panWheelEnabled: true | false\n  //\n  //   // modifier keys that must be pressed to trigger a pan on wheel\n  //   panWheelModifiers: {...}\n  //\n  //   // enable or disable zooming with the mouse wheel\n  //   zoomWheelEnabled: true | false\n  //\n  //   // modifier keys that must be pressed to trigger a zoom on wheel\n  //   zoomWheelModifiers: {...}\n  //\n  //   // wheel scale factor to change the magnitude of wheel interactions\n  //   wheelScaleX: 1\n  //   wheelScaleY: 1\n  //\n  //   // zoom scale factor to change the magnitude of zoom move interactions\n  //   zoomScale: 1\n  //\n  //   // button that must be pressed to enable drag selection\n  //    selectionButton: 'right' | 'left' | 'middle'\n  //\n  //   // keyboard modifiers that must be pressed to initiate a selection\n  //   selectionModifiers: {...}\n  //\n  //   // enable momentum when panning\n  //   momentum: {\n  //     enabled: true | false,\n  //     drag: number, // drag coefficient\n  //     maxSpeed: number, // don't allow animation to pan faster than this\n  //     minSpeed: number  // stop animations if the speed is less than this\n  //   }\n  //\n  //   // enable spring clamping to screen edges to enforce clamping\n  //   spring: {\n  //     enabled: true | false,\n  //     springConstant: number,\n  //   }\n  // }\n\n  // A bunch of type definitions for api documentation:\n  /**\n   * General representation of rectangular bounds in world coordinates\n   * @typedef geo.geoBounds\n   * @type {object}\n   * @property {geo.geoPosition} upperLeft Upper left corner\n   * @property {geo.geoPosition} upperRight Upper right corner\n   * @property {geo.geoPosition} lowerLeft Lower left corner\n   * @property {geo.geoPosition} lowerRight Lower right corner\n   */\n\n  /**\n   * General representation of rectangular bounds in pixel coordinates\n   * @typedef geo.screenBounds\n   * @type {object}\n   * @property {geo.screenPosition} upperLeft Upper left corner\n   * @property {geo.screenPosition} upperRight Upper right corner\n   * @property {geo.screenPosition} lowerLeft Lower left corner\n   * @property {geo.screenPosition} lowerRight Lower right corner\n   */\n\n  /**\n   * General representation of a point on the screen.\n   * @typedef geo.screenPosition\n   * @type {object}\n   * @property {Number} x Horizontal coordinate in pixels\n   * @property {Number} y Vertical coordinate in pixels\n   */\n\n  /**\n   * General represention of a point on the earth.\n   * @typedef geo.geoPosition\n   * @type {object}\n   * @property {Number} x Horizontal coordinate in degrees longitude\n   * @property {Number} y Vertical coordinate in degrees latitude\n   */\n\n  /**\n   * The status of all mouse buttons.\n   * @typedef geo.mouseButtons\n   * @type {object}\n   * @property {true|false} left The left mouse button\n   * @property {true|false} right The right mouse button\n   * @property {true|false} middle The middle mouse button\n   */\n\n  /**\n   * The status of all modifier keys these are copied from the\n   * standard DOM events.\n   * @typedef geo.modifierKeys\n   * @type {object}\n   * @property {true|false} alt <code>Event.alt</code>\n   * @property {true|false} ctrl <code>Event.ctrl</code>\n   * @property {true|false} shift <code>Event.shift</code>\n   * @property {true|false} meta <code>Event.meta</code>\n   */\n\n  /**\n   * Provides information about the state of the mouse\n   * @typedef geo.mouseState\n   * @type {object}\n   * @property {geo.screenPosition} page Mouse location in pixel space\n   * @property {geo.geoPosition} map Mouse location in world space\n   * @property {geo.mouseButtons} buttons The current state of the mouse buttons\n   * @property {geo.modifierKeys} modifiers The current state of all modifier keys\n   * @property {Date} time The timestamp the event took place\n   * @property {Number} deltaTime The time in milliseconds since the last mouse event\n   * @property {geo.screenPosition} velocity The velocity of the mouse pointer\n   * in pixels per second\n   */\n\n  /**\n   * @typedef geo.brushSelection\n   * @type {object}\n   * @property {geo.screenBounds} display The selection bounds in pixel space\n   * @property {geo.geoBounds} gcs The selection bounds in world space\n   * @property {geo.mouseState} mouse The current mouse state\n   * @property {geo.mouseState} origin The mouse state at the start of the\n   * brush action\n   */\n\n\n  // default mouse object\n  m_mouse = {\n    page: { // mouse position relative to the page\n      x: 0,\n      y: 0\n    },\n    map: { // mouse position relative to the map\n      x: 0,\n      y: 0\n    },\n    // mouse button status\n    buttons: {\n      left: false,\n      right: false,\n      middle: false\n    },\n    // keyboard modifier status\n    modifiers: {\n      alt: false,\n      ctrl: false,\n      shift: false,\n      meta: false\n    },\n    // time the event was captured\n    time: new Date(),\n    // time elapsed since the last mouse event\n    deltaTime: 1,\n    // pixels/ms\n    velocity: {\n      x: 0,\n      y: 0\n    }\n  };\n\n  // default keyboard object\n  // (keyboard events not implemented yet)\n  m_keyboard = {\n  };\n\n  // The interactor state determines what actions are taken in response to\n  // core browser events.\n  //\n  // i.e.\n  // {\n  //    'action': 'pan',      // an ongoing pan event\n  //    'origin': {...},      // mouse object at the start of the action\n  //    'delta': {x: *, y: *} // mouse movement since action start\n  //                          // not including the current event\n  //  }\n  //\n  //  {\n  //    'action': 'zoom',  // an ongoing zoom event\n  //    ...\n  //  }\n  //\n  //  {\n  //    'acton': 'select',\n  //    'origin': {...},\n  //    'delta': {x: *, y: *}\n  //  }\n  //\n  //  {\n  //    'action': 'momentum',\n  //    'origin': {...},\n  //    'handler': function () { }, // called in animation loop\n  //    'timer': animate loop timer\n  //  }\n  m_state = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connects events to a map.  If the map is not set, then this does nothing.\n   * @returns {geo.mapInteractor}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._connectEvents = function () {\n    if (!m_options.map) {\n      return m_this;\n    }\n\n    // prevent double binding to dom elements\n    m_this._disconnectEvents();\n\n    // store the connected element\n    $node = $(m_options.map.node());\n\n\n    // add event handlers\n    $node.on('mousemove.geojs', m_this._handleMouseMove);\n    $node.on('mousedown.geojs', m_this._handleMouseDown);\n    $node.on('mouseup.geojs', m_this._handleMouseUp);\n    $node.on('mousewheel.geojs', m_this._handleMouseWheel);\n    if (m_options.panMoveButton === 'right' ||\n        m_options.zoomMoveButton === 'right') {\n      $node.on('contextmenu.geojs', function () { return false; });\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Disonnects events to a map.  If the map is not set, then this does nothing.\n   * @returns {geo.mapInteractor}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._disconnectEvents = function () {\n    if ($node) {\n      $node.off('.geojs');\n      $node = null;\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets map for this interactor, adds draw region layer if needed\n   *\n   * @param {geo.map} newMap optional\n   * @returns {geo.interactorStyle|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function (val) {\n    if (val !== undefined) {\n      m_options.map = val;\n      m_this._connectEvents();\n      return m_this;\n    }\n    return m_options.map;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Gets/sets the options object for the interactor.\n   *\n   * @param {Object} opts optional\n   * @returns {geo.interactorStyle|Object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.options = function (opts) {\n    if (opts === undefined) {\n      return $.extend({}, m_options);\n    }\n    $.extend(m_options, opts);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Stores the current mouse position from an event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getMousePosition = function (evt) {\n    var offset = $node.offset(), dt, t;\n\n    t = (new Date()).valueOf();\n    dt = t - m_mouse.time;\n    m_mouse.time = t;\n    m_mouse.deltaTime = dt;\n    m_mouse.velocity = {\n      x: (evt.pageX - m_mouse.page.x) / dt,\n      y: (evt.pageY - m_mouse.page.y) / dt\n    };\n    m_mouse.page = {\n      x: evt.pageX,\n      y: evt.pageY\n    };\n    m_mouse.map = {\n      x: evt.pageX - offset.left,\n      y: evt.pageY - offset.top\n    };\n    try {\n      m_mouse.geo = m_this.map().displayToGcs(m_mouse.map);\n    } catch (e) {\n      // catch georeferencing problems and move on\n      // needed for handling the map before the base layer\n      // is attached\n      m_mouse.geo = null;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Stores the current mouse button\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getMouseButton = function (evt) {\n    if (evt.which === 1) {\n      m_mouse.buttons.left = evt.type !== 'mouseup';\n    } else if (evt.which === 3) {\n      m_mouse.buttons.right = evt.type !== 'mouseup';\n    } else if (evt.which === 2) {\n      m_mouse.buttons.middle = evt.type !== 'mouseup';\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Stores the current keyboard modifiers\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getMouseModifiers = function (evt) {\n    m_mouse.modifiers.alt = evt.altKey;\n    m_mouse.modifiers.ctrl = evt.ctrlKey;\n    m_mouse.modifiers.meta = evt.metaKey;\n    m_mouse.modifiers.shift = evt.shiftKey;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute a selection information object.\n   * @private\n   * @returns {Object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getSelection = function () {\n    var origin = m_state.origin,\n        mouse = m_this.mouse(),\n        map = m_this.map(),\n        display = {}, gcs = {};\n\n    // TODO: clamp to map bounds\n    // Get the display coordinates\n    display.upperLeft = {\n      x: Math.min(origin.map.x, mouse.map.x),\n      y: Math.min(origin.map.y, mouse.map.y)\n    };\n\n    display.lowerRight = {\n      x: Math.max(origin.map.x, mouse.map.x),\n      y: Math.max(origin.map.y, mouse.map.y)\n    };\n\n    display.upperRight = {\n      x: display.lowerRight.x,\n      y: display.upperLeft.y\n    };\n\n    display.lowerLeft = {\n      x: display.upperLeft.x,\n      y: display.lowerRight.y\n    };\n\n    // Get the gcs coordinates\n    gcs.upperLeft = map.displayToGcs(display.upperLeft);\n    gcs.lowerRight = map.displayToGcs(display.lowerRight);\n    gcs.upperRight = map.displayToGcs(display.upperRight);\n    gcs.lowerLeft = map.displayToGcs(display.lowerLeft);\n\n    m_selectionPlane.origin([\n      display.lowerLeft.x,\n      display.lowerLeft.y,\n      0\n    ]);\n    m_selectionPlane.upperLeft([\n      display.upperLeft.x,\n      display.upperLeft.y,\n      0\n    ]);\n    m_selectionPlane.lowerRight([\n      display.lowerRight.x,\n      display.lowerRight.y,\n      0\n    ]);\n    m_selectionPlane.draw();\n\n    return {\n      display: display,\n      gcs: gcs,\n      mouse: mouse,\n      origin: $.extend({}, m_state.origin)\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Immediately cancel an ongoing action.\n   *\n   * @param {string?} action The action type, if null cancel any action\n   * @returns {bool} If an action was canceled\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.cancel = function (action) {\n    var out;\n    if (!action) {\n      out = !!m_state.action;\n    } else {\n      out = m_state.action === action;\n    }\n    if (out) {\n      m_state = {};\n    }\n    return out;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle event when a mouse button is pressed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseDown = function (evt) {\n    var action = null;\n\n    if (m_state.action === 'momentum') {\n      // cancel momentum on click\n      m_state = {};\n    }\n\n    m_this._getMousePosition(evt);\n    m_this._getMouseButton(evt);\n    m_this._getMouseModifiers(evt);\n\n    if (eventMatch(m_options.panMoveButton, m_options.panMoveModifiers)) {\n      action = 'pan';\n    } else if (eventMatch(m_options.zoomMoveButton, m_options.zoomMoveModifiers)) {\n      action = 'zoom';\n    } else if (eventMatch(m_options.selectionButton, m_options.selectionModifiers)) {\n      action = 'select';\n    }\n\n    m_mouse.velocity = {\n      x: 0,\n      y: 0\n    };\n\n    if (action) {\n      // store the state object\n      m_state = {\n        action: action,\n        origin: $.extend(true, {}, m_mouse),\n        delta: {x: 0, y: 0}\n      };\n\n      if (action === 'select') {\n        // Make sure the old selection layer is gone.\n        if (m_selectionLayer) {\n          m_selectionLayer.clear();\n          m_this.map().deleteLayer(m_selectionLayer);\n          m_selectionLayer = null;\n        }\n        // Create a feature layer and plane feature to show the selection bounds\n        m_selectionLayer = m_this.map().createLayer('feature', {renderer: 'd3'});\n        m_selectionPlane = m_selectionLayer.createFeature('plane');\n        m_selectionPlane.style({\n          screenCoordinates: true,\n          fillOpacity: function () { return 0.25; }\n        });\n        m_this.map().geoTrigger(geo.event.brushstart, m_this._getSelection());\n      }\n\n      // bind temporary handlers to document\n      $(document).on('mousemove.geojs', m_this._handleMouseMoveDocument);\n      $(document).on('mouseup.geojs', m_this._handleMouseUpDocument);\n    }\n\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseMove = function (evt) {\n    if (m_state.action) {\n      // If currently performing a navigation action, the mouse\n      // coordinates will be captured by the document handler.\n      return;\n    }\n    m_this._getMousePosition(evt);\n    m_this._getMouseButton(evt);\n    m_this._getMouseModifiers(evt);\n    m_this.map().geoTrigger(geo.event.mousemove, m_this.mouse());\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event on the document (temporary bindings)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseMoveDocument = function (evt) {\n    var dx, dy, selectionObj;\n    m_this._getMousePosition(evt);\n    m_this._getMouseButton(evt);\n    m_this._getMouseModifiers(evt);\n\n    if (!m_state.action) {\n      // This shouldn't happen\n      console.log('WARNING: Invalid state in mapInteractor.');\n      return;\n    }\n\n    // when throttled, do nothing\n    if (!doRespond()) {\n      return;\n    }\n\n    // calculate the delta from the origin point to avoid\n    // accumulation of floating point errors\n    dx = m_mouse.map.x - m_state.origin.map.x - m_state.delta.x;\n    dy = m_mouse.map.y - m_state.origin.map.y - m_state.delta.y;\n    m_state.delta.x += dx;\n    m_state.delta.y += dy;\n\n    if (m_state.action === 'pan') {\n      m_this.map().pan({x: dx, y: dy});\n    } else if (m_state.action === 'zoom') {\n      m_this.map().zoom(\n        m_this.map().zoom() - dy * m_options.zoomScale / 120\n      );\n    } else if (m_state.action === 'select') {\n      // Get the bounds of the current selection\n      selectionObj = m_this._getSelection();\n      m_this.map().geoTrigger(geo.event.brush, selectionObj);\n    }\n\n    // Prevent default to stop text selection in particular\n    evt.preventDefault();\n  };\n\n  /**\n   * Use interactor options to modify the mouse velocity by momentum\n   * or spring equations depending on the current map state.\n   * @private\n   * @param {object} v Current velocity in pixels / ms\n   * @param {number} deltaT The time delta\n   * @returns {object} New velocity\n   */\n  function modifyVelocity(v, deltaT) {\n    deltaT = deltaT <= 0 ? 30 : deltaT;\n    var sf = springForce();\n    var speed = calcSpeed(v);\n    var vx = v.x / speed;\n    var vy = v.y / speed;\n\n    speed = speed * Math.exp(-m_options.momentum.drag * deltaT);\n\n    // |force| + |velocity| < c <- stopping condition\n    if (calcSpeed(sf) * deltaT + speed < m_options.momentum.minSpeed) {\n      return null;\n    }\n\n    if (speed > 0) {\n      vx = vx * speed;\n      vy = vy * speed;\n    } else {\n      vx = 0;\n      vy = 0;\n    }\n\n    return {\n      x: vx - sf.x * deltaT,\n      y: vy - sf.y * deltaT\n    };\n  }\n\n  /**\n   * Get the spring force for the current map bounds\n   * (This method might need to move elsewhere to deal\n   * with different projections)\n   * @private\n   * @returns {object} The spring force\n   */\n  function springForce() {\n    var xplus,  // force to the right\n        xminus, // force to the left\n        yplus,  // force to the top\n        yminus; // force to the bottom\n\n    if (!m_options.spring.enabled) {\n      return {x: 0, y: 0};\n    }\n    // get screen coordinates of corners\n    var ul = m_this.map().gcsToDisplay({\n      x: -180,\n      y: 82\n    });\n    var lr = m_this.map().gcsToDisplay({\n      x: 180,\n      y: -82\n    });\n\n    var c = m_options.spring.springConstant;\n    // Arg... map needs to expose the canvas size\n    var width = m_this.map().node().width();\n    var height = m_this.map().node().height();\n\n    xplus = c * Math.max(0, ul.x);\n    xminus = c * Math.max(0, width - lr.x);\n    yplus = c * Math.max(0, ul.y) / 2;\n    yminus = c * Math.max(0, height - lr.y) / 2;\n\n    return {\n      x: xplus - xminus,\n      y: yplus - yminus\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle event when a mouse button is unpressed on the document.\n   * Removes temporary bindings.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseUpDocument = function (evt) {\n    var selectionObj, oldAction;\n\n    m_this._getMouseButton(evt);\n    m_this._getMouseModifiers(evt);\n\n    // unbind temporary handlers on document\n    $(document).off('.geojs');\n\n    if (m_mouse.buttons.right) {\n      evt.preventDefault();\n    }\n\n    if (m_state.action === 'select') {\n      selectionObj = m_this._getSelection();\n\n      m_selectionLayer.clear();\n      m_this.map().deleteLayer(m_selectionLayer);\n      m_selectionLayer = null;\n      m_selectionPlane = null;\n\n      m_this.map().geoTrigger(geo.event.brushend, selectionObj);\n    }\n\n    // reset the interactor state\n    oldAction = m_state.action;\n    m_state = {};\n\n    // if momentum is enabled, start the action here\n    if (m_options.momentum.enabled && oldAction === 'pan') {\n      m_this.springBack(true);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle event when a mouse button is unpressed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseUp = function (evt) {\n    m_this._getMouseButton(evt);\n    m_this._getMouseModifiers(evt);\n\n    // fire a click event here\n    m_this.map().geoTrigger(geo.event.mouseclick, m_this.mouse());\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseWheel = function (evt) {\n    var zoomFactor, direction;\n\n    // In case jquery-mousewheel isn't loaded for some reason\n    evt.deltaFactor = evt.deltaFactor || 1;\n\n    m_this._getMouseModifiers(evt);\n    evt.deltaX = evt.deltaX * m_options.wheelScaleX * evt.deltaFactor / 120;\n    evt.deltaY = evt.deltaY * m_options.wheelScaleY * evt.deltaFactor / 120;\n\n    evt.preventDefault();\n    if (!doRespond()) {\n      m_wheelQueue.x += evt.deltaX;\n      m_wheelQueue.y += evt.deltaY;\n      return;\n    }\n\n    evt.deltaX += m_wheelQueue.x;\n    evt.deltaY += m_wheelQueue.y;\n\n    m_wheelQueue = {\n      x: 0,\n      y: 0\n    };\n\n    if (m_options.panWheelEnabled &&\n        eventMatch('wheel', m_options.panWheelModifiers)) {\n\n      m_this.map().pan({\n        x: evt.deltaX,\n        y: evt.deltaY\n      });\n\n    } else if (m_options.zoomWheelEnabled &&\n               eventMatch('wheel', m_options.zoomWheelModifiers)) {\n\n      zoomFactor = evt.deltaY;\n      direction = m_mouse.map;\n\n      m_this.map().zoom(\n        m_this.map().zoom() + zoomFactor,\n        direction\n      );\n    }\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Start up a spring back action when the map bounds are out of range.\n   * Not to be user callable.\n   * @todo Move this and momentum handling to the map class\n   * @protected\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.springBack = function (initialVelocity) {\n    if (m_state.action === 'momentum') {\n      return;\n    }\n    if (!initialVelocity) {\n      m_mouse.velocity = {\n        x: 0,\n        y: 0\n      };\n    }\n    m_state.action = 'momentum';\n    m_state.origin = m_this.mouse();\n    m_state.start = new Date();\n    m_state.handler = function () {\n      var v, s, last, dt;\n\n      // Not sure the correct way to do this.  We need the delta t for the\n      // next time step...  Maybe use a better interpolator and the time\n      // parameter from requestAnimationFrame.\n      dt = Math.min(m_mouse.deltaTime, 30);\n      if (m_state.action !== 'momentum' ||\n          !m_this.map() ||\n          m_this.map().transition()) {\n        // cancel if a new action was performed\n        return;\n      }\n\n      last = m_state.start.valueOf();\n      m_state.start = new Date();\n\n      v = modifyVelocity(m_mouse.velocity, m_state.start - last);\n\n      // stop panning when the speed is below the threshold\n      if (!v) {\n        m_state = {};\n        return;\n      }\n\n      s = calcSpeed(v);\n      if (s > m_options.momentum.maxSpeed) {\n        s = m_options.momentum.maxSpeed / s;\n        v.x = v.x * s;\n        v.y = v.y * s;\n      }\n\n      if (!isFinite(v.x) || !isFinite(v.y)) {\n        v.x = 0;\n        v.y = 0;\n      }\n      m_mouse.velocity.x = v.x;\n      m_mouse.velocity.y = v.y;\n\n      m_this.map().pan({\n        x: m_mouse.velocity.x * dt,\n        y: m_mouse.velocity.y * dt\n      });\n\n      if (m_state.handler) {\n        window.requestAnimationFrame(m_state.handler);\n      }\n    };\n    if (m_state.handler) {\n      window.requestAnimationFrame(m_state.handler);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleDoubleClick = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Public method that unbinds all events\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.destroy = function () {\n    m_this._disconnectEvents();\n    m_this.map(null);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get current mouse information\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.mouse = function () {\n    return $.extend(true, {}, m_mouse);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get current keyboard information\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.keyboard = function () {\n    return $.extend(true, {}, m_keyboard);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the current interactor state\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.state = function () {\n    return $.extend(true, {}, m_state);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Simulate a DOM mouse event on connected map.\n   *\n   * The options for creating the events are as follows, not all\n   * options are required for every event type. ::\n   *\n   *   options = {\n   *     page: {x, y} // position on the page\n   *     map: {x, y}  // position on the map (overrides page)\n   *     button: 'left' | 'right' | 'middle'\n   *     modifiers: [ 'alt' | 'ctrl' | 'meta' | 'shift' ]\n   *     wheelDelta: {x, y}\n   *   }\n   *\n   * @param {string} type Event type 'mousemove', 'mousedown', 'mouseup', ...\n   * @param {object} options\n   * @returns {mapInteractor}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.simulateEvent = function (type, options) {\n    var evt, page, offset, which;\n\n    if (!m_this.map()) {\n      return m_this;\n    }\n\n    page = options.page || {};\n\n    if (options.map) {\n      offset = $node.offset();\n      page.x = options.map.x + offset.left;\n      page.y = options.map.y + offset.top;\n    }\n\n    if (options.button === 'left') {\n      which = 1;\n    } else if (options.button === 'right') {\n      which = 3;\n    } else if (options.button === 'middle') {\n      which = 2;\n    }\n\n    options.modifiers = options.modifiers || [];\n    options.wheelDelta = options.wheelDelta || {};\n\n    evt = $.Event(\n      type,\n      {\n        pageX: page.x,\n        pageY: page.y,\n        which: which,\n        altKey: options.modifiers.indexOf('alt') >= 0,\n        ctrlKey: options.modifiers.indexOf('ctrl') >= 0,\n        metaKey: options.modifiers.indexOf('meta') >= 0,\n        shiftKey: options.modifiers.indexOf('shift') >= 0,\n        deltaX: options.wheelDelta.x,\n        deltaY: options.wheelDelta.y,\n        deltaFactor: 1\n      }\n    );\n    $node.trigger(evt);\n  };\n  this._connectEvents();\n  return this;\n};\n\ninherit(geo.mapInteractor, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Stores the current time for a map, triggers time keeping events, and\n * handles the animation state and interaction.\n *\n * @class geo.clock\n * @extends geo.object\n * @returns {geo.clock}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.clock = function (opts) {\n  'use strict';\n\n  if (!(this instanceof geo.clock)) {\n    return new geo.clock(opts);\n  }\n  opts = opts || {};\n  geo.object.call(this, opts);\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_now = new Date(0),\n      m_start = null,\n      m_end = null,\n      m_step = null,\n      m_rate = null,\n      m_loop = Number.POSITIVE_INFINITY,\n      m_currentLoop = 0,\n      m_state = 'stop',\n      m_currentAnimation = null,\n      m_object = null;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the geo.object to trigger events on.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.object = function (arg) {\n    if (arg === undefined) {\n      return m_object;\n    }\n    m_object = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns true if attached to a valid geo.object.\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._attached = function () {\n    return (m_object instanceof geo.object);\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the current time.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.now = function (arg) {\n    var previous = m_now;\n    if (arg === undefined) {\n      return m_now;\n    }\n    m_now = arg;\n\n    if (m_now !== previous &&\n        m_this._attached()) {\n      m_this.object().geoTrigger(geo.event.clock.change, {\n        previous: previous,\n        current: m_now,\n        clock: m_this\n      });\n    }\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the animation start time.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.start = function (arg) {\n    if (arg === undefined) {\n      return m_start;\n    }\n    m_start = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the animation end time.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.end = function (arg) {\n    if (arg === undefined) {\n      return m_end;\n    }\n    m_end = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the animation time step.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.step = function (arg) {\n    if (arg === undefined) {\n      return m_step;\n    }\n    m_step = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set looping control of the clock.  This controls how many times the\n   * animation will repeat before stopping.  Default\n   * ``Number.POSITIVE_INFINITY``, the animation repeats forever.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.loop = function (arg) {\n    if (arg === undefined) {\n      return m_loop;\n    }\n    m_loop = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the animation state.  Valid values are:\n   *\n   *   * 'stop'\n   *   * 'play'\n   *   * 'pause'\n   *\n   * This will also trigger relevant events, but they may be fired\n   * asynchronously.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.state = function (arg, step) {\n\n    if (arg === undefined) {\n      return m_state;\n    }\n    if (['stop', 'play', 'pause'].indexOf(arg) < 0) {\n      console.log('WARNING: Ignored invalid state: ' + arg);\n      return m_this;\n    }\n\n    if (arg === 'play' && m_state === 'stop') {\n      // reset animation parameters\n      m_currentLoop = 0;\n      m_this.now(m_this.start());\n    }\n\n    if (arg === 'play' && m_state !== 'play') {\n      // Start a new animation.\n      m_state = arg;\n      m_this._animate(step || 1);\n    }\n\n    m_state = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the animation frame rate.  This is approximately the number\n   * of frames displayed per second.  A null value will use the browser's\n   * native requestAnimationFrame to draw new frames.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.framerate = function (arg) {\n    if (arg === undefined) {\n      return m_rate;\n    }\n    m_rate = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Step to the next frame in the animation.  Pauses the animation if it is\n   * playing.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.stepForward = function () {\n    m_this.state('pause');\n    m_this._setNextFrame(1);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Step to the previous frame in the animation.  Pauses the animation if it is\n   * playing.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.stepBackward = function () {\n    m_this.state('pause');\n    m_this._setNextFrame(-1);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Step to the next frame in the animation.  Will set the state to stop\n   * if the animation has reached the end and there are no more loops.\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._setNextFrame = function (step) {\n    var next = new Date(m_this.now().valueOf() + step * m_this.step());\n\n    if (next >= m_this.end() || next <= m_this.start()) {\n      if (m_this.loop() <= m_currentLoop) {\n        m_this.state('stop');\n        return;\n      }\n      m_currentLoop += 1;\n      if (step >= 0) {\n        m_this.now(m_this.start());\n      } else {\n        m_this.now(m_this.end());\n      }\n      return;\n    }\n    m_this.now(next);\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Start an animation.\n   * @param {integer} step The animation frame step (+1 for forward -1 for\n   *                       reverse, etc).\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._animate = function (step) {\n    var myAnimation = {};\n    m_currentAnimation = myAnimation;\n\n    function frame() {\n      if (myAnimation !== m_currentAnimation) {\n        // A new animation has started, so kill this one.\n        return;\n      }\n      m_this._setNextFrame(step);\n      if (m_this.state() === 'play') {\n\n        // Queue the next frame\n        if (!m_this.framerate()) {\n          window.requestAnimationFrame(frame);\n        } else {\n          window.setTimeout(frame, 1000 / m_this.framerate());\n        }\n      } else if (m_this._attached()) {\n        m_this.object().geoTrigger(geo.event.clock[m_this.state()], {\n          current: m_this.now(),\n          clock: m_this\n        });\n      }\n    }\n\n    // trigger the play event\n    if (m_this._attached()) {\n      m_this.object().geoTrigger(geo.event.clock.play, {\n        current: m_this.now(),\n        clock: m_this\n      });\n    }\n\n    // Queue the first frame\n    if (!m_this.framerate()) {\n      window.requestAnimationFrame(frame);\n    } else {\n      window.setTimeout(frame, 1000 / m_this.framerate());\n    }\n  };\n};\ninherit(geo.clock, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class fileReader\n *\n * @class\n * @extends geo.object\n * @returns {geo.fileReader}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.fileReader = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.fileReader)) {\n    return new geo.fileReader(arg);\n  }\n  geo.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  arg = arg || {};\n\n  if (!(arg.layer instanceof geo.featureLayer)) {\n    throw \"fileReader must be given a feature layer\";\n  }\n\n  var m_layer = arg.layer;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the feature layer attached to the reader\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Tells the caller if it can handle the given file by returning a boolean.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canRead = function () {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reads the file object and calls the done function when finished.  As an\n   * argument to done, provides a boolean that reports if the read was a\n   * success.  Possibly, it can call done with an object containing details\n   * of the read operation.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.read = function (file, done) {\n    done(false);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return a FileReader with handlers attached.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function newFileReader(done, progress) {\n    var reader = new FileReader();\n    if (progress) {\n      reader.onprogress = progress;\n    }\n    reader.onloadend = function () {\n      if (!reader.result) {\n        done(reader.error);\n      }\n      done(reader.result);\n    };\n    return reader;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private method for reading a file object as a string.  Calls done with\n   * the string content when finished or an error object if unsuccessful.\n   * Optionally, the caller can provide a progress method that is called\n   * after reading each slice.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getString = function (file, done, progress) {\n    var reader = newFileReader(done, progress);\n    reader.readAsText(file);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Like _getString, but returns an ArrayBuffer object.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getArrayBuffer = function (file, done, progress) {\n    var reader = newFileReader(done, progress);\n    reader.readAsText(file);\n  };\n\n  return this;\n};\n\ninherit(geo.fileReader, geo.object);\n","/*global File*/\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class jsonReader\n *\n * @class\n * @extends geo.fileReader\n * @returns {geo.jsonReader}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.jsonReader = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.jsonReader)) {\n    return new geo.jsonReader(arg);\n  }\n\n  var m_this = this, m_style = arg.style || {};\n  m_style = $.extend({\n      'strokeWidth': 2,\n      'strokeColor': {r: 0, g: 0, b: 0},\n      'strokeOpacity': 1,\n      'fillColor': {r: 1, g: 0, b: 0},\n      'fillOpacity': 1\n    }, m_style);\n\n  geo.fileReader.call(this, arg);\n\n  this.canRead = function (file) {\n    if (file instanceof File) {\n      return (file.type === 'application/json' || file.name.match(/\\.json$/));\n    } else if (typeof file === 'string') {\n      try {\n        JSON.parse(file);\n      } catch (e) {\n        return false;\n      }\n      return true;\n    }\n    try {\n      if (Array.isArray(m_this._featureArray(file))) {\n        return true;\n      }\n    } catch (e) {}\n    return false;\n  };\n\n  this._readObject = function (file, done, progress) {\n    var object;\n    function onDone(fileString) {\n      if (typeof fileString !== 'string') {\n        done(false);\n      }\n\n      // We have two possibilities here:\n      // 1) fileString is a JSON string or is\n      // a URL.\n      try {\n        object = JSON.parse(fileString);\n        done(object);\n      } catch (e) {\n        if (!object) {\n          $.ajax({\n            type: 'GET',\n            url: fileString,\n            dataType: 'text'\n          }).done(function (data) {\n            object = JSON.parse(data);\n            done(object);\n          }).fail(function () {\n            done(false);\n          });\n        }\n      }\n    }\n\n    if (file instanceof File) {\n      m_this._getString(file, onDone, progress);\n    } else if (typeof file === 'string') {\n      onDone(file);\n    } else {\n      done(file);\n    }\n  };\n\n  this._featureArray = function (spec) {\n    if (spec.type === 'FeatureCollection') {\n      return spec.features || [];\n    }\n    if (spec.type === 'GeometryCollection') {\n      throw 'GeometryCollection not yet implemented.';\n    }\n    if (Array.isArray(spec.coordinates)) {\n      return spec;\n    }\n    throw 'Unsupported collection type: ' + spec.type;\n  };\n\n  this._featureType = function (spec) {\n    var geometry = spec.geometry || {};\n    if (geometry.type === 'Point' || geometry.type === 'MultiPoint') {\n      return 'point';\n    }\n    if (geometry.type === 'LineString') {\n      return 'line';\n    }\n    if (geometry.type === 'Polygon') {\n      return 'polygon';\n    }\n    return null;\n  };\n\n  this._getCoordinates = function (spec) {\n    var geometry = spec.geometry || {},\n        coordinates = geometry.coordinates || [], elv;\n\n    if ((coordinates.length === 2 || coordinates.length === 3) &&\n        (isFinite(coordinates[0]) && isFinite(coordinates[1]))) {\n\n      // Do we have a elevation component\n      if (isFinite(coordinates[2])) {\n        elv = coordinates[2];\n      }\n\n      // special handling for single point coordinates\n      return [{x: coordinates[0], y: coordinates[1], z: elv}];\n    }\n\n    // need better handling here, but we can plot simple polygons\n    // by taking just the outer linearring\n    if (Array.isArray(coordinates[0][0])) {\n      coordinates = coordinates[0];\n    }\n\n    // return an array of latlng's for LineString, MultiPoint, etc...\n    return coordinates.map(function (c) {\n      return {\n        x: c[0],\n        y: c[1],\n        z: c[2]\n      };\n    });\n  };\n\n  this._getStyle = function (spec) {\n    return spec.properties;\n  };\n\n  this.read = function (file, done, progress) {\n\n    function _done(object) {\n      var features, allFeatures = [];\n\n      features = m_this._featureArray(object);\n\n      features.forEach(function (feature) {\n        var type = m_this._featureType(feature),\n            coordinates = m_this._getCoordinates(feature),\n            style = m_this._getStyle(feature);\n        if (type) {\n          if (type === 'line') {\n            style.fill = style.fill || false;\n            allFeatures.push(m_this._addFeature(\n              type,\n              [coordinates],\n              style,\n              feature.properties\n            ));\n          } else if (type === 'point') {\n            style.stroke = style.stroke || false;\n            allFeatures.push(m_this._addFeature(\n              type,\n              coordinates,\n              style,\n              feature.properties\n            ));\n          } else if (type === 'polygon') {\n            style.fill = style.fill === undefined ? true : style.fill;\n            style.fillOpacity = (\n              style.fillOpacity === undefined ? 0.25 : style.fillOpacity\n            );\n            // polygons not yet supported\n            allFeatures.push(m_this._addFeature(\n              'line',\n              [coordinates],\n              style,\n              feature.properties\n            ));\n          }\n        } else {\n          console.log('unsupported feature type: ' + feature.geometry.type);\n        }\n      });\n\n      if (done) {\n        done(allFeatures);\n      }\n    }\n\n    m_this._readObject(file, _done, progress);\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build the data array for a feature given the coordinates and properties\n   * from the geojson.\n   *\n   * @private\n   * @param {Object[]} coordinates Coordinate data array\n   * @param {Object} properties Geojson properties object\n   * @param {Object} style Global style defaults\n   * @returns {Object[]}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._buildData = function (coordinates, properties, style) {\n    return coordinates.map(function (coord) {\n      return {\n        coordinates: coord,\n        properties: properties,\n        style: style\n      };\n    });\n  };\n\n  this._addFeature = function (type, coordinates, style, properties) {\n    var _style = $.extend({}, m_style, style);\n    var feature = m_this.layer().createFeature(type)\n      .data(m_this._buildData(coordinates, properties, style))\n      .style(_style);\n\n    if (type === 'line') {\n      feature.line(function (d) { return d.coordinates; });\n    } else {\n      feature.position(function (d) { return d.coordinates; });\n    }\n    return feature;\n  };\n\n};\n\ninherit(geo.jsonReader, geo.fileReader);\n\ngeo.registerFileReader('jsonReader', geo.jsonReader);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class map\n *\n * Creates a new map inside of the given HTML layer (Typically DIV)\n * @class\n * @extends geo.sceneObject\n * @returns {geo.map}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.map = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.map)) {\n    return new geo.map(arg);\n  }\n  arg = arg || {};\n  geo.sceneObject.call(this, arg);\n  arg.layers = arg.layers === undefined ? [] : arg.layers;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private member variables\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_exit = this._exit,\n      m_x = 0,\n      m_y = 0,\n      m_node = $(arg.node),\n      m_width = arg.width || m_node.width(),\n      m_height = arg.height || m_node.height(),\n      m_gcs = arg.gcs === undefined ? \"EPSG:4326\" : arg.gcs,\n      m_uigcs = arg.uigcs === undefined ? \"EPSG:4326\" : arg.uigcs,\n      m_center = { x: 0, y: 0 },\n      m_zoom = arg.zoom === undefined ? 1 : arg.zoom,\n      m_baseLayer = null,\n      m_fileReader = null,\n      m_interactor = null,\n      m_validZoomRange = { min: 0, max: 16 },\n      m_transition = null,\n      m_queuedTransition = null,\n      m_clock = null,\n      m_bounds = {};\n\n  arg.center = geo.util.normalizeCoordinates(arg.center);\n  arg.autoResize = arg.autoResize === undefined ? true : arg.autoResize;\n  arg.clampBounds = arg.clampBounds === undefined ? true : arg.clampBounds;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map gcs\n   *\n   * @returns {string}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (arg) {\n    if (arg === undefined) {\n      return m_gcs;\n    }\n    m_gcs = arg;\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map user interface GCS\n   *\n   * @returns {string}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.uigcs = function () {\n    return m_uigcs;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get root node of the map\n   *\n   * @returns {object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.node = function () {\n    return m_node;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set zoom level of the map\n   *\n   * @returns {Number|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoom = function (val, direction) {\n    var base, evt, recenter = false;\n    if (val === undefined) {\n      return m_zoom;\n    }\n\n    val = Math.min(m_validZoomRange.max, Math.max(val, m_validZoomRange.min));\n    if (val === m_zoom) {\n      return m_this;\n    }\n\n    base = m_this.baseLayer();\n\n    evt = {\n      geo: {},\n      zoomLevel: val,\n      screenPosition: direction,\n      eventType: geo.event.zoom\n    };\n    if (base) {\n      base.renderer().geoTrigger(geo.event.zoom, evt, true);\n    }\n\n    recenter = evt.center;\n    if (!evt.geo.preventDefault) {\n\n      m_zoom = val;\n      m_this._updateBounds();\n\n      m_this.children().forEach(function (child) {\n        child.geoTrigger(geo.event.zoom, evt, true);\n      });\n\n      m_this.modified();\n    }\n\n    if (evt.center) {\n      m_this.center(recenter);\n    } else {\n      m_this.pan({x: 0, y: 0});\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Pan the map by (x: dx, y: dy) pixels.\n   *\n   * @param {Object} delta\n   * @param {bool?} force Disable bounds clamping\n   * @returns {geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pan = function (delta, force) {\n    var base = m_this.baseLayer(),\n        evt, pt, corner1, corner2;\n\n    if (arg.clampBounds && !force && m_width && m_height) {\n      pt = m_this.displayToGcs({\n        x: delta.x,\n        y: delta.y\n      });\n\n      corner1 = m_this.gcsToDisplay({\n        x: -180,\n        y: 82\n      });\n      corner2 = m_this.gcsToDisplay({\n        x: 180,\n        y: -82\n      });\n\n      if (corner1.x > 0 && corner2.x < m_width) {\n        // if the map is too small horizontally\n        delta.x = (-corner1.x + m_width - corner2.x) / 2;\n      } else {\n        delta.x = Math.max(Math.min(delta.x, -corner1.x), m_width - corner2.x);\n      }\n      if (corner1.y > 0 && corner2.y < m_height) {\n        // if the map is too small horizontally\n        delta.y = (-corner1.y + m_height - corner2.y) / 2;\n      } else {\n        delta.y = Math.max(Math.min(delta.y, -corner1.y), m_height - corner2.y);\n      }\n    }\n\n    evt = {\n      geo: {},\n      screenDelta: delta,\n      eventType: geo.event.pan\n    };\n    // first pan the base layer\n    if (base) {\n      base.renderer().geoTrigger(geo.event.pan, evt, true);\n    }\n\n    // If the base renderer says the pan is invalid, then cancel the action.\n    if (evt.geo.preventDefault) {\n      return;\n    }\n    m_center = m_this.displayToGcs({\n      x: m_width / 2,\n      y: m_height / 2\n    });\n    m_this._updateBounds();\n\n    m_this.children().forEach(function (child) {\n      child.geoTrigger(geo.event.pan, evt, true);\n    });\n\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set center of the map to the given geographic coordinates, or get the\n   * current center.  Uses bare objects {x: 0, y: 0}.\n   *\n   * @param {Object} coordinates\n   * @returns {Object|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.center = function (coordinates, force) {\n    var newCenter, currentCenter;\n\n    if (coordinates === undefined) {\n      return m_center;\n    }\n\n    // get the screen coordinates of the new center\n    coordinates = geo.util.normalizeCoordinates(coordinates);\n    newCenter = m_this.gcsToDisplay(coordinates);\n    currentCenter = m_this.gcsToDisplay(m_center);\n\n    // call the pan method\n    m_this.pan({\n      x: currentCenter.x - newCenter.x,\n      y: currentCenter.y - newCenter.y\n    }, force);\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add layer to the map\n   *\n   * @param {geo.layer} layer to be added to the map\n   * @return {geom.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createLayer = function (layerName, arg) {\n    var newLayer = geo.createLayer(\n      layerName, m_this, arg);\n\n    if (newLayer !== null || newLayer !== undefined) {\n      newLayer._resize(m_x, m_y, m_width, m_height);\n    } else {\n      return null;\n    }\n\n    if (newLayer.referenceLayer() || m_this.children().length === 0) {\n      m_this.baseLayer(newLayer);\n    }\n    m_this.addChild(newLayer);\n    m_this.modified();\n\n    // TODO: need a better way to set the initial coordinates of a layer\n    if (!newLayer.referenceLayer()) {\n      m_this.center(m_this.center());\n    }\n\n    m_this.geoTrigger(geo.event.layerAdd, {\n      type: geo.event.layerAdd,\n      target: m_this,\n      layer: newLayer\n    });\n\n    return newLayer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove layer from the map\n   *\n   * @param {geo.layer} layer that should be removed from the map\n   * @return {geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteLayer = function (layer) {\n\n    if (layer !== null && layer !== undefined) {\n      layer._exit();\n\n      m_this.removeChild(layer);\n\n      m_this.modified();\n\n      m_this.geoTrigger(geo.event.layerRemove, {\n        type: geo.event.layerRemove,\n        target: m_this,\n        layer: layer\n      });\n    }\n\n    /// Return deleted layer (similar to createLayer) as in the future\n    /// we may provide extension of this method to support deletion of\n    /// layer using id or some sort.\n    return layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Toggle visibility of a layer\n   *\n   *  @param {geo.layer} layer\n   *  @returns {Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toggle = function (layer) {\n    if (layer !== null && layer !== undefined) {\n      layer.visible(!layer.visible());\n      m_this.modified();\n\n      m_this.geoTrigger(geo.event.layerToggle, {\n        type: geo.event.layerToggle,\n        target: m_this,\n        layer: layer\n      });\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize map\n   *\n   * @param {Number} x x-offset in display space\n   * @param {Number} y y-offset in display space\n   * @param {Number} w width in display space\n   * @param {Number} h height in display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function (x, y, w, h) {\n    var i, layers = m_this.children();\n\n    m_x = x;\n    m_y  = y;\n    m_width = w;\n    m_height = h;\n\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._resize(x, y, w, h);\n    }\n\n    m_this.geoTrigger(geo.event.resize, {\n      type: geo.event.resize,\n      target: m_this,\n      x: m_x,\n      y: m_y,\n      width: w,\n      height: h\n    });\n\n    m_this._updateBounds();\n    m_this.pan({x: 0, y: 0});\n    m_this.modified();\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from gcs coordinates to display coordinates\n   *\n   * @param {*} input {[geo.latlng], [{x:_x, y: _y}], [x1,y1, x2, y2]}\n   * @return {object}\n   *\n   * @note Currently only lat-lon inputs are supported\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcsToDisplay = function (input) {\n    var world, output;\n\n    /// Now handle different data types\n    if ((input instanceof Array &&\n         input.length > 0) || input instanceof Object) {\n      world = m_baseLayer.toLocal(input);\n      output = m_baseLayer.renderer().worldToDisplay(world);\n    } else {\n      /// Everything else\n      throw \"Conversion method latLonToDisplay does not handle \" + input;\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from display to latitude longitude coordinates\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToGcs = function (input) {\n    var output;\n\n    /// Now handle different data types\n    if ((input instanceof Array && input.length > 0) ||\n         input instanceof Object) {\n      output = m_baseLayer.renderer().displayToWorld(input);\n      output = m_baseLayer.fromLocal(output);\n    } else {\n      throw \"Conversion method displayToGcs does not handle \" + input;\n    }\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Queries each layer for information at this location.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.query = function () {\n    // TODO Implement this\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets base layer for this map\n   *\n   * @param {geo.layer} baseLayer optional\n   * @returns {geo.map|geo.layer}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.baseLayer = function (baseLayer) {\n    var save;\n    if (baseLayer !== undefined) {\n\n      // The GCS of the layer must match the map\n      if (m_gcs !== baseLayer.gcs()) {\n        m_this.gcs(baseLayer.gcs());\n      }\n\n      m_baseLayer = baseLayer;\n\n      // Set the layer as the reference layer\n      m_baseLayer.referenceLayer(true);\n\n      if (arg.center) {\n        // This assumes that the base layer is initially centered at\n        // (0, 0).  May want to add an explicit call to the base layer\n        // to set a given center.\n        m_this.center(arg.center, true);\n      }\n      save = m_zoom;\n      m_zoom = null;\n      m_this.zoom(save);\n\n      m_this._updateBounds();\n\n      // This forces the map into a state with valid bounds\n      // when clamping is on.  The original call to center\n      // is forced to initialize the camera position in the\n      // base layer so no adjustment is done there.\n      m_this.pan({x: 0, y: 0});\n      return m_this;\n    }\n    return m_baseLayer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Manually force to render map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    var i, layers = m_this.children();\n\n    m_this.geoTrigger(geo.event.draw, {\n        type: geo.event.draw,\n        target: m_this\n      }\n    );\n\n    m_this._update();\n\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i].draw();\n    }\n\n    m_this.geoTrigger(geo.event.drawEnd, {\n        type: geo.event.drawEnd,\n        target: m_this\n      }\n    );\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Attach a file reader to a layer in the map to be used as a drop target.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fileReader = function (readerType, opts) {\n    var layer, renderer;\n    opts = opts || {};\n    if (!readerType) {\n      return m_fileReader;\n    }\n    layer = opts.layer;\n    if (!layer) {\n      renderer = opts.renderer;\n      if (!renderer) {\n        renderer = \"d3\";\n      }\n      layer = m_this.createLayer(\"feature\", {renderer: renderer});\n    }\n    opts.layer = layer;\n    opts.renderer = renderer;\n    m_fileReader = geo.createFileReader(readerType, opts);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize the map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var i;\n\n    if (m_node === undefined || m_node === null) {\n      throw \"Map require DIV node\";\n    }\n\n    if (arg !== undefined && arg.layers !== undefined) {\n      for (i = 0; i < arg.layers.length; i += 1) {\n        if (i === 0) {\n          m_this.baseLayer(arg.layers[i]);\n        }\n\n        m_this.addLayer(arg.layers[i]);\n      }\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    var i, layers = m_this.children();\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._update(request);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit this map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.exit = function () {\n    var i, layers = m_this.children();\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._exit();\n    }\n    if (m_this.interactor()) {\n      m_this.interactor().destroy();\n      m_this.interactor(null);\n    }\n    m_this.node().off(\".geo\");\n    $(window).off(\"resize\", resizeSelf);\n    s_exit();\n  };\n\n  this._init(arg);\n\n  // set up drag/drop handling\n  this.node().on(\"dragover.geo\", function (e) {\n    var evt = e.originalEvent;\n\n    if (m_this.fileReader()) {\n      evt.stopPropagation();\n      evt.preventDefault();\n      evt.dataTransfer.dropEffect = \"copy\";\n    }\n  })\n  .on(\"drop.geo\", function (e) {\n    var evt = e.originalEvent, reader = m_this.fileReader(),\n        i, file;\n\n    function done() {\n      m_this.draw();\n    }\n\n    if (reader) {\n      evt.stopPropagation();\n      evt.preventDefault();\n\n      for (i = 0; i < evt.dataTransfer.files.length; i += 1) {\n        file = evt.dataTransfer.files[i];\n        if (reader.canRead(file)) {\n          reader.read(file, done); // to do: trigger event on done\n        }\n      }\n    }\n  });\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the map interactor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.interactor = function (arg) {\n    if (arg === undefined) {\n      return m_interactor;\n    }\n    m_interactor = arg;\n\n    // this makes it possible to set a null interactor\n    // i.e. map.interactor(null);\n    if (m_interactor) {\n      m_interactor.map(m_this);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the map clock\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clock = function (arg) {\n    if (arg === undefined) {\n      return m_clock;\n    }\n    m_clock = arg;\n\n    if (m_clock) {\n      m_clock.object(m_this);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the min/max zoom range.\n   *\n   * @param {Object} arg {min: minimumzoom, max: maximumzom}\n   * @returns {Object|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoomRange = function (arg) {\n    if (arg === undefined) {\n      return $.extend({}, m_validZoomRange);\n    }\n    m_validZoomRange.min = arg.min;\n    m_validZoomRange.max = arg.max;\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Start an animated zoom/pan.\n   *\n   * Options:\n   * <pre>\n   *   opts = {\n   *     center: { x: ... , y: ... } // the new center\n   *     zoom: ... // the new zoom level\n   *     duration: ... // the duration (in ms) of the transition\n   *     ease: ... // an easing function [0, 1] -> [0, 1]\n   *   }\n   * </pre>\n   *\n   * Call with no arguments to return the current transition information.\n   *\n   * @param {object?} opts\n   * @returns {geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transition = function (opts) {\n\n    if (opts === undefined) {\n      return m_transition;\n    }\n\n    if (m_transition) {\n      m_queuedTransition = opts;\n      return m_this;\n    }\n\n    function interp1(p0, p1, t) {\n      return p0 + (p1 - p0) * t;\n    }\n    function defaultInterp(p0, p1) {\n      return function (t) {\n        return [\n          interp1(p0[0], p1[0], t),\n          interp1(p0[1], p1[1], t),\n          interp1(p0[2], p1[2], t)\n        ];\n      };\n    }\n\n    // Transform zoom level into z-coordinate and inverse\n    function zoom2z(z) {\n      return 360 * Math.pow(2, -1 - z);\n    }\n    function z2zoom(z) {\n      return -1 - Math.log2(z / 360);\n    }\n\n    var defaultOpts = {\n      center: m_this.center(),\n      zoom: m_this.zoom(),\n      duration: 1000,\n      ease: function (t) {\n        return t;\n      },\n      interp: defaultInterp,\n      done: null,\n      zCoord: true\n    };\n\n    if (opts.center) {\n      opts.center = geo.util.normalizeCoordinates(opts.center);\n    }\n    $.extend(defaultOpts, opts);\n\n    m_transition = {\n      start: {\n        center: m_this.center(),\n        zoom: m_this.zoom()\n      },\n      end: {\n        center: defaultOpts.center,\n        zoom: defaultOpts.zoom\n      },\n      ease: defaultOpts.ease,\n      zCoord: defaultOpts.zCoord,\n      done: defaultOpts.done,\n      duration: defaultOpts.duration\n    };\n\n    if (defaultOpts.zCoord) {\n      m_transition.interp = defaultOpts.interp(\n        [\n          m_transition.start.center.x,\n          m_transition.start.center.y,\n          zoom2z(m_transition.start.zoom)\n        ],\n        [\n          m_transition.end.center.x,\n          m_transition.end.center.y,\n          zoom2z(m_transition.end.zoom)\n        ]\n      );\n    } else {\n      m_transition.interp = defaultOpts.interp(\n        [\n          m_transition.start.center.x,\n          m_transition.start.center.y,\n          m_transition.start.zoom\n        ],\n        [\n          m_transition.end.center.x,\n          m_transition.end.center.y,\n          m_transition.end.zoom\n        ]\n      );\n    }\n\n    function anim(time) {\n      var done = m_transition.done, next;\n      next = m_queuedTransition;\n\n      if (!m_transition.start.time) {\n        m_transition.start.time = time;\n        m_transition.end.time = time + defaultOpts.duration;\n      }\n      m_transition.time = time - m_transition.start.time;\n      if (time >= m_transition.end.time || next) {\n        if (!next) {\n          m_this.center(m_transition.end.center);\n          m_this.zoom(m_transition.end.zoom);\n        }\n\n        m_transition = null;\n\n        m_this.geoTrigger(geo.event.transitionend, defaultOpts);\n\n        if (done) {\n          done();\n        }\n\n        if (next) {\n          m_queuedTransition = null;\n          m_this.transition(next);\n        }\n\n        return;\n      }\n\n      var z = m_transition.ease(\n        (time - m_transition.start.time) / defaultOpts.duration\n      );\n\n      var p = m_transition.interp(z);\n      if (m_transition.zCoord) {\n        p[2] = z2zoom(p[2]);\n      }\n      m_this.center({\n        x: p[0],\n        y: p[1]\n      });\n      m_this.zoom(p[2]);\n\n      window.requestAnimationFrame(anim);\n    }\n\n    m_this.geoTrigger(geo.event.transitionstart, defaultOpts);\n\n    if (defaultOpts.cancelNavigation) {\n      m_this.geoTrigger(geo.event.transitionend, defaultOpts);\n      return m_this;\n    } else if (defaultOpts.cancelAnimation) {\n      // run the navigation synchronously\n      defaultOpts.duration = 0;\n      anim(0);\n    } else {\n      window.requestAnimationFrame(anim);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the internally cached map bounds.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._updateBounds = function () {\n    m_bounds.lowerLeft = m_this.displayToGcs({\n      x: 0,\n      y: m_height\n    });\n    m_bounds.lowerRight = m_this.displayToGcs({\n      x: m_width,\n      y: m_height\n    });\n    m_bounds.upperLeft = m_this.displayToGcs({\n      x: 0,\n      y: 0\n    });\n    m_bounds.upperRight = m_this.displayToGcs({\n      x: m_width,\n      y: 0\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the locations of the current map corners as latitudes/longitudes.\n   * The return value of this function is an object as follows: ::\n   *\n   *    {\n   *        lowerLeft: {x: ..., y: ...},\n   *        upperLeft: {x: ..., y: ...},\n   *        lowerRight: {x: ..., y: ...},\n   *        upperRight: {x: ..., y: ...}\n   *    }\n   *\n   * @todo Provide a setter\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bounds = function () {\n    return m_bounds;\n  };\n\n\n  this.interactor(arg.interactor || geo.mapInteractor());\n  this.clock(arg.clock || geo.clock());\n\n  function resizeSelf() {\n    m_this.resize(0, 0, m_node.width(), m_node.height());\n  }\n\n  if (arg.autoResize) {\n    $(window).resize(resizeSelf);\n  }\n\n  return this;\n};\n\n/**\n * General object specification for map types.  Any additional\n * values in the object are passed to the map constructor.\n * @typedef geo.map.spec\n * @type {object}\n * @property {object[]} [data=[]] The default data array to\n * apply to each feature if none exists\n * @property {geo.layer.spec[]} [layers=[]] Layers to create\n */\n\n/**\n * Create a map from an object.  Any errors in the creation\n * of the map will result in returning null.\n * @param {geo.map.spec} spec The object specification\n * @returns {geo.map|null}\n */\ngeo.map.create = function (spec) {\n  \"use strict\";\n\n  var map = geo.map(spec);\n\n  if (!map) {\n    console.warn(\"Could not create map.\");\n    return null;\n  }\n\n  spec.data = spec.data || [];\n  spec.layers = spec.layers || [];\n\n  spec.layers.forEach(function (l) {\n    l.data = l.data || spec.data;\n    l.layer = geo.layer.create(map, l);\n  });\n\n  return map;\n};\n\ninherit(geo.map, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class feature\n *\n * @class\n * @extends geo.sceneObject\n * @returns {geo.feature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.feature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.feature)) {\n    return new geo.feature(arg);\n  }\n  geo.sceneObject.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  arg = arg || {};\n\n  var m_this = this,\n      s_exit = this._exit,\n      m_selectionAPI = arg.selectionAPI === undefined ? false : arg.selectionAPI,\n      m_style = {},\n      m_layer = arg.layer === undefined ? null : arg.layer,\n      m_gcs = arg.gcs === undefined ? \"EPSG:4326\" : arg.gcs,\n      m_visible = arg.visible === undefined ? true : arg.visible,\n      m_bin = arg.bin === undefined ? 0 : arg.bin,\n      m_renderer = arg.renderer === undefined ? null : arg.renderer,\n      m_dataTime = geo.timestamp(),\n      m_buildTime = geo.timestamp(),\n      m_updateTime = geo.timestamp(),\n      m_selectedFeatures = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private method to bind mouse handlers on the map element.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._bindMouseHandlers = function () {\n\n    // Don't bind handlers for improved performance on features that don't\n    // require it.\n    if (!m_selectionAPI) {\n      return;\n    }\n\n    // First unbind to be sure that the handlers aren't bound twice.\n    m_this._unbindMouseHandlers();\n\n    m_this.geoOn(geo.event.mousemove, m_this._handleMousemove);\n    m_this.geoOn(geo.event.mouseclick, m_this._handleMouseclick);\n    m_this.geoOn(geo.event.brushend, m_this._handleBrushend);\n    m_this.geoOn(geo.event.brush, m_this._handleBrush);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private method to unbind mouse handlers on the map element.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._unbindMouseHandlers = function () {\n    m_this.geoOff(geo.event.mousemove, m_this._handleMousemove);\n    m_this.geoOff(geo.event.mouseclick, m_this._handleMouseclick);\n    m_this.geoOff(geo.event.brushend, m_this._handleBrushend);\n    m_this.geoOff(geo.event.brush, m_this._handleBrush);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * For binding mouse events, use functions with\n   * the following call signatures:\n   *\n   * function handler(arg) {\n   *   // arg.data - the data object of the feature\n   *   // arg.index - the index inside the data array of the featue\n   *   // arg.mouse - mouse information object (see src/core/mapInteractor.js)\n   * }\n   *\n   * i.e.\n   *\n   * feature.geoOn(geo.event.feature.mousemove, function (arg) {\n   *   // do something with the feature marker.\n   * });\n   */\n  ////////////////////////////////////////////////////////////////////////////\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Search for features containing the given point.\n   *\n   * Returns an object: ::\n   *\n   *   {\n   *     data: [...] // an array of data objects for matching features\n   *     index: [...] // an array of indices of the matching features\n   *   }\n   *\n   * @argument {Object} coordinate\n   * @returns {Object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pointSearch = function () {\n    // base class method does nothing\n    return {\n      index: [],\n      found: []\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private mousemove handler\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMousemove = function () {\n    var mouse = m_this.layer().map().interactor().mouse(),\n        data = m_this.data(),\n        over = m_this.pointSearch(mouse.geo),\n        newFeatures = [], oldFeatures = [], lastTop = -1, top = -1;\n\n    // Get the index of the element that was previously on top\n    if (m_selectedFeatures.length) {\n      lastTop = m_selectedFeatures[m_selectedFeatures.length - 1];\n    }\n\n    // There are probably faster ways of doing this:\n    newFeatures = over.index.filter(function (i) {\n      return m_selectedFeatures.indexOf(i) < 0;\n    });\n    oldFeatures = m_selectedFeatures.filter(function (i) {\n      return over.index.indexOf(i) < 0;\n    });\n\n    geo.feature.eventID += 1;\n    // Fire events for mouse in first.\n    newFeatures.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.mouseover, {\n        data: data[i],\n        index: i,\n        mouse: mouse,\n        eventID: geo.feature.eventID,\n        top: idx === newFeatures.length - 1\n      }, true);\n    });\n\n    geo.feature.eventID += 1;\n    // Fire events for mouse out next\n    oldFeatures.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.mouseout, {\n        data: data[i],\n        index: i,\n        mouse: mouse,\n        eventID: geo.feature.eventID,\n        top: idx === oldFeatures.length - 1\n      }, true);\n    });\n\n    geo.feature.eventID += 1;\n    // Fire events for mouse move last\n    over.index.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.mousemove, {\n        data: data[i],\n        index: i,\n        mouse: mouse,\n        eventID: geo.feature.eventID,\n        top: idx === over.index.length - 1\n      }, true);\n    });\n\n    // Replace the selected features array\n    m_selectedFeatures = over.index;\n\n    // Get the index of the element that is now on top\n    if (m_selectedFeatures.length) {\n      top = m_selectedFeatures[m_selectedFeatures.length - 1];\n    }\n\n    if (lastTop !== top) {\n      // The element on top changed so we need to fire mouseon/mouseoff\n      if (lastTop !== -1) {\n        m_this.geoTrigger(geo.event.feature.mouseoff, {\n          data: data[lastTop],\n          index: lastTop,\n          mouse: mouse\n        }, true);\n      }\n\n      if (top !== -1) {\n        m_this.geoTrigger(geo.event.feature.mouseon, {\n          data: data[top],\n          index: top,\n          mouse: mouse\n        }, true);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private mouseclick handler\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleMouseclick = function () {\n    var mouse = m_this.layer().map().interactor().mouse(),\n        data = m_this.data(),\n        over = m_this.pointSearch(mouse.geo);\n\n    geo.feature.eventID += 1;\n    over.index.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.mouseclick, {\n        data: data[i],\n        index: i,\n        mouse: mouse,\n        eventID: geo.feature.eventID,\n        top: idx === over.index.length - 1\n      }, true);\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private brush handler.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleBrush = function (brush) {\n    var idx = m_this.boxSearch(brush.gcs.lowerLeft, brush.gcs.upperRight),\n        data = m_this.data();\n\n    geo.feature.eventID += 1;\n    idx.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.brush, {\n        data: data[i],\n        index: i,\n        mouse: brush.mouse,\n        brush: brush,\n        eventID: geo.feature.eventID,\n        top: idx === idx.length - 1\n      }, true);\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private brushend handler.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._handleBrushend = function (brush) {\n    var idx = m_this.boxSearch(brush.gcs.lowerLeft, brush.gcs.upperRight),\n        data = m_this.data();\n\n    geo.feature.eventID += 1;\n    idx.forEach(function (i, idx) {\n      m_this.geoTrigger(geo.event.feature.brushend, {\n        data: data[i],\n        index: i,\n        mouse: brush.mouse,\n        brush: brush,\n        eventID: geo.feature.eventID,\n        top: idx === idx.length - 1\n      }, true);\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set style used by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style = function (arg1, arg2) {\n    if (arg1 === undefined) {\n      return m_style;\n    } else if (typeof arg1 === \"string\" && arg2 === undefined) {\n      return m_style[arg1];\n    } else if (arg2 === undefined) {\n      m_style = $.extend({}, m_style, arg1);\n      m_this.modified();\n      return m_this;\n    } else {\n      m_style[arg1] = arg2;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * A uniform getter that always returns a function even for constant styles.\n   * Maybe extend later to support accessor-like objects.  If undefined input,\n   * return all the styles as an object.\n   *\n   * @param {string|undefined} key\n   * @return {function}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style.get = function (key) {\n    var tmp, out;\n    if (key === undefined) {\n      var all = {}, k;\n      for (k in m_style) {\n        if (m_style.hasOwnProperty(k)) {\n          all[k] = m_this.style.get(k);\n        }\n      }\n      return all;\n    }\n    if (key.toLowerCase().match(/color$/)) {\n      if (geo.util.isFunction(m_style[key])) {\n        tmp = geo.util.ensureFunction(m_style[key]);\n        out = function () {\n          return geo.util.convertColor(\n            tmp.apply(this, arguments)\n          );\n        };\n      } else {\n        // if the color is not a function, only convert it once\n        out = geo.util.ensureFunction(geo.util.convertColor(m_style[key]));\n      }\n    } else {\n      out = geo.util.ensureFunction(m_style[key]);\n    }\n    return out;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer referenced by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get renderer used by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderer = function () {\n    return m_renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get list of drawables or nodes that are context/api specific.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawables = function () {\n    return m_this._drawables();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set projection of the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (val) {\n    if (val === undefined) {\n      return m_gcs;\n    } else {\n      m_gcs = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set visibility of the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function (val) {\n    if (val === undefined) {\n      return m_visible;\n    } else {\n      m_visible = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set bin of the feature\n   *\n   * Bin number is typically used for sorting the order of rendering\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bin = function (val) {\n    if (val === undefined) {\n      return m_bin;\n    } else {\n      m_bin = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of data change\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.dataTime = function (val) {\n    if (val === undefined) {\n      return m_dataTime;\n    } else {\n      m_dataTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of last time build happened\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.buildTime = function (val) {\n    if (val === undefined) {\n      return m_buildTime;\n    } else {\n      m_buildTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of last time update happened\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateTime = function (val) {\n    if (val === undefined) {\n      return m_updateTime;\n    } else {\n      m_updateTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set data\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function (data) {\n    if (data === undefined) {\n      return m_this.style(\"data\") || [];\n    } else {\n      m_this.style(\"data\", data);\n      m_this.dataTime().modified();\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Query if the selection API is enabled for this feature.\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.selectionAPI = function () {\n    return m_selectionAPI;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    if (!m_layer) {\n      throw \"Feature requires a valid layer\";\n    }\n    m_style = $.extend({},\n                {\"opacity\": 1.0}, arg.style === undefined ? {} :\n                arg.style);\n    m_this._bindMouseHandlers();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific drawables\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._drawables = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this._unbindMouseHandlers();\n    m_selectedFeatures = [];\n    m_style = {};\n    arg = {};\n    s_exit();\n  };\n\n  this._init(arg);\n  return this;\n};\n\n/**\n * The most recent feature event triggered.\n * @type {number}\n */\ngeo.feature.eventID = 0;\n\n/**\n * General object specification for feature types.\n * @typedef geo.feature.spec\n * @type {object}\n * @property {string} type A supported feature type.\n * @property {object[]} [data=[]] An array of arbitrary objects used to\n * construct the feature.  These objects (and their associated\n * indices in the array) will be passed back to style and attribute\n * accessors provided by the user.  In general the number of\n * \"markers\" drawn will be equal to the length of this array.\n */\n\n/**\n * Create a feature from an object.  The implementation here is\n * meant to define the general interface of creating features\n * from a javascript object.  See documentation from individual\n * feature types for specific details.  In case of an error in\n * the arguments this method will return null;\n * @param {geo.layer} layer The layer to add the feature to\n * @param {geo.feature.spec} [spec={}] The object specification\n * @returns {geo.feature|null}\n */\ngeo.feature.create = function (layer, spec) {\n  \"use strict\";\n\n  var type = spec.type;\n\n  // Check arguments\n  if (!layer instanceof geo.layer) {\n    console.warn(\"Invalid layer\");\n    return null;\n  }\n  if (typeof spec !== \"object\") {\n    console.warn(\"Invalid spec\");\n    return null;\n  }\n  var feature = layer.createFeature(type);\n  if (!feature) {\n    console.warn(\"Could not create feature type '\" + type + \"'\");\n    return null;\n  }\n\n  spec = spec || {};\n  spec.data = spec.data || [];\n  return feature.style(spec);\n};\n\ninherit(geo.feature, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pointFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.pointFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.pointFeature)) {\n    return new geo.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      m_rangeTree = null,\n      s_data = this.data,\n      s_style = this.style,\n      m_maxRadius = 0;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set position\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_this.style(\"position\");\n    } else {\n      m_this.style(\"position\", val);\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the current range tree object.  Should be called whenever the\n   * data changes.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._updateRangeTree = function () {\n    var pts, position,\n        radius = m_this.style.get(\"radius\"),\n        stroke = m_this.style.get(\"stroke\"),\n        strokeWidth = m_this.style.get(\"strokeWidth\");\n\n    position = m_this.position();\n\n    m_maxRadius = 0;\n\n    // create an array of positions in geo coordinates\n    pts = m_this.data().map(function (d, i) {\n      var pt = position(d);\n      pt.idx = i;\n\n      // store the maximum point radius\n      m_maxRadius = Math.max(\n        m_maxRadius,\n        radius(d, i) + (stroke(d, i) ? strokeWidth(d, i) : 0)\n      );\n\n      return pt;\n    });\n\n    m_rangeTree = new geo.util.RangeTree(pts);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns an array of datum indices that contain the given point.\n   * Largely adapted from wigglemaps pointQuerier:\n   *\n   * https://github.com/dotskapes/wigglemaps/blob/cf5bed3fbfe2c3e48d31799462a80c564be1fb60/src/query/PointQuerier.js\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pointSearch = function (p) {\n    var min, max, data, idx = [], box, found = [], ifound = [], map, pt,\n        stroke = m_this.style.get(\"stroke\"),\n        strokeWidth = m_this.style.get(\"strokeWidth\"),\n        radius = m_this.style.get(\"radius\");\n\n    if (!m_this.selectionAPI()) {\n      return [];\n    }\n\n    data = m_this.data();\n    if (!data || !data.length) {\n      return {\n        found: [],\n        index: []\n      };\n    }\n\n    map = m_this.layer().map();\n    pt = map.gcsToDisplay(p);\n\n    // Get the upper right corner in geo coordinates\n    min = map.displayToGcs({\n      x: pt.x - m_maxRadius,\n      y: pt.y + m_maxRadius   // GCS coordinates are bottom to top\n    });\n\n    // Get the lower left corner in geo coordinates\n    max = map.displayToGcs({\n      x: pt.x + m_maxRadius,\n      y: pt.y - m_maxRadius\n    });\n\n    // Find points inside the bounding box\n    box = new geo.util.Box(geo.util.vect(min.x, min.y), geo.util.vect(max.x, max.y));\n    m_rangeTree.search(box).forEach(function (q) {\n      idx.push(q.idx);\n    });\n\n    // Filter by circular region\n    idx.forEach(function (i) {\n      var d = data[i],\n          p = m_this.position()(d, i),\n          dx, dy, rad;\n\n      rad = radius(data[i], i);\n      rad += stroke(data[i], i) ? strokeWidth(data[i], i) : 0;\n      p = map.gcsToDisplay(p);\n      dx = p.x - pt.x;\n      dy = p.y - pt.y;\n      if (Math.sqrt(dx * dx + dy * dy) <= rad) {\n        found.push(d);\n        ifound.push(i);\n      }\n    });\n\n    return {\n      data: found,\n      index: ifound\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns an array of datum indices that are contained in the given box.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boxSearch = function (lowerLeft, upperRight) {\n    var pos = m_this.position(),\n        idx = [];\n    // TODO: use the range tree\n    m_this.data().forEach(function (d, i) {\n      var p = pos(d);\n      if (p.x >= lowerLeft.x &&\n          p.x <= upperRight.x &&\n          p.y >= lowerLeft.y &&\n          p.y <= upperRight.y\n      ) {\n        idx.push(i);\n      }\n    });\n    return idx;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Overloaded data method that updates the internal range tree on write.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function (data) {\n    if (data === undefined) {\n      return s_data();\n    }\n    s_data(data);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Overloaded style method that updates the internal range tree on write.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style = function (arg1, arg2) {\n    var val = s_style(arg1, arg2);\n    if (val === m_this && m_this.selectionAPI()) {\n      m_this._updateRangeTree();\n    }\n    return val;\n  };\n  this.style.get = s_style.get;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the bounding box for a given datum in screen coordinates as an\n   * object: ::\n   *\n   *   {\n   *     min: {\n   *       x: value,\n   *       y: value\n   *     },\n   *     max: {\n   *       x: value,\n   *       y: value\n   *     }\n   *   }\n   *\n   * @returns {object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._boundingBox = function (d) {\n    var pt, radius;\n\n    // get the position in geo coordinates\n    pt = m_this.position()(d);\n\n    // convert to screen coordinates\n    pt = m_this.layer().map().gcsToDisplay(pt);\n\n    // get the radius of the points (should we add stroke width?)\n    radius = m_this.style().radius(d);\n\n    return {\n      min: {\n        x: pt.x - radius,\n        y: pt.y - radius\n      },\n      max: {\n        x: pt.x + radius,\n        y: pt.y + radius\n      }\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        radius: 10.0,\n        stroke: true,\n        strokeColor: { r: 0.0, g: 1.0, b: 0.0 },\n        strokeWidth: 2.0,\n        strokeOpacity: 1.0,\n        fillColor: { r: 1.0, g: 0.0, b: 0.0 },\n        fill: true,\n        fillOpacity: 1.0,\n        sprites: false,\n        sprites_image: null,\n        position: function (d) { return d; }\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    if (arg.position !== undefined) {\n      defaultStyle.position = arg.position;\n    }\n\n    m_this.style(defaultStyle);\n    m_this.dataTime().modified();\n  };\n\n  return m_this;\n};\n\ngeo.event.pointFeature = $.extend({}, geo.event.feature);\n\n/**\n * Object specification for a point feature.\n *\n * @extends geo.feature.spec // need to make a jsdoc plugin for this to work\n * @typedef geo.pointFeature.spec\n * @type {object}\n */\n\n/**\n * Create a pointFeature from an object.\n * @see {@link geo.feature.create}\n * @param {geo.layer} layer The layer to add the feature to\n * @param {geo.pointFeature.spec} spec The object specification\n * @returns {geo.pointFeature|null}\n */\ngeo.pointFeature.create = function (layer, renderer, spec) {\n  \"use strict\";\n\n  spec.type = \"point\";\n  return geo.feature.create(layer, spec);\n};\n\ninherit(geo.pointFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.lineFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.lineFeature)) {\n    return new geo.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set line accessor\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.line = function (val) {\n    if (val === undefined) {\n      return m_this.style(\"line\");\n    } else {\n      m_this.style(\"line\", val);\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set position accessor\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_this.style(\"position\");\n    } else {\n      m_this.style(\"position\", val);\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns an array of datum indices that contain the given point.\n   * This is a slow implementation with runtime order of the number of\n   * vertices.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pointSearch = function (p) {\n    var data, pt, map, line, width, indices = [], found = [], pos;\n    data = m_this.data();\n    if (!data || !data.length) {\n      return {\n        found: [],\n        index: []\n      };\n    }\n\n    map = m_this.layer().map();\n    line = m_this.line();\n    width = m_this.style.get(\"strokeWidth\");\n    pos = m_this.position();\n    pt = map.gcsToDisplay(p);\n\n    // minimum l2 distance squared from\n    // q -> line(u, v)\n    function lineDist2(q, u, v) {\n      var t, l2 = dist2(u, v);\n\n      if (l2 < 1) {\n        // u, v are within 1 pixel\n        return dist2(q, u);\n      }\n\n      t = ((q.x - u.x) * (v.x - u.x) + (q.y - u.y) * (v.y - u.y)) / l2;\n      if (t < 0) { return dist2(q, u); }\n      if (t > 1) { return dist2(q, v); }\n      return dist2(\n        q,\n        {\n          x: u.x + t * (v.x - u.x),\n          y: u.y + t * (v.y - u.y)\n        }\n      );\n    }\n\n    // l2 distance squared from u to v\n    function dist2(u, v) {\n      var dx = u.x - v.x,\n          dy = u.y - v.y;\n      return dx * dx + dy * dy;\n    }\n\n    // for each line\n    data.forEach(function (d, index) {\n      var last = null;\n\n      try {\n        line(d, index).forEach(function (current, j) {\n\n          // get the screen coordinates of the current point\n          var p = pos(current, j, d, index);\n          var s = map.gcsToDisplay(p);\n          var r = Math.ceil(width(p, j, d, index) / 2) + 2;\n          r = r * r;\n\n          if (last) {\n            // test the line segment s -> last\n            if (lineDist2(pt, s, last) <= r) {\n\n              // short circuit the loop here\n              throw \"found\";\n            }\n          }\n\n          last = s;\n        });\n      } catch (err) {\n        if (err !== \"found\") {\n          throw err;\n        }\n        found.push(d);\n        indices.push(index);\n      }\n    });\n\n    return {\n      data: found,\n      index: indices\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns an array of line indices that are contained in the given box.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boxSearch = function (lowerLeft, upperRight, opts) {\n    var pos = m_this.position(),\n        idx = [],\n        line = m_this.line();\n\n    opts = opts || {};\n    opts.partial = opts.partial || false;\n    if (opts.partial) {\n      throw \"Unimplemented query method.\";\n    }\n\n    m_this.data().forEach(function (d, i) {\n      var inside = true;\n      line(d, i).forEach(function (e, j) {\n        if (!inside) { return; }\n        var p = pos(e, j, d, i);\n        if (!(p.x >= lowerLeft.x  &&\n              p.x <= upperRight.x &&\n              p.y >= lowerLeft.y  &&\n              p.y <= upperRight.y)\n        ) {\n          inside = false;\n        }\n      });\n      if (inside) {\n        idx.push(i);\n      }\n    });\n    return idx;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"strokeWidth\": 1.0,\n        // Default to gold color for lines\n        \"strokeColor\": { r: 1.0, g: 0.8431372549, b: 0.0 },\n        \"strokeStyle\": \"solid\",\n        \"strokeOpacity\": 1.0,\n        \"line\": function (d) { return d; },\n        \"position\": function (d) { return d; }\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    if (arg.line !== undefined) {\n      defaultStyle.line = arg.line;\n    }\n\n    if (arg.position !== undefined) {\n      defaultStyle.position = arg.position;\n    }\n\n\n    m_this.style(defaultStyle);\n\n    m_this.dataTime().modified();\n  };\n\n  this._init(arg);\n  return this;\n};\n\n/**\n * Create a lineFeature from an object.\n * @see {@link geo.feature.create}\n * @param {geo.layer} layer The layer to add the feature to\n * @param {geo.lineFeature.spec} spec The object specification\n * @returns {geo.lineFeature|null}\n */\ngeo.lineFeature.create = function (layer, spec) {\n  \"use strict\";\n\n  spec.type = \"line\";\n  return geo.feature.create(layer, spec);\n};\n\ninherit(geo.lineFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pathFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.pathFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.pathFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.pathFeature)) {\n    return new geo.pathFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_position = arg.position === undefined ? [] : arg.position,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set positions\n   *\n   * @returns {geo.pathFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_position;\n    }\n    // Copy incoming array of positions\n    m_position = val;\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"strokeWidth\": function () { return 1; },\n        \"strokeColor\": function () { return { r: 1.0, g: 1.0, b: 1.0 }; }\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n\n    if (m_position) {\n      m_this.dataTime().modified();\n    }\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.pathFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class polygonFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.polygonFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.polygonFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.polygonFeature)) {\n    return new geo.polygonFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_position,\n      m_polygon,\n      s_init = this._init,\n      s_data = this.data,\n      m_coordinates = {outer: [], inner: []};\n\n  if (arg.line === undefined) {\n    m_polygon = function (d) {\n      return d;\n    };\n  } else {\n    m_polygon = arg.polygon;\n  }\n\n  if (arg.position === undefined) {\n    m_position = function (d) {\n      return d;\n    };\n  } else {\n    m_position = arg.position;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Override the parent data method to keep track of changes to the\n   * internal coordinates.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function (arg) {\n    var ret = s_data(arg);\n    if (arg !== undefined) {\n      getCoordinates();\n    }\n    return ret;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the internal coordinates whenever the data changes.  For now, we do\n   * the computation in world coordinates, but we will need to work in GCS\n   * for other projections.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getCoordinates() {\n    var posFunc = m_this.position(),\n        polyFunc = m_this.polygon();\n    m_coordinates = m_this.data().map(function (d, i) {\n      var poly = polyFunc(d);\n      var outer, inner;\n\n      outer = (poly.outer || []).map(function (d0, j) {\n        return posFunc.call(m_this, d0, j, d, i);\n      });\n\n      inner = (poly.inner || []).map(function (hole) {\n        return (hole || []).map(function (d0, k) {\n          return posFunc.call(m_this, d0, k, d, i);\n        });\n      });\n      return {\n        outer: outer,\n        inner: inner\n      };\n    });\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set line accessor\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.polygon = function (val) {\n    if (val === undefined) {\n      return m_polygon;\n    } else {\n      m_polygon = val;\n      m_this.dataTime().modified();\n      m_this.modified();\n      getCoordinates();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set position accessor\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_position;\n    } else {\n      m_position = val;\n      m_this.dataTime().modified();\n      m_this.modified();\n      getCoordinates();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Point searce method for selection api.  Returns markers containing the\n   * given point.\n   * @argument {Object} coordinate\n   * @returns {Object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pointSearch = function (coordinate) {\n    var found = [], indices = [], data = m_this.data();\n    m_coordinates.forEach(function (coord, i) {\n      var inside = geo.util.pointInPolygon(\n        coordinate,\n        coord.outer,\n        coord.inner\n      );\n      if (inside) {\n        indices.push(i);\n        found.push(data[i]);\n      }\n    });\n    return {\n      index: indices,\n      found: found\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"fillColor\": { r: 0.0,  g: 0.5, b: 0.5 },\n        \"fillOpacity\": 1.0\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n\n    if (m_position) {\n      m_this.dataTime().modified();\n    }\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.polygonFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class planeFeature\n *\n * @class\n * @extends geo.polygonFeature\n * @returns {geo.planeFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.planeFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.planeFeature)) {\n    return new geo.planeFeature(arg);\n  }\n  arg = arg || {};\n\n  // Defaults\n  arg.ul = arg.ul === undefined ? [0.0, 1.0, 0.0] : arg.ul;\n  arg.lr = arg.lr === undefined ? [1.0, 0.0, 0.0] : arg.lr;\n  arg.depth = arg.depth === undefined ? 0.0 : arg.depth;\n\n  geo.polygonFeature.call(this, arg);\n\n  var m_this = this,\n      m_origin = [arg.ul.x, arg.lr.y, arg.depth],\n      m_upperLeft = [arg.ul.x, arg.ul.y, arg.depth],\n      m_lowerRight = [arg.lr.x, arg.lr.y, arg.depth],\n      m_defaultDepth = arg.depth,\n      m_drawOnAsyncResourceLoad = arg.drawOnAsyncResourceLoad === undefined ?\n                                    true : false,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set origin\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.origin = function (val) {\n    if (val === undefined) {\n      return m_origin;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_origin = val.slice(0);\n      if (m_origin.length === 2) {\n        m_origin[2] = m_defaultDepth;\n      }\n    } else if (val instanceof geo.latlng) {\n      m_origin = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set pt1\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.upperLeft = function (val) {\n    if (val === undefined) {\n      return m_upperLeft;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_upperLeft = val.slice(0);\n      if (m_upperLeft.length === 2) {\n        m_upperLeft[2] = m_defaultDepth;\n      }\n    } else if (val instanceof geo.latlng) {\n      m_upperLeft = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set origin\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.lowerRight = function (val) {\n    if (val === undefined) {\n      return m_lowerRight;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_lowerRight = val.slice(0);\n      if (m_lowerRight.length === 2) {\n        m_lowerRight[2] = m_defaultDepth;\n      }\n      m_this.dataTime().modified();\n    } else if (val instanceof geo.latlng) {\n      m_lowerRight = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if draw should happen as soon as a async resource is loaded\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawOnAsyncResourceLoad = function (val) {\n    if (val === undefined) {\n      return m_drawOnAsyncResourceLoad;\n    } else {\n      m_drawOnAsyncResourceLoad = val;\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var style = null;\n    s_init.call(m_this, arg);\n    style = m_this.style();\n    if (style.image === undefined) {\n      style.image = null;\n    }\n    m_this.style(style);\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.planeFeature, geo.polygonFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vectorFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.vectorFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.vectorFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.vectorFeature)) {\n    return new geo.vectorFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      s_style = this.style;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the accessor for the origin of the vector.  This is the point\n   * that the vector base resides at.  Defaults to (0, 0, 0).\n   * @param {geo.accessor|geo.geoPosition} [accessor] The origin accessor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.origin = function (val) {\n    if (val === undefined) {\n      return s_style('origin');\n    } else {\n      s_style('origin', val);\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the accessor for the displacement (coordinates) of the vector.\n   * @param {geo.accessor|geo.geoPosition} [accessor] The accessor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.delta = function (val) {\n    if (val === undefined) {\n      return s_style('delta');\n    } else {\n      s_style('delta', val);\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        strokeColor: 'black',\n        strokeWidth: 2.0,\n        strokeOpacity: 1.0,\n        // TODO: define styles for the end markers\n        // originStyle: 'none',\n        // endStyle: 'arrow',\n        origin: {x: 0, y: 0, z: 0},\n        delta: function (d) { return d; },\n        scale: null // size scaling factor (null -> renderer decides)\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    if (arg.origin !== undefined) {\n      defaultStyle.origin = arg.origin;\n    }\n\n    m_this.style(defaultStyle);\n    m_this.dataTime().modified();\n  };\n};\n\ninherit(geo.vectorFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class geomFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.geomFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.geomFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.geomFeature)) {\n    return new geo.geomFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  arg.style = arg.style === undefined ? $.extend({}, {\n    \"color\": [1.0, 1.0, 1.0],\n    \"point_sprites\": false,\n    \"point_sprites_image\": null\n  }, arg.style) : arg.style;\n\n  // Update style\n  this.style(arg.style);\n\n  return this;\n};\n\ninherit(geo.geomFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class graphFeature\n *\n * @class\n * @extends geo.feature\n * @returns {geo.graphFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.graphFeature = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.graphFeature)) {\n    return new geo.graphFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_draw = this.draw,\n      s_style = this.style,\n      m_nodes = null,\n      m_points = null,\n      m_children = function (d) { return d.children; },\n      m_links = [],\n      s_init = this._init,\n      s_exit = this._exit;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(true, {},\n      {\n        nodes: {\n          radius: 5.0,\n          fill: true,\n          fillColor: { r: 1.0, g: 0.0, b: 0.0 },\n          strokeColor: { r: 0, g: 0, b: 0 }\n        },\n        links: {\n          strokeColor: { r: 0.0, g: 0.0, b: 0.0 }\n        },\n        linkType: \"path\" /* 'path' || 'line' */\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n    m_this.nodes(function (d) { return d; });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call child _build methods\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    m_this.children().forEach(function (child) {\n      child._build();\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call child _update methods\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    m_this.children().forEach(function (child) {\n      child._update();\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Custom _exit method to remove all sub-features\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.data([]);\n    m_links.forEach(function (link) {\n      link._exit();\n      m_this.removeChild(link);\n    });\n    m_links = [];\n    m_points._exit();\n    m_this.removeChild(m_points);\n    s_exit();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set style\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style = function (arg, arg2) {\n    var out = s_style.call(m_this, arg, arg2);\n    if (out !== m_this) {\n      return out;\n    }\n    // set styles for sub-features\n    m_points.style(arg.nodes);\n    m_links.forEach(function (l) {\n      l.style(arg.links);\n    });\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set links accessor.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.links = function (arg) {\n    if (arg === undefined) {\n      return m_children;\n    }\n\n    m_children = geo.util.ensureFunction(arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set nodes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.nodes = function (val) {\n    if (val === undefined) {\n      return m_nodes;\n    }\n    m_nodes = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal node feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.nodeFeature = function () {\n    return m_points;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal link features\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.linkFeatures = function () {\n    return m_links;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build the feature for drawing\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n\n    var layer = m_this.layer(),\n        data = m_this.data(),\n        nLinks = 0,\n        style;\n\n    // get the feature style object\n    style = m_this.style();\n\n    // Bind data to the point nodes\n    m_points.data(data);\n    m_points.style(style.nodes);\n\n    // get links from node connections\n    data.forEach(function (source) {\n      (source.children || []).forEach(function (target) {\n        var link;\n        nLinks += 1;\n        if (m_links.length < nLinks) {\n          link = geo.createFeature(\n            style.linkType, layer, layer.renderer()\n          ).style(style.links);\n          m_this.addChild(link);\n          m_links.push(link);\n        }\n        m_links[nLinks - 1].data([source, target]);\n      });\n    });\n\n    m_links.splice(nLinks, m_links.length - nLinks).forEach(function (l) {\n      l._exit();\n      m_this.removeChild(l);\n    });\n\n    s_draw();\n    return m_this;\n  };\n\n  m_points = geo.createFeature(\n    \"point\",\n    this.layer(),\n    this.layer().renderer()\n  );\n  m_this.addChild(m_points);\n\n  if (arg.nodes) {\n    this.nodes(arg.nodes);\n  }\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.graphFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform geometric data of a feature from source projection to destination\n * projection.\n *\n * @namespace\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform = {};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Custom transform for a feature used for OpenStreetMap\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.osmTransformFeature = function (destGcs, feature, inplace) {\n  /// TODO\n  /// Currently we make assumption that incoming feature is in 4326\n  /// which may not be true.\n\n  \"use strict\";\n\n  if (!feature) {\n    console.log(\"[warning] Invalid (null) feature\");\n    return;\n  }\n\n  if (feature.gcs() === destGcs) {\n    return;\n  }\n\n  if (!(feature instanceof geo.pointFeature ||\n        feature instanceof geo.lineFeature)) {\n    throw \"Supports only point or line feature\";\n  }\n\n  var noOfComponents = null,\n      pointOffset = 0,\n      count = null,\n      inPos = null,\n      outPos = null,\n      srcGcs = feature.gcs(),\n      i,\n      yCoord;\n\n  inplace = !!inplace;\n  if (feature instanceof geo.pointFeature ||\n      feature instanceof geo.lineFeature) {\n\n    ///  If source GCS is not in 4326, transform it first into 4326\n    /// before we transform it for OSM.\n    if (srcGcs !== \"EPSG:4326\") {\n      geo.transform.transformFeature(\"EPSG:4326\", feature, true);\n    }\n\n    inPos = feature.positions();\n    count = inPos.length;\n\n    if (!(inPos instanceof Array)) {\n      throw \"Supports Array of 2D and 3D points\";\n    }\n\n    if (inPos.length > 0 && inPos[0] instanceof geo.latlng) {\n      noOfComponents = 2;\n      pointOffset = 1;\n    } else {\n      noOfComponents = (count % 2 === 0 ? 2 :\n                       (count % 3 === 0 ? 3 : null));\n      pointOffset = noOfComponents;\n    }\n\n    if (noOfComponents !== 2 && noOfComponents !== 3) {\n      throw \"Transform points require points in 2D or 3D\";\n    }\n\n    if (inplace) {\n      outPos = inPos;\n    } else {\n      outPos = inPos.slice(0);\n    }\n\n    for (i = 0; i < count; i += pointOffset) {\n\n      /// Y goes from 0 (top edge is 85.0511 °N) to 2zoom − 1\n      /// (bottom edge is 85.0511 °S) in a Mercator projection.\n      if (inPos[i] instanceof geo.latlng) {\n        yCoord = inPos[i].lat();\n      } else {\n        yCoord = inPos[i + 1];\n      }\n\n      if (yCoord > 85.0511) {\n        yCoord = 85.0511;\n      }\n      if (yCoord < -85.0511) {\n        yCoord = -85.0511;\n      }\n      if (inPos[i] instanceof geo.latlng) {\n        outPos[i] = geo.latlng(geo.mercator.lat2y(yCoord), outPos[i].lng());\n      } else {\n        outPos[i + 1] = geo.mercator.lat2y(yCoord);\n      }\n    }\n\n    if (inplace) {\n      feature.positions(outPos);\n      feature.gcs(destGcs);\n    }\n    return outPos;\n  }\n\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform a feature to destination GCS\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformFeature = function (destGcs, feature, inplace) {\n  \"use strict\";\n\n  if (!feature) {\n    throw \"Invalid (null) feature\";\n  }\n\n  if (!(feature instanceof geo.pointFeature ||\n        feature instanceof geo.lineFeature)) {\n    throw \"Supports only point or line feature\";\n  }\n\n  if (feature.gcs() === destGcs) {\n    return feature.positions();\n  }\n\n  if (destGcs === \"EPSG:3857\") {\n    return geo.transform.osmTransformFeature(destGcs, feature, inplace);\n  }\n\n  var noOfComponents = null,\n      pointOffset = 0,\n      count = null,\n      inPos = null,\n      outPos = null,\n      projPoint = null,\n      srcGcs = feature.gcs(),\n      i,\n      projSrcGcs = new proj4.Proj(srcGcs),\n      projDestGcs = new proj4.Proj(destGcs);\n\n  inplace = !!inplace;\n  if (feature instanceof geo.pointFeature ||\n      feature instanceof geo.lineFeature) {\n    inPos = feature.positions();\n    count = inPos.length;\n\n    if (!(inPos instanceof Array)) {\n      throw \"Supports Array of 2D and 3D points\";\n    }\n\n    if (inPos.length > 0 && inPos[0] instanceof geo.latlng) {\n      noOfComponents = 2;\n      pointOffset = 1;\n    } else {\n      noOfComponents = (count % 2 === 0 ? 2 :\n                       (count % 3 === 0 ? 3 : null));\n      pointOffset = noOfComponents;\n    }\n\n    if (noOfComponents !== 2 && noOfComponents !== 3) {\n      throw \"Transform points require points in 2D or 3D\";\n    }\n\n    if (inplace) {\n      outPos = inPos;\n    } else {\n      outPos = [];\n      outPos.length = inPos.length;\n    }\n\n    for (i = 0; i < count; i += pointOffset) {\n      if (noOfComponents === 2) {\n        projPoint = new proj4.Point(inPos[i], inPos[i + 1], 0.0);\n      } else {\n        projPoint = new proj4.Point(inPos[i], inPos[i + 1], inPos[i + 2]);\n      }\n\n      proj4.transform(projSrcGcs, projDestGcs, projPoint);\n\n      if (noOfComponents === 2) {\n        outPos[i] =  projPoint.x;\n        outPos[i + 1] = projPoint.y;\n      } else {\n        outPos[i] = projPoint.x;\n        outPos[i + 1] = projPoint.y;\n        outPos[i + 2] = projPoint.z;\n      }\n    }\n\n    if (inplace) {\n      feature.positions(outPos);\n      feature.gcs(destGcs);\n    }\n\n    return outPos;\n  }\n\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform geometric data of a layer from source projection to destination\n * projection.\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformLayer = function (destGcs, layer, baseLayer) {\n  \"use strict\";\n\n  var features, count, i;\n\n  if (!layer) {\n    throw \"Requires valid layer for tranformation\";\n  }\n\n  if (!baseLayer) {\n    throw \"Requires baseLayer used by the map\";\n  }\n\n  if (layer === baseLayer) {\n    return;\n  }\n\n  if (layer instanceof geo.featureLayer) {\n    features = layer.features();\n    count = features.length;\n    i = 0;\n\n    for (i = 0; i < count; i += 1) {\n      if (destGcs === \"EPSG:3857\" && baseLayer instanceof geo.osmLayer) {\n        geo.transform.osmTransformFeature(\n          destGcs, features[i], true);\n      } else {\n        geo.transform.transformFeature(\n          destGcs, features[i], true);\n      }\n    }\n\n    layer.gcs(destGcs);\n  } else {\n    throw \"Only feature layer transformation is supported\";\n  }\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform position coordinates from source projection to destination\n * projection.\n *\n * @param {string} srcGcs GCS of the coordinates\n * @param {string} destGcs Desired GCS of the transformed coordinates\n * @param {object} coordinates\n * @return {geo.latlng|geo.latlng[]} Transformed coordinates\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformCoordinates = function (srcGcs, destGcs, coordinates,\n                                               numberOfComponents) {\n  \"use strict\";\n\n  var i, count, offset, xCoord, yCoord, zCoord, xAcc,\n      yAcc, zAcc, writer, output, projPoint,\n      projSrcGcs = new proj4.Proj(srcGcs),\n      projDestGcs = new proj4.Proj(destGcs);\n\n  /// Default Z accessor\n  zAcc = function () {\n    return 0.0;\n  };\n\n  if (destGcs === srcGcs) {\n    return coordinates;\n  }\n\n  /// TODO: Can we check for EPSG code?\n  if (!destGcs || !srcGcs) {\n    throw \"Invalid source or destination GCS\";\n  }\n\n  /// Helper methods\n  function handleLatLngCoordinates() {\n    if (coordinates[0] && coordinates[0] instanceof geo.latlng) {\n      xAcc = function (index) {\n        return coordinates[index].x();\n      };\n      yAcc = function (index) {\n        return coordinates[index].y();\n      };\n      writer = function (index, x, y) {\n        output[index] = geo.latlng(y, x);\n      };\n    } else {\n      xAcc = function () {\n        return coordinates.x();\n      };\n      yAcc = function () {\n        return coordinates.y();\n      };\n      writer = function (index, x, y) {\n        output = geo.latlng(y, x);\n      };\n    }\n  }\n\n  /// Helper methods\n  function handleArrayCoordinates() {\n    if (coordinates[0] instanceof Array) {\n      if (coordinates[0].length === 2) {\n        xAcc = function (index) {\n          return coordinates[index][0];\n        };\n        yAcc = function (index) {\n          return coordinates[index][1];\n        };\n        writer = function (index, x, y) {\n          output[index] = [x, y];\n        };\n      } else if (coordinates[0].length === 3) {\n        xAcc = function (index) {\n          return coordinates[index][0];\n        };\n        yAcc = function (index) {\n          return coordinates[index][1];\n        };\n        zAcc = function (index) {\n          return coordinates[index][2];\n        };\n        writer = function (index, x, y, z) {\n          output[index] = [x, y, z];\n        };\n      } else {\n        throw \"Invalid coordinates. Requires two or three components per array\";\n      }\n    } else {\n      if (coordinates.length === 2) {\n        offset = 2;\n\n        xAcc = function (index) {\n          return coordinates[index * offset];\n        };\n        yAcc = function (index) {\n          return coordinates[index * offset + 1];\n        };\n        writer = function (index, x, y) {\n          output[index] = x;\n          output[index + 1] = y;\n        };\n      } else if (coordinates.length === 3) {\n        offset = 3;\n\n        xAcc = function (index) {\n          return coordinates[index * offset];\n        };\n        yAcc = function (index) {\n          return coordinates[index * offset + 1];\n        };\n        zAcc = function (index) {\n          return coordinates[index * offset + 2];\n        };\n        writer = function (index, x, y, z) {\n          output[index] = x;\n          output[index + 1] = y;\n          output[index + 2] = z;\n        };\n      } else if (numberOfComponents) {\n        if (numberOfComponents === 2 || numberOfComponents || 3) {\n          offset = numberOfComponents;\n\n          xAcc = function (index) {\n            return coordinates[index];\n          };\n          yAcc = function (index) {\n            return coordinates[index + 1];\n          };\n          if (numberOfComponents === 2) {\n            writer = function (index, x, y) {\n              output[index] = x;\n              output[index + 1] = y;\n            };\n          } else {\n            zAcc = function (index) {\n              return coordinates[index + 2];\n            };\n            writer = function (index, x, y, z) {\n              output[index] = x;\n              output[index + 1] = y;\n              output[index + 2] = z;\n            };\n          }\n        } else {\n          throw \"Number of components should be two or three\";\n        }\n      } else {\n        throw \"Invalid coordinates\";\n      }\n    }\n  }\n\n  /// Helper methods\n  function handleObjectCoordinates() {\n    if (coordinates[0] &&\n        \"x\" in coordinates[0] &&\n        \"y\" in coordinates[0]) {\n      xAcc = function (index) {\n        return coordinates[index].x;\n      };\n      yAcc = function (index) {\n        return coordinates[index].y;\n      };\n\n      if (\"z\" in coordinates[0]) {\n        zAcc = function (index) {\n          return coordinates[index].z;\n        };\n        writer = function (index, x, y, z) {\n          output[i] = {x: x, y: y, z: z};\n        };\n      } else {\n        writer = function (index, x, y) {\n          output[index] = {x: x, y: y};\n        };\n      }\n    } else if (coordinates &&\n        \"x\" in coordinates && \"y\" in coordinates) {\n      xAcc = function () {\n        return coordinates.x;\n      };\n      yAcc = function () {\n        return coordinates.y;\n      };\n\n      if (\"z\" in coordinates) {\n        zAcc = function () {\n          return coordinates.z;\n        };\n        writer = function (index, x, y, z) {\n          output = {x: x, y: y, z: z};\n        };\n      } else {\n        writer = function (index, x, y) {\n          output = {x: x, y: y};\n        };\n      }\n    } else {\n      throw \"Invalid coordinates\";\n    }\n  }\n\n  if (coordinates instanceof Array) {\n    output = [];\n    output.length = coordinates.length;\n    count = coordinates.length;\n\n    if (coordinates[0] instanceof Array ||\n        coordinates[0] instanceof geo.latlng ||\n        coordinates[0] instanceof Object) {\n      offset = 1;\n\n      if (coordinates[0] instanceof Array) {\n        handleArrayCoordinates();\n      } else if (coordinates[0] instanceof geo.latlng) {\n        handleLatLngCoordinates();\n      } else if (coordinates[0] instanceof Object) {\n        handleObjectCoordinates();\n      }\n    } else {\n      handleArrayCoordinates();\n    }\n  } else if (coordinates && coordinates instanceof Object) {\n    count = 1;\n    offset = 1;\n    if (coordinates instanceof geo.latlng) {\n      handleLatLngCoordinates();\n    } else if (coordinates && \"x\" in coordinates && \"y\" in coordinates) {\n      handleObjectCoordinates();\n    } else {\n      throw \"Coordinates are not valid\";\n    }\n  }\n\n  if (destGcs === \"EPSG:3857\" && srcGcs === \"EPSG:4326\") {\n    for (i = 0; i < count; i += offset) {\n      /// Y goes from 0 (top edge is 85.0511 °N) to 2zoom − 1\n      /// (bottom edge is 85.0511 °S) in a Mercator projection.\n      xCoord = xAcc(i);\n      yCoord = yAcc(i);\n      zCoord = zAcc(i);\n\n      if (yCoord > 85.0511) {\n        yCoord = 85.0511;\n      }\n      if (yCoord < -85.0511) {\n        yCoord = -85.0511;\n      }\n\n      writer(i, xCoord, geo.mercator.lat2y(yCoord), zCoord);\n    }\n\n    return output;\n  } else {\n    for (i = 0; i < count; i += offset) {\n      projPoint = new proj4.Point(xAcc(i), yAcc(i), zAcc(i));\n      proj4.transform(projSrcGcs, projDestGcs, projPoint);\n      writer(i, projPoint.x, projPoint.y, projPoint.z);\n      return output;\n    }\n  }\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderer\n *\n * @class\n * @extends geo.object\n * @returns {geo.renderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.renderer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.renderer)) {\n    return new geo.renderer(arg);\n  }\n  geo.object.call(this);\n\n  arg = arg || {};\n  var m_this = this,\n      m_layer = arg.layer === undefined ? null : arg.layer,\n      m_canvas = arg.canvas === undefined ? null : arg.canvas,\n      m_initialized = false;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer of the renderer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas for the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function (val) {\n    if (val === undefined) {\n      return m_canvas;\n    } else {\n      m_canvas = val;\n      m_this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map that this renderer belongs to\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function () {\n    if (m_layer) {\n      return m_layer.map();\n    } else {\n      return null;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get base layer that belongs to this renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.baseLayer = function () {\n    if (m_this.map()) {\n      return m_this.map().baseLayer();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if renderer has been initialized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initialized = function (val) {\n    if (val === undefined) {\n      return m_initialized;\n    } else {\n      m_initialized = val;\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get render API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function () {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from world to GCS coordinate space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToGcs = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to GCS space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToGcs = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to GCS space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcsToDisplay = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from world to display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to world space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get mouse coodinates related to canvas\n   *\n   * @param {object} event\n   * @returns {object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.relMouseCoords = function (event) {\n    var totalOffsetX = 0,\n        totalOffsetY = 0,\n        canvasX = 0,\n        canvasY = 0,\n        currentElement = m_this.canvas();\n\n    do {\n      totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;\n      totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;\n      currentElement = currentElement.offsetParent;\n    } while (currentElement);\n\n    canvasX = event.pageX - totalOffsetX;\n    canvasY = event.pageY - totalOffsetY;\n\n    return {\n      x: canvasX,\n      y: canvasY\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._render = function () {\n  };\n\n  return this;\n};\n\ninherit(geo.renderer, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of osmLayer\n *\n * @class\n * @extends geo.featureLayer\n *\n * @param {Object} arg - arg can contain following keys: baseUrl,\n *        imageFormat (such as png or jpeg), and displayLast\n *        (to decide whether or not render tiles from last zoom level).\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.osmLayer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.osmLayer)) {\n    return new geo.osmLayer(arg);\n  }\n  geo.featureLayer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private member variables\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n    s_exit = this._exit,\n    m_tiles = {},\n    m_hiddenBinNumber = -1,\n    m_lastVisibleBinNumber = -1,\n    m_visibleBinNumber = 1000,\n    m_pendingNewTiles = [],\n    m_pendingInactiveTiles = [],\n    m_numberOfCachedTiles = 0,\n    m_tileCacheSize = 100,\n    m_baseUrl = \"http://tile.openstreetmap.org/\",\n    m_mapOpacity = 1.0,\n    m_imageFormat = \"png\",\n    m_updateTimerId = null,\n    m_lastVisibleZoom = null,\n    m_visibleTilesRange = {},\n    s_init = this._init,\n    m_pendingNewTilesStat = {},\n    s_update = this._update,\n    m_updateDefer = null,\n    m_zoom = null,\n    m_tileUrl;\n\n  if (arg && arg.baseUrl !== undefined) {\n    m_baseUrl = arg.baseUrl;\n  }\n\n  if (m_baseUrl.charAt(m_baseUrl.length - 1) !== \"/\") {\n    m_baseUrl += \"/\";\n  }\n\n  if (arg && arg.mapOpacity !== undefined) {\n    m_mapOpacity = arg.mapOpacity;\n  }\n  if (arg && arg.imageFormat !== undefined) {\n    m_imageFormat = arg.imageFormat;\n  }\n\n  if (arg && arg.displayLast !== undefined && arg.displayLast) {\n    m_lastVisibleBinNumber = 999;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns a url string containing the requested tile.  This default\n   * version uses the open street map standard, but the user can\n   * change the default behavior.\n   *\n   * @param {integer} zoom The zoom level\n   * @param {integer} x The tile from the xth row\n   * @param {integer} y The tile from the yth column\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  m_tileUrl = function (zoom, x, y) {\n    return m_baseUrl + zoom + \"/\" + x +\n      \"/\" + y + \".\" + m_imageFormat;\n  };\n\n  if (arg && arg.tileUrl !== undefined) {\n    m_tileUrl = arg.tileUrl;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if a tile is visible in current view\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function isTileVisible(tile) {\n    if (tile.zoom in m_visibleTilesRange) {\n      if (tile.index_x >= m_visibleTilesRange[tile.zoom].startX &&\n          tile.index_x <= m_visibleTilesRange[tile.zoom].endX &&\n          tile.index_y >= m_visibleTilesRange[tile.zoom].startY &&\n          tile.index_y <= m_visibleTilesRange[tile.zoom].endY) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Draw new tiles and remove the old ones\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function drawTiles() {\n    m_this._removeTiles();\n    m_this.draw();\n    delete m_pendingNewTilesStat[m_updateTimerId];\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set tile cache size\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.tileCacheSize = function (val) {\n    if (val === undefined) {\n      return m_tileCacheSize;\n    }\n    m_tileCacheSize = val;\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set the tile url formatting function.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.tileUrl = function (val) {\n    if (val === undefined) {\n      return m_tileUrl;\n    }\n    m_tileUrl = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in latitude-longitude-altitude\n   * space to local space of the layer\n   *\n   * @param {*} input\n   * Input can be of following types:\n   *\n   *   1. geo.latlng\n   *   2. [geo.latlng]\n   *   3. [x1,y1, x2, y2]\n   *   4. [[x,y]]\n   *   5. {x:val: y:val, z:val},\n   *   6. [{x:val: y:val}]\n   *\n   * returns geo.latlng, [geo.latlng], or {x:lon, y:lat}, [{x:lon, y:lat}]\n   * [x1,y1, x2, y2], [[x,y]]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toLocal = function (input) {\n    var i, output, delta;\n\n    /// Now handle different data types\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n      output.length = input.length;\n\n      /// Input is array of geo.latlng\n      if (input[0] instanceof geo.latlng) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = geo.latlng(input[i]);\n          output[i].lat(geo.mercator.lat2y(output[i].lat()));\n        }\n      } else if (input[0] instanceof Array) {\n        delta = input % 3 === 0 ? 3 : 2;\n\n        if (delta === 2) {\n          for (i = 0; i < input.length; i += delta) {\n            output[i] = input[i];\n            output[i + 1] = geo.mercator.lat2y(input[i + 1]);\n          }\n        } else {\n          for (i = 0; i < input.length; i += delta) {\n            output[i] = input[i];\n            output[i + 1] = geo.mercator.lat2y(input[i + 1]);\n            output[i + 2] = input[i + 2];\n          }\n        }\n      } else if (input[0] instanceof Object &&\n                 \"x\" in input[0] && \"y\" in input[0] && \"z\" in input[0]) {\n        /// Input is array of object\n        output[i] = { x: input[i].x, y: geo.mercator.lat2y(input[i].y),\n                      z: input[i].z };\n      } else if (input[0] instanceof Object &&\n                 \"x\" in input[0] && \"y\" in input[0] && \"z\" in input[0]) {\n        /// Input is array of object\n        output[i] = { x: input[i].x, y: geo.mercator.lat2y(input[i].y)};\n      } else if (input.length >= 2) {\n        output = input.slice(0);\n        output[1] = geo.mercator.lat2y(input[1]);\n      }\n    } else if (input instanceof geo.latlng) {\n      output = {};\n      output.x = input.x();\n      output.y = geo.mercator.lat2y(input.y());\n    } else {\n      output = {};\n      output.x = input.x;\n      output.y = geo.mercator.lat2y(input.y);\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in local space to\n   * latitude-longitude space\n   *\n   * @input Input An object, array, of array of objects/array representing 2D\n   * point in space. [x,y], [[x,y]], [{x:val: y:val}], {x:val, y:val}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fromLocal = function (input) {\n    var i, output;\n\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n      output.length = input.length;\n\n      if (input[0] instanceof Object) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = {};\n          output[i].x = input[i].x;\n          output[i].y = geo.mercator.y2lat(input[i].y);\n        }\n      } else if (input[0] instanceof Array) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = input[i];\n          output[i][1] = geo.mercator.y2lat(input[i][1]);\n        }\n      } else {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = input[i];\n          output[i + 1] = geo.mercator.y2lat(input[i + 1]);\n        }\n      }\n    } else {\n      output = {};\n      output.x = input.x;\n      output.y = geo.mercator.y2lat(input.y);\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if a tile exists in the cache\n   *\n   * @param {number} zoom The zoom value for the map [1-17]\n   * @param {number} x X axis tile index\n   * @param {number} y Y axis tile index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._hasTile = function (zoom, x, y) {\n    if (!m_tiles[zoom]) {\n      return false;\n    }\n    if (!m_tiles[zoom][x]) {\n      return false;\n    }\n    if (!m_tiles[zoom][x][y]) {\n      return false;\n    }\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a new tile\n   * @param {number} x X axis tile index\n   * @param {number} y Y axis tile index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._addTile = function (request, zoom, x, y) {\n    if (!m_tiles[zoom]) {\n      m_tiles[zoom] = {};\n    }\n    if (!m_tiles[zoom][x]) {\n      m_tiles[zoom][x] = {};\n    }\n    if (m_tiles[zoom][x][y]) {\n      return;\n    }\n\n    /// Compute corner points\n    var noOfTilesX = Math.max(1, Math.pow(2, zoom)),\n        noOfTilesY = Math.max(1, Math.pow(2, zoom)),\n        /// Convert into mercator\n        totalLatDegrees = 360.0,\n        lonPerTile = 360.0 / noOfTilesX,\n        latPerTile = totalLatDegrees / noOfTilesY,\n        llx = -180.0 + x * lonPerTile,\n        lly = -totalLatDegrees * 0.5 + y * latPerTile,\n        urx = -180.0 + (x + 1) * lonPerTile,\n        ury = -totalLatDegrees * 0.5 + (y + 1) * latPerTile,\n        tile = new Image();\n\n    tile.LOADING = true;\n    tile.LOADED = false;\n    tile.REMOVED = false;\n    tile.REMOVING = false;\n    tile.INVALID = false;\n\n    tile.crossOrigin = \"anonymous\";\n    tile.zoom = zoom;\n    tile.index_x = x;\n    tile.index_y = y;\n    tile.llx = llx;\n    tile.lly = lly;\n    tile.urx = urx;\n    tile.ury = ury;\n    tile.lastused = new Date();\n\n    tile.src = m_tileUrl(zoom, x, Math.pow(2, zoom) - 1 - y);\n\n    m_tiles[zoom][x][y] = tile;\n    m_pendingNewTiles.push(tile);\n    m_numberOfCachedTiles += 1;\n    return tile;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear tiles that are no longer required\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  /* jshint -W089 */\n  this._removeTiles = function () {\n    var i, x, y, tile, zoom, currZoom = m_zoom,\n        lastZoom = m_lastVisibleZoom;\n\n    if (!m_tiles) {\n      return m_this;\n    }\n\n    for (zoom in m_tiles) {\n      for (x in m_tiles[zoom]) {\n        for (y in m_tiles[zoom][x]) {\n          tile = m_tiles[zoom][x][y];\n          if (tile) {\n            tile.REMOVING = true;\n            m_pendingInactiveTiles.push(tile);\n          }\n        }\n      }\n    }\n\n    /// First remove the tiles if we have cached more than max cached limit\n    m_pendingInactiveTiles.sort(function (a, b) {\n      return a.lastused - b.lastused;\n    });\n\n    i = 0;\n\n    /// Get rid of tiles if we have reached our threshold. However,\n    /// If the tile is required for current zoom, then do nothing.\n    /// Also do not delete the tile if it is from the previous zoom\n    while (m_numberOfCachedTiles > m_tileCacheSize &&\n      i < m_pendingInactiveTiles.length) {\n      tile = m_pendingInactiveTiles[i];\n\n      if (isTileVisible(tile)) {\n        i += 1;\n      } else {\n        m_this.deleteFeature(tile.feature);\n        delete m_tiles[tile.zoom][tile.index_x][tile.index_y];\n        m_pendingInactiveTiles.splice(i, 1);\n        m_numberOfCachedTiles -= 1;\n      }\n    }\n\n    for (i = 0; i < m_pendingInactiveTiles.length; i += 1) {\n      tile = m_pendingInactiveTiles[i];\n      tile.REMOVING = false;\n      tile.REMOVED = false;\n      if (tile.zoom !== currZoom && tile.zoom === lastZoom) {\n        tile.feature.bin(m_lastVisibleBinNumber);\n      } else if (tile.zoom !== currZoom) {\n        tile.feature.bin(m_hiddenBinNumber);\n      } else {\n        tile.lastused = new Date();\n        tile.feature.bin(m_visibleBinNumber);\n      }\n      tile.feature._update();\n    }\n    m_pendingInactiveTiles = [];\n\n    return m_this;\n  };\n  /* jshint +W089 */\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create / delete tiles as necessary\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._addTiles = function (request) {\n    var feature, ren = m_this.renderer(),\n        /// First get corner points\n        /// In display coordinates the origin is on top left corner (0, 0)\n        llx = 0.0, lly = m_this.height(), urx = m_this.width(), ury = 0.0,\n        temp = null, tile = null, tile1x = null, tile1y = null, tile2x = null,\n        tile2y = null, invJ = null, i = 0, j = 0, lastStartX, lastStartY,\n        lastEndX, lastEndY, currStartX, currStartY, currEndX, currEndY,\n        worldPt1 = ren.displayToWorld([llx, lly]),\n        worldPt2 = ren.displayToWorld([urx, ury]),\n        worldDeltaY = null, displayDeltaY = null,\n        worldDelta = null, displayDelta = null,\n        noOfTilesRequired = null, worldDeltaPerTile = null,\n        minDistWorldDeltaPerTile = null, distWorldDeltaPerTile;\n\n    worldPt1[0] = Math.max(worldPt1[0], -180.0);\n    worldPt1[0] = Math.min(worldPt1[0], 180.0);\n    worldPt1[1] = Math.max(worldPt1[1], -180.0);\n    worldPt1[1] = Math.min(worldPt1[1], 180.0);\n\n    worldPt2[0] = Math.max(worldPt2[0], -180.0);\n    worldPt2[0] = Math.min(worldPt2[0], 180.0);\n    worldPt2[1] = Math.max(worldPt2[1], -180.0);\n    worldPt2[1] = Math.min(worldPt2[1], 180.0);\n\n    /// Compute tile zoom\n    worldDelta = Math.abs(worldPt2[0] - worldPt1[0]);\n    worldDeltaY = Math.abs(worldPt2[1] - worldPt1[1]);\n\n    displayDelta = urx - llx;\n    displayDeltaY = lly - ury;\n\n    /// Reuse variables\n    if (displayDeltaY > displayDelta) {\n      displayDelta = displayDeltaY;\n      worldDelta = worldDeltaY;\n    }\n\n    noOfTilesRequired = Math.round(displayDelta / 256.0);\n    worldDeltaPerTile = worldDelta / noOfTilesRequired;\n\n    /// Minimize per pixel distortion\n    minDistWorldDeltaPerTile = Number.POSITIVE_INFINITY;\n    for (i = 20; i >= 2; i = i - 1) {\n      distWorldDeltaPerTile = Math.abs(360.0 / Math.pow(2, i) - worldDeltaPerTile);\n      if (distWorldDeltaPerTile < minDistWorldDeltaPerTile) {\n        minDistWorldDeltaPerTile = distWorldDeltaPerTile;\n        m_zoom = i;\n      }\n    }\n\n    /// Compute tilex and tiley\n    tile1x = geo.mercator.long2tilex(worldPt1[0], m_zoom);\n    tile1y = geo.mercator.lat2tiley(worldPt1[1], m_zoom);\n\n    tile2x = geo.mercator.long2tilex(worldPt2[0], m_zoom);\n    tile2y = geo.mercator.lat2tiley(worldPt2[1], m_zoom);\n\n    /// Clamp tilex and tiley\n    tile1x = Math.max(tile1x, 0);\n    tile1x = Math.min(Math.pow(2, m_zoom) - 1, tile1x);\n    tile1y = Math.max(tile1y, 0);\n    tile1y = Math.min(Math.pow(2, m_zoom) - 1, tile1y);\n\n    tile2x = Math.max(tile2x, 0);\n    tile2x = Math.min(Math.pow(2, m_zoom) - 1, tile2x);\n    tile2y = Math.max(tile2y, 0);\n    tile2y = Math.min(Math.pow(2, m_zoom) - 1, tile2y);\n\n    /// Check and update variables appropriately if view\n    /// direction is flipped. This should not happen but\n    /// just in case.\n    if (tile1x > tile2x) {\n      temp = tile1x;\n      tile1x = tile2x;\n      tile2x = temp;\n    }\n    if (tile2y > tile1y) {\n      temp = tile1y;\n      tile1y = tile2y;\n      tile2y = temp;\n    }\n\n    /// Compute current tile indices\n    currStartX = tile1x;\n    currEndX = tile2x;\n    currStartY = (Math.pow(2, m_zoom) - 1 - tile1y);\n    currEndY = (Math.pow(2, m_zoom) - 1 - tile2y);\n    if (currEndY < currStartY) {\n      temp = currStartY;\n      currStartY = currEndY;\n      currEndY = temp;\n    }\n\n    /// Compute last tile indices\n    lastStartX = geo.mercator.long2tilex(worldPt1[0],\n                   m_lastVisibleZoom);\n    lastStartY = geo.mercator.lat2tiley(worldPt1[1],\n                   m_lastVisibleZoom);\n    lastEndX = geo.mercator.long2tilex(worldPt2[0],\n                   m_lastVisibleZoom);\n    lastEndY = geo.mercator.lat2tiley(worldPt2[1],\n                   m_lastVisibleZoom);\n    lastStartY = Math.pow(2, m_lastVisibleZoom) - 1 - lastStartY;\n    lastEndY   = Math.pow(2, m_lastVisibleZoom) - 1 - lastEndY;\n\n    if (lastEndY < lastStartY) {\n      temp = lastStartY;\n      lastStartY = lastEndY;\n      lastEndY = temp;\n    }\n\n    m_visibleTilesRange = {};\n    m_visibleTilesRange[m_zoom] = { startX: currStartX, endX: currEndX,\n                                    startY: currStartY, endY: currEndY };\n\n    m_visibleTilesRange[m_lastVisibleZoom] =\n                                { startX: lastStartX, endX: lastEndX,\n                                  startY: lastStartY, endY: lastEndY };\n    m_pendingNewTilesStat[m_updateTimerId] = { total:\n      ((tile2x - tile1x + 1) * (tile1y - tile2y + 1)), count: 0 };\n\n    for (i = tile1x; i <= tile2x; i += 1) {\n      for (j = tile2y; j <= tile1y; j += 1) {\n        invJ = (Math.pow(2, m_zoom) - 1 - j);\n        if (!m_this._hasTile(m_zoom, i, invJ)) {\n          tile = m_this._addTile(request, m_zoom, i, invJ);\n        } else {\n          tile = m_tiles[m_zoom][i][invJ];\n          tile.feature.bin(m_visibleBinNumber);\n          if (tile.LOADED && m_updateTimerId in m_pendingNewTilesStat) {\n            m_pendingNewTilesStat[m_updateTimerId].count += 1;\n          }\n          tile.lastused = new Date();\n          tile.feature._update();\n        }\n        tile.updateTimerId = m_updateTimerId;\n      }\n    }\n\n    // define a function here to set tile properties after it is loaded\n    function tileOnLoad(tile) {\n      var defer = $.Deferred();\n      m_this.addDeferred(defer);\n\n      return function () {\n        if (tile.INVALID) {\n          return;\n        }\n        tile.LOADING = false;\n        tile.LOADED = true;\n        if ((tile.REMOVING || tile.REMOVED) &&\n          tile.feature &&\n          tile.zoom !== m_zoom) {\n          tile.feature.bin(m_hiddenBinNumber);\n          tile.REMOVING = false;\n          tile.REMOVED = true;\n        } else {\n          tile.REMOVED = false;\n          tile.lastused = new Date();\n          tile.feature.bin(m_visibleBinNumber);\n        }\n\n        if (tile.updateTimerId === m_updateTimerId &&\n            m_updateTimerId in m_pendingNewTilesStat) {\n          tile.feature.bin(m_visibleBinNumber);\n          m_pendingNewTilesStat[m_updateTimerId].count += 1;\n        } else {\n          tile.REMOVED = true;\n          tile.feature.bin(m_hiddenBinNumber);\n        }\n        tile.feature._update();\n\n        if (m_updateTimerId in m_pendingNewTilesStat &&\n            m_pendingNewTilesStat[m_updateTimerId].count >=\n            m_pendingNewTilesStat[m_updateTimerId].total) {\n          drawTiles();\n        }\n        defer.resolve();\n      };\n    }\n\n    /// And now finally add them\n    for (i = 0; i < m_pendingNewTiles.length; i += 1) {\n      tile = m_pendingNewTiles[i];\n      feature = m_this.createFeature(\n        \"plane\", {drawOnAsyncResourceLoad: false, onload: tileOnLoad(tile)})\n        .origin([tile.llx, tile.lly])\n        .upperLeft([tile.llx, tile.ury])\n        .lowerRight([tile.urx, tile.lly])\n        .gcs(\"EPSG:3857\")\n        .style({image: tile, opacity: m_mapOpacity});\n      tile.feature = feature;\n      tile.feature._update();\n    }\n    m_pendingNewTiles = [];\n\n    if (m_updateTimerId in m_pendingNewTilesStat &&\n        m_pendingNewTilesStat[m_updateTimerId].count >=\n        m_pendingNewTilesStat[m_updateTimerId].total) {\n      drawTiles();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update OSM tiles as needed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function updateOSMTiles(request) {\n    if (request === undefined) {\n      request = {};\n    }\n\n    if (!m_zoom) {\n      m_zoom = m_this.map().zoom();\n    }\n\n    if (!m_lastVisibleZoom) {\n      m_lastVisibleZoom = m_zoom;\n    }\n\n    /// Add tiles that are currently visible\n    m_this._addTiles(request);\n\n    /// Update the zoom\n    if (m_lastVisibleZoom !== m_zoom) {\n      m_lastVisibleZoom = m_zoom;\n    }\n\n    m_this.updateTime().modified();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create / delete tiles as necessary\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._updateTiles = function (request) {\n    var defer = $.Deferred();\n    m_this.addDeferred(defer);\n\n    if (m_updateTimerId !== null) {\n      clearTimeout(m_updateTimerId);\n      m_updateDefer.resolve();\n      m_updateDefer = defer;\n      if (m_updateTimerId in m_pendingNewTilesStat) {\n        delete m_pendingNewTilesStat[m_updateTimerId];\n      }\n      /// Set timeout for 60 ms. 60 ms seems to playing well\n      /// with the events. Also, 60ms corresponds to 15 FPS.\n      m_updateTimerId = setTimeout(function () {\n        updateOSMTiles(request);\n        m_updateDefer.resolve();\n      }, 100);\n    } else {\n      m_updateDefer = defer;\n      m_updateTimerId = setTimeout(function () {\n        updateOSMTiles(request);\n        m_updateDefer.resolve();\n      }, 0);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Do not call parent _init method as its already been executed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    s_init.call(m_this);\n    m_this.gcs(\"EPSG:3857\");\n    m_this.map().zoomRange({\n      min: 0,\n      max: 18\n    });\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    /// Update tiles (create new / delete old etc...)\n    m_this._updateTiles(request);\n\n    /// Now call base class update\n    s_update.call(m_this, request);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update baseUrl for map tiles.  Map all tiles as needing to be refreshed.\n   *\n   * @param baseUrl: the new baseUrl for the map.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  /* jshint -W089 */\n  this.updateBaseUrl = function (baseUrl) {\n    if (baseUrl.charAt(m_baseUrl.length - 1) !== \"/\") {\n      baseUrl += \"/\";\n    }\n    if (baseUrl !== m_baseUrl) {\n      m_baseUrl = baseUrl;\n\n      var tile, x, y, zoom;\n      for (zoom in m_tiles) {\n        for (x in m_tiles[zoom]) {\n          for (y in m_tiles[zoom][x]) {\n            tile = m_tiles[zoom][x][y];\n            tile.INVALID = true;\n            m_this.deleteFeature(tile.feature);\n          }\n        }\n      }\n      m_tiles = {};\n      m_pendingNewTiles = [];\n      m_pendingInactiveTiles = [];\n      m_numberOfCachedTiles = 0;\n      m_visibleTilesRange = {};\n      m_pendingNewTilesStat = {};\n\n      if (m_updateTimerId !== null) {\n        clearTimeout(m_updateTimerId);\n        m_updateTimerId = null;\n      }\n      this._update();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set map opacity\n   *\n   * @returns {geo.osmLayer}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.mapOpacity = function (val) {\n    if (val === undefined) {\n      return m_mapOpacity;\n    } else if (val !== m_mapOpacity) {\n      m_mapOpacity = val;\n      var zoom, x, y, tile;\n      for (zoom in m_tiles) {\n        for (x in m_tiles[zoom]) {\n          for (y in m_tiles[zoom][x]) {\n            tile = m_tiles[zoom][x][y];\n            tile.feature.style().opacity = val;\n            tile.feature._update();\n          }\n        }\n      }\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_tiles = {};\n    m_pendingNewTiles = [];\n    m_pendingInactiveTiles = [];\n    m_numberOfCachedTiles = 0;\n    m_visibleTilesRange = {};\n    m_pendingNewTilesStat = {};\n    s_exit();\n  };\n\n  return this;\n};\n\ninherit(geo.osmLayer, geo.featureLayer);\n\ngeo.registerLayer(\"osm\", geo.osmLayer);\n","/**\n * @namespace\n */\ngeo.gl = {};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vglRenderer\n *\n * @class\n * @extends geo.renderer\n * @param canvas\n * @returns {geo.gl.renderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.renderer = function (arg) {\n  'use strict';\n\n  if (!(this instanceof geo.gl.renderer)) {\n    return new geo.gl.renderer(arg);\n  }\n  geo.renderer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.contextRenderer = function () {\n    throw 'Should be implemented by derived classes';\n  };\n\n  return this;\n};\n\ninherit(geo.gl.renderer, geo.renderer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of lineFeature\n *\n * @class\n * @extends geo.lineFeature\n * @returns {geo.gl.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.lineFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.gl.lineFeature)) {\n    return new geo.gl.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.lineFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_exit = this._exit,\n      m_actor = null,\n      m_mapper = null,\n      m_material = null,\n      m_pixelWidthUnif = null,\n      m_aspectUniform = null,\n      m_dynamicDraw = arg.dynamicDraw === undefined ? false : arg.dynamicDraw,\n      s_init = this._init,\n      s_update = this._update;\n\n  function createVertexShader() {\n    var vertexShaderSource = [\n      '#ifdef GL_ES',\n      '  precision highp float;',\n      '#endif',\n      'attribute vec3 pos;',\n      'attribute vec3 prev;',\n      'attribute vec3 next;',\n      'attribute float offset;',\n\n      'attribute vec3 strokeColor;',\n      'attribute float strokeOpacity;',\n      'attribute float strokeWidth;',\n\n      'uniform mat4 modelViewMatrix;',\n      'uniform mat4 projectionMatrix;',\n      'uniform float pixelWidth;',\n      'uniform float aspect;',\n\n      'varying vec3 strokeColorVar;',\n      'varying float strokeWidthVar;',\n      'varying float strokeOpacityVar;',\n\n      'void main(void)',\n      '{',\n      /* If any vertex has been deliberately set to a negative opacity,\n       * skip doing computations on it. */\n      '  if (strokeOpacity < 0.0) {',\n      '    gl_Position = vec4(2, 2, 0, 1);',\n      '    return;',\n      '  }',\n      '  const float PI = 3.14159265358979323846264;',\n      '  vec4 worldPos = projectionMatrix * modelViewMatrix * vec4(pos.xyz, 1);',\n      '  if (worldPos.w != 0.0) {',\n      '    worldPos = worldPos/worldPos.w;',\n      '  }',\n      '  vec4 worldNext = projectionMatrix * modelViewMatrix * vec4(next.xyz, 1);',\n      '  if (worldNext.w != 0.0) {',\n      '    worldNext = worldNext/worldNext.w;',\n      '  }',\n      '  vec4 worldPrev = projectionMatrix* modelViewMatrix * vec4(prev.xyz, 1);',\n      '  if (worldPrev.w != 0.0) {',\n      '    worldPrev = worldPrev/worldPrev.w;',\n      '  }',\n      '  strokeColorVar = strokeColor;',\n      '  strokeWidthVar = strokeWidth;',\n      '  strokeOpacityVar = strokeOpacity;',\n      '  vec2 deltaNext = worldNext.xy - worldPos.xy;',\n      '  vec2 deltaPrev = worldPos.xy - worldPrev.xy;',\n      '  float angleNext = 0.0, anglePrev = 0.0;',\n      '  if (deltaNext.xy != vec2(0.0, 0.0))',\n      '    angleNext = atan(deltaNext.y / aspect, deltaNext.x);',\n      '  if (deltaPrev.xy == vec2(0.0, 0.0)) anglePrev = angleNext;',\n      '  else  anglePrev = atan(deltaPrev.y / aspect, deltaPrev.x);',\n      '  if (deltaNext.xy == vec2(0.0, 0.0)) angleNext = anglePrev;',\n      '  float angle = (anglePrev + angleNext) / 2.0;',\n      '  float cosAngle = cos(anglePrev - angle);',\n      '  if (cosAngle < 0.1) { cosAngle = sign(cosAngle) * 1.0; angle = 0.0; }',\n      '  float distance = (offset * strokeWidth * pixelWidth) /',\n      '                    cosAngle;',\n      '  worldPos.x += distance * sin(angle);',\n      '  worldPos.y -= distance * cos(angle) * aspect;',\n      '  gl_Position = worldPos;',\n      '}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.VERTEX_SHADER);\n    shader.setShaderSource(vertexShaderSource);\n    return shader;\n  }\n\n  function createFragmentShader() {\n    var fragmentShaderSource = [\n      '#ifdef GL_ES',\n      '  precision highp float;',\n      '#endif',\n      'varying vec3 strokeColorVar;',\n      'varying float strokeWidthVar;',\n      'varying float strokeOpacityVar;',\n      'void main () {',\n      '  gl_FragColor = vec4 (strokeColorVar, strokeOpacityVar);',\n      '}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n    shader.setShaderSource(fragmentShaderSource);\n    return shader;\n  }\n\n  function createGLLines() {\n    var data = m_this.data(),\n        i, j, k, v,\n        numSegments = 0, len,\n        lineItem, lineItemData,\n        vert = [{}, {}], vertTemp,\n        pos, posIdx3,\n        position = [],\n        posFunc = m_this.position(),\n        strkWidthFunc = m_this.style.get('strokeWidth'),\n        strkColorFunc = m_this.style.get('strokeColor'),\n        strkOpacityFunc = m_this.style.get('strokeOpacity'),\n        order = m_this.featureVertices(),\n        posBuf, nextBuf, prevBuf, offsetBuf, indicesBuf,\n        strokeWidthBuf, strokeColorBuf, strokeOpacityBuf,\n        dest, dest3,\n        geom = m_mapper.geometryData();\n\n    for (i = 0; i < data.length; i += 1) {\n      lineItem = m_this.line()(data[i], i);\n      numSegments += lineItem.length - 1;\n      for (j = 0; j < lineItem.length; j += 1) {\n        pos = posFunc(lineItem[j], j, lineItem, i);\n        if (pos instanceof geo.latlng) {\n          position.push(pos.x());\n          position.push(pos.y());\n          position.push(0.0);\n        } else {\n          position.push(pos.x);\n          position.push(pos.y);\n          position.push(pos.z || 0.0);\n        }\n      }\n    }\n\n    position = geo.transform.transformCoordinates(\n                 m_this.gcs(), m_this.layer().map().gcs(),\n                 position, 3);\n\n    len = numSegments * order.length;\n    posBuf           = getBuffer(geom, 'pos', len * 3);\n    nextBuf          = getBuffer(geom, 'next', len * 3);\n    prevBuf          = getBuffer(geom, 'prev', len * 3);\n    offsetBuf        = getBuffer(geom, 'offset', len * 1);\n    strokeWidthBuf   = getBuffer(geom, 'strokeWidth', len * 1);\n    strokeColorBuf   = getBuffer(geom, 'strokeColor', len * 3);\n    strokeOpacityBuf = getBuffer(geom, 'strokeOpacity', len * 1);\n    indicesBuf = geom.primitive(0).indices();\n    if (!(indicesBuf instanceof Uint16Array) || indicesBuf.length !== len) {\n      indicesBuf = new Uint16Array(len);\n      geom.primitive(0).setIndices(indicesBuf);\n    }\n\n    for (i = posIdx3 = dest = dest3 = 0; i < data.length; i += 1) {\n      lineItem = m_this.line()(data[i], i);\n      for (j = 0; j < lineItem.length; j += 1, posIdx3 += 3) {\n        lineItemData = lineItem[j];\n        /* swap entries in vert so that vert[0] is the first vertex, and\n         * vert[1] will be reused for the second vertex */\n        if (j) {\n          vertTemp = vert[0];\n          vert[0] = vert[1];\n          vert[1] = vertTemp;\n        }\n        vert[1].pos = posIdx3;\n        vert[1].prev = posIdx3 - (j ? 3 : 0);\n        vert[1].next = posIdx3 + (j + 1 < lineItem.length ? 3 : 0);\n        vert[1].strokeWidth = strkWidthFunc(lineItemData, j, lineItem, i);\n        vert[1].strokeColor = strkColorFunc(lineItemData, j, lineItem, i);\n        vert[1].strokeOpacity = strkOpacityFunc(lineItemData, j, lineItem, i);\n        if (j) {\n          for (k = 0; k < order.length; k += 1, dest += 1, dest3 += 3) {\n            v = vert[order[k][0]];\n            posBuf[dest3]     = position[v.pos];\n            posBuf[dest3 + 1] = position[v.pos + 1];\n            posBuf[dest3 + 2] = position[v.pos + 2];\n            prevBuf[dest3]     = position[v.prev];\n            prevBuf[dest3 + 1] = position[v.prev + 1];\n            prevBuf[dest3 + 2] = position[v.prev + 2];\n            nextBuf[dest3]     = position[v.next];\n            nextBuf[dest3 + 1] = position[v.next + 1];\n            nextBuf[dest3 + 2] = position[v.next + 2];\n            offsetBuf[dest] = order[k][1];\n            /* We can ignore the indicies (they will all be zero) */\n            strokeWidthBuf[dest] = v.strokeWidth;\n            strokeColorBuf[dest3]     = v.strokeColor.r;\n            strokeColorBuf[dest3 + 1] = v.strokeColor.g;\n            strokeColorBuf[dest3 + 2] = v.strokeColor.b;\n            strokeOpacityBuf[dest] = v.strokeOpacity;\n          }\n        }\n      }\n    }\n\n    geom.boundsDirty(true);\n    m_mapper.modified();\n    m_mapper.boundsDirtyTimestamp().modified();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get a buffer for a geometry source.  If a buffer already exists and is\n   * the correct size, return it.  Otherwise, allocate a new buffer; any data\n   * in an old buffer is discarded.\n   *\n   * @param geom: the geometry to reference and modify.\n   * @param srcName: the name of the source.\n   * @param len: the number of elements for the array.\n   * @returns {Float32Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getBuffer(geom, srcName, len) {\n    var src = geom.sourceByName(srcName), data;\n\n    data = src.data();\n    if (data instanceof Float32Array && data.length === len) {\n      return data;\n    }\n    data = new Float32Array(len);\n    src.setData(data);\n    return data;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the arrangement of vertices used for each line segment.\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.featureVertices = function () {\n    return [[0, 1], [1, -1], [0, -1], [0, 1], [1, 1], [1, -1]];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the number of vertices used for each line segment.\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.verticesPerFeature = function () {\n    return this.featureVertices().length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var prog = vgl.shaderProgram(),\n        vs = createVertexShader(),\n        fs = createFragmentShader(),\n        // Vertex attributes\n        posAttr = vgl.vertexAttribute('pos'),\n        prvAttr = vgl.vertexAttribute('prev'),\n        nxtAttr = vgl.vertexAttribute('next'),\n        offAttr = vgl.vertexAttribute('offset'),\n        strkWidthAttr = vgl.vertexAttribute('strokeWidth'),\n        strkColorAttr = vgl.vertexAttribute('strokeColor'),\n        strkOpacityAttr = vgl.vertexAttribute('strokeOpacity'),\n        // Shader uniforms\n        mviUnif = new vgl.modelViewUniform('modelViewMatrix'),\n        prjUnif = new vgl.projectionUniform('projectionMatrix'),\n        geom = vgl.geometryData(),\n        // Sources\n        posData = vgl.sourceDataP3fv({'name': 'pos'}),\n        prvPosData = vgl.sourceDataAnyfv(\n            3, vgl.vertexAttributeKeysIndexed.Four, {'name': 'prev'}),\n        nxtPosData = vgl.sourceDataAnyfv(\n            3, vgl.vertexAttributeKeysIndexed.Five, {'name': 'next'}),\n        offPosData = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Six, {'name': 'offset'}),\n        strkWidthData = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.One, {'name': 'strokeWidth'}),\n        strkColorData = vgl.sourceDataAnyfv(\n            3, vgl.vertexAttributeKeysIndexed.Two, {'name': 'strokeColor'}),\n        strkOpacityData = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Three,\n            {'name': 'strokeOpacity'}),\n        // Primitive indices\n        triangles = vgl.triangles();\n\n    m_pixelWidthUnif =  new vgl.floatUniform('pixelWidth',\n                          1.0 / m_this.renderer().width());\n    m_aspectUniform = new vgl.floatUniform('aspect',\n        m_this.renderer().width() / m_this.renderer().height());\n\n    s_init.call(m_this, arg);\n    m_material = vgl.material();\n    m_mapper = vgl.mapper({dynamicDraw: m_dynamicDraw});\n\n    prog.addVertexAttribute(posAttr, vgl.vertexAttributeKeys.Position);\n    prog.addVertexAttribute(strkWidthAttr, vgl.vertexAttributeKeysIndexed.One);\n    prog.addVertexAttribute(strkColorAttr, vgl.vertexAttributeKeysIndexed.Two);\n    prog.addVertexAttribute(strkOpacityAttr, vgl.vertexAttributeKeysIndexed.Three);\n    prog.addVertexAttribute(prvAttr, vgl.vertexAttributeKeysIndexed.Four);\n    prog.addVertexAttribute(nxtAttr, vgl.vertexAttributeKeysIndexed.Five);\n    prog.addVertexAttribute(offAttr, vgl.vertexAttributeKeysIndexed.Six);\n\n    prog.addUniform(mviUnif);\n    prog.addUniform(prjUnif);\n    prog.addUniform(m_pixelWidthUnif);\n    prog.addUniform(m_aspectUniform);\n\n    prog.addShader(fs);\n    prog.addShader(vs);\n\n    m_material.addAttribute(prog);\n    m_material.addAttribute(vgl.blend());\n\n    m_actor = vgl.actor();\n    m_actor.setMaterial(m_material);\n    m_actor.setMapper(m_mapper);\n\n    geom.addSource(posData);\n    geom.addSource(prvPosData);\n    geom.addSource(nxtPosData);\n    geom.addSource(strkWidthData);\n    geom.addSource(strkColorData);\n    geom.addSource(strkOpacityData);\n    geom.addSource(offPosData);\n    geom.addPrimitive(triangles);\n    m_mapper.setGeometryData(geom);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return list of actors\n   *\n   * @returns {vgl.actor[]}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.actors = function () {\n    if (!m_actor) {\n      return [];\n    }\n    return [m_actor];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    createGLLines();\n\n    m_this.renderer().contextRenderer().addActor(m_actor);\n    m_this.buildTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_this.buildTime().getMTime() ||\n        m_this.updateTime().getMTime() <= m_this.getMTime()) {\n      m_this._build();\n    }\n\n    m_pixelWidthUnif.set(1.0 / m_this.renderer().width());\n    m_aspectUniform.set(m_this.renderer().width() /\n                        m_this.renderer().height());\n    m_actor.setVisible(m_this.visible());\n    m_actor.material().setBinNumber(m_this.bin());\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n    s_exit();\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.gl.lineFeature, geo.lineFeature);\n\n// Now register it\ngeo.registerFeature('vgl', 'line', geo.gl.lineFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pointFeature\n *\n * @class\n * @extends geo.pointFeature\n * @returns {geo.gl.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.pointFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.gl.pointFeature)) {\n    return new geo.gl.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.pointFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_exit = this._exit,\n      m_actor = null,\n      m_mapper = null,\n      m_pixelWidthUniform = null,\n      m_aspectUniform = null,\n      m_dynamicDraw = arg.dynamicDraw === undefined ? false : arg.dynamicDraw,\n      m_primitiveShape = \"sprite\", // arg can change this, below\n      s_init = this._init,\n      s_update = this._update,\n      vertexShaderSource = null,\n      fragmentShaderSource = null;\n\n  if (arg.primitiveShape === \"triangle\" ||\n      arg.primitiveShape === \"square\" ||\n      arg.primitiveShape === \"sprite\") {\n    m_primitiveShape = arg.primitiveShape;\n  }\n\n  vertexShaderSource = [\n    \"#ifdef GL_ES\",\n    \"  precision highp float;\",\n    \"#endif\",\n    \"attribute vec3 pos;\",\n    \"attribute float rad;\",\n    \"attribute vec3 fillColor;\",\n    \"attribute vec3 strokeColor;\",\n    \"attribute float fillOpacity;\",\n    \"attribute float strokeWidth;\",\n    \"attribute float strokeOpacity;\",\n    \"attribute float fill;\",\n    \"attribute float stroke;\",\n    \"uniform float pixelWidth;\",\n    \"uniform float aspect;\",\n    \"uniform mat4 modelViewMatrix;\",\n    \"uniform mat4 projectionMatrix;\",\n    \"varying vec4 fillColorVar;\",\n    \"varying vec4 strokeColorVar;\",\n    \"varying float radiusVar;\",\n    \"varying float strokeWidthVar;\",\n    \"varying float fillVar;\",\n    \"varying float strokeVar;\"\n  ];\n\n  if (m_primitiveShape !== \"sprite\") {\n    vertexShaderSource = vertexShaderSource.concat([\n      \"attribute vec2 unit;\",\n      \"varying vec3 unitVar;\"\n    ]);\n  }\n\n  vertexShaderSource.push.apply(vertexShaderSource, [\n    \"void main(void)\",\n    \"{\",\n    \"  strokeWidthVar = strokeWidth;\",\n    \"  // No stroke or fill implies nothing to draw\",\n    \"  if (stroke < 1.0 || strokeWidth <= 0.0 || strokeOpacity <= 0.0) {\",\n    \"    strokeVar = 0.0;\",\n    \"    strokeWidthVar = 0.0;\",\n    \"  }\",\n    \"  else\",\n    \"    strokeVar = 1.0;\",\n    \"  if (fill < 1.0 || rad <= 0.0 || fillOpacity <= 0.0)\",\n    \"    fillVar = 0.0;\",\n    \"  else\",\n    \"    fillVar = 1.0;\",\n    /* If the point has no visible pixels, skip doing computations on it. */\n    \"  if (fillVar == 0.0 && strokeVar == 0.0) {\",\n    \"    gl_Position = vec4(2, 2, 0, 1);\",\n    \"    return;\",\n    \"  }\",\n    \"  fillColorVar = vec4 (fillColor, fillOpacity);\",\n    \"  strokeColorVar = vec4 (strokeColor, strokeOpacity);\",\n    \"  radiusVar = rad;\"\n  ]);\n\n  if (m_primitiveShape === \"sprite\") {\n    vertexShaderSource.push.apply(vertexShaderSource, [\n      \"  gl_Position = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;\",\n      \"  gl_PointSize = 2.0 * (rad + strokeWidthVar); \",\n      \"}\"\n    ]);\n  } else {\n    vertexShaderSource.push.apply(vertexShaderSource, [\n        \"  unitVar = vec3 (unit, 1.0);\",\n        \"  vec4 p = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;\",\n        \"  if (p.w != 0.0) {\",\n        \"    p = p / p.w;\",\n        \"  }\",\n        \"  p += (rad + strokeWidthVar) * \",\n        \"       vec4 (unit.x * pixelWidth, unit.y * pixelWidth * aspect, 0.0, 1.0);\",\n        \"  gl_Position = vec4(p.xyz, 1.0);\",\n        \"}\"\n      ]);\n  }\n  vertexShaderSource = vertexShaderSource.join(\"\\n\");\n\n  fragmentShaderSource = [\n    \"#ifdef GL_ES\",\n    \"  precision highp float;\",\n    \"#endif\",\n    \"uniform float aspect;\",\n    \"varying vec4 fillColorVar;\",\n    \"varying vec4 strokeColorVar;\",\n    \"varying float radiusVar;\",\n    \"varying float strokeWidthVar;\",\n    \"varying float fillVar;\",\n    \"varying float strokeVar;\"\n  ];\n\n  if (m_primitiveShape !== \"sprite\") {\n    fragmentShaderSource.push(\"varying vec3 unitVar;\");\n  }\n\n  fragmentShaderSource.push.apply(fragmentShaderSource, [\n    \"void main () {\",\n    \"  vec4 strokeColor, fillColor;\",\n    \"  float endStep;\",\n    \"  // No stroke or fill implies nothing to draw\",\n    \"  if (fillVar == 0.0 && strokeVar == 0.0)\",\n    \"    discard;\"\n  ]);\n\n  if (m_primitiveShape === \"sprite\") {\n    fragmentShaderSource.push(\n      \"  float rad = 2.0 * length (gl_PointCoord - vec2(0.5));\");\n  } else {\n    fragmentShaderSource.push(\n      \"  float rad = length (unitVar.xy);\");\n  }\n\n  fragmentShaderSource.push.apply(fragmentShaderSource, [\n    \"  if (rad > 1.0)\",\n    \"    discard;\",\n    \"  // If there is no stroke, the fill region should transition to nothing\",\n    \"  if (strokeVar == 0.0) {\",\n    \"    strokeColor = vec4 (fillColorVar.rgb, 0.0);\",\n    \"    endStep = 1.0;\",\n    \"  } else {\",\n    \"    strokeColor = strokeColorVar;\",\n    \"    endStep = radiusVar / (radiusVar + strokeWidthVar);\",\n    \"  }\",\n    \"  // Likewise, if there is no fill, the stroke should transition to nothing\",\n    \"  if (fillVar == 0.0)\",\n    \"    fillColor = vec4 (strokeColor.rgb, 0.0);\",\n    \"  else\",\n    \"    fillColor = fillColorVar;\",\n    \"  // Distance to antialias over\",\n    \"  float antialiasDist = 3.0 / (2.0 * radiusVar);\",\n    \"  if (rad < endStep) {\",\n    \"    float step = smoothstep (endStep - antialiasDist, endStep, rad);\",\n    \"    gl_FragColor = mix (fillColor, strokeColor, step);\",\n    \"  } else {\",\n    \"    float step = smoothstep (1.0 - antialiasDist, 1.0, rad);\",\n    \"    gl_FragColor = mix (strokeColor, vec4 (strokeColor.rgb, 0.0), step);\",\n    \"  }\",\n    \"}\"\n  ]);\n\n  fragmentShaderSource = fragmentShaderSource.join(\"\\n\");\n\n  function createVertexShader() {\n    var shader = new vgl.shader(gl.VERTEX_SHADER);\n    shader.setShaderSource(vertexShaderSource);\n    return shader;\n  }\n\n  function createFragmentShader() {\n    var shader = new vgl.shader(gl.FRAGMENT_SHADER);\n    shader.setShaderSource(fragmentShaderSource);\n    return shader;\n  }\n\n  function pointPolygon(x, y, w, h) {\n    var verts;\n    switch (m_primitiveShape) {\n      case \"triangle\":\n        /* Use an equilateral triangle.  While this has 30% more area than a\n         * square, the reduction in vertices should help more than the\n         * processing the additional fragments. */\n        verts = [\n          x, y - h * 2,\n          x - w * Math.sqrt(3.0), y + h,\n          x + w * Math.sqrt(3.0), y + h\n        ];\n        break;\n      case \"sprite\":\n        /* Point sprite uses only one vertex per point. */\n        verts = [x, y];\n        break;\n      default: // \"square\"\n        /* Use a surrounding square split diagonally into two triangles. */\n        verts = [\n          x - w, y + h,\n          x - w, y - h,\n          x + w, y + h,\n          x - w, y - h,\n          x + w, y - h,\n          x + w, y + h\n        ];\n        break;\n    }\n    return verts;\n  }\n\n  function createGLPoints() {\n    // unit and associated data is not used when drawing sprite\n    var i, j, numPts = m_this.data().length,\n        unit = pointPolygon(0, 0, 1, 1),\n        position = new Array(numPts * 3), posBuf, posVal, posFunc,\n        unitBuf, indices,\n        radius, radiusVal, radFunc,\n        stroke, strokeVal, strokeFunc,\n        strokeWidth, strokeWidthVal, strokeWidthFunc,\n        strokeOpacity, strokeOpacityVal, strokeOpactityFunc,\n        strokeColor, strokeColorVal, strokeColorFunc,\n        fill, fillVal, fillFunc,\n        fillOpacity, fillOpacityVal, fillOpacityFunc,\n        fillColor, fillColorVal, fillColorFunc,\n        vpf = m_this.verticesPerFeature(),\n        data = m_this.data(),\n        item, ivpf, ivpf3, iunit, i3,\n        geom = m_mapper.geometryData();\n\n    posFunc = m_this.position();\n    radFunc = m_this.style.get(\"radius\");\n    strokeFunc = m_this.style.get(\"stroke\");\n    strokeWidthFunc = m_this.style.get(\"strokeWidth\");\n    strokeOpactityFunc = m_this.style.get(\"strokeOpacity\");\n    strokeColorFunc = m_this.style.get(\"strokeColor\");\n    fillFunc = m_this.style.get(\"fill\");\n    fillOpacityFunc = m_this.style.get(\"fillOpacity\");\n    fillColorFunc = m_this.style.get(\"fillColor\");\n\n    /* It is more efficient to do a transform on a single array rather than on\n     * an array of arrays or an array of objects. */\n    for (i = i3 = 0; i < numPts; i += 1, i3 += 3) {\n      posVal = posFunc(data[i]);\n      position[i3]     = posVal.x;\n      position[i3 + 1] = posVal.y;\n      position[i3 + 2] = posVal.z || 0;\n    }\n    position = geo.transform.transformCoordinates(\n                  m_this.gcs(), m_this.layer().map().gcs(),\n                  position, 3);\n\n    posBuf        = getBuffer(geom, \"pos\", vpf * numPts * 3);\n\n    if (m_primitiveShape !== \"sprite\") {\n      unitBuf       = getBuffer(geom, \"unit\", vpf * numPts * 2);\n    }\n\n    radius        = getBuffer(geom, \"rad\", vpf * numPts * 1);\n    stroke        = getBuffer(geom, \"stroke\", vpf * numPts * 1);\n    strokeWidth   = getBuffer(geom, \"strokeWidth\", vpf * numPts * 1);\n    strokeOpacity = getBuffer(geom, \"strokeOpacity\", vpf * numPts * 1);\n    strokeColor   = getBuffer(geom, \"strokeColor\", vpf * numPts * 3);\n    fill          = getBuffer(geom, \"fill\", vpf * numPts * 1);\n    fillOpacity   = getBuffer(geom, \"fillOpacity\", vpf * numPts * 1);\n    fillColor     = getBuffer(geom, \"fillColor\", vpf * numPts * 3);\n    indices = geom.primitive(0).indices();\n    if (!(indices instanceof Uint16Array) || indices.length !== vpf * numPts) {\n      indices = new Uint16Array(vpf * numPts);\n      geom.primitive(0).setIndices(indices);\n    }\n\n    for (i = ivpf = ivpf3 = iunit = i3 = 0; i < numPts; i += 1, i3 += 3) {\n      item = data[i];\n      if (m_primitiveShape !== \"sprite\") {\n        for (j = 0; j < unit.length; j += 1, iunit += 1) {\n          unitBuf[iunit] = unit[j];\n        }\n      }\n      /* We can ignore the indicies (they will all be zero) */\n      radiusVal = radFunc(item);\n      strokeVal = strokeFunc(item) ? 1.0 : 0.0;\n      strokeWidthVal = strokeWidthFunc(item);\n      strokeOpacityVal = strokeOpactityFunc(item);\n      strokeColorVal = strokeColorFunc(item);\n      fillVal = fillFunc(item) ? 1.0 : 0.0;\n      fillOpacityVal = fillOpacityFunc(item);\n      fillColorVal = fillColorFunc(item);\n      for (j = 0; j < vpf; j += 1, ivpf += 1, ivpf3 += 3) {\n        posBuf[ivpf3]     = position[i3];\n        posBuf[ivpf3 + 1] = position[i3 + 1];\n        posBuf[ivpf3 + 2] = position[i3 + 2];\n        radius[ivpf] = radiusVal;\n        stroke[ivpf] = strokeVal;\n        strokeWidth[ivpf] = strokeWidthVal;\n        strokeOpacity[ivpf] = strokeOpacityVal;\n        strokeColor[ivpf3]     = strokeColorVal.r;\n        strokeColor[ivpf3 + 1] = strokeColorVal.g;\n        strokeColor[ivpf3 + 2] = strokeColorVal.b;\n        fill[ivpf] = fillVal;\n        fillOpacity[ivpf] = fillOpacityVal;\n        fillColor[ivpf3]     = fillColorVal.r;\n        fillColor[ivpf3 + 1] = fillColorVal.g;\n        fillColor[ivpf3 + 2] = fillColorVal.b;\n      }\n    }\n\n    geom.boundsDirty(true);\n    m_mapper.modified();\n    m_mapper.boundsDirtyTimestamp().modified();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get a buffer for a geometry source.  If a buffer already exists and is\n   * the correct size, return it.  Otherwise, allocate a new buffer; any data\n   * in an old buffer is discarded.\n   *\n   * @param geom: the geometry to reference and modify.\n   * @param srcName: the name of the source.\n   * @param len: the number of elements for the array.\n   * @returns {Float32Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getBuffer(geom, srcName, len) {\n    var src = geom.sourceByName(srcName), data;\n\n    data = src.data();\n    if (data instanceof Float32Array && data.length === len) {\n      return data;\n    }\n    data = new Float32Array(len);\n    src.setData(data);\n    return data;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return list of actors\n   *\n   * @returns {vgl.actor[]}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.actors = function () {\n    if (!m_actor) {\n      return [];\n    }\n    return [m_actor];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the number of vertices used for each point.\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.verticesPerFeature = function () {\n    var unit = pointPolygon(0, 0, 1, 1);\n    return unit.length / 2;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    var prog = vgl.shaderProgram(),\n        vertexShader = createVertexShader(),\n        fragmentShader = createFragmentShader(),\n        posAttr = vgl.vertexAttribute(\"pos\"),\n        unitAttr = vgl.vertexAttribute(\"unit\"),\n        radAttr = vgl.vertexAttribute(\"rad\"),\n        strokeWidthAttr = vgl.vertexAttribute(\"strokeWidth\"),\n        fillColorAttr = vgl.vertexAttribute(\"fillColor\"),\n        fillAttr = vgl.vertexAttribute(\"fill\"),\n        strokeColorAttr = vgl.vertexAttribute(\"strokeColor\"),\n        strokeAttr = vgl.vertexAttribute(\"stroke\"),\n        fillOpacityAttr = vgl.vertexAttribute(\"fillOpacity\"),\n        strokeOpacityAttr = vgl.vertexAttribute(\"strokeOpacity\"),\n        modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n        projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n        mat = vgl.material(),\n        blend = vgl.blend(),\n        geom = vgl.geometryData(),\n        sourcePositions = vgl.sourceDataP3fv({\"name\": \"pos\"}),\n        sourceUnits = vgl.sourceDataAnyfv(\n            2, vgl.vertexAttributeKeysIndexed.One, {\"name\": \"unit\"}),\n        sourceRadius = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Two, {\"name\": \"rad\"}),\n        sourceStrokeWidth = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Three, {\"name\": \"strokeWidth\"}),\n        sourceFillColor = vgl.sourceDataAnyfv(\n            3, vgl.vertexAttributeKeysIndexed.Four, {\"name\": \"fillColor\"}),\n        sourceFill = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Five, {\"name\": \"fill\"}),\n        sourceStrokeColor = vgl.sourceDataAnyfv(\n            3, vgl.vertexAttributeKeysIndexed.Six, {\"name\": \"strokeColor\"}),\n        sourceStroke = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Seven, {\"name\": \"stroke\"}),\n        sourceAlpha = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Eight, {\"name\": \"fillOpacity\"}),\n        sourceStrokeOpacity = vgl.sourceDataAnyfv(\n            1, vgl.vertexAttributeKeysIndexed.Nine, {\"name\": \"strokeOpacity\"}),\n        primitive = new vgl.triangles();\n\n    if (m_primitiveShape === \"sprite\") {\n      primitive = new vgl.points();\n    }\n\n    m_pixelWidthUniform = new vgl.floatUniform(\"pixelWidth\",\n                            2.0 / m_this.renderer().width());\n    m_aspectUniform = new vgl.floatUniform(\"aspect\",\n                        m_this.renderer().width() / m_this.renderer().height());\n\n    s_init.call(m_this, arg);\n    m_mapper = vgl.mapper({dynamicDraw: m_dynamicDraw});\n\n    // TODO: Right now this is ugly but we will fix it.\n    prog.addVertexAttribute(posAttr, vgl.vertexAttributeKeys.Position);\n    if (m_primitiveShape !== \"sprite\") {\n      prog.addVertexAttribute(unitAttr, vgl.vertexAttributeKeysIndexed.One);\n    }\n\n    prog.addVertexAttribute(radAttr, vgl.vertexAttributeKeysIndexed.Two);\n    prog.addVertexAttribute(strokeWidthAttr, vgl.vertexAttributeKeysIndexed.Three);\n    prog.addVertexAttribute(fillColorAttr, vgl.vertexAttributeKeysIndexed.Four);\n    prog.addVertexAttribute(fillAttr, vgl.vertexAttributeKeysIndexed.Five);\n    prog.addVertexAttribute(strokeColorAttr, vgl.vertexAttributeKeysIndexed.Six);\n    prog.addVertexAttribute(strokeAttr, vgl.vertexAttributeKeysIndexed.Seven);\n    prog.addVertexAttribute(fillOpacityAttr, vgl.vertexAttributeKeysIndexed.Eight);\n    prog.addVertexAttribute(strokeOpacityAttr, vgl.vertexAttributeKeysIndexed.Nine);\n\n    prog.addUniform(m_pixelWidthUniform);\n    prog.addUniform(m_aspectUniform);\n    prog.addUniform(modelViewUniform);\n    prog.addUniform(projectionUniform);\n\n    prog.addShader(fragmentShader);\n    prog.addShader(vertexShader);\n\n    mat.addAttribute(prog);\n    mat.addAttribute(blend);\n\n    m_actor = vgl.actor();\n    m_actor.setMaterial(mat);\n    m_actor.setMapper(m_mapper);\n\n    geom.addSource(sourcePositions);\n    geom.addSource(sourceUnits);\n    geom.addSource(sourceRadius);\n    geom.addSource(sourceStrokeWidth);\n    geom.addSource(sourceFillColor);\n    geom.addSource(sourceFill);\n    geom.addSource(sourceStrokeColor);\n    geom.addSource(sourceStroke);\n    geom.addSource(sourceAlpha);\n    geom.addSource(sourceStrokeOpacity);\n    geom.addPrimitive(primitive);\n    m_mapper.setGeometryData(geom);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    createGLPoints();\n\n    m_this.renderer().contextRenderer().addActor(m_actor);\n    m_this.renderer().contextRenderer().render();\n    m_this.buildTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n\n    s_update.call(m_this);\n\n    // For now build if the data or style changes. In the future we may\n    // we able to partially update the data using dynamic gl buffers.\n    if (m_this.dataTime().getMTime() >= m_this.buildTime().getMTime() ||\n        m_this.updateTime().getMTime() < m_this.getMTime()) {\n      m_this._build();\n    }\n\n    // Update uniforms\n    m_pixelWidthUniform.set(2.0 / m_this.renderer().width());\n    m_aspectUniform.set(m_this.renderer().width() /\n                        m_this.renderer().height());\n\n    m_actor.setVisible(m_this.visible());\n    m_actor.material().setBinNumber(m_this.bin());\n\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n    s_exit();\n  };\n\n  m_this._init();\n  return this;\n};\n\ninherit(geo.gl.pointFeature, geo.pointFeature);\n\n// Now register it\ngeo.registerFeature(\"vgl\", \"point\", geo.gl.pointFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geomFeature\n *\n * @class\n * @extends geo.geomFeature\n * @param {vgl.geometryData} arg\n * @returns {geo.gl.geomFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.geomFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.gl.geomFeature)) {\n    return new geo.gl.geomFeature(arg);\n  }\n  arg = arg || {};\n  geo.geomFeature.call(this, arg);\n\n  // Initialize\n  var m_this = this,\n      m_geom = arg.geom || null,\n      m_actor = vgl.actor(),\n      m_mapper = vgl.mapper(),\n      m_material = null,\n      m_scalar = null,\n      m_color = arg.color || [1.0, 1.0, 1.0],\n      m_buildTime = null,\n      m_noOfPrimitives = 0;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var style = m_this.style();\n\n    // Vertex color gets the preference\n    if (m_geom !== null) {\n      m_scalar = m_geom.sourceData(vgl.vertexAttributeKeys.Scalar);\n      m_color = m_geom.sourceData(vgl.vertexAttributeKeys.Color);\n      m_mapper.setGeometryData(m_geom);\n    }\n\n    this.setMapper(m_mapper);\n\n    if (style.point_sprites !== undefined && style.point_sprites &&\n        style.point_sprites_image !== undefined &&\n        style.point_sprites_image !== null &&\n        m_noOfPrimitives === 1 &&\n        m_geom.primitive(0).primitiveType() === gl.POINTS) {\n      m_material = vgl.utils.createPointSpritesMaterial(\n                     style.point_sprites_image);\n    } else if (m_scalar) {\n      if (m_color instanceof vgl.lookupTable) {\n        m_color.updateRange(m_scalar.scalarRange());\n        m_material = vgl.utils.createColorMappedMaterial(m_color);\n      } else {\n        m_color = vgl.lookupTable();\n        m_color.updateRange(m_scalar.scalarRange());\n        m_material = vgl.utils.createColorMappedMaterial(m_color);\n      }\n    } else if (m_color) {\n      m_material = vgl.utils.createColorMaterial();\n    } else {\n      m_material = vgl.utils.createSolidColorMaterial();\n    }\n    m_actor.setMaterial(m_material);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @private\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    if (m_buildTime &&\n        m_buildTime.getMTime() < m_this.getMTime()) {\n      if (m_color instanceof vgl.lookupTable) {\n        vgl.utils.updateColorMappedMaterial(m_this.material(),\n          m_this.style.color);\n      }/* else {\n        // TODO\n      }*/\n    } else {\n      m_buildTime = vgl.timestamp();\n      m_buildTime.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set geometry\n   *\n   * @returns {geo.gl.geomFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometry = function (val) {\n    if (val === undefined) {\n      return m_geom;\n    } else {\n      m_geom = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  return this;\n};\n\ninherit(geo.gl.geomFeature, geo.geomFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a plane feature given a lower left corner point geo.latlng\n * and and upper right corner point geo.latlng\n * @class\n * @extends geo.planeFeature\n * @param lowerleft\n * @param upperright\n * @returns {geo.planeFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.planeFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.gl.planeFeature)) {\n    return new geo.gl.planeFeature(arg);\n  }\n  geo.planeFeature.call(this, arg);\n\n  var m_this = this,\n      s_exit = this._exit,\n      m_actor = null,\n      m_onloadCallback = arg.onload === undefined ? null : arg.onload;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Gets the coordinates for this plane\n   *\n   * @returns {Array} [[origin], [upper left] [lower right]]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.coords = function () {\n    return [m_this.origin(), m_this.upperLeft(), m_this.lowerRight()];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build this feature\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var or = m_this.origin(),\n        ul = m_this.upperLeft(),\n        lr = m_this.lowerRight(),\n        /// img could be a source or an Image\n        img = m_this.style().image,\n        image = null,\n        texture = null;\n\n    /// TODO If for some reason base layer changes its gcs at run time\n    /// then we need to trigger an event to rebuild every feature\n    or = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            or);\n    ul = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            ul);\n    lr = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            lr);\n\n    m_this.buildTime().modified();\n\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    if (img && img instanceof Image) {\n      image = img;\n    } else if (img) {\n      image = new Image();\n      image.src = img;\n    }\n\n    if (!image) {\n      m_actor = vgl.utils.createPlane(or[0], or[1], or[2],\n        ul[0], ul[1], ul[2],\n        lr[0], lr[1], lr[2]);\n\n      m_actor.material().shaderProgram().uniform(\"opacity\").set(\n        m_this.style().opacity !== undefined ? m_this.style().opacity : 1);\n\n      m_this.renderer().contextRenderer().addActor(m_actor);\n\n    } else {\n      m_actor = vgl.utils.createTexturePlane(or[0], or[1], or[2],\n        lr[0], lr[1], lr[2],\n        ul[0], ul[1], ul[2], true);\n\n      m_actor.material().shaderProgram().uniform(\"opacity\").set(\n        m_this.style().opacity !== undefined ? m_this.style().opacity : 1);\n\n      texture = vgl.texture();\n      m_this.visible(false);\n\n      /// TODO: Is there a reliable way to make sure that image is loaded already?\n      m_this.renderer().contextRenderer().addActor(m_actor);\n\n      if (image.complete) {\n        texture.setImage(image);\n        m_actor.material().addAttribute(texture);\n        /// NOTE Currently we assume that we want to show the feature as\n        /// soon as the image gets loaded. However, there might be a case\n        /// where we want to lock down the visibility. We will deal with that\n        /// later.\n        m_this.visible(true);\n\n        if (m_onloadCallback) {\n          m_onloadCallback.call(m_this);\n        }\n        //}\n      } else {\n        image.onload = function () {\n          texture.setImage(image);\n          m_actor.material().addAttribute(texture);\n          /// NOTE Currently we assume that we want to show the feature as\n          /// soon as the image gets loaded. However, there might be a case\n          /// where we want to lock down the visibility. We will deal with that\n          /// later.\n          m_this.visible(true);\n\n          if (m_onloadCallback) {\n            m_onloadCallback.call(m_this);\n          }\n\n          if (m_this.drawOnAsyncResourceLoad()) {\n            m_this._update();\n            m_this.layer().draw();\n          }\n        };\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    if (m_this.buildTime().getMTime() <= m_this.dataTime().getMTime()) {\n      m_this._build();\n    }\n\n    if (m_this.updateTime().getMTime() <= m_this.getMTime()) {\n      m_actor.setVisible(m_this.visible());\n      m_actor.material().setBinNumber(m_this.bin());\n      m_actor.material().shaderProgram().uniform(\"opacity\").set(\n        m_this.style().opacity !== undefined ? m_this.style().opacity : 1);\n    }\n\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n    s_exit();\n  };\n\n  return this;\n};\n\ninherit(geo.gl.planeFeature, geo.planeFeature);\n\n// Now register it\ngeo.registerFeature(\"vgl\", \"plane\", geo.gl.planeFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of polygonFeature\n *\n * @class\n * @extends geo.polygonFeature\n * @returns {geo.gl.polygonFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.polygonFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.gl.polygonFeature)) {\n    return new geo.gl.polygonFeature(arg);\n  }\n  arg = arg || {};\n  geo.polygonFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_exit = this._exit,\n      m_actor = vgl.actor(),\n      m_mapper = vgl.mapper(),\n      m_material = vgl.material(),\n      s_init = this._init,\n      s_update = this._update;\n\n  function createVertexShader() {\n    var vertexShaderSource = [\n      'attribute vec3 pos;',\n      'attribute vec3 fillColor;',\n      'attribute float fillOpacity;',\n      'uniform mat4 modelViewMatrix;',\n      'uniform mat4 projectionMatrix;',\n      'uniform float pixelWidth;',\n      'varying vec3 fillColorVar;',\n      'varying float fillOpacityVar;',\n\n      'void main(void)',\n      '{',\n      '  vec4 clipPos = projectionMatrix * modelViewMatrix * vec4(pos.xyz, 1);',\n      '  if (clipPos.w != 0.0) {',\n      '    clipPos = clipPos/clipPos.w;',\n      '  }',\n      '  fillColorVar = fillColor;',\n      '  fillOpacityVar = fillOpacity;',\n      '  gl_Position = clipPos;',\n      '}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.VERTEX_SHADER);\n    shader.setShaderSource(vertexShaderSource);\n    return shader;\n  }\n\n  function createFragmentShader() {\n    var fragmentShaderSource = [\n      '#ifdef GL_ES',\n      '  precision highp float;',\n      '#endif',\n      'varying vec3 fillColorVar;',\n      'varying float fillOpacityVar;',\n      'void main () {',\n      '  gl_FragColor = vec4 (fillColorVar, fillOpacityVar);',\n      '}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n    shader.setShaderSource(fragmentShaderSource);\n    return shader;\n  }\n\n  function createGLPolygons() {\n    var i = null,\n        numPts = null,\n        start = null,\n        itemIndex = 0,\n        polygonItemCoordIndex = 0,\n        position = [],\n        fillColor = [],\n        fillOpacity = [],\n        fillColorNew = [],\n        fillOpacityNew = [],\n        posFunc = null,\n        fillColorFunc = null,\n        polygonItem = null,\n        fillOpacityFunc = null,\n        buffers = vgl.DataBuffers(1024),\n        sourcePositions = vgl.sourceDataP3fv(),\n        sourceFillColor =\n          vgl.sourceDataAnyfv(3, vgl.vertexAttributeKeysIndexed.Two),\n        sourceFillOpacity =\n          vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Three),\n        trianglePrimitive = vgl.triangles(),\n        geom = vgl.geometryData(),\n        polygon = null,\n        holes = null,\n        extRing = null,\n        extIndex = 0,\n        extLength = null,\n        intIndex = 0,\n        posInstance = null,\n        triangulator = new PNLTRI.Triangulator(),\n        triangList = null,\n        newTriangList = null,\n        fillColorInstance = null,\n        currentIndex = null;\n\n    posFunc = m_this.position();\n    fillColorFunc = m_this.style.get('fillColor');\n    fillOpacityFunc = m_this.style.get('fillOpacity');\n\n    m_this.data().forEach(function (item) {\n      polygon = m_this.polygon()(item, itemIndex);\n      polygonItem = polygon.outer || [];\n      holes = polygon.inner || [];\n      polygonItemCoordIndex = 0;\n      extRing = [];\n      extIndex = 0;\n      extLength = polygonItem.length - 1;\n      extRing[0] = [];\n      intIndex = 0;\n\n      polygonItem.forEach(function (extRingCoords) {\n        if (extIndex !== extLength) {\n          //extRing = extRing.concat(extRingCoords);\n          posInstance = posFunc(extRingCoords,\n                                polygonItemCoordIndex,\n                                item, itemIndex);\n          if (posInstance instanceof geo.latlng) {\n            extRing[0].push({\n              x: posInstance.x(), y: posInstance.y(), i: fillColor.length\n            });\n          } else {\n            extRing[0].push({\n              x: posInstance.x, y: posInstance.y, i: fillColor.length\n            });\n          }\n\n          fillColorInstance = fillColorFunc(extRingCoords,\n                                            polygonItemCoordIndex,\n                                            item, itemIndex);\n          fillColor.push([fillColorInstance.r,\n                          fillColorInstance.g,\n                          fillColorInstance.b]);\n          fillOpacity.push(fillOpacityFunc(extRingCoords,\n                                           polygonItemCoordIndex,\n                                           item,\n                                           itemIndex));\n          polygonItemCoordIndex += 1;\n        }\n        extIndex += 1;\n      });\n\n      polygonItemCoordIndex = 0;\n      holes.forEach(function (hole) {\n        extRing[intIndex + 1] = [];\n        hole.forEach(function (intRingCoords) {\n          posInstance = posFunc(intRingCoords, polygonItemCoordIndex,\n                                item, itemIndex);\n          if (posInstance instanceof geo.latlng) {\n            extRing[intIndex + 1].push({\n              x: posInstance.x(), y: posInstance.y(), i: fillColor.length\n            });\n          } else {\n            extRing[intIndex + 1].push({\n              x: posInstance.x, y: posInstance.y, i: fillColor.length\n            });\n          }\n          fillColorInstance = fillColorFunc(intRingCoords,\n                                            polygonItemCoordIndex,\n                                            item, itemIndex);\n          fillColor.push([fillColorInstance.r,\n                          fillColorInstance.g,\n                          fillColorInstance.b]);\n          fillOpacity.push(fillOpacityFunc(intRingCoords,\n                                           polygonItemCoordIndex,\n                                           item, itemIndex));\n          polygonItemCoordIndex += 1;\n        });\n        intIndex += 1;\n      });\n\n      //console.log(\"extRing \", extRing);\n      //console.log(\"result\", PolyK.Triangulate(extRing));\n      triangList = triangulator.triangulate_polygon(extRing);\n      newTriangList = [];\n\n      triangList.forEach(function (newIndices) {\n        Array.prototype.push.apply(newTriangList, newIndices);\n      });\n\n      for (i = 1; i < extRing.length; i += 1) {\n        extRing[0] = extRing[0].concat(extRing[i]);\n      }\n\n      newTriangList.forEach(function (polygonIndex) {\n        var polygonItemCoords = extRing[0][polygonIndex];\n        position.push([polygonItemCoords.x,\n                       polygonItemCoords.y,\n                       polygonItemCoords.z || 0.0]);\n        fillColorNew.push(fillColor[polygonItemCoords.i]);\n        fillOpacityNew.push(fillOpacity[polygonItemCoords.i]);\n      });\n\n      itemIndex += 1;\n    });\n\n    position = geo.transform.transformCoordinates(\n                 m_this.gcs(), m_this.layer().map().gcs(),\n                 position, 3);\n\n    buffers.create('pos', 3);\n    buffers.create('indices', 1);\n    buffers.create('fillColor', 3);\n    buffers.create('fillOpacity', 1);\n\n    numPts = position.length;\n\n    start = buffers.alloc(numPts);\n    currentIndex = start;\n\n    //console.log(\"numPts \", numPts);\n    for (i = 0; i < numPts; i += 1) {\n      buffers.write('pos', position[i], start + i, 1);\n      buffers.write('indices', [i], start + i, 1);\n      buffers.write('fillColor', fillColorNew[i], start + i, 1);\n      buffers.write('fillOpacity', [fillOpacityNew[i]], start + i, 1);\n    }\n\n    //console.log(buffers.get('fillColor'));\n    sourcePositions.pushBack(buffers.get('pos'));\n    geom.addSource(sourcePositions);\n\n    sourceFillColor.pushBack(buffers.get('fillColor'));\n    geom.addSource(sourceFillColor);\n\n    sourceFillOpacity.pushBack(buffers.get('fillOpacity'));\n    geom.addSource(sourceFillOpacity);\n\n    //console.log(buffers.get('indices'));\n    trianglePrimitive.setIndices(buffers.get('indices'));\n    geom.addPrimitive(trianglePrimitive);\n\n    m_mapper.setGeometryData(geom);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var blend = vgl.blend(),\n        prog = vgl.shaderProgram(),\n        posAttr = vgl.vertexAttribute('pos'),\n        fillColorAttr = vgl.vertexAttribute('fillColor'),\n        fillOpacityAttr = vgl.vertexAttribute('fillOpacity'),\n        modelViewUniform = new vgl.modelViewUniform('modelViewMatrix'),\n        projectionUniform = new vgl.projectionUniform('projectionMatrix'),\n        vertexShader = createVertexShader(),\n        fragmentShader = createFragmentShader();\n\n    s_init.call(m_this, arg);\n\n    prog.addVertexAttribute(posAttr, vgl.vertexAttributeKeys.Position);\n    prog.addVertexAttribute(fillColorAttr, vgl.vertexAttributeKeysIndexed.Two);\n    prog.addVertexAttribute(fillOpacityAttr, vgl.vertexAttributeKeysIndexed.Three);\n\n    prog.addUniform(modelViewUniform);\n    prog.addUniform(projectionUniform);\n\n    prog.addShader(fragmentShader);\n    prog.addShader(vertexShader);\n\n    m_material.addAttribute(prog);\n    m_material.addAttribute(blend);\n\n    m_actor.setMapper(m_mapper);\n    m_actor.setMaterial(m_material);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    createGLPolygons();\n\n    m_this.renderer().contextRenderer().addActor(m_actor);\n    m_this.buildTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_this.buildTime().getMTime() ||\n        m_this.updateTime().getMTime() <= m_this.getMTime()) {\n      m_this._build();\n    }\n\n    m_actor.setVisible(m_this.visible());\n    m_actor.material().setBinNumber(m_this.bin());\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n    s_exit();\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.gl.polygonFeature, geo.polygonFeature);\n\n// Now register it\ngeo.registerFeature('vgl', 'polygon', geo.gl.polygonFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Single VGL viewer\n *\n * This singleton instance is used to share a single GL context across multiple\n * vlgRenderer and therefore layers.\n * @private\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl._vglViewerInstances = {\n  viewers: [],\n  maps: []\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Retrives the singleton, lazily constructs as necessary.\n *\n * @return {vgl.viewer} the single viewer instance.\n */\n//////////////////////////////////////////////////////////////////////////////\n\ngeo.gl.vglViewerInstance = function (map) {\n  \"use strict\";\n\n  var mapIdx,\n      maps = geo.gl._vglViewerInstances.maps,\n      viewers = geo.gl._vglViewerInstances.viewers,\n      canvas;\n\n  function makeViewer() {\n    canvas = $(document.createElement(\"canvas\"));\n    canvas.attr(\"class\", \"webgl-canvas\");\n    var viewer = vgl.viewer(canvas.get(0));\n    viewer.renderWindow().removeRenderer(\n    viewer.renderWindow().activeRenderer());\n    viewer.init();\n    return viewer;\n  }\n\n  for (mapIdx = 0; mapIdx < maps.length; mapIdx += 1) {\n    if (map === maps[mapIdx]) {\n      break;\n    }\n  }\n\n  if (map !== maps[mapIdx]) {\n    maps[mapIdx] = map;\n    viewers[mapIdx] = makeViewer();\n  }\n\n  viewers[mapIdx]._exit = function () {\n    if (canvas) {\n      canvas.off();\n      canvas.remove();\n    }\n  };\n\n  return viewers[mapIdx];\n};\n\ngeo.gl.vglViewerInstance.deleteCache = function (viewer) {\n  \"use strict\";\n\n  var mapIdx,\n      maps = geo.gl._vglViewerInstances.maps,\n      viewers = geo.gl._vglViewerInstances.viewers;\n\n  for (mapIdx = 0; mapIdx < viewers.length; mapIdx += 1) {\n    if (viewer === undefined || viewer === viewers[mapIdx]) {\n      viewer._exit();\n      maps.splice(mapIdx, 1);\n      viewers.splice(mapIdx, 1);\n    }\n  }\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vglRenderer\n *\n * @class\n * @extends geo.gl.renderer\n * @param canvas\n * @returns {geo.gl.vglRenderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gl.vglRenderer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.gl.vglRenderer)) {\n    return new geo.gl.vglRenderer(arg);\n  }\n  geo.gl.renderer.call(this, arg);\n\n  var m_this = this,\n      s_exit = this._exit,\n      m_viewer = geo.gl.vglViewerInstance(this.layer().map()),\n      m_contextRenderer = vgl.renderer(),\n      m_width = 0,\n      m_height = 0,\n      s_init = this._init;\n\n  m_contextRenderer.setResetScene(false);\n\n  /// TODO: Move this API to the base class\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return width of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function () {\n    return m_width;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return height of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function () {\n    return m_height;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert input data in display space to world space\n   *\n   * @param {object} input {x:val, y:val}, [{x:val, y:val}],\n   * [{x:val, y:val}], [x1,y1], [[x,y]]\n   *\n   * @returns {object} {x:val, y:val, z:val, w:val}, [{x:val, y:val, z:val, w:val}],\n              [[x, y, z, w]], [x1,y1,z1,w]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function (input) {\n    var i,\n        delta,\n        ren = m_this.contextRenderer(),\n        cam = ren.camera(),\n        fdp = ren.focusDisplayPoint(),\n        output,\n        temp,\n        point;\n\n    /// Handle if the input is an array [...]\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n    /// Input is array of object {x:val, y:val}\n      if (input[0] instanceof Object) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          point = input[i];\n          temp = ren.displayToWorld(vec4.fromValues(\n                   point.x, point.y, fdp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(),\n                   m_width, m_height);\n          output.push({x: temp[0], y: temp[1], z: temp[2], w: temp[3]});\n        }\n    /// Input is array of 2d array [[x,y], [x,y]]\n      } else if (input[0] instanceof Array) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          point = input[i];\n          temp = ren.displayToWorld(vec4.fromValues(\n                   point[0], point[1], fdp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(),\n                   m_width, m_height);\n          output.push(temp);\n        }\n    /// Input is flat array [x1,y1,x2,y2]\n      } else {\n        delta = input.length % 3 === 0 ? 3 : 2;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.displayToWorld(vec4.fromValues(\n            input[i],\n            input[i + 1],\n            fdp[2],\n            1.0), cam.viewMatrix(), cam.projectionMatrix(),\n            m_width, m_height);\n          output.push(temp[0]);\n          output.push(temp[1]);\n          output.push(temp[2]);\n          output.push(temp[3]);\n        }\n      }\n    /// Input is object {x:val, y:val}\n    } else if (input instanceof Object) {\n      output = {};\n      temp = ren.displayToWorld(vec4.fromValues(\n               input.x, input.y, fdp[2], 1.0),\n               cam.viewMatrix(), cam.projectionMatrix(),\n               m_width, m_height);\n      output = {x: temp[0], y: temp[1], z: temp[2], w: temp[3]};\n    } else {\n      throw \"Display to world conversion requires array of 2D/3D points\";\n    }\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert input data in world space to display space\n   *\n   * @param {object} input {x:val, y:val} or {x:val, y:val, z:val} or [{x:val, y:val}]\n   * [{x:val, y:val, z:val}] or [[x,y]] or  [[x,y,z]] or [x1,y1,z1, x2, y2, z2]\n   *\n   * @returns {object} {x:val, y:val} or [{x:val, y:val}] or [[x,y]] or\n   * [x1,y1, x2, y2]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function (input) {\n    var i, temp, delta,\n        ren = m_this.contextRenderer(), cam = ren.camera(),\n        fp = cam.focalPoint(), output = [];\n\n    /// Input is an array\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n\n      /// Input is an array of objects\n      if (input[0] instanceof Object) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.worldToDisplay(vec4.fromValues(\n                   input[i].x, input[i].y, fp[2], 1.0), cam.viewMatrix(),\n                   cam.projectionMatrix(),\n                   m_width, m_height);\n          output[i] = { x: temp[0], y: temp[1], z: temp[2] };\n        }\n      } else if (input[0] instanceof Array) {\n        /// Input is an array of array\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.worldToDisplay(\n                   vec4.fromValues(input[i][0], input[i][1], fp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(), m_width, m_height);\n          output[i].push(temp);\n        }\n      } else {\n        /// Input is a flat array of 2 or 3 dimension\n        delta = input.length % 3 === 0 ? 3 : 2;\n        if (delta === 2) {\n          for (i = 0; i < input.length; i += delta) {\n            temp = ren.worldToDisplay(vec4.fromValues(\n                     input[i], input[i + 1], fp[2], 1.0), cam.viewMatrix(),\n                     cam.projectionMatrix(),\n                     m_width, m_height);\n            output.push(temp[0]);\n            output.push(temp[1]);\n            output.push(temp[2]);\n          }\n        } else {\n          for (i = 0; i < input.length; i += delta) {\n            temp = ren.worldToDisplay(vec4.fromValues(\n                         input[i], input[i + 1], input[i + 2], 1.0), cam.viewMatrix(),\n                         cam.projectionMatrix(),\n                         m_width, m_height);\n            output.push(temp[0]);\n            output.push(temp[1]);\n            output.push(temp[2]);\n          }\n        }\n      }\n    } else if (input instanceof Object) {\n      temp = ren.worldToDisplay(vec4.fromValues(\n               input.x, input.y, fp[2], 1.0), cam.viewMatrix(),\n               cam.projectionMatrix(),\n               m_width, m_height);\n\n      output = {x: temp[0], y: temp[1], z: temp[2]};\n    } else {\n      throw \"World to display conversion requires array of 2D/3D points\";\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.contextRenderer = function () {\n    return m_contextRenderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    return \"vgl\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_this.initialized()) {\n      return m_this;\n    }\n\n    s_init.call(m_this);\n\n    m_this.canvas($(m_viewer.canvas()));\n    if (m_viewer.renderWindow().renderers().length > 0) {\n      m_contextRenderer.setLayer(m_viewer.renderWindow().renderers().length);\n      m_contextRenderer.setResetScene(false);\n    }\n    m_viewer.renderWindow().addRenderer(m_contextRenderer);\n\n    m_this.layer().node().append(m_this.canvas());\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    m_width = w;\n    m_height = h;\n    m_this.canvas().attr(\"width\", w);\n    m_this.canvas().attr(\"height\", h);\n    m_viewer.renderWindow().positionAndResize(x, y, w, h);\n    m_this._render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._render = function () {\n    m_viewer.render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   * @todo remove all vgl objects\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    geo.gl.vglViewerInstance.deleteCache(m_viewer);\n    s_exit();\n  };\n\n  this._updateRendererCamera = function () {\n    var vglRenderer = m_this.contextRenderer(),\n        renderWindow = m_viewer.renderWindow(),\n        camera = vglRenderer.camera(),\n        pos, fp, cr;\n\n    vglRenderer.resetCameraClippingRange();\n    pos = camera.position();\n    fp = camera.focalPoint();\n    cr = camera.clippingRange();\n    renderWindow.renderers().forEach(function (renderer) {\n      var cam = renderer.camera();\n\n      if (cam !== camera) {\n        cam.setPosition(pos[0], pos[1], pos[2]);\n        cam.setFocalPoint(fp[0], fp[1], fp[2]);\n        cam.setClippingRange(cr[0], cr[1]);\n        renderer.render();\n      }\n    });\n  };\n\n  // connect to interactor events\n  this.geoOn(geo.event.pan, function (evt) {\n    var vglRenderer = m_this.contextRenderer(),\n        camera,\n        focusPoint,\n        centerDisplay,\n        centerGeo,\n        newCenterDisplay,\n        newCenterGeo,\n        renderWindow,\n        layer = m_this.layer();\n\n    // only the base layer needs to respond\n    if (layer.map().baseLayer() !== layer) {\n      return;\n    }\n\n    // skip handling if the renderer is unconnected\n    if (!vglRenderer || !vglRenderer.camera()) {\n      console.log(\"Pan event triggered on unconnected vgl renderer.\");\n    }\n\n    renderWindow = m_viewer.renderWindow();\n    camera = vglRenderer.camera();\n    focusPoint = renderWindow.focusDisplayPoint();\n\n    // Calculate the center in display coordinates\n    centerDisplay = [m_width / 2, m_height / 2, 0];\n\n    // Calculate the center in world coordinates\n    centerGeo = renderWindow.displayToWorld(\n      centerDisplay[0],\n      centerDisplay[1],\n      focusPoint,\n      vglRenderer\n    );\n\n    newCenterDisplay = [\n      centerDisplay[0] + evt.screenDelta.x,\n      centerDisplay[1] + evt.screenDelta.y\n    ];\n\n    newCenterGeo = renderWindow.displayToWorld(\n      newCenterDisplay[0],\n      newCenterDisplay[1],\n      focusPoint,\n      vglRenderer\n    );\n\n    camera.pan(\n      centerGeo[0] - newCenterGeo[0],\n      centerGeo[1] - newCenterGeo[1],\n      centerGeo[2] - newCenterGeo[2]\n    );\n\n    evt.center = {\n      x: newCenterGeo[0],\n      y: newCenterGeo[1],\n      z: newCenterGeo[2]\n    };\n\n    m_this._updateRendererCamera();\n  });\n\n  this.geoOn(geo.event.zoom, function (evt) {\n    var vglRenderer = m_this.contextRenderer(),\n        camera,\n        renderWindow,\n        layer = m_this.layer(),\n        center,\n        dir,\n        focusPoint,\n        position,\n        newZ;\n\n    // only the base layer needs to respond\n    if (layer.map().baseLayer() !== layer) {\n      return;\n    }\n\n    // skip handling if the renderer is unconnected\n    if (!vglRenderer || !vglRenderer.camera()) {\n      console.log(\"Zoom event triggered on unconnected vgl renderer.\");\n    }\n\n    renderWindow = m_viewer.renderWindow();\n    camera = vglRenderer.camera();\n    focusPoint = camera.focalPoint();\n    position = camera.position();\n    newZ = 360 * Math.pow(2, -evt.zoomLevel);\n\n    evt.pan = null;\n    if (evt.screenPosition) {\n      center = renderWindow.displayToWorld(\n        evt.screenPosition.x,\n        evt.screenPosition.y,\n        focusPoint,\n        vglRenderer\n      );\n      dir = [center[0] - position[0], center[1] - position[1], center[2] - position[2]];\n      evt.center = layer.fromLocal({\n        x: position[0] + dir[0] * (1 - newZ / position[2]),\n        y: position[1] + dir[1] * (1 - newZ / position[2])\n      });\n    }\n\n    camera.setPosition(position[0], position[1], 360 * Math.pow(2, -evt.zoomLevel));\n\n    m_this._updateRendererCamera();\n  });\n\n  return this;\n};\n\ninherit(geo.gl.vglRenderer, geo.gl.renderer);\n\ngeo.registerRenderer(\"vgl\", geo.gl.vglRenderer);\n","/** @namespace */\ngeo.d3 = {};\n\n(function () {\n  'use strict';\n\n  var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz',\n    strLength = 8;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get a random string to use as a div ID\n   * @returns {string}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  geo.d3.uniqueID = function () {\n    var strArray = [],\n        i;\n    strArray.length = strLength;\n    for (i = 0; i < strLength; i += 1) {\n      strArray[i] = chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return strArray.join('');\n  };\n\n  // event propagated when the d3 renderer rescales its group element\n  geo.event.d3Rescale = 'geo_d3_rescale';\n}());\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * D3 specific subclass of object which adds an id property for d3 selections\n * on groups of objects by class id.\n * @class\n * @extends geo.sceneObject\n */\n//////////////////////////////////////////////////////////////////////////////\n\ngeo.d3.object = function (arg) {\n  'use strict';\n  // this is used to extend other geojs classes, so only generate\n  // a new object when that is not the case... like if this === window\n  if (!(this instanceof geo.object)) {\n    return new geo.d3.object(arg);\n  }\n  geo.sceneObject.call(this);\n\n  var m_id = 'd3-' + geo.d3.uniqueID(),\n      s_exit = this._exit,\n      m_this = this,\n      s_draw = this.draw;\n\n  this._d3id = function () {\n    return m_id;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the feature elements\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function () {\n    return m_this.renderer().select(m_this._d3id());\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Redraw the object.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    m_this._update();\n    s_draw();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Removes the element from the svg and the renderer\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer()._removeFeature(m_this._d3id());\n    s_exit();\n  };\n\n  return this;\n};\n\ninherit(geo.d3.object, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pointFeature\n *\n * @class\n * @extends geo.pointFeature\n * @extends geo.d3.object\n * @returns {geo.d3.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.pointFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.d3.pointFeature)) {\n    return new geo.d3.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.pointFeature.call(this, arg);\n  geo.d3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      s_update = this._update,\n      m_buildTime = geo.timestamp(),\n      m_style = {},\n      m_sticky;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    m_sticky = m_this.layer().sticky();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data(),\n        s_style = m_this.style.get(),\n        m_renderer = m_this.renderer(),\n        pos_func = m_this.position();\n\n    // call super-method\n    s_update.call(m_this);\n\n    // default to empty data array\n    if (!data) { data = []; }\n\n    // fill in d3 renderer style object defaults\n    m_style.id = m_this._d3id();\n    m_style.data = data;\n    m_style.append = 'circle';\n    m_style.attributes = {\n      r: m_renderer._convertScale(s_style.radius),\n      cx: function (d) {\n        return m_renderer.worldToDisplay(pos_func(d)).x;\n      },\n      cy: function (d) {\n        return m_renderer.worldToDisplay(pos_func(d)).y;\n      }\n    };\n    m_style.style = s_style;\n    m_style.classes = ['d3PointFeature'];\n\n    // pass to renderer to draw\n    m_this.renderer()._drawFeatures(m_style);\n\n    // update time stamps\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.d3.pointFeature, geo.pointFeature);\n\n// Now register it\ngeo.registerFeature('d3', 'point', geo.d3.pointFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineFeature\n *\n * @class\n * @extends geo.lineFeature\n * @extends geo.d3.object\n * @returns {geo.d3.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.lineFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.d3.lineFeature)) {\n    return new geo.d3.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.lineFeature.call(this, arg);\n  geo.d3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      m_buildTime = geo.timestamp(),\n      s_update = this._update;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data() || [],\n        s_style = m_this.style(),\n        m_renderer = m_this.renderer(),\n        pos_func = m_this.position(),\n        line = d3.svg.line()\n                .x(function (d) { return m_renderer.worldToDisplay(d).x; })\n                .y(function (d) { return m_renderer.worldToDisplay(d).y; });\n\n    s_update.call(m_this);\n    s_style.fill = function () { return false; };\n\n    data.forEach(function (item, idx) {\n      var m_style;\n      var ln = m_this.line()(item, idx);\n\n      var style = {}, key;\n      function wrapStyle(func) {\n        if (geo.util.isFunction(func)) {\n          return function () {\n            return func(ln[0], 0, item, idx);\n          };\n        } else {\n          return func;\n        }\n      }\n      for (key in s_style) {\n        if (s_style.hasOwnProperty(key)) {\n          style[key] = wrapStyle(s_style[key]);\n        }\n      }\n\n      // item is an object representing a single line\n      // m_this.line()(item) is an array of coordinates\n      m_style = {\n        data: [ln.map(function (d, i) { return pos_func(d, i, item, idx);})],\n        append: 'path',\n        attributes: {\n          d: line\n        },\n        id: m_this._d3id() + idx,\n        classes: ['d3LineFeature', 'd3SubLine-' + idx],\n        style: style\n      };\n\n      m_renderer._drawFeatures(m_style);\n    });\n\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.d3.lineFeature, geo.lineFeature);\n\ngeo.registerFeature('d3', 'line', geo.d3.lineFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pathFeature\n *\n * @class\n * @extends geo.pathFeature\n * @extends geo.d3.object\n * @returns {geo.d3.pathFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.pathFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.d3.pathFeature)) {\n    return new geo.d3.pathFeature(arg);\n  }\n  arg = arg || {};\n  geo.pathFeature.call(this, arg);\n  geo.d3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      m_buildTime = geo.timestamp(),\n      s_update = this._update,\n      m_style = {};\n\n  m_style.style = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data() || [],\n        s_style = m_this.style(),\n        m_renderer = m_this.renderer(),\n        tmp, diag;\n    s_update.call(m_this);\n\n    diag = function (d) {\n        var p = {\n          source: d.source,\n          target: d.target\n        };\n        return d3.svg.diagonal()(p);\n      };\n    tmp = [];\n    data.forEach(function (d, i) {\n      var src, trg;\n      if (i < data.length - 1) {\n        src = d;\n        trg = data[i + 1];\n        tmp.push({\n          source: m_renderer.worldToDisplay(src),\n          target: m_renderer.worldToDisplay(trg)\n        });\n      }\n    });\n    m_style.data = tmp;\n    m_style.attributes = {\n      d: diag\n    };\n\n    m_style.id = m_this._d3id();\n    m_style.append = 'path';\n    m_style.classes = ['d3PathFeature'];\n    m_style.style = $.extend({\n      'fill': function () { return false; },\n      'fillColor': function () { return { r: 0, g: 0, b: 0 }; }\n    }, s_style);\n\n    m_this.renderer()._drawFeatures(m_style);\n\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.d3.pathFeature, geo.pathFeature);\n\ngeo.registerFeature('d3', 'path', geo.d3.pathFeature);\n","/**\n * @class\n * @extends geo.graphFeature\n */\ngeo.d3.graphFeature = function (arg) {\n  'use strict';\n\n  var m_this = this;\n\n  if (!(this instanceof geo.d3.graphFeature)) {\n    return new geo.d3.graphFeature(arg);\n  }\n  geo.graphFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the graph elements\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function () {\n    var renderer = m_this.renderer(),\n        selection = {},\n        node = m_this.nodeFeature(),\n        links = m_this.linkFeatures();\n    selection.nodes = renderer.select(node._d3id());\n    selection.links = links.map(function (link) {\n      return renderer.select(link._d3id());\n    });\n    return selection;\n  };\n\n  return this;\n};\n\ninherit(geo.d3.graphFeature, geo.graphFeature);\n\ngeo.registerFeature('d3', 'graph', geo.d3.graphFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a plane feature given a lower left corner point geo.latlng\n * and and upper right corner point geo.latlng\n *\n * *CURRENTLY BROKEN*\n *\n * @class\n * @extends geo.planeFeature\n * @param lowerleft\n * @param upperright\n * @returns {geo.d3.planeFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.planeFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.d3.planeFeature)) {\n    return new geo.d3.planeFeature(arg);\n  }\n  geo.planeFeature.call(this, arg);\n  geo.d3.object.call(this);\n\n  var m_this = this,\n      m_style = {},\n      s_update = this._update,\n      s_init = this._init,\n      m_buildTime = geo.timestamp();\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Normalize a coordinate as an object {x: ..., y: ...}\n   *\n   * @private\n   * @returns {Object}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  function normalize(pt) {\n    if (Array.isArray(pt)) {\n      return {\n        x: pt[0],\n        y: pt[1]\n      };\n    } else if (pt instanceof geo.latlng) {\n      return {\n        x: pt.x(),\n        y: pt.y()\n      };\n    }\n    return pt;\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build the feature object and pass to the renderer for drawing.\n   *\n   * @private\n   * @returns {geo.d3.planeFeature}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var origin = normalize(m_this.origin()),\n        ul = normalize(m_this.upperLeft()),\n        lr = normalize(m_this.lowerRight()),\n        renderer = m_this.renderer(),\n        s = m_this.style();\n\n    delete s.fill_color;\n    delete s.color;\n    delete s.opacity;\n    if (!s.screenCoordinates) {\n      origin = renderer.worldToDisplay(origin);\n      ul = renderer.worldToDisplay(ul);\n      lr = renderer.worldToDisplay(lr);\n    }\n    m_style.id = m_this._d3id();\n    m_style.style = s;\n    m_style.attributes = {\n      x: ul.x,\n      y: ul.y,\n      width: lr.x - origin.x,\n      height: origin.y - ul.y\n    };\n    m_style.append = 'rect';\n    m_style.data = [0];\n    m_style.classes = ['d3PlaneFeature'];\n\n    renderer._drawFeatures(m_style);\n    m_buildTime.modified();\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Redraw the plane feature if necessary.\n   *\n   * @private\n   * @returns {geo.d3.planeFeature}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initializes the plane feature style (over-riding the parent default).\n   *\n   * @private\n   * @returns {geo.d3.planeFeature}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg || {});\n    m_this.style({\n      stroke: function () { return false; },\n      fill: function () { return true; },\n      fillColor: function () { return {r: 0.3, g: 0.3, b: 0.3}; },\n      fillOpacity: function () { return 0.5; }\n    });\n    return m_this;\n  };\n\n  this._init();\n  return this;\n};\n\ninherit(geo.d3.planeFeature, geo.planeFeature);\n\ngeo.registerFeature('d3', 'plane', geo.d3.planeFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vectorFeature\n *\n * @class\n * @extends geo.vectorFeature\n * @extends geo.d3.object\n * @returns {geo.d3.vectorFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.vectorFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.d3.vectorFeature)) {\n    return new geo.d3.vectorFeature(arg);\n  }\n  arg = arg || {};\n  geo.vectorFeature.call(this, arg);\n  geo.d3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      s_exit = this._exit,\n      s_update = this._update,\n      m_buildTime = geo.timestamp(),\n      m_style = {},\n      m_sticky;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Generate a unique ID for a marker definition\n   * @private\n   * @param {object} d Unused datum (for d3 compat)\n   * @param {number} i The marker index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function markerID(d, i) {\n    return m_this._d3id() + '_marker_' + i;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add marker styles for vector arrows.\n   * @private\n   * @param {object[]} data The vector data array\n   * @param {function} stroke The stroke accessor\n   * @param {function} opacity The opacity accessor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function updateMarkers(data, stroke, opacity) {\n\n    var renderer = m_this.renderer();\n    var sel = m_this.renderer()._definitions()\n      .selectAll('marker.geo-vector')\n        .data(data);\n    sel.enter()\n      .append('marker')\n        .attr('id', markerID)\n        .attr('class', 'geo-vector')\n        .attr('viewBox', '0 0 10 10')\n        .attr('refX', '1')\n        .attr('refY', '5')\n        .attr('markerWidth', '5')\n        .attr('markerHeight', '5')\n        .attr('orient', 'auto')\n        .append('path')\n          .attr('d', 'M 0 0 L 10 5 L 0 10 z');\n\n    sel.exit().remove();\n\n    sel.style('stroke', renderer._convertColor(stroke))\n      .style('fill', renderer._convertColor(stroke))\n      .style('opacity', opacity);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    m_sticky = m_this.layer().sticky();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data(),\n        s_style = m_this.style.get(),\n        m_renderer = m_this.renderer(),\n        orig_func = m_this.origin(),\n        size_func = m_this.delta(),\n        cache = [],\n        scale = m_this.style('scale'),\n        max = Number.NEGATIVE_INFINITY;\n\n    // call super-method\n    s_update.call(m_this);\n\n    // default to empty data array\n    if (!data) { data = []; }\n\n    // cache the georeferencing\n    cache = data.map(function (d, i) {\n      var origin = m_renderer.worldToDisplay(orig_func(d, i)),\n          delta = size_func(d, i);\n      max = Math.max(max, delta.x * delta.x + delta.y * delta.y);\n      return {\n        x1: origin.x,\n        y1: origin.y,\n        dx: delta.x,\n        dy: -delta.y\n      };\n    });\n\n    max = Math.sqrt(max);\n    if (!scale) {\n      scale = 75 / max;\n    }\n\n    function getScale() {\n      return scale / m_renderer.scaleFactor();\n    }\n\n    // fill in d3 renderer style object defaults\n    m_style.id = m_this._d3id();\n    m_style.data = data;\n    m_style.append = 'line';\n    m_style.attributes = {\n      x1: function (d, i) {\n        return cache[i].x1;\n      },\n      y1: function (d, i) {\n        return cache[i].y1;\n      },\n      x2: function (d, i) {\n        return cache[i].x1 + getScale() * cache[i].dx;\n      },\n      y2: function (d, i) {\n        return cache[i].y1 + getScale() * cache[i].dy;\n      },\n      'marker-end': function (d, i) {\n        return 'url(#' + markerID(d, i) + ')';\n      }\n    };\n    m_style.style = {\n      stroke: function () { return true; },\n      strokeColor: s_style.strokeColor,\n      strokeWidth: s_style.strokeWidth,\n      strokeOpacity: s_style.strokeOpacity\n    };\n    m_style.classes = ['d3VectorFeature'];\n\n    // Add markers to the defition list\n    updateMarkers(data, s_style.strokeColor, s_style.strokeOpacity);\n\n    // pass to renderer to draw\n    m_this.renderer()._drawFeatures(m_style);\n\n    // update time stamps\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    } else {\n      updateMarkers(\n        m_style.data,\n        m_style.style.strokeColor,\n        m_style.style.strokeOpacity\n      );\n    }\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    s_exit.call(m_this);\n    m_style = {};\n    updateMarkers([], null, null);\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.d3.vectorFeature, geo.vectorFeature);\n\n// Now register it\ngeo.registerFeature('d3', 'vector', geo.d3.vectorFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class d3Renderer\n *\n * @class\n * @extends geo.renderer\n * @returns {geo.d3.d3Renderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.d3.d3Renderer = function (arg) {\n  'use strict';\n\n  if (!(this instanceof geo.d3.d3Renderer)) {\n    return new geo.d3.d3Renderer(arg);\n  }\n  geo.renderer.call(this, arg);\n\n  var s_exit = this._exit;\n\n  geo.d3.object.call(this, arg);\n\n  arg = arg || {};\n\n  var m_this = this,\n      m_sticky = null,\n      m_features = {},\n      m_corners = null,\n      m_width = null,\n      m_height = null,\n      m_scale = 1,\n      m_dx = 0,\n      m_dy = 0,\n      m_svg = null,\n      m_defs = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set attributes to a d3 selection.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setAttrs(select, attrs) {\n    var key;\n    for (key in attrs) {\n      if (attrs.hasOwnProperty(key)) {\n        select.attr(key, attrs[key]);\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Meta functions for converting from geojs styles to d3.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._convertColor = function (f, g) {\n    f = geo.util.ensureFunction(f);\n    g = g || function () { return true; };\n    return function () {\n      var c = 'none';\n      if (g.apply(this, arguments)) {\n        c = f.apply(this, arguments);\n        if (c.hasOwnProperty('r') &&\n            c.hasOwnProperty('g') &&\n            c.hasOwnProperty('b')) {\n          c = d3.rgb(255 * c.r, 255 * c.g, 255 * c.b);\n        }\n      }\n      return c;\n    };\n  };\n\n  this._convertPosition = function (f) {\n    f = geo.util.ensureFunction(f);\n    return function () {\n      return m_this.worldToDisplay(f.apply(this, arguments));\n    };\n  };\n\n  this._convertScale = function (f) {\n    f = geo.util.ensureFunction(f);\n    return function () {\n      return f.apply(this, arguments) / m_scale;\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set styles to a d3 selection. Ignores unkown style keys.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setStyles(select, styles) {\n    /* jshint validthis:true */\n    var key, k, f;\n    function fillFunc() {\n      if (styles.fill.apply(this, arguments)) {\n        return null;\n      } else {\n        return 'none';\n      }\n    }\n    function strokeFunc() {\n      if (styles.stroke.apply(this, arguments)) {\n        return null;\n      } else {\n        return 'none';\n      }\n    }\n    for (key in styles) {\n      if (styles.hasOwnProperty(key)) {\n        f = null;\n        k = null;\n        if (key === 'strokeColor') {\n          k = 'stroke';\n          f = m_this._convertColor(styles[key], styles.stroke);\n        } else if (key === 'stroke' && styles[key]) {\n          k = 'stroke';\n          f = strokeFunc;\n        } else if (key === 'strokeWidth') {\n          k = 'stroke-width';\n          f = m_this._convertScale(styles[key]);\n        } else if (key === 'strokeOpacity') {\n          k = 'stroke-opacity';\n          f = styles[key];\n        } else if (key === 'fillColor') {\n          k = 'fill';\n          f = m_this._convertColor(styles[key], styles.fill);\n        } else if (key === 'fill' && !styles.hasOwnProperty('fillColor')) {\n          k = 'fill';\n          f = fillFunc;\n        } else if (key === 'fillOpacity') {\n          k = 'fill-opacity';\n          f = styles[key];\n        }\n        if (k) {\n          select.style(k, f);\n        }\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the map instance or return null if not connected to a map.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getMap() {\n    var layer = m_this.layer();\n    if (!layer) {\n      return null;\n    }\n    return layer.map();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the svg group element associated with this renderer instance.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getGroup() {\n    return m_svg.select('.group-' + m_this._d3id());\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the initial lat-lon coordinates of the map view.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function initCorners() {\n    var layer = m_this.layer(),\n        map = layer.map(),\n        width = m_this.layer().width(),\n        height = m_this.layer().height();\n\n    m_width = width;\n    m_height = height;\n    if (!m_width || !m_height) {\n      throw 'Map layer has size 0';\n    }\n    m_corners = {\n      'upperLeft': map.displayToGcs({'x': 0, 'y': 0}),\n      'lowerRight': map.displayToGcs({'x': width, 'y': height})\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the translation, scale, and zoom for the current view.\n   * @note rotation not yet supported\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setTransform() {\n\n    if (!m_corners) {\n      initCorners();\n    }\n\n    if (!m_sticky) {\n      return;\n    }\n\n    var layer = m_this.layer(),\n        map = layer.map(),\n        upperLeft = map.gcsToDisplay(m_corners.upperLeft),\n        lowerRight = map.gcsToDisplay(m_corners.lowerRight),\n        group = getGroup(),\n        dx, dy, scale;\n\n    // calculate the translation\n    dx = upperLeft.x;\n    dy = upperLeft.y;\n\n    // calculate the scale\n    scale = (lowerRight.y - upperLeft.y) / m_height;\n\n    // set the group transform property\n    group.attr('transform', 'matrix(' + [scale, 0, 0, scale, dx, dy].join() + ')');\n\n    // set internal variables\n    m_scale = scale;\n    m_dx = dx;\n    m_dy = dy;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from screen pixel coordinates to the local coordinate system\n   * in the SVG group element taking into account the transform.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function baseToLocal(pt) {\n    return {\n      x: (pt.x - m_dx) / m_scale,\n      y: (pt.y - m_dy) / m_scale\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from the local coordinate system in the SVG group element\n   * to screen pixel coordinates.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function localToBase(pt) {\n    return {\n      x: pt.x * m_scale + m_dx,\n      y: pt.y * m_scale + m_dy\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (!m_this.canvas()) {\n      var canvas;\n      m_svg = d3.select(m_this.layer().node().get(0)).append('svg');\n\n      // create a global svg definitions element\n      m_defs = m_svg.append('defs');\n\n      var shadow = m_defs\n        .append('filter')\n          .attr('id', 'geo-highlight')\n          .attr('x', '-100%')\n          .attr('y', '-100%')\n          .attr('width', '300%')\n          .attr('height', '300%');\n      shadow\n        .append('feMorphology')\n          .attr('operator', 'dilate')\n          .attr('radius', 2)\n          .attr('in', 'SourceAlpha')\n          .attr('result', 'dilateOut');\n      shadow\n        .append('feGaussianBlur')\n          .attr('stdDeviation', 5)\n          .attr('in', 'dilateOut')\n          .attr('result', 'blurOut');\n      shadow\n        .append('feColorMatrix')\n          .attr('type', 'matrix')\n          .attr('values', '-1 0 0 0 1  0 -1 0 0 1  0 0 -1 0 1  0 0 0 1 0')\n          .attr('in', 'blurOut')\n          .attr('result', 'invertOut');\n      shadow\n        .append('feBlend')\n          .attr('in', 'SourceGraphic')\n          .attr('in2', 'invertOut')\n          .attr('mode', 'normal');\n      canvas = m_svg.append('g');\n\n      shadow = m_defs.append('filter')\n          .attr('id', 'geo-blur')\n          .attr('x', '-100%')\n          .attr('y', '-100%')\n          .attr('width', '300%')\n          .attr('height', '300%');\n\n      shadow\n        .append('feGaussianBlur')\n          .attr('stdDeviation', 20)\n          .attr('in', 'SourceGraphic');\n\n      m_sticky = m_this.layer().sticky();\n      m_svg.attr('class', m_this._d3id());\n      m_svg.attr('width', m_this.layer().node().width());\n      m_svg.attr('height', m_this.layer().node().height());\n\n      canvas.attr('class', 'group-' + m_this._d3id());\n\n      m_this.canvas(canvas);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from coordinates in the svg group element to lat/lon.\n   * Supports objects or arrays of objects.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function (pt) {\n    var map = getMap();\n    if (!map) {\n      throw 'Cannot project until this layer is connected to a map.';\n    }\n    if (Array.isArray(pt)) {\n      pt = pt.map(function (x) {\n        return map.displayToGcs(localToBase(x));\n      });\n    } else {\n      pt = map.displayToGcs(localToBase(pt));\n    }\n    return pt;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from lat/lon to pixel coordinates in the svg group element.\n   * Supports objects or arrays of objects.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function (pt) {\n    var map = getMap();\n    if (!map) {\n      throw 'Cannot project until this layer is connected to a map.';\n    }\n    var v;\n    if (Array.isArray(pt)) {\n      v = pt.map(function (x) {\n        return baseToLocal(map.gcsToDisplay(x));\n      });\n    } else {\n      v = baseToLocal(map.gcsToDisplay(pt));\n    }\n    return v;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    return 'd3';\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the current scaling factor to build features that shouldn't\n   * change size during zooms.  For example:\n   *\n   *  selection.append('circle')\n   *    .attr('r', r0 / renderer.scaleFactor());\n   *\n   * This will create a circle element with radius r0 independent of the\n   * current zoom level.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.scaleFactor = function () {\n    return m_scale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    if (!m_corners) {\n      initCorners();\n    }\n    m_svg.attr('width', w);\n    m_svg.attr('height', h);\n    setTransform();\n    m_this.layer().geoTrigger(geo.event.d3Rescale, { scale: m_scale }, true);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update noop for geo.d3.object api.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_features = {};\n    m_this.canvas().remove();\n    s_exit();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the definitions dom element for the layer\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._definitions = function () {\n    return m_defs;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a new feature element from an object that describes the feature\n   * attributes.  To be called from feature classes only.\n   *\n   * Input:\n   *  {\n   *    id:         A unique string identifying the feature.\n   *    data:       Array of data objects used in a d3 data method.\n   *    index:      A function that returns a unique id for each data element.\n   *    style:      An object containing element CSS styles.\n   *    attributes: An object containing element attributes.\n   *    classes:    An array of classes to add to the elements.\n   *    append:     The element type as used in d3 append methods.\n   *  }\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._drawFeatures = function (arg) {\n    m_features[arg.id] = {\n      data: arg.data,\n      index: arg.dataIndex,\n      style: arg.style,\n      attributes: arg.attributes,\n      classes: arg.classes,\n      append: arg.append\n    };\n    return m_this.__render(arg.id);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Updates a feature by performing a d3 data join.  If no input id is\n  *  provided then this method will update all features.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.__render = function (id) {\n    var key;\n    if (id === undefined) {\n      for (key in m_features) {\n        if (m_features.hasOwnProperty(key)) {\n          m_this.__render(key);\n        }\n      }\n      return m_this;\n    }\n    var data = m_features[id].data,\n        index = m_features[id].index,\n        style = m_features[id].style,\n        attributes = m_features[id].attributes,\n        classes = m_features[id].classes,\n        append = m_features[id].append,\n        selection = m_this.select(id).data(data, index);\n    selection.enter().append(append);\n    selection.exit().remove();\n    setAttrs(selection, attributes);\n    selection.attr('class', classes.concat([id]).join(' '));\n    setStyles(selection, style);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the given feature id.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function (id) {\n    return getGroup().selectAll('.' + id);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Removes a feature from the layer.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this._removeFeature = function (id) {\n    m_this.select(id).remove();\n    delete m_features[id];\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Override draw method to do nothing.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n  };\n\n  // connect to pan event\n  this.layer().geoOn(geo.event.pan, setTransform);\n\n  // connect to zoom event\n  this.layer().geoOn(geo.event.zoom, function () {\n    setTransform();\n    m_this.__render();\n    m_this.layer().geoTrigger(geo.event.d3Rescale, { scale: m_scale }, true);\n  });\n\n  this.layer().geoOn(geo.event.resize, function (event) {\n    m_this._resize(event.x, event.y, event.width, event.height);\n  });\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.d3.d3Renderer, geo.renderer);\n\ngeo.registerRenderer('d3', geo.d3.d3Renderer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @namespace\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gui = {};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class uiLayer\n *\n * @class\n * @extends {geo.layer}\n * @returns {geo.gui.uiLayer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gui.uiLayer = function (arg) {\n  'use strict';\n\n  // The widget stays fixed on the screen.  (only available in d3 at the moment)\n  arg.renderer = 'd3';\n  arg.sticky = false;\n\n  if (!(this instanceof geo.gui.uiLayer)) {\n    return new geo.gui.uiLayer(arg);\n  }\n  geo.layer.call(this, arg);\n\n  var m_this = this,\n      s_exit = this._exit;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a new ui control\n   *\n   * @returns {geo.gui.Widget} Will return a new control widget\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createWidget = function (widgetName, arg) {\n\n    var newWidget = geo.createWidget(\n      widgetName, m_this, m_this.renderer(), arg);\n\n    m_this.addChild(newWidget);\n    newWidget._init();\n    m_this.modified();\n    return newWidget;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete a ui control\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteWidget = function (widget) {\n    widget._exit();\n    m_this.removeChild(widget);\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Free memory and destroy the layer.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.children().forEach(function (child) {\n      m_this.deleteWidget(child);\n    });\n    s_exit();\n  };\n};\n\ninherit(geo.gui.uiLayer, geo.layer);\n\ngeo.registerLayer('ui', geo.gui.uiLayer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class widget\n *\n * @class\n * @extends {geo.sceneObject}\n * @returns {geo.gui.widget}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gui.widget = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.gui.widget)) {\n    return new geo.gui.widget(arg);\n  }\n  geo.sceneObject.call(this, arg);\n\n  var m_this = this,\n      s_exit = this._exit,\n      m_layer = arg.layer;\n\n  this._init = function () {\n    m_this.modified();\n  };\n\n  this._exit = function () {\n    m_this.children().forEach(function (child) {\n      m_this._deleteFeature(child);\n    });\n    s_exit();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create feature give a name\n   *\n   * @returns {geo.Feature} Will return a new feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._createFeature = function (featureName, arg) {\n\n    var newFeature = geo.createFeature(\n      featureName, m_this, m_this.renderer(), arg);\n\n    m_this.addChild(newFeature);\n    m_this.modified();\n    return newFeature;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._deleteFeature = function (feature) {\n    m_this.removeChild(feature);\n    feature._exit();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the layer associated with this widget.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n};\ninherit(geo.gui.widget, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sliderWidget\n *\n * @class\n * @extends {geo.gui.widget}\n * @returns {geo.gui.sliderWidget}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gui.sliderWidget = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.gui.sliderWidget)) {\n    return new geo.gui.sliderWidget(arg);\n  }\n  geo.gui.widget.call(this, arg);\n\n  var m_this = this,\n      s_exit = this._exit,\n      m_xscale,\n      m_yscale,\n      m_plus,\n      m_minus,\n      m_track,\n      m_nub,\n      m_width = 20, // Approximate size of the widget in pixels\n      m_height = 100,\n      m_nubSize = 10,\n      m_plusIcon,\n      m_minusIcon,\n      m_group,\n      m_lowContrast,\n      m_highlightDur = 100;\n\n  /* http://icomoon.io */\n  /* CC BY 3.0 http://creativecommons.org/licenses/by/3.0/ */\n  /* jshint -W101 */\n  m_plusIcon = 'M512 81.92c-237.568 0-430.080 192.614-430.080 430.080 0 237.568 192.563 430.080 430.080 430.080s430.080-192.563 430.080-430.080c0-237.517-192.563-430.080-430.080-430.080zM564.326 564.326v206.182h-104.653v-206.182h-206.234v-104.653h206.182v-206.234h104.704v206.182h206.182v104.704h-206.182z';\n  m_minusIcon = 'M512 81.92c-237.568 0-430.080 192.614-430.080 430.080 0 237.568 192.563 430.080 430.080 430.080s430.080-192.563 430.080-430.080c0-237.517-192.563-430.080-430.080-430.080zM770.56 459.674v104.704h-517.12v-104.704h517.12z';\n  /* jshint +W101 */\n\n  // Define off-white gray colors for low contrast ui (unselected).\n  m_lowContrast = {\n    white: '#f4f4f4',\n    black: '#505050'\n  };\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Add an icon from a path string.  Returns a d3 group element.\n *\n * @function\n * @argument {String} icon svg path string\n * @argument {Array} base where to append the element (d3 selection)\n * @argument {Number} cx Center x-coordinate\n * @argument {Number} cy Center y-coordinate\n * @argument {Number} size Icon size in pixels\n * @returns {object}\n * @private\n */\n//////////////////////////////////////////////////////////////////////////////\n  function put_icon(icon, base, cx, cy, size) {\n    var g = base.append('g');\n\n    // the scale factor\n    var s = size / 1024;\n\n    g.append('g')\n      .append('g')\n        .attr(\n          'transform',\n          'translate(' + cx + ',' + cy + ') scale(' + s + ') translate(-512,-512)'\n      )\n      .append('path')\n        .attr('d', icon)\n        .attr('class', 'geo-glyphicon');\n\n    return g;\n  }\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Initialize the slider widget in the map.\n *\n * @function\n * @returns {geo.gui.sliderWidget}\n * @private\n */\n//////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    var svg = m_this.layer().renderer().canvas(),\n        x0 = 40,\n        y0 = 40 + m_width,\n        map = m_this.layer().map();\n\n    // create d3 scales for positioning\n    // TODO: make customizable and responsive\n    m_xscale = d3.scale.linear().domain([-4, 4]).range([x0, x0 + m_width]);\n    m_yscale = d3.scale.linear().domain([0, 1]).range([y0, y0 + m_height]);\n\n    // Create the main group element\n    svg = svg.append('g').classed('geo-ui-slider', true);\n    m_group = svg;\n\n    // Create + zoom button\n    m_plus = svg.append('g');\n    m_plus.append('circle')\n      .datum({\n        fill: 'white',\n        stroke: null\n      })\n      .classed('geo-zoom-in', true)\n      .attr('cx', m_xscale(0))\n      .attr('cy', m_yscale(0.0) - m_width + 2)\n      .attr('r', m_width / 2)\n      .style({\n        'cursor': 'pointer'\n      })\n      .on('click', function () {\n        var z = map.zoom();\n        map.transition({\n          zoom: z + 1,\n          ease: d3.ease('cubic-in-out'),\n          duration: 500\n        });\n      })\n      .on('mousedown', function () {\n        d3.event.stopPropagation();\n      });\n\n    put_icon(\n      m_plusIcon,\n      m_plus,\n      m_xscale(0),\n      m_yscale(0) - m_width + 2,\n      m_width + 5\n    ).style('cursor', 'pointer')\n      .style('pointer-events', 'none')\n      .select('path')\n      .datum({\n        fill: 'black',\n        stroke: null\n      });\n\n    // Create the - zoom button\n    m_minus = svg.append('g');\n    m_minus.append('circle')\n      .datum({\n        fill: 'white',\n        stroke: null\n      })\n      .classed('geo-zoom-out', true)\n      .attr('cx', m_xscale(0))\n      .attr('cy', m_yscale(1.0) + m_width - 2)\n      .attr('r', m_width / 2)\n      .style({\n        'cursor': 'pointer'\n      })\n      .on('click', function () {\n        var z = map.zoom();\n        map.transition({\n          zoom: z - 1,\n          ease: d3.ease('cubic-in-out'),\n          duration: 500\n        });\n      })\n      .on('mousedown', function () {\n        d3.event.stopPropagation();\n      });\n\n    put_icon(\n      m_minusIcon,\n      m_minus,\n      m_xscale(0),\n      m_yscale(1) + m_width - 2,\n      m_width + 5\n    ).style('cursor', 'pointer')\n      .style('pointer-events', 'none')\n      .select('path')\n      .datum({\n        fill: 'black',\n        stroke: null\n      });\n\n    // Respond to a mouse event on the widget\n    function respond(evt, trans) {\n      var z = m_yscale.invert(d3.mouse(m_this.layer().node()[0])[1]),\n          zrange = map.zoomRange();\n      z = (1 - z) * (zrange.max - zrange.min) + zrange.min;\n      if (trans) {\n        map.transition({\n          zoom: z,\n          ease: d3.ease('cubic-in-out'),\n          duration: 500,\n          done: m_this._update()\n        });\n      } else {\n        map.zoom(z);\n        m_this._update();\n      }\n      evt.stopPropagation();\n    }\n\n    // Create the track\n    m_track = svg.append('rect')\n      .datum({\n        fill: 'white',\n        stroke: 'black'\n      })\n      .classed('geo-zoom-track', true)\n      .attr('x', m_xscale(0) - m_width / 6)\n      .attr('y', m_yscale(0))\n      .attr('rx', m_width / 10)\n      .attr('ry', m_width / 10)\n      .attr('width', m_width / 3)\n      .attr('height', m_height)\n      .style({\n        'cursor': 'pointer'\n      })\n      .on('click', function () {\n        respond(d3.event, true);\n      });\n\n    // Create the nub\n    m_nub = svg.append('rect')\n      .datum({\n        fill: 'black',\n        stroke: null\n      })\n      .classed('geo-zoom-nub', true)\n      .attr('x', m_xscale(-4))\n      .attr('y', m_yscale(0.5) - m_nubSize / 2)\n      .attr('rx', 3)\n      .attr('ry', 3)\n      .attr('width', m_width)\n      .attr('height', m_nubSize)\n      .style({\n        'cursor': 'pointer'\n      })\n      .on('mousedown', function () {\n        d3.select(document).on('mousemove.geo.slider', function () {\n          respond(d3.event);\n        });\n        d3.select(document).on('mouseup.geo.slider', function () {\n          respond(d3.event);\n          d3.select(document).on('.geo.slider', null);\n        });\n        d3.event.stopPropagation();\n      });\n\n    var mouseOver = function () {\n      d3.select(this).attr('filter', 'url(#geo-highlight)');\n      m_group.selectAll('rect,path,circle').transition()\n        .duration(m_highlightDur)\n        .style('fill', function (d) {\n          return d.fill || null;\n        })\n        .style('stroke', function (d) {\n          return d.stroke || null;\n        });\n\n    };\n\n    var mouseOut = function () {\n      d3.select(this).attr('filter', null);\n      m_group.selectAll('circle,rect,path').transition()\n        .duration(m_highlightDur)\n        .style('fill', function (d) {\n          return m_lowContrast[d.fill] || null;\n        })\n        .style('stroke', function (d) {\n          return m_lowContrast[d.stroke] || null;\n        });\n    };\n\n    m_group.selectAll('*')\n      .on('mouseover', mouseOver)\n      .on('mouseout', mouseOut);\n\n    // Update the nub position on zoom\n    m_this.layer().geoOn(geo.event.zoom, function () {\n      m_this._update();\n    });\n\n    mouseOut();\n    m_this._update();\n  };\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Removes the slider element from the map and unbinds all handlers.\n *\n * @function\n * @returns {geo.gui.sliderWidget}\n * @private\n */\n//////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_group.remove();\n    m_this.layer().geoOff(geo.event.zoom);\n    s_exit();\n  };\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Update the slider widget state in reponse to map changes.  I.e. zoom\n * range changes.\n *\n * @function\n * @returns {geo.gui.sliderWidget}\n * @private\n */\n//////////////////////////////////////////////////////////////////////////////\n  this._update = function (obj) {\n    var map = m_this.layer().map(),\n        zoomRange = map.zoomRange(),\n        zoom = map.zoom(),\n        zoomScale = d3.scale.linear();\n\n    obj = obj || {};\n    zoom = obj.value || zoom;\n    zoomScale.domain([zoomRange.min, zoomRange.max])\n      .range([1, 0])\n      .clamp(true);\n\n    m_nub.attr('y', m_yscale(zoomScale(zoom)) - m_nubSize / 2);\n  };\n};\n\ninherit(geo.gui.sliderWidget, geo.gui.widget);\n\ngeo.registerWidget('d3', 'slider', geo.gui.sliderWidget);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class legendWidget\n *\n * @class\n * @extends geo.gui.widget\n * @returns {geo.gui.legendWidget}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.gui.legendWidget = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.gui.legendWidget)) {\n    return new geo.gui.legendWidget(arg);\n  }\n  geo.gui.widget.call(this, arg);\n\n  /** @private */\n  var m_this = this,\n      m_categories = [],\n      m_top = null,\n      m_group = null,\n      m_border = null,\n      m_spacing = 20, // distance in pixels between lines\n      m_padding = 12; // padding in pixels inside the border\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get or set the category array associated with\n   * the legend.  Each element of this array is\n   * an object: ::\n   *     {\n   *         name: string,\n   *         style: object,\n   *         type: 'point' | 'line' | ...\n   *     }\n   *\n   * The style property can contain the following feature styles:\n   *     * fill: bool\n   *     * fillColor: object | string\n   *     * fillOpacity: number\n   *     * stroke: bool\n   *     * strokeColor: object | string\n   *     * strokeWidth: number\n   *     * strokeOpacity: number\n   *\n   * The type controls how the element is displayed, point as a circle,\n   * line as a line segment.  Any other value will display as a rounded\n   * rectangle.\n   *\n   * @param {object[]?} categories The categories to display\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.categories = function (arg) {\n    if (arg === undefined) {\n      return m_categories.slice();\n    }\n    m_categories = arg.slice().map(function (d) {\n      if (d.type === 'line') {\n        d.style.fill = false;\n        d.style.stroke = true;\n      }\n      return d;\n    });\n    m_this.draw();\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the widget's size\n   * @return {{width: number, height: number}} The size in pixels\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.size = function () {\n    var width = 1, height;\n    var test =  m_this.layer().renderer().canvas().append('text')\n      .style('opacity', 1e-6);\n\n    m_categories.forEach(function (d) {\n      test.text(d.name);\n      width = Math.max(width, test.node().getBBox().width);\n    });\n    test.remove();\n\n    height = m_spacing * (m_categories.length + 1);\n    return {\n      width: width + 50,\n      height: height\n    };\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Redraw the legend\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n\n    m_this._init();\n    function applyColor(selection) {\n      selection.style('fill', function (d) {\n          if (d.style.fill || d.style.fill === undefined) {\n            return d.style.fillColor;\n          } else {\n            return 'none';\n          }\n        })\n        .style('fill-opacity', function (d) {\n          if (d.style.fillOpacity === undefined) {\n            return 1;\n          }\n          return d.style.fillOpacity;\n        })\n        .style('stroke', function (d) {\n          if (d.style.stroke || d.style.stroke === undefined) {\n            return d.style.strokeColor;\n          } else {\n            return 'none';\n          }\n        })\n        .style('stroke-opacity', function (d) {\n          if (d.style.strokeOpacity === undefined) {\n            return 1;\n          }\n          return d.style.strokeOpacity;\n        })\n        .style('stroke-width', function (d) {\n          if (d.style.strokeWidth === undefined) {\n            return 1.5;\n          }\n          return d.style.strokeWidth;\n        });\n    }\n\n    m_border.attr('height', m_this.size().height + 2 * m_padding)\n      .style('display', null);\n\n    var scale = m_this._scale();\n\n    var labels = m_group.selectAll('g.geo-label')\n      .data(m_categories, function (d) { return d.name; });\n\n    var g = labels.enter().append('g')\n      .attr('class', 'geo-label')\n      .attr('transform', function (d, i) {\n        return 'translate(0,' + scale.y(i) + ')';\n      });\n\n    applyColor(g.filter(function (d) {\n        return d.type !== 'point' && d.type !== 'line';\n      }).append('rect')\n        .attr('x', 0)\n        .attr('y', -6)\n        .attr('rx', 5)\n        .attr('ry', 5)\n        .attr('width', 40)\n        .attr('height', 12)\n    );\n\n    applyColor(g.filter(function (d) {\n        return d.type === 'point';\n      }).append('circle')\n        .attr('cx', 20)\n        .attr('cy', 0)\n        .attr('r', 6)\n    );\n\n    applyColor(g.filter(function (d) {\n        return d.type === 'line';\n      }).append('line')\n        .attr('x1', 0)\n        .attr('y1', 0)\n        .attr('x2', 40)\n        .attr('y2', 0)\n    );\n\n    g.append('text')\n      .attr('x', '50px')\n      .attr('y', 0)\n      .attr('dy', '0.3em')\n      .text(function (d) {\n        return d.name;\n      });\n\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get scales for the x and y axis for the current size.\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._scale = function () {\n    return {\n      x: d3.scale.linear()\n        .domain([0, 1])\n        .range([0, m_this.size().width]),\n      y: d3.scale.linear()\n        .domain([0, m_categories.length - 1])\n        .range([m_padding / 2, m_this.size().height - m_padding / 2])\n    };\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private initialization.  Creates the widget's DOM container and internal\n   * variables.\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    var w = m_this.size().width + 2 * m_padding,\n        h = m_this.size().height + 2 * m_padding,\n        nw = m_this.layer().map().node().width(),\n        margin = 20;\n    if (m_top) {\n      m_top.remove();\n    }\n    m_top = m_this.layer().renderer().canvas().append('g')\n        .attr('transform', 'translate(' + (nw - w - margin) + ',' + margin + ')');\n    m_group = m_top\n      .append('g')\n        .attr('transform', 'translate(' + [m_padding - 1.5, m_padding] + ')');\n    m_border = m_group.append('rect')\n      .attr('x', -m_padding)\n      .attr('y', -m_padding)\n      .attr('width', w)\n      .attr('height', h)\n      .attr('rx', 3)\n      .attr('ry', 3)\n      .style({\n        'stroke': 'black',\n        'stroke-width': '1.5px',\n        'fill': 'white',\n        'fill-opacity': 0.75,\n        'display': 'none'\n      });\n    m_group.on('mousedown', function () {\n      d3.event.stopPropagation();\n    });\n    m_group.on('mouseover', function () {\n      m_border.transition()\n        .duration(250)\n        .style('fill-opacity', 1);\n    });\n    m_group.on('mouseout', function () {\n      m_border.transition()\n        .duration(250)\n        .style('fill-opacity', 0.75);\n    });\n  };\n\n  this.geoOn(geo.event.resize, function () {\n    this.draw();\n  });\n\n};\n\ninherit(geo.gui.legendWidget, geo.gui.widget);\n\ngeo.registerWidget('d3', 'legend', geo.gui.legendWidget);\n","/*jscs:disable validateIndentation*/\n(function ($, geo, d3) {\n  'use strict';\n\n  var load = function () {\n\n  // This requires jquery ui, which we don't want to make a\n  // hard requirement, so bail out here if the widget factory\n  // is not available and throw a helpful message when the\n  // tries to use it.\n  if (!$.widget) {\n    $.fn.geojsMap = function () {\n      throw new Error(\n        'The geojs jquery plugin requires jquery ui to be available.'\n      );\n    };\n    return;\n  }\n\n  // for multiple initialization detection\n  var initialized = false;\n\n  /**\n   * Takes an option key and returns true if it should\n   * return a color accessor.\n   * @private\n   */\n  function isColorKey(key) {\n    return key.slice(key.length - 5, key.length)\n      .toLowerCase() === 'color';\n  }\n\n  /**\n   * Take an array of data and an accessor for a color property\n   * and return a wrapped accessor mapping to actual color\n   * values.  This allows users to pass arbitrary strings\n   * or numbers as any color property and this will wrap\n   * a categorical scale or linear scale.\n   *\n   * Requires d3\n   * @private\n   * @param {Object[]} data A data array\n   * @param {(string|number|function)} acc A color accessor\n   * @return {function}\n   */\n  function makeColorScale(data, acc) {\n    if (!d3) {\n      console.warn('d3 is unavailable, cannot apply color scales.');\n      return acc;\n    }\n    var domain;\n    var cannotHandle = false;\n    var doNotHandle = true;\n    var categorical = false;\n    var min = Number.POSITIVE_INFINITY;\n    var max = Number.NEGATIVE_INFINITY;\n\n    function wrap(func) {\n      if (geo.util.isFunction(func)) {\n        return function () {\n          return func(acc.apply(this, arguments));\n        };\n      } else {\n        return func(acc);\n      }\n    }\n\n    if (geo.util.isFunction(acc)) {\n      domain = d3.set(data.map(acc)).values();\n    } else {\n      domain = [acc];\n    }\n    domain.forEach(function (v) {\n      if (!(typeof v === 'string' &&\n            typeof geo.util.convertColor(v) === 'object')) {\n        // This is to handle cases when values are css names or\n        // hex strings.  We don't want to apply a categorical\n        // scale.\n        doNotHandle = false;\n      }\n      if (typeof v === 'string') {\n        categorical = true;\n      } else if (!isFinite(v)) {\n        cannotHandle = true;\n      } else if (+v > max) {\n        max = +v;\n      } else if (+v < min) {\n        min = +v;\n      }\n    });\n    if (cannotHandle) {\n      // At least one value is not a string or a numeric value.\n      // Pass the bare accessor back to geojs to handle it.\n      return acc;\n    }\n    if (doNotHandle) {\n      return acc;\n    }\n    if (categorical) {\n      if (domain.length <= 10) {\n        return wrap(d3.scale.category10().domain(domain));\n      } else if (domain.length <= 20) {\n        return wrap(d3.scale.category20().domain(domain));\n      } else {\n        // TODO: sort domain by most used and make an \"other\" category\n        return wrap(d3.scale.category20().domain(domain));\n      }\n    }\n    // http://colorbrewer2.org/?type=diverging&scheme=RdYlBu&n=3\n    return wrap(d3.scale.linear()\n      .range([\n        'rgb(252,141,89)',\n        'rgb(255,255,191)',\n        'rgb(145,191,219)'\n      ])\n      .domain([\n        min,\n        (min + max) / 2,\n        max\n      ]));\n  }\n\n  /**\n   * @class geojsMap\n   * @memberOf jQuery.fn\n   *\n   * @description Generates a geojs map inside an element.\n   *\n   *\n   * Due to current limitations in geojs, only a single map can be instantiated\n   * on a page.  Trying to create a second map will throw an error\n   * (see issue\n   * <a href=\"https://github.com/OpenGeoscience/geojs/issues/154\">#154</a>).\n   *\n   * @example <caption>Create a map with the default options.</caption>\n   * $(\"#map\").geojsMap();\n   * @example <caption>Create a map with a given initial center and zoom</caption>\n   * $(\"#map\").geojsMap({\n   *    longitude: -125,\n   *    latitude: 35,\n   *    zoom: 5\n   * });\n   * @example <caption>Create a map with points</caption>\n   * $(\"#map\").geojsMap({\n   *   data: [...],\n   *   layers: [{\n   *     renderer: 'vgl',\n   *     features: [{\n   *       type: 'point',\n   *       size: 5,\n   *       position: function (d) { return {x: d.geometry.x, y: d.geometry.y} },\n   *       fillColor: function (d, i) { return i < 5 ? 'red' : 'blue' },\n   *       stroke: false\n   *     }]\n   *   }]\n   * };\n   * @example <caption>Create a map with points, lines and multiple layers</caption>\n   * $(\"#map\").geojsMap({\n   *   center: { x: -130, y: 40 },\n   *   zoom: 3,\n   *   layers: [{\n   *     renderer: 'vgl',\n   *     features: [{\n   *       data: [...],\n   *       type: 'point',\n   *       size: 5,\n   *       position: function (d) { return {x: d.geometry.x, y: d.geometry.y} },\n   *       fillColor: function (d, i) { return i < 5 ? 'red' : 'blue' },\n   *       stroke: false\n   *     }]\n   *   },\n   *   {\n   *      renderer: 'd3',\n   *      features[{\n   *        data: [...],\n   *        type: 'line',\n   *        position: function (d) { return { x: d[0], y: d[1] } },\n   *        line: function (d) { return d.coordinates; },\n   *        strokeWidth: 3,\n   *        strokeColor: 'black',\n   *        strokeOpacity: 0.5\n   *      }]\n   *   }]\n   * };\n   */\n  // jscs:disable requireSpaceBetweenArguments\n  $.widget('geojs.geojsMap', /** @lends jQuery.fn.geojsMap */{\n  // jscs:enable requireSpaceBetweenArguments\n    /**\n     * A coordinate object as accepted by geojs to express positions in an\n     * arbitrary coordinate system (geographic, screen, etc).  Coordinates returned by\n     * geojs methods are always expressed with \"x\" and \"y\" properties, but\n     * it will accept any of the aliased properties.\n     * @typedef coordinate\n     * @type {object}\n     * @property {number} longitude Alias: \"x\", \"lng\", or \"lon\"\n     * @property {number} latitude Alias: \"y\" or \"lat\"\n     * @property {number} [elevation=0] Alias: \"z\", \"elev\", or \"height\"\n     */\n\n    /**\n     * Colors can be expressed in multiple ways:\n     * <ul>\n     *   <li>css name (<code>\"steelblue\"</code>)</li>\n     *   <li>24 bit hex value (<code>0xff0051</code>)</li>\n     *   <li>25 bit hex string (<code>\"#ff0051\"</code>)</li>\n     *   <li>rgb object (values from 0-1, <code>{r: 1, g: 0.5, b: 0}</code>)</li>\n     * </ul>\n     * @typedef color\n     * @type {*}\n     */\n\n    /**\n     * Point feature options object.  All styles can be\n     * given as accessor functions or constants.  Accessor\n     * functions are called with the following signature:\n     * <pre>\n     *     function func(d, i) {\n     *         // d    - data object\n     *         // i    - index of d in the data array\n     *         // this - geo.pointFeature\n     *     }\n     * </pre>\n     * Pass null to remove saved options from previous calls.\n     * @typedef pointOptions\n     * @type {Object}\n     * @property {Object[]} data Data array\n     * @property {coordinate} position Location of the point center\n     * @property {number} radius\n     *  Radius of the circle in pixels (ignored when <code>size</code>\n     *  is present)\n     * @property {number} size\n     *   A numerical value mapped affinely to a radius in the range [5,20]\n     * @property {boolean} fill Presence or absence of the fill\n     * @property {color} fillColor Interior color\n     * @property {float} fillOpacity Opacity of the interior <code>[0,1]</code>\n     * @property {boolean} stroke Presence or absence of the stroke\n     * @property {color} strokeColor Stroke color\n     * @property {float} strokeOpacity Opacity of the stroke <code>[0,1]</code>\n     */\n\n    /**\n     * @instance\n     * @description\n     * Map options (not fully implemented).\n     * @example <caption>Get the current map center</caption>\n     * var center=$(\"#map\").geojsMap(\"center\");\n     * @example <caption>Pan the map to a new center</caption>\n     * $(\"#map\").geojsMap(\"center\", {lat: 10, lng: -100});\n     * @property {object[]} [data=[]] The default data array used for\n     * features/layers not already containing data.\n     * @property {coordinate} [center={lat: 0, lng: 0}] The map center\n     * @property {number} [zoom=0] The zoom level (floating point >= 0)\n     * @property {(number|null)} [width=null]\n     *   The width of the map in pixels or null for 100%\n     * @property {(number|null)} [height=null]\n     *   The height of the map in pixels or null for 100%\n     * @property {geo.layer.spec[]} [layers=[]]\n     *   Describes layers added to the map\n     * @property {boolean} [autoresize=true]\n     *   Resize the map on <code>window.resize</code> (initialization only)\n     */\n    options: {\n      center: {latitude: 0, longitude: 0},\n      zoom: 0,\n      width: null,\n      height: null,\n      layers: [],\n      data: [],\n\n      // These options are for future use, but shouldn't\n      // be changed at the moment, so they aren't documented.\n      baseLayer: 'osm',\n      baseRenderer: 'vgl'\n    },\n\n    /**\n     * Internal constructor\n     * @instance\n     * @protected\n     */\n    _create: function () {\n      if (this._map || !this.element.length) {\n        // when called multiple times on a single element, do nothing\n        return;\n      }\n      if (initialized) {\n        // warn when called multiple times on different elements\n        console.warn(\n          'Geojs already initialized in this window.'\n        );\n        // Try to clean up the old gl context, but this doesn't usually work\n        delete window.gl;\n      }\n      // set global initialization state\n      initialized = true;\n\n      // create the map\n      this._map = geo.map({\n        width: this.options.width,\n        height: this.options.height,\n        zoom: this.options.zoom,\n        center: this.options.center,\n        node: this.element.get(0)\n      });\n\n      // create the base layer\n      this._baseLayer = this._map.createLayer(\n        this.options.baseLayer,\n        {\n          renderer: this.options.baseRenderer\n        }\n      );\n\n      // Trigger a resize to a valid size before adding\n      // the feature layer to handle some of the bugs that\n      // occur when initializing onto a node of size 0.\n      this._resize({width: 800, height: 600});\n\n      this._layers = [];\n      this.update();\n    },\n\n    /**\n     * Update the layers and features using a new array of\n     * {@link geo.layer.spec} objects.  All existing layers\n     * and features are deleted.  If only the data has changed,\n     * you can usually just call {@link jQuery.fn.geojsMap#redraw redraw}.\n     * @instance\n     * @param {geo.layer.spec[]} [layers] New map layers\n     * @example <caption>Delete and recreate all existing layers</caption>\n     * $(\"#map\").geojsMap(\"update\");\n     * @example <caption>Remove all existing feature layers.</caption>\n     * $(\"#map\").geojsMap(\"update\", []);\n     */\n    update: function (layers) {\n      var m_this = this;\n      this.options.layers = layers || this.options.layers || [];\n\n      // delete existing layers\n      this._layers.forEach(function (layer) {\n        layer.clear();\n        m_this._map.deleteLayer(layer);\n      });\n\n      // create new layers\n      this._layers = this.options.layers.map(function (layer) {\n        layer.data = layer.data || m_this.options.data;\n\n        // Until auto color scaling gets moved into geojs core, we will\n        // mutate the spec and replace the color and radius options.\n        (layer.features || []).forEach(function (feature) {\n          var data = feature.data || layer.data || [];\n          var scl;\n          if (feature.type === 'point') {\n            if (feature.size) {\n              feature._size = feature.size;\n            } else if (feature.size === null) {\n              delete feature._size;\n            }\n\n            if (data.length && feature._size) {\n              scl = d3.scale.linear()\n                .domain(\n                  d3.extent(data, feature._size)\n                )\n                .range([5, 20]);\n              feature.radius = function () {\n                // TODO: wrong `this` (wait for style refactor)\n                return scl(feature._size.apply(this, arguments));\n              };\n            }\n            delete feature.size;\n          }\n\n          var key;\n          for (key in feature) {\n            if (feature.hasOwnProperty(key) &&\n                isColorKey(key)) {\n              feature[key] = makeColorScale(data, feature[key]);\n            }\n          }\n        });\n        return geo.layer.create(m_this._map, layer);\n      });\n\n      // trigger an initial draw\n      this.redraw();\n\n      return this;\n    },\n\n    /**\n     * Resize the map canvas.\n     * @instance\n     * @protected\n     * @param {object?} size Explicit size or use this.options.\n     */\n    _resize: function (size) {\n      var width = this.options.width,\n          height = this.options.height;\n      if (size) {\n        width = size.width;\n        height = size.height;\n      }\n      if (!width) {\n        width = this.element.width();\n      }\n      if (!height) {\n        height = this.element.height();\n      }\n      this._map.resize(0, 0, width, height);\n    },\n\n    /**\n     * Do a full redraw of the map.  In general, users shouldn't need to\n     * call this method, but it could be useful when accessing lower\n     * level features of the mapping api.\n     * @todo This function may need to go through each feature and call\n     * {@link geo.feature#modified} to properly update.\n     * @instance\n     */\n    redraw: function () {\n      this._resize();\n      return this;\n    }\n  });\n\n  // Some argument type definitions used only by this plugin:\n  /**\n   * A geojs renderer is one of the following:\n   * <ul>\n   *   <li><code>\"vgl\"</code>: Uses webGL</li>\n   *   <li><code>\"d3\"</code>: Uses svg</li>\n   * </ul>\n   * @typedef renderer\n   * @type {string}\n   */\n\n  };\n\n  $(load);\n})($ || window.$, geo || window.geo, d3 || window.d3);\n"]}
<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> quadDebug = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Run after the DOM loads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;

  <span class="hljs-keyword">var</span> map = geo.map({
    node: <span class="hljs-string">'#map'</span>,
    center: {
      x: <span class="hljs-number">-88.0</span>,
      y: <span class="hljs-number">29</span>
    },
    zoom: <span class="hljs-number">4</span>
  });
  <span class="hljs-keyword">var</span> layer = map.createLayer(<span class="hljs-string">'feature'</span>, {renderer: <span class="hljs-string">'vgl'</span>});
  <span class="hljs-keyword">var</span> quads = layer.createFeature(<span class="hljs-string">'quad'</span>, {selectionAPI: <span class="hljs-literal">true</span>});
  <span class="hljs-keyword">var</span> previewImage = <span class="hljs-keyword">new</span> Image();
  previewImage.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    quads
      .data([{
        ll: {x: <span class="hljs-number">-108</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-88</span>, y: <span class="hljs-number">49</span>},
        image: <span class="hljs-string">'../../data/tilefancy.png'</span>
      }, {
        ll: {x: <span class="hljs-number">-88</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-58</span>, y: <span class="hljs-number">49</span>},
        image: <span class="hljs-string">'flower1.jpg'</span>,
        opacity: <span class="hljs-number">0.75</span>
      }, {
        ul: {x: <span class="hljs-number">-108</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-58</span>, y: <span class="hljs-number">29</span>},
        ll: {x: <span class="hljs-number">-98</span>, y: <span class="hljs-number">9</span>},
        lr: {x: <span class="hljs-number">-68</span>, y: <span class="hljs-number">9</span>},
        previewImage: <span class="hljs-literal">null</span>,
        image: <span class="hljs-string">'flower3.jpg'</span>
      }, {
        lr: {x: <span class="hljs-number">-58</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-58</span>, y: <span class="hljs-number">49</span>},
        ul: {x: <span class="hljs-number">-38</span>, y: <span class="hljs-number">54</span>},
        ll: {x: <span class="hljs-number">-33</span>, y: <span class="hljs-number">34</span>},
        image: <span class="hljs-string">'flower2.jpg'</span>,
        opacity: <span class="hljs-number">0.15</span>
      }, {
        ll: {x: <span class="hljs-number">-33</span>, y: <span class="hljs-number">34</span>},
        lr: {x: <span class="hljs-number">-33</span>, y: <span class="hljs-number">9</span>},
        ur: {x: <span class="hljs-number">-68</span>, y: <span class="hljs-number">9</span>},
        ul: {x: <span class="hljs-number">-58</span>, y: <span class="hljs-number">29</span>},
        image: <span class="hljs-string">'../../data/tilefancy.png'</span>
      }, {
        ll: {x: <span class="hljs-number">-128</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-108</span>, y: <span class="hljs-number">49</span>},
        image: <span class="hljs-string">'../../data/nosuchimage.png'</span>
      }, {
        ul: {x: <span class="hljs-number">-128</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-108</span>, y: <span class="hljs-number">29</span>},
        ll: {x: <span class="hljs-number">-123</span>, y: <span class="hljs-number">9</span>},
        lr: {x: <span class="hljs-number">-98</span>, y: <span class="hljs-number">9</span>},
        previewImage: <span class="hljs-literal">null</span>,
        image: <span class="hljs-string">'../../data/nosuchimage.png'</span>
      }, {
        ul: {x: <span class="hljs-number">-148</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-128</span>, y: <span class="hljs-number">29</span>},
        ll: {x: <span class="hljs-number">-148</span>, y: <span class="hljs-number">9</span>},
        lr: {x: <span class="hljs-number">-123</span>, y: <span class="hljs-number">9</span>},
        previewImage: previewImage,
        image: <span class="hljs-string">'../../data/nosuchimage.png'</span>
      }, {
        ll: {x: <span class="hljs-number">-138</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-128</span>, y: <span class="hljs-number">39</span>},
        color: <span class="hljs-string">'#FF0000'</span>
      }, {
        ll: {x: <span class="hljs-number">-148</span>, y: <span class="hljs-number">39</span>},
        ur: {x: <span class="hljs-number">-138</span>, y: <span class="hljs-number">49</span>},
        color: <span class="hljs-string">'#FF0000'</span>
      }, {
        ll: {x: <span class="hljs-number">-138</span>, y: <span class="hljs-number">39</span>},
        ur: {x: <span class="hljs-number">-128</span>, y: <span class="hljs-number">49</span>},
        color: <span class="hljs-string">'#00FFFF'</span>
      }, {
        ll: {x: <span class="hljs-number">-148</span>, y: <span class="hljs-number">29</span>},
        ur: {x: <span class="hljs-number">-138</span>, y: <span class="hljs-number">39</span>},
        opacity: <span class="hljs-number">0.25</span>,
        color: <span class="hljs-string">'#0000FF'</span>
      <span class="hljs-comment">/* You can specify quads so that the corners are 'twisted' and the quad
       * would be non-convex.  In this case, the quads are each rendered as a
       * pair of triangles, but they probably aren't what is desired.
      }, {
        ll: {x: -108, y: 49},
        lr: {x: -88, y: 49},
        ur: {x: -108, y: 59},
        ul: {x: -88, y: 59},
        image: '../../data/tilefancy.png'
      }, {
        ll: {x: -88, y: 49},
        ur: {x: -68, y: 49},
        ul: {x: -88, y: 59},
        lr: {x: -68, y: 59},
        image: '../../data/tilefancy.png'
      */</span>
      }])
      .style({
        opacity: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
          <span class="hljs-keyword">return</span> d.opacity !== <span class="hljs-literal">undefined</span> ? d.opacity : <span class="hljs-number">1</span>;
        },
        color: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
          <span class="hljs-keyword">return</span> d.color;
        },
        previewColor: {r: <span class="hljs-number">1</span>, g: <span class="hljs-number">0.75</span>, b: <span class="hljs-number">0.75</span>},
        previewImage: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
          <span class="hljs-keyword">return</span> d.previewImage !== <span class="hljs-literal">undefined</span> ? d.previewImage : previewImage;
        }
      })
      .geoOn(geo.event.feature.mouseover, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
        <span class="hljs-keyword">if</span> (evt.data.orig_opacity === <span class="hljs-literal">undefined</span>) {
          evt.data.orig_opacity = (evt.data.opacity || <span class="hljs-literal">null</span>);
        }
        evt.data.opacity = <span class="hljs-number">0.5</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>we either have to clear the internal cache on the item, or have
asked for it not to have been cached to begin with.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">delete</span> evt.data._cachedQuad;
        <span class="hljs-keyword">this</span>.modified();
        layer.map().draw();
      })
      .geoOn(geo.event.feature.mouseout, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
        <span class="hljs-keyword">if</span> (evt.data.orig_opacity === <span class="hljs-literal">undefined</span>) {
          evt.data.orig_opacity = (evt.data.opacity || <span class="hljs-literal">null</span>);
        }
        evt.data.opacity = evt.data.orig_opacity || <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">delete</span> evt.data._cachedQuad;
        <span class="hljs-keyword">this</span>.modified();
        layer.map().draw();
      })
      .draw();

    map.draw();

    quadDebug.map = map;
    quadDebug.layer = layer;
    quadDebug.quads = quads;
  };

  previewImage.src = <span class="hljs-string">'../../data/grid.jpg'</span>;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

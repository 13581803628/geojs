<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>This example should be tried with different query strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/* Many parameters can be adjusted via url query parameters:
 *  clampBoundsX: 'true' to clamp movement in the horizontal direction.
 *  clampBoundsY: 'true' to clamp movement in the vertical direction.
 *  clampZoom: 'true' to clamp zooming out smaller than the window.
 *  debug: 'true' to show tile labels when using the html renderer.  'border'
 *      to draw borders on each tile when using the html renderer.  'all' to
 *      show both labels and borders.  These options just add a class to the
 *      #map element to invoke special css rules.
 *  discrete: 'true' to use discrete zoom.
 *  fade: 'true' to enable image fade in on the html renderer.
 *  h: height of a tiled image (at max zoom).
 *  lower: 'true' (default) or 'false'.  Keep all lower-level tiles if true.
 *      'false' was the old behavior where fewer tiles are rendered, and
 *      panning shows blank areas.
 *  min: minimum zoom level (default is 0).
 *  max: maximum zoom level (default is 16 for maps, or the entire image for
 *      images).
 *  opacity: a css opacity value (typically a float from 0 to 1).
 *  projection: 'parallel' or 'projection' for the camera projection.
 *  renderer: 'vgl' (default), 'd3', 'null', or 'html'.  This picks the
 *      renderer for map tiles.  null or html uses the html renderer.
 *  round: 'round' (default), 'floor', 'ceil'.
 *  subdomains: a comma-separated string of subdomains to use in the {s} part
 *      of the url parameter.  If there are no commas in the string, each letter
 *      is used by itself (e.g., 'abc' is the same as 'a,b,c').
 *  url: url to use for the map files.  Placeholders are allowed.  Default is
 *      http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png .  Other useful
 *      urls are are: /data/tilefancy.png
 *      http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png
 *  w: width of a tiled image (at max zoom).  If w and h are specified, a
 *      variety of other changes are made to make this served in image
 *      coordinates.
 *  wrapX: 'true' to wrap the tiles in the horizontal direction.
 *  wrapY: 'true' to wrap the tiles in the vertical direction.
 *  x: map center x
 *  y: map center y
 *  zoom: starting zoom level
 */</span>

<span class="hljs-keyword">var</span> tileDebug = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Run after the DOM loads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Parse query parameters into an object for ease of access</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> query = <span class="hljs-built_in">document</span>.location.search.replace(<span class="hljs-regexp">/(^\?)/</span>, <span class="hljs-string">''</span>).split(
    <span class="hljs-string">'&amp;'</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
      n = n.split(<span class="hljs-string">'='</span>);
      <span class="hljs-keyword">this</span>[n[<span class="hljs-number">0</span>]] = <span class="hljs-built_in">decodeURIComponent</span>(n[<span class="hljs-number">1</span>]);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }.bind({}))[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Set map defaults to use our named node and have a reasonable center and
zoom level</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> mapParams = {
    node: <span class="hljs-string">'#map'</span>,
    center: {
      x: <span class="hljs-number">-98.0</span>,
      y: <span class="hljs-number">39.5</span>
    },
    zoom: query.zoom !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">parseFloat</span>(query.zoom) : <span class="hljs-number">3</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Set the tile layer defaults to use the specified renderer and opacity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> layerParams = {
    renderer: query.renderer || <span class="hljs-string">'vgl'</span>,
    opacity: query.opacity || <span class="hljs-string">'1'</span>
  };
  <span class="hljs-keyword">if</span> (layerParams.renderer === <span class="hljs-string">'null'</span> || layerParams.renderer === <span class="hljs-string">'html'</span>) {
    layerParams.renderer = <span class="hljs-literal">null</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Allow a custom tile url, including subdomains.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.url) {
    layerParams.url = query.url;
  } <span class="hljs-keyword">else</span> {
    layerParams.baseUrl = <span class="hljs-string">'http://otile1.mqcdn.com/tiles/1.0.0/map/'</span>;
  }
  <span class="hljs-keyword">if</span> (query.subdomains) {
    <span class="hljs-keyword">if</span> (query.subdomains.indexOf(<span class="hljs-string">','</span>) &gt;= <span class="hljs-number">0</span>) {
      layerParams.subdomains = query.subdomains.split(<span class="hljs-string">','</span>);
    } <span class="hljs-keyword">else</span> {
      layerParams.subdomains = query.subdomains;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>For image tile servers, where we know the maximum width and height, use
a pixel coordinate system.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.w &amp;&amp; query.h) {
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>(query.w), h = <span class="hljs-built_in">parseInt</span>(query.h);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Set a pixel coordinate system where 0, 0 is the upper left and w, h is
the lower-right.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* If both ingcs and gcs are set to an empty string '', the coordinates
     * will stay at pixel values, but the y values will from from [0, -h).  If
     * '+proj=longlat +axis=esu', '+proj=longlat +axis=enu' are used instead,
     * the y coordinate will be reversed.  It would be better to install a new
     * 'inverse-y' projection into proj4, but this works without that change.
     * The 'longlat' projection functionally is a no-op in this case. */</span>
    mapParams.ingcs = <span class="hljs-string">'+proj=longlat +axis=esu'</span>;
    mapParams.gcs = <span class="hljs-string">'+proj=longlat +axis=enu'</span>;
    <span class="hljs-comment">/* mapParams.ingcs = mapParams.gcs = ''; */</span>
    mapParams.maxBounds = {left: <span class="hljs-number">0</span>, top: <span class="hljs-number">0</span>, right: w, bottom: h};
    mapParams.center = {x: w / <span class="hljs-number">2</span>, y: h / <span class="hljs-number">2</span>};
    mapParams.max = <span class="hljs-built_in">Math</span>.ceil(<span class="hljs-built_in">Math</span>.log(<span class="hljs-built_in">Math</span>.max(w, h) / <span class="hljs-number">256</span>) / <span class="hljs-built_in">Math</span>.log(<span class="hljs-number">2</span>));
    mapParams.clampBoundsX = mapParams.clampBoundsY = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>unitsPerPixel is at zoom level 0.  We want each pixel to be 1 at the
maximum zoom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mapParams.unitsPerPixel = <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, mapParams.max);
    layerParams.maxLevel = mapParams.max;
    layerParams.wrapX = layerParams.wrapY = <span class="hljs-literal">false</span>;
    layerParams.tileOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> {x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>};
    };
    layerParams.attribution = <span class="hljs-string">''</span>;
    layerParams.tileRounding = <span class="hljs-built_in">Math</span>.ceil;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Parse additional query options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.x !== <span class="hljs-literal">undefined</span>) {
    mapParams.center.x = <span class="hljs-built_in">parseFloat</span>(query.x);
  }
  <span class="hljs-keyword">if</span> (query.y !== <span class="hljs-literal">undefined</span>) {
    mapParams.center.y = <span class="hljs-built_in">parseFloat</span>(query.y);
  }
  <span class="hljs-keyword">if</span> (query.min !== <span class="hljs-literal">undefined</span>) {
    mapParams.min = <span class="hljs-built_in">parseFloat</span>(query.min);
  }
  <span class="hljs-keyword">if</span> (query.max !== <span class="hljs-literal">undefined</span>) {
    mapParams.max = <span class="hljs-built_in">parseFloat</span>(query.max);
    <span class="hljs-keyword">if</span> (!layerParams.maxLevel) {
      layerParams.maxLevel = mapParams.max;
    }
  }
  <span class="hljs-keyword">if</span> (query.round) {
    layerParams.tileRounding = <span class="hljs-built_in">Math</span>[query.round];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Populate boolean flags for the map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $.each({
      clampBoundsX: <span class="hljs-string">'clampBoundsX'</span>,
      clampBoundsY: <span class="hljs-string">'clampBoundsY'</span>,
      clampZoom: <span class="hljs-string">'clampZoom'</span>,
      discrete: <span class="hljs-string">'discreteZoom'</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">qkey, mkey</span>) </span>{
      <span class="hljs-keyword">if</span> (query[qkey] !== <span class="hljs-literal">undefined</span>) {
        mapParams[mkey] = query[qkey] === <span class="hljs-string">'true'</span>;
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Populate boolean flags for the tile layer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $.each({
      clampBoundsX: <span class="hljs-string">'clampBoundsX'</span>,
      lower: <span class="hljs-string">'keepLower'</span>,
      wrapX: <span class="hljs-string">'wrapX'</span>,
      wrapY: <span class="hljs-string">'wrapY'</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">qkey, lkey</span>) </span>{
      <span class="hljs-keyword">if</span> (query[qkey] !== <span class="hljs-literal">undefined</span>) {
        layerParams[lkey] = query[qkey] === <span class="hljs-string">'true'</span>;
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create a map object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> map = geo.map(mapParams);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Set the projection.  This has to be set on the camera, not in the map
parameters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.projection) {
    map.camera().projection = query.projection;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Enable debug classes, if requested.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'#map'</span>).toggleClass(<span class="hljs-string">'debug-label'</span>, (
      query.debug === <span class="hljs-string">'true'</span> || query.debug === <span class="hljs-string">'all'</span>))
    .toggleClass(<span class="hljs-string">'debug-border'</span>, (
      query.debug === <span class="hljs-string">'border'</span> || query.debug === <span class="hljs-string">'all'</span>))
    .toggleClass(<span class="hljs-string">'fade-image'</span>, (query.fade === <span class="hljs-string">'true'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Add the tile layer with the specified parameters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> osmLayer = map.createLayer(<span class="hljs-string">'osm'</span>, layerParams);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Make variables available as a global for easier debug</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tileDebug.map = map;
  tileDebug.mapParams = mapParams;
  tileDebug.layerParams = layerParams;
  tileDebug.osmLayer = osmLayer;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

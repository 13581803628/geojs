<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* globals $, geo, utils */</span>

<span class="hljs-keyword">var</span> annotationDebug = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Run after the DOM loads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;

  <span class="hljs-keyword">var</span> layer, fromButtonSelect;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>get the query parameters and set controls appropriately</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> query = utils.getQuery();
  $(<span class="hljs-string">'#clickadd'</span>).prop(<span class="hljs-string">'checked'</span>, query.clickadd !== <span class="hljs-string">'false'</span>);
  $(<span class="hljs-string">'#keepadding'</span>).prop(<span class="hljs-string">'checked'</span>, query.keepadding === <span class="hljs-string">'true'</span>);
  <span class="hljs-keyword">if</span> (query.lastannotation) {
    $(<span class="hljs-string">'.annotationtype button'</span>).removeClass(<span class="hljs-string">'lastused'</span>);
    $(<span class="hljs-string">'.annotationtype button#'</span> + query.lastannotation).addClass(<span class="hljs-string">'lastused'</span>);
  }

  $(<span class="hljs-string">'#controls'</span>).on(<span class="hljs-string">'change'</span>, change_controls);
  $(<span class="hljs-string">'#controls'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'a'</span>, select_control);
  $(<span class="hljs-string">'.annotationtype button'</span>).on(<span class="hljs-string">'click'</span>, select_annotation);
  $(<span class="hljs-string">'#editdialog'</span>).on(<span class="hljs-string">'submit'</span>, edit_update);

  $(<span class="hljs-string">'#controls'</span>).toggleClass(<span class="hljs-string">'no-controls'</span>, query.controls === <span class="hljs-string">'false'</span>);

  <span class="hljs-keyword">var</span> map = geo.map({
    <span class="hljs-attr">node</span>: <span class="hljs-string">'#map'</span>,
    <span class="hljs-attr">center</span>: {
      <span class="hljs-attr">x</span>: query.x ? +query.x : <span class="hljs-number">-119.5420833</span>,
      <span class="hljs-attr">y</span>: query.y ? +query.y : <span class="hljs-number">37.4958333</span>
    },
    <span class="hljs-attr">zoom</span>: query.zoom ? +query.zoom : <span class="hljs-number">8</span>,
    <span class="hljs-attr">rotation</span>: query.rotation ? +query.rotation * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span> : <span class="hljs-number">0</span>
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>allow some query parameters without controls to specify what map we will
show</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.map !== <span class="hljs-string">'false'</span>) {
    <span class="hljs-keyword">if</span> (query.map !== <span class="hljs-string">'satellite'</span>) {
      annotationDebug.mapLayer = map.createLayer(<span class="hljs-string">'osm'</span>);
    }
    <span class="hljs-keyword">if</span> (query.map === <span class="hljs-string">'satellite'</span> || query.map === <span class="hljs-string">'dual'</span>) {
      annotationDebug.satelliteLayer = map.createLayer(<span class="hljs-string">'osm'</span>, {<span class="hljs-attr">url</span>: <span class="hljs-string">'http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.png'</span>, <span class="hljs-attr">opacity</span>: query.map === <span class="hljs-string">'dual'</span> ? <span class="hljs-number">0.25</span> : <span class="hljs-number">1</span>});
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>create an annotation layer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  layer = map.createLayer(<span class="hljs-string">'annotation'</span>, {
    <span class="hljs-attr">renderer</span>: query.renderer ? (query.renderer === <span class="hljs-string">'html'</span> ? <span class="hljs-literal">null</span> : query.renderer) : <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">annotations</span>: query.renderer ? <span class="hljs-literal">undefined</span> : geo.listAnnotations()
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>bind to the mouse click and annotation mode events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  layer.geoOn(geo.event.mouseclick, mouseClickToStart);
  layer.geoOn(geo.event.annotation.mode, handleModeChange);
  layer.geoOn(geo.event.annotation.add, handleAnnotationChange);
  layer.geoOn(geo.event.annotation.remove, handleAnnotationChange);
  layer.geoOn(geo.event.annotation.state, handleAnnotationChange);

  map.draw();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>pick which button is initially highlighted based on query parameters.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (query.lastused || query.active) {
    <span class="hljs-keyword">if</span> (query.active) {
      layer.mode(query.active);
    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'.annotationtype button'</span>).removeClass(<span class="hljs-string">'lastused active'</span>);
      $(<span class="hljs-string">'.annotationtype button#'</span> + query.lastused).addClass(<span class="hljs-string">'lastused'</span>);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>expose some internal parameters so you can examine them from the console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  annotationDebug.map = map;
  annotationDebug.layer = layer;
  annotationDebug.query = query;

  <span class="hljs-comment">/**
   * When the mouse is clicked, switch adding an annotation if appropriate.
   *
   * @param {geo.event} evt geojs event.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mouseClickToStart</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">if</span> (evt.handled || query.clickadd === <span class="hljs-string">'false'</span>) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (evt.buttonsDown.left) {
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.annotationtype button.lastused'</span>).hasClass(<span class="hljs-string">'active'</span>) &amp;&amp; query.keepadding === <span class="hljs-string">'true'</span>) {
        <span class="hljs-keyword">return</span>;
      }
      select_button(<span class="hljs-string">'.annotationtype button.lastused'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (evt.buttonsDown.right) {
      select_button(<span class="hljs-string">'.annotationtype button#'</span> +
                    $(<span class="hljs-string">'.annotationtype button.lastused'</span>).attr(<span class="hljs-string">'next'</span>));
    }
  }

  <span class="hljs-comment">/**
   * Handle changes to our controls.
   *
   * @param evt jquery evt that triggered this call.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change_controls</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> ctl = $(evt.target),
        param = ctl.attr(<span class="hljs-string">'param-name'</span>),
        value = ctl.val();
    <span class="hljs-keyword">if</span> (ctl.is(<span class="hljs-string">'[type="checkbox"]'</span>)) {
      value = ctl.is(<span class="hljs-string">':checked'</span>) ? <span class="hljs-string">'true'</span> : <span class="hljs-string">'false'</span>;
    }
    <span class="hljs-keyword">if</span> (value === <span class="hljs-string">''</span> &amp;&amp; ctl.attr(<span class="hljs-string">'placeholder'</span>)) {
      value = ctl.attr(<span class="hljs-string">'placeholder'</span>);
    }
    <span class="hljs-keyword">if</span> (!param || value === query[param]) {
      <span class="hljs-keyword">return</span>;
    }
    query[param] = value;
    <span class="hljs-keyword">if</span> (value === <span class="hljs-string">''</span> || (ctl.attr(<span class="hljs-string">'placeholder'</span>) &amp;&amp;
        value === ctl.attr(<span class="hljs-string">'placeholder'</span>))) {
      <span class="hljs-keyword">delete</span> query[param];
    }
    utils.setQuery(query);
  }

  <span class="hljs-comment">/**
   * Handle selecting an annotation button.
   *
   * @param evt jquery evt that triggered this call.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select_annotation</span>(<span class="hljs-params">evt</span>) </span>{
    select_button(evt.target);
  }

  <span class="hljs-comment">/**
   * Select an annotation button by jquery selector.
   *
   * @param {object} ctl a jquery selector or element.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select_button</span>(<span class="hljs-params">ctl</span>) </span>{
    ctl = $(ctl);
    <span class="hljs-keyword">var</span> wasactive = ctl.hasClass(<span class="hljs-string">'active'</span>),
        id = ctl.attr(<span class="hljs-string">'id'</span>);
    fromButtonSelect = <span class="hljs-literal">true</span>;
    layer.mode(wasactive ? <span class="hljs-literal">null</span> : id);
    fromButtonSelect = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">/**
   * When the annotation mode changes, update the controls to reflect it.
   *
   * @param {geo.event} evt a geojs mode change event.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleModeChange</span>(<span class="hljs-params">evt</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>highlight the current buttons based on the current mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> mode = layer.mode();
    $(<span class="hljs-string">'.annotationtype button'</span>).removeClass(<span class="hljs-string">'active'</span>);
    <span class="hljs-keyword">if</span> (mode) {
      $(<span class="hljs-string">'.annotationtype button'</span>).removeClass(<span class="hljs-string">'lastused active'</span>);
      $(<span class="hljs-string">'.annotationtype button#'</span> + mode).addClass(<span class="hljs-string">'lastused active'</span>);
    }
    $(<span class="hljs-string">'#instructions'</span>).attr(
      <span class="hljs-string">'annotation'</span>, $(<span class="hljs-string">'.annotationtype button.active'</span>).attr(<span class="hljs-string">'id'</span>) || <span class="hljs-string">'none'</span>);
    query.active = $(<span class="hljs-string">'.annotationtype button.active'</span>).attr(<span class="hljs-string">'id'</span>) || <span class="hljs-literal">undefined</span>;
    query.lastused = query.active ? <span class="hljs-literal">undefined</span> : $(<span class="hljs-string">'.annotationtype button.lastused'</span>).attr(<span class="hljs-string">'id'</span>);
    utils.setQuery(query);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>if we are in keep-adding mode, and the mode changed to null, and that
wasn’t caused by clicking the button, reenable the annotation mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!mode &amp;&amp; !fromButtonSelect &amp;&amp; query.keepadding === <span class="hljs-string">'true'</span>) {
      layer.mode($(<span class="hljs-string">'.annotationtype button.lastused'</span>).attr(<span class="hljs-string">'id'</span>));
    }
  }

  <span class="hljs-comment">/**
   * When an annotation is created or removed, update our list of annotations.
   *
   * @param {geo.event} evt a geojs mode change event.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleAnnotationChange</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> annotations = layer.annotations();
    <span class="hljs-keyword">var</span> ids = annotations.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">annotation</span>) </span>{
      <span class="hljs-keyword">return</span> annotation.id();
    });
    <span class="hljs-keyword">var</span> present = [];
    $(<span class="hljs-string">'#annotationlist .entry'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> entry = $(<span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">if</span> (entry.attr(<span class="hljs-string">'id'</span>) === <span class="hljs-string">'sample'</span>) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">var</span> id = entry.attr(<span class="hljs-string">'annotation-id'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Remove deleted annotations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ($.inArray(id, ids) &lt; <span class="hljs-number">0</span>) {
        entry.remove();
        <span class="hljs-keyword">return</span>;
      }
      present.push(id);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>update existing elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      entry.find(<span class="hljs-string">'.entry-name'</span>).text(layer.annotationById(id).name());
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Add if new and fully created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.each(ids, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">idx, id</span>) </span>{
      <span class="hljs-keyword">if</span> ($.inArray(id, present) &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">var</span> annotation = layer.annotationById(id);
      <span class="hljs-keyword">if</span> (annotation.state() === geo.annotation.state.create) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">var</span> entry = $(<span class="hljs-string">'#annotationlist .entry#sample'</span>).clone();
      entry.attr({<span class="hljs-attr">id</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'annotation-id'</span>: id});
      entry.find(<span class="hljs-string">'.entry-name'</span>).text(annotation.name());
      $(<span class="hljs-string">'#annotationlist'</span>).append(entry);
    });
    $(<span class="hljs-string">'#annotationheader'</span>).css(
        <span class="hljs-string">'display'</span>, $(<span class="hljs-string">'#annotationlist .entry'</span>).length &lt;= <span class="hljs-number">1</span> ? <span class="hljs-string">'none'</span> : <span class="hljs-string">'block'</span>);
  }

  <span class="hljs-comment">/**
   * Handle selecting a control.
   *
   * @param evt jquery evt that triggered this call.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select_control</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> mode,
        ctl = $(evt.target),
        action = ctl.attr(<span class="hljs-string">'action'</span>),
        id = ctl.closest(<span class="hljs-string">'.entry'</span>).attr(<span class="hljs-string">'annotation-id'</span>),
        annotation = layer.annotationById(id);
    <span class="hljs-keyword">switch</span> (action) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'edit'</span>:
        show_edit_dialog(id, annotation);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'remove'</span>:
        layer.removeAnnotation(annotation);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'remove-all'</span>:
        fromButtonSelect = <span class="hljs-literal">true</span>;
        mode = layer.mode();
        layer.mode(<span class="hljs-literal">null</span>);
        layer.removeAllAnnotations();
        layer.mode(mode);
        fromButtonSelect = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-comment">/**
   * Show the edit dialog for a particular annotation.
   *
   * @param {number} id the annotation id to edit.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_edit_dialog</span>(<span class="hljs-params">id</span>) </span>{
    <span class="hljs-keyword">var</span> annotation = layer.annotationById(id),
        type = annotation.type(),
        typeMatch = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'(^| )'</span> + type + <span class="hljs-string">'( |$)'</span>),
        opt = annotation.options(),
        dlg = $(<span class="hljs-string">'#editdialog'</span>);

    $(<span class="hljs-string">'#edit-validation-error'</span>, dlg).text(<span class="hljs-string">''</span>);
    dlg.attr(<span class="hljs-string">'annotation-id'</span>, id);
    dlg.attr(<span class="hljs-string">'annotation-type'</span>, type);
    $(<span class="hljs-string">'[option="name"]'</span>, dlg).val(annotation.name());
    $(<span class="hljs-string">'.form-group[annotation-types]'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> ctl = $(<span class="hljs-keyword">this</span>),
          key = $(<span class="hljs-string">'[option]'</span>, ctl).attr(<span class="hljs-string">'option'</span>),
          format = $(<span class="hljs-string">'[option]'</span>, ctl).attr(<span class="hljs-string">'format'</span>),
          value;
      <span class="hljs-keyword">if</span> (!ctl.attr(<span class="hljs-string">'annotation-types'</span>).match(typeMatch)) {
        <span class="hljs-keyword">return</span>;
      }
      value = opt.style[key];
      <span class="hljs-keyword">switch</span> (format) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'color'</span>:
          value = geo.util.convertColor(value);
          <span class="hljs-keyword">if</span> (!value.r &amp;&amp; !value.g &amp;&amp; !value.b) {
            value = <span class="hljs-string">'#000000'</span>;
          } <span class="hljs-keyword">else</span> {
            value = <span class="hljs-string">'#'</span> + ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24</span>) + (<span class="hljs-built_in">Math</span>.round(value.r * <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">16</span>) +
                           (<span class="hljs-built_in">Math</span>.round(value.g * <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">8</span>) +
                            <span class="hljs-built_in">Math</span>.round(value.b * <span class="hljs-number">255</span>)).toString(<span class="hljs-number">16</span>).slice(<span class="hljs-number">1</span>);
          }
          <span class="hljs-keyword">break</span>;
      }
      $(<span class="hljs-string">'[option]'</span>, ctl).val(<span class="hljs-string">''</span> + value);
    });
    dlg.one(<span class="hljs-string">'shown.bs.modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      $(<span class="hljs-string">'[option="name"]'</span>, dlg).focus();
    });
    dlg.modal();
  }

  <span class="hljs-comment">/**
   * Update an annotation from values in the edit dialog.
   *
   * @param evt jquery evt that triggered this call.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit_update</span>(<span class="hljs-params">evt</span>) </span>{
    evt.preventDefault();
    <span class="hljs-keyword">var</span> dlg = $(<span class="hljs-string">'#editdialog'</span>),
        id = dlg.attr(<span class="hljs-string">'annotation-id'</span>),
        annotation = layer.annotationById(id),
        type = annotation.type(),
        typeMatch = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'(^| )'</span> + type + <span class="hljs-string">'( |$)'</span>),
        error,
        newopt = {};

    $(<span class="hljs-string">'.form-group[annotation-types]'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> ctl = $(<span class="hljs-keyword">this</span>),
          key = $(<span class="hljs-string">'[option]'</span>, ctl).attr(<span class="hljs-string">'option'</span>),
          value;
      <span class="hljs-keyword">if</span> (!ctl.attr(<span class="hljs-string">'annotation-types'</span>).match(typeMatch)) {
        <span class="hljs-keyword">return</span>;
      }
      value = $(<span class="hljs-string">'[option]'</span>, ctl).val();
      <span class="hljs-keyword">switch</span> ($(<span class="hljs-string">'[option]'</span>, ctl).attr(<span class="hljs-string">'format'</span>)) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'boolean'</span>:
          value = (<span class="hljs-string">''</span> + value).toLowerCase() === <span class="hljs-string">'true'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'color'</span>:
          value = geo.util.convertColor(value);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'opacity'</span>:
          value = +value;
          <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span> || value &gt; <span class="hljs-number">1</span> || <span class="hljs-built_in">isNaN</span>(value)) {
            error = $(<span class="hljs-string">'label'</span>, ctl).text() + <span class="hljs-string">' must be a between 0 and 1, inclusive.'</span>;
          }
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'positive'</span>:
          value = +value;
          <span class="hljs-keyword">if</span> (value &lt;= <span class="hljs-number">0</span> || <span class="hljs-built_in">isNaN</span>(value)) {
            error = $(<span class="hljs-string">'label'</span>, ctl).text() + <span class="hljs-string">' must be a positive number.'</span>;
          }
          <span class="hljs-keyword">break</span>;
      }
      newopt[key] = value;
    });
    <span class="hljs-keyword">if</span> (error) {
      $(<span class="hljs-string">'#edit-validation-error'</span>, dlg).text(error);
      <span class="hljs-keyword">return</span>;
    }
    annotation.name($(<span class="hljs-string">'[option="name"]'</span>, dlg).val());
    annotation.options({<span class="hljs-attr">style</span>: newopt}).draw();

    dlg.modal(<span class="hljs-string">'hide'</span>);
    handleAnnotationChange();
  }
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
